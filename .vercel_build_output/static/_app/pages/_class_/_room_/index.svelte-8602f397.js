var ot=Object.defineProperty;var Se=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable;var Ae=(n,e,o)=>e in n?ot(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o,J=(n,e)=>{for(var o in e||(e={}))rt.call(e,o)&&Ae(n,o,e[o]);if(Se)for(var o of Se(e))nt.call(e,o)&&Ae(n,o,e[o]);return n};import{S as K,i as Q,s as Z,G as ue,H as ce,I as fe,J as de,x as g,u as $,T as st,O as N,M as Y,ab as we,aa as Pe,ag as lt,ah as at,ai as it,P as ut,aj as ct,ak as Ie,D as B,A as _e,al as ft,am as Le,j as E,m as C,o as U,v as W,V as x,k as V,n as z,f as D,r as q,w as O,a2 as dt,d as b,t as ee,g as te,an as oe,ao as re,a as F,b as w,a7 as pe,K as ne,e as se,c as le,ap as he,aq as Ee,X as ye,a9 as Ce,af as Ue,ac as De,ad as ht,l as H,W as We,ae as mt,ar as ge,as as Fe,at as Me,au as _t,av as pt,aw as gt,ax as me,ay as ae,L as ve}from"../../../chunks/vendor-55a52f70.js";import{f as bt,a as kt}from"../../../chunks/database-a36dd1eb.js";import{d as Ne,r as be,u as Be,b as Te,c as Re,a as je}from"../../../chunks/store-2964d983.js";import{d as ke,a as Ve,p as $t,l as ze}from"../../../chunks/canvas-dc2dc66e.js";import{g as wt}from"../../../chunks/navigation-51f4a605.js";import"../../../chunks/singletons-12a22614.js";const yt=n=>({boardDoc:n&4,isFetchingStrokes:n&2,strokesArray:n&1}),qe=n=>({boardDoc:n[2],fetchStrokes:n[3],listenToStrokes:n[4],isFetchingStrokes:n[1],strokesArray:n[0],handleNewlyDrawnStroke:n[5],deleteAllStrokesFromDb:n[6]});function Dt(n){let e;const o=n[9].default,t=ue(o,n,n[8],qe);return{c(){t&&t.c()},l(r){t&&t.l(r)},m(r,s){t&&t.m(r,s),e=!0},p(r,[s]){t&&t.p&&(!e||s&263)&&ce(t,o,r,r[8],e?de(o,r[8],s,yt):fe(r[8]),qe)},i(r){e||(g(t,r),e=!0)},o(r){$(t,r),e=!1},d(r){t&&t.d(r)}}}function Oe(n){const e=J({id:n.id},n.data());return e.startTime=0,e.endTime=0,n.data().isErasing||(e.endTime+=.5),e}function vt(n,e,o){let{$$slots:t={},$$scope:r}=e,{dbPath:s}=e,l,i=!1,a,c;const h=st(N(),`${s}/strokes`),u=Y(N(),s);we(u,y=>{o(2,a=J({id:y.id},y.data()))}),Pe(()=>{c&&c()});async function f(){o(1,i=!0),o(0,l=await bt(s+"/strokes"))}async function d(){o(1,i=!0);const y=lt(h,at("timestamp"));c=we(y,async T=>{T.docChanges().filter(A=>A.type==="removed").length>0?(o(0,l=[]),await it(),T.docs.length>0&&T.docs.forEach(A=>{l.push(Oe(A))})):(l||(o(1,i=!1),o(0,l=[])),T.docs.length===l.length||T.docChanges().filter(A=>A.type==="added").forEach(A=>{o(0,l=[...l,Oe(A.doc)])}))})}function _(y){l.push(y);try{ut(Y(N(),`${s}/strokes/${y.id}`),J({timestamp:ct()},y))}catch(T){alert(T)}}async function P(){const y=[];let T=Ie(N()),L=0;for(const A of l){L>=500&&(y.push(T.commit()),T=Ie(N()),L=0);const X=Y(N(),`${s}/strokes/${A.id}`);T.delete(X),L+=1}y.push(T.commit()),console.log("number of strokes =",l.length),console.log("number of batches to be deleted =",L),await Promise.all(y)}return n.$$set=y=>{"dbPath"in y&&o(7,s=y.dbPath),"$$scope"in y&&o(8,r=y.$$scope)},[l,i,a,f,d,_,P,s,r,t]}class Tt extends K{constructor(e){super();Q(this,e,vt,Dt,Z,{dbPath:7})}}const Rt=n=>({currentTime:n&1}),He=n=>({startRecording:n[1],stopRecording:n[2],currentTime:n[0]});function St(n){let e;const o=n[4].default,t=ue(o,n,n[3],He);return{c(){t&&t.c()},l(r){t&&t.l(r)},m(r,s){t&&t.m(r,s),e=!0},p(r,[s]){t&&t.p&&(!e||s&9)&&ce(t,o,r,r[3],e?de(o,r[3],s,Rt):fe(r[3]),He)},i(r){e||(g(t,r),e=!0)},o(r){$(t,r),e=!1},d(r){t&&t.d(r)}}}function At(n,e,o){let t;B(n,Ne,f=>o(7,t=f));let{$$slots:r={},$$scope:s}=e,l=0,i;_e(()=>{window.MediaRecorder=ft});const a=Le();let c=null;function h(){return new Promise(async f=>{if(!t){const _=await navigator.mediaDevices.getUserMedia({audio:!0});Ne.set(_)}const d=t.clone();c=new MediaRecorder(d),c.start(),i=setInterval(()=>o(0,l+=.1),100),a("record-start"),be.set("mid_record"),f()})}function u(){return new Promise((f,d)=>{clearTimeout(i),be.set("post_record"),c.addEventListener("dataavailable",_=>{const P=_.data;a("record-end",{audioBlob:P}),f(),be.set("pre_record")}),c.stop();for(const _ of c.stream.getTracks())_.stop()})}return n.$$set=f=>{"$$scope"in f&&o(3,s=f.$$scope)},[l,h,u,s,r]}class Pt extends K{constructor(e){super();Q(this,e,At,St,Z,{})}}function Xe(n,e,o){const t=n.slice();return t[5]=e[o],t}function It(n){let e,o,t,r,s,l,i,a;return{c(){e=oe("svg"),o=oe("g"),t=oe("path"),r=oe("polygon"),l=oe("path"),i=oe("path"),this.h()},l(c){e=re(c,"svg",{preserveAspectRatio:!0,version:!0,id:!0,xmlns:!0,"xmlns:xlink":!0,x:!0,y:!0,width:!0,height:!0,":viewbox":!0,style:!0,"xml:space":!0});var h=F(e);o=re(h,"g",{});var u=F(o);t=re(u,"path",{d:!0}),F(t).forEach(b),r=re(u,"polygon",{style:!0,points:!0}),F(r).forEach(b),l=re(u,"path",{style:!0,d:!0}),F(l).forEach(b),i=re(u,"path",{style:!0,d:!0}),F(i).forEach(b),u.forEach(b),h.forEach(b),this.h()},h(){w(t,"d",`M0,0v72.377c0,1.588,0.234,3.169,0.698,4.706l45.416,150.032C46.633,228.828,48.212,230,50,230s3.367-1.172,3.886-2.883\r
          L99.31,77.079c0.457-1.525,0.69-3.108,0.69-4.702V0.002`),w(r,"style",s=`fill: ${n[5]};`),w(r,"points","50,211.978 38.879,175.24 61.122,175.24"),pe(l,"fill","#424242"),w(l,"d",`M63.581,167.118H36.42L8.765,75.761l10.924-9.63l12.5,11.015c1.54,1.353,3.835,1.35,5.375-0.002\r
            l12.468-11.007l12.464,11.005c1.54,1.357,3.839,1.357,5.377,0l12.465-11.005l10.9,9.623L63.581,167.118z`),w(i,"style",a=`fill: ${n[5]};`),w(i,"d",`M91.878,0v65.486l-8.852-7.813c-1.539-1.353-3.838-1.354-5.377,0.002L65.185,68.679L52.72,57.674\r
            c-1.539-1.356-3.838-1.354-5.377-0.002L34.871,68.683L22.375,57.67c-0.769-0.676-1.725-1.013-2.685-1.013\r
            c-0.959,0-1.919,0.339-2.685,1.013L8.121,65.5L8.098,0.024L91.878,0z`),w(e,"preserveAspectRatio","none"),w(e,"version","1.1"),w(e,"id","Layer_1"),w(e,"xmlns","http://www.w3.org/2000/svg"),w(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),w(e,"x","0px"),w(e,"y","0px"),w(e,"width","16px"),w(e,"height","35px"),w(e,":viewbox","`0 0 100 230`"),pe(e,"enable-background","new 0 0 100 230"),w(e,"xml:space","preserve")},m(c,h){D(c,e,h),ne(e,o),ne(o,t),ne(o,r),ne(o,l),ne(o,i)},p(c,h){h&1&&s!==(s=`fill: ${c[5]};`)&&w(r,"style",s),h&1&&a!==(a=`fill: ${c[5]};`)&&w(i,"style",a)},d(c){c&&b(e)}}}function Ye(n){let e,o;function t(){return n[2](n[5])}return e=new x({props:{$$slots:{default:[It]},$$scope:{ctx:n}}}),e.$on("click",t),{c(){E(e.$$.fragment)},l(r){C(e.$$.fragment,r)},m(r,s){U(e,r,s),o=!0},p(r,s){n=r;const l={};s&17&&(l.$$scope={dirty:s,ctx:n}),e.$set(l)},i(r){o||(g(e.$$.fragment,r),o=!0)},o(r){$(e.$$.fragment,r),o=!1},d(r){W(e,r)}}}function Lt(n){let e;return{c(){e=ee("Eraser")},l(o){e=te(o,"Eraser")},m(o,t){D(o,e,t)},d(o){o&&b(e)}}}function Et(n){let e,o,t,r,s=n[0].pencilColors,l=[];for(let h=0;h<s.length;h+=1)l[h]=Ye(Xe(n,s,h));const i=h=>$(l[h],1,1,()=>{l[h]=null});o=new x({props:{$$slots:{default:[Lt]},$$scope:{ctx:n}}}),o.$on("click",n[3]);const a=n[1].default,c=ue(a,n,n[4],null);return{c(){for(let h=0;h<l.length;h+=1)l[h].c();e=V(),E(o.$$.fragment),t=V(),c&&c.c()},l(h){for(let u=0;u<l.length;u+=1)l[u].l(h);e=z(h),C(o.$$.fragment,h),t=z(h),c&&c.l(h)},m(h,u){for(let f=0;f<l.length;f+=1)l[f].m(h,u);D(h,e,u),U(o,h,u),D(h,t,u),c&&c.m(h,u),r=!0},p(h,[u]){if(u&1){s=h[0].pencilColors;let d;for(d=0;d<s.length;d+=1){const _=Xe(h,s,d);l[d]?(l[d].p(_,u),g(l[d],1)):(l[d]=Ye(_),l[d].c(),g(l[d],1),l[d].m(e.parentNode,e))}for(q(),d=s.length;d<l.length;d+=1)i(d);O()}const f={};u&16&&(f.$$scope={dirty:u,ctx:h}),o.$set(f),c&&c.p&&(!r||u&16)&&ce(c,a,h,h[4],r?de(a,h[4],u,null):fe(h[4]),null)},i(h){if(!r){for(let u=0;u<s.length;u+=1)g(l[u]);g(o.$$.fragment,h),g(c,h),r=!0}},o(h){l=l.filter(Boolean);for(let u=0;u<l.length;u+=1)$(l[u]);$(o.$$.fragment,h),$(c,h),r=!1},d(h){dt(l,h),h&&b(e),W(o,h),h&&b(t),c&&c.d(h)}}}function Ct(n,e,o){let t;B(n,Be,a=>o(0,t=a));let{$$slots:r={},$$scope:s}=e;const l=a=>Te.set({type:"pencil",color:a,lineWidth:3}),i=()=>Te.set({type:"eraser",color:"",lineWidth:40});return n.$$set=a=>{"$$scope"in a&&o(4,s=a.$$scope)},[t,r,l,i,s]}class Ut extends K{constructor(e){super();Q(this,e,Ct,Et,Z,{})}}function Ge(){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let o=0;o<20;o++)e+=n.charAt(Math.floor(Math.random()*n.length));return e}function Wt(n){let e;const o=n[11].default,t=ue(o,n,n[13],null);return{c(){t&&t.c()},l(r){t&&t.l(r)},m(r,s){t&&t.m(r,s),e=!0},p(r,s){t&&t.p&&(!e||s&8192)&&ce(t,o,r,r[13],e?de(o,r[13],s,null):fe(r[13]),null)},i(r){e||(g(t,r),e=!0)},o(r){$(t,r),e=!1},d(r){t&&t.d(r)}}}function Ft(n){let e,o,t,r,s,l,i;return e=new Ut({props:{$$slots:{default:[Wt]},$$scope:{ctx:n}}}),{c(){E(e.$$.fragment),o=V(),t=se("canvas"),this.h()},l(a){C(e.$$.fragment,a),o=z(a),t=le(a,"CANVAS",{style:!0});var c=F(t);c.forEach(b),this.h()},h(){w(t,"style",r=`background-color: #2e3131; width: ${n[2]}; height: ${n[1]}`)},m(a,c){U(e,a,c),D(a,o,c),D(a,t,c),n[12](t),s=!0,l||(i=[he(t,"touchstart",n[3]),he(t,"touchmove",n[4]),he(t,"touchend",n[5])],l=!0)},p(a,[c]){const h={};c&8192&&(h.$$scope={dirty:c,ctx:a}),e.$set(h),(!s||c&6&&r!==(r=`background-color: #2e3131; width: ${a[2]}; height: ${a[1]}`))&&w(t,"style",r)},i(a){s||(g(e.$$.fragment,a),s=!0)},o(a){$(e.$$.fragment,a),s=!1},d(a){W(e,a),a&&b(o),a&&b(t),n[12](null),l=!1,Ee(i)}}}function Mt(n){return(n.endTime-n.startTime)/n.points.length}function Nt(n,e,o){let t,r,s;B(n,Te,m=>o(17,t=m)),B(n,Re,m=>o(1,r=m)),B(n,je,m=>o(2,s=m));let{$$slots:l={},$$scope:i}=e,{strokesArray:a}=e,{currentTime:c=0}=e;const h=Le();let u,f=[],d,_=!1,P={x:-1,y:-1},y={points:[]},T;_e(()=>{o(8,u=d.getContext("2d"))});function L(m){m.touches.length>1||(m.touches[0].touchType,S(m,{isInitialContact:!0}))}function A(m){if(!!_){if(m.touches.length>1){console.log("touchmove ignored: only 1 finger allowed");return}m.touches[0].touchType,S(m,{isInitialContact:!1})}}function X(m){!_||m.touches.length>0||(m.changedTouches[0].touchType,p(y),_=!1)}function k(m){_=!0,P={x:-1,y:-1},y={strokeNumber:a.length+1,startTime:Number(c.toFixed(1)),color:t.color,lineWidth:t.lineWidth,isErasing:t.type==="eraser",points:[],sessionID:"123"}}function S(m,{isInitialContact:I}){m.preventDefault(),I&&k();const M=v(m);j(m,M)}function j(m,I){y.points.push({unitX:parseFloat(I.x/d.width).toFixed(4),unitY:parseFloat(I.y/d.height).toFixed(4)}),P.x!==-1&&P.y!==-1&&Ve([R(P),R(I)],1,t.type==="eraser",u,t.color,t.lineWidth,d),P=I}function p(m){m.endTime=Number(c.toFixed(1)),m.id=Ge(),f.push(m),h("stroke-drawn",{newStroke:m})}function v(m){const{left:I,top:M}=d.getBoundingClientRect();return{x:m.touches[0].pageX-I-window.scrollX,y:m.touches[0].pageY-M-window.scrollY}}function R({x:m,y:I}){return{unitX:m/d.width,unitY:I/d.height}}function ie(){u.clearRect(0,0,d.scrollWidth,d.scrollHeight)}function $e(m){ye[m?"unshift":"push"](()=>{d=m,o(0,d),o(8,u),o(2,s),o(1,r),o(6,a)})}return n.$$set=m=>{"strokesArray"in m&&o(6,a=m.strokesArray),"currentTime"in m&&o(7,c=m.currentTime),"$$scope"in m&&o(13,i=m.$$scope)},n.$$.update=()=>{if(n.$$.dirty&327&&u){o(0,d.width=s,d),o(0,d.height=r,d);for(const m of a)ke(m,null,u,d)}if(n.$$.dirty&1857&&u){let m=f.length,I=a.length;if(m!==I)if(m<I)if(m===0){for(const M of a)ke(M,null,u,d);o(9,f=[...a])}else for(let M=m;M<I;M++){const G=a[M];ke(G,G.startTime!==G.endTime?Mt(G):null,u,d),f.push(G)}else{let M=function(){ie(),o(9,f=[]),P={x:-1,y:-1};for(const tt of a)ke(tt,null,u,d)};(function(){console.log("debounced board reset"),T&&clearTimeout(T),o(10,T=setTimeout(M,1e3))})()}}},[d,r,s,L,A,X,a,c,u,f,T,l,$e,i]}class Bt extends K{constructor(e){super();Q(this,e,Nt,Ft,Z,{strokesArray:6,currentTime:7})}}function jt(n){let e,o,t,r,s,l,i,a,c;const h=n[10].default,u=ue(h,n,n[9],null);return{c(){u&&u.c(),e=V(),o=se("canvas"),r=V(),s=se("audio"),this.h()},l(f){u&&u.l(f),e=z(f),o=le(f,"CANVAS",{style:!0});var d=F(o);d.forEach(b),r=z(f),s=le(f,"AUDIO",{src:!0,style:!0});var _=F(s);_.forEach(b),this.h()},h(){w(o,"style",t=`background-color: #2e3131; width: ${n[3]}; height: ${n[2]}`),Ce(s.src,l=n[0])||w(s,"src",l),s.controls=!0,pe(s,"width","100%")},m(f,d){u&&u.m(f,d),D(f,e,d),D(f,o,d),n[11](o),D(f,r,d),D(f,s,d),n[12](s),i=!0,a||(c=[he(s,"play",n[5]),he(s,"seeking",n[6])],a=!0)},p(f,[d]){u&&u.p&&(!i||d&512)&&ce(u,h,f,f[9],i?de(h,f[9],d,null):fe(f[9]),null),(!i||d&12&&t!==(t=`background-color: #2e3131; width: ${f[3]}; height: ${f[2]}`))&&w(o,"style",t),(!i||d&1&&!Ce(s.src,l=f[0]))&&w(s,"src",l)},i(f){i||(g(u,f),i=!0)},o(f){$(u,f),i=!1},d(f){u&&u.d(f),f&&b(e),f&&b(o),n[11](null),f&&b(r),f&&b(s),n[12](null),a=!1,Ee(c)}}}let Vt=1;function zt(n){return(n.endTime-n.startTime)/n.points.length}function qt(n,e,o){let t,r;B(n,Re,p=>o(2,t=p)),B(n,je,p=>o(3,r=p));let{$$slots:s={},$$scope:l}=e,{strokesArray:i}=e,{audioDownloadURL:a}=e,c,h=0,u,f,d,_;Pe(()=>{_&&clearTimeout(_)}),_e(()=>{o(8,f=u.getContext("2d"));const p=[];for(let v=0;v<i.length;v++)for(let R=1;R<i[v].points.length;R++){const ie={strokeIndex:v,pointIndex:R};p.push(J({startTime:P(ie)},ie))}c=p.sort((v,R)=>v.startTime-R.startTime)});function P({strokeIndex:p,pointIndex:v}){const R=i[p];return R.startTime+(v-1)*zt(R)}function y(){h=0,f.clearRect(0,0,r,t),T()}function T(){if(!!d&&(L(),h<c.length)){const p=c[h],v=1e3*(p.startTime-d.currentTime);_=setTimeout(T,v/Vt)}}function L(){if(!d)return;const p=c[h];(!p||p.startTime>d.currentTime)&&(f.clearRect(0,0,u.width,u.height),h=0),A()}function A(){const{currentTime:p}=d;for(let v=h;v<c.length;v++){const R=c[v];if(R.startTime>p)break;X(R),h+=1}}function X({strokeIndex:p,pointIndex:v}){const R=i[p],$e=R.lineWidth*(u.scrollWidth/1e3);Ve(R.points,v,R.isErasing,f,R.color,$e,u)}function k(){return new Promise(async p=>{_?(h=0,L()):A(),p()})}function S(p){ye[p?"unshift":"push"](()=>{u=p,o(4,u),o(8,f),o(1,d),o(3,r),o(2,t)})}function j(p){ye[p?"unshift":"push"](()=>{d=p,o(1,d)})}return n.$$set=p=>{"strokesArray"in p&&o(7,i=p.strokesArray),"audioDownloadURL"in p&&o(0,a=p.audioDownloadURL),"$$scope"in p&&o(9,l=p.$$scope)},n.$$.update=()=>{n.$$.dirty&270&&f&&d&&(o(4,u.width=r,u),o(4,u.height=t,u),k())},[a,d,t,r,u,y,L,i,f,l,s,S,j]}class Ot extends K{constructor(e){super();Q(this,e,qt,jt,Z,{strokesArray:7,audioDownloadURL:0})}}function Je(n,e,o){const t=n.slice();return t[18]=e[o],t}function Ke(n){let e,o,t,r=[],s=new Map,l,i,a,c;o=new We({props:{value:n[0].name,style:"width: 100%"}}),o.$on("input",n[10]);let h=n[0].blackboards;const u=f=>f[18];for(let f=0;f<h.length;f+=1){let d=Je(n,h,f),_=u(d);s.set(_,r[f]=et(_,d))}return{c(){e=se("div"),E(o.$$.fragment),t=V();for(let f=0;f<r.length;f+=1)r[f].c();this.h()},l(f){e=le(f,"DIV",{style:!0,class:!0});var d=F(e);C(o.$$.fragment,d),t=z(d);for(let _=0;_<r.length;_+=1)r[_].l(d);d.forEach(b),this.h()},h(){pe(e,"height","100vh"),w(e,"class","svelte-8vfgqd"),Ue(e,"question-room",n[0].name.charAt(n[0].name.length-1)==="?")},m(f,d){D(f,e,d),U(o,e,null),ne(e,t);for(let _=0;_<r.length;_+=1)r[_].m(e,null);i=!0,a||(c=De(l=$t.call(null,e,"main-content")),a=!0)},p(f,d){const _={};d[0]&1&&(_.value=f[0].name),o.$set(_),d[0]&2061500655&&(h=f[0].blackboards,q(),r=ht(r,d,u,1,f,h,s,e,mt,et,null,Je),O()),d[0]&1&&Ue(e,"question-room",f[0].name.charAt(f[0].name.length-1)==="?")},i(f){if(!i){g(o.$$.fragment,f);for(let d=0;d<h.length;d+=1)g(r[d]);i=!0}},o(f){$(o.$$.fragment,f);for(let d=0;d<r.length;d+=1)$(r[d]);i=!1},d(f){f&&b(e),W(o);for(let d=0;d<r.length;d+=1)r[d].d();a=!1,c()}}}function Qe(n){let e,o,t,r,s,l;function i(...u){return n[11](n[18],...u)}e=new We({props:{textarea:!0,value:n[21].description||""}}),e.$on("input",i);const a=[Xt,Ht],c=[];function h(u,f){return u[21].audioDownloadURL?0:1}return t=h(n),r=c[t]=a[t](n),{c(){E(e.$$.fragment),o=V(),r.c(),s=H()},l(u){C(e.$$.fragment,u),o=z(u),r.l(u),s=H()},m(u,f){U(e,u,f),D(u,o,f),c[t].m(u,f),D(u,s,f),l=!0},p(u,f){n=u;const d={};f[0]&2097152&&(d.value=n[21].description||""),e.$set(d);let _=t;t=h(n),t===_?c[t].p(n,f):(q(),$(c[_],1,1,()=>{c[_]=null}),O(),r=c[t],r?r.p(n,f):(r=c[t]=a[t](n),r.c()),g(r,1),r.m(s.parentNode,s))},i(u){l||(g(e.$$.fragment,u),g(r),l=!0)},o(u){$(e.$$.fragment,u),$(r),l=!1},d(u){W(e,u),u&&b(o),c[t].d(u),u&&b(s)}}}function Ht(n){let e,o,t,r,s,l,i=n[25]&&Ze(n);return{c(){e=se("div"),i&&i.c(),this.h()},l(a){e=le(a,"DIV",{style:!0});var c=F(e);i&&i.l(c),c.forEach(b),this.h()},h(){w(e,"style",o=`width: 100%; height: ${n[1]+80}px`)},m(a,c){D(a,e,c),i&&i.m(e,null),r=!0,s||(l=De(t=ze.call(null,e,n[23])),s=!0)},p(a,c){a[25]?i?(i.p(a,c),c[0]&33554432&&g(i,1)):(i=Ze(a),i.c(),g(i,1),i.m(e,null)):i&&(q(),$(i,1,1,()=>{i=null}),O()),(!r||c[0]&2&&o!==(o=`width: 100%; height: ${a[1]+80}px`))&&w(e,"style",o),t&&ae(t.update)&&c[0]&8388608&&t.update.call(null,a[23])},i(a){r||(g(i),r=!0)},o(a){$(i),r=!1},d(a){a&&b(e),i&&i.d(),s=!1,l()}}}function Xt(n){let e,o,t,r,s,l,i=n[25]&&xe(n);return{c(){e=se("div"),i&&i.c(),this.h()},l(a){e=le(a,"DIV",{style:!0});var c=F(e);i&&i.l(c),c.forEach(b),this.h()},h(){w(e,"style",o=`width: 100%; height: ${n[1]+80}px`)},m(a,c){D(a,e,c),i&&i.m(e,null),r=!0,s||(l=De(t=ze.call(null,e,n[22])),s=!0)},p(a,c){a[25]?i?(i.p(a,c),c[0]&33554432&&g(i,1)):(i=xe(a),i.c(),g(i,1),i.m(e,null)):i&&(q(),$(i,1,1,()=>{i=null}),O()),(!r||c[0]&2&&o!==(o=`width: 100%; height: ${a[1]+80}px`))&&w(e,"style",o),t&&ae(t.update)&&c[0]&4194304&&t.update.call(null,a[22])},i(a){r||(g(i),r=!0)},o(a){$(i),r=!1},d(a){a&&b(e),i&&i.d(),s=!1,l()}}}function Ze(n){let e,o;function t(...r){return n[13](n[18],...r)}return e=new Pt({props:{$$slots:{default:[eo,({startRecording:r,stopRecording:s,currentTime:l})=>({28:r,29:s,30:l}),({startRecording:r,stopRecording:s,currentTime:l})=>[(r?268435456:0)|(s?536870912:0)|(l?1073741824:0)]]},$$scope:{ctx:n}}}),e.$on("record-end",t),{c(){E(e.$$.fragment)},l(r){C(e.$$.fragment,r)},m(r,s){U(e,r,s),o=!0},p(r,s){n=r;const l={};s[0]&2046820356|s[1]&1&&(l.$$scope={dirty:s,ctx:n}),e.$set(l)},i(r){o||(g(e.$$.fragment,r),o=!0)},o(r){$(e.$$.fragment,r),o=!1},d(r){W(e,r)}}}function Yt(n){let e;return{c(){e=ee("Uploading...")},l(o){e=te(o,"Uploading...")},m(o,t){D(o,e,t)},p:ve,i:ve,o:ve,d(o){o&&b(e)}}}function Gt(n){let e,o;return e=new x({props:{$$slots:{default:[Kt]},$$scope:{ctx:n}}}),e.$on("click",function(){ae(n[29])&&n[29].apply(this,arguments)}),{c(){E(e.$$.fragment)},l(t){C(e.$$.fragment,t)},m(t,r){U(e,t,r),o=!0},p(t,r){n=t;const s={};r[1]&1&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){$(e.$$.fragment,t),o=!1},d(t){W(e,t)}}}function Jt(n){let e,o,t,r;return e=new x({props:{$$slots:{default:[Qt]},$$scope:{ctx:n}}}),e.$on("click",function(){ae(n[28])&&n[28].apply(this,arguments)}),t=new x({props:{$$slots:{default:[Zt]},$$scope:{ctx:n}}}),t.$on("click",function(){ae(n[27])&&n[27].apply(this,arguments)}),{c(){E(e.$$.fragment),o=V(),E(t.$$.fragment)},l(s){C(e.$$.fragment,s),o=z(s),C(t.$$.fragment,s)},m(s,l){U(e,s,l),D(s,o,l),U(t,s,l),r=!0},p(s,l){n=s;const i={};l[1]&1&&(i.$$scope={dirty:l,ctx:n}),e.$set(i);const a={};l[1]&1&&(a.$$scope={dirty:l,ctx:n}),t.$set(a)},i(s){r||(g(e.$$.fragment,s),g(t.$$.fragment,s),r=!0)},o(s){$(e.$$.fragment,s),$(t.$$.fragment,s),r=!1},d(s){W(e,s),s&&b(o),W(t,s)}}}function Kt(n){let e;return{c(){e=ee("Stop")},l(o){e=te(o,"Stop")},m(o,t){D(o,e,t)},d(o){o&&b(e)}}}function Qt(n){let e;return{c(){e=ee("Record")},l(o){e=te(o,"Record")},m(o,t){D(o,e,t)},d(o){o&&b(e)}}}function Zt(n){let e;return{c(){e=ee("Wipe board")},l(o){e=te(o,"Wipe board")},m(o,t){D(o,e,t)},d(o){o&&b(e)}}}function xt(n){let e,o,t,r;const s=[Jt,Gt,Yt],l=[];function i(a,c){return a[2]==="pre_record"?0:a[2]==="mid_record"?1:2}return e=i(n),o=l[e]=s[e](n),{c(){o.c(),t=H()},l(a){o.l(a),t=H()},m(a,c){l[e].m(a,c),D(a,t,c),r=!0},p(a,c){let h=e;e=i(a),e===h?l[e].p(a,c):(q(),$(l[h],1,1,()=>{l[h]=null}),O(),o=l[e],o?o.p(a,c):(o=l[e]=s[e](a),o.c()),g(o,1),o.m(t.parentNode,t))},i(a){r||(g(o),r=!0)},o(a){$(o),r=!1},d(a){l[e].d(a),a&&b(t)}}}function eo(n){let e,o;function t(...r){return n[12](n[26],...r)}return e=new Bt({props:{strokesArray:n[25],currentTime:n[30],$$slots:{default:[xt]},$$scope:{ctx:n}}}),e.$on("stroke-drawn",t),{c(){E(e.$$.fragment)},l(r){C(e.$$.fragment,r)},m(r,s){U(e,r,s),o=!0},p(r,s){n=r;const l={};s[0]&33554432&&(l.strokesArray=n[25]),s[0]&1073741824&&(l.currentTime=n[30]),s[0]&939524100|s[1]&1&&(l.$$scope={dirty:s,ctx:n}),e.$set(l)},i(r){o||(g(e.$$.fragment,r),o=!0)},o(r){$(e.$$.fragment,r),o=!1},d(r){W(e,r)}}}function xe(n){let e,o;return e=new Ot({props:{strokesArray:n[25],audioDownloadURL:n[21].audioDownloadURL,$$slots:{default:[oo]},$$scope:{ctx:n}}}),{c(){E(e.$$.fragment)},l(t){C(e.$$.fragment,t)},m(t,r){U(e,t,r),o=!0},p(t,r){const s={};r[0]&33554432&&(s.strokesArray=t[25]),r[0]&2097152&&(s.audioDownloadURL=t[21].audioDownloadURL),r[0]&2097152|r[1]&1&&(s.$$scope={dirty:r,ctx:t}),e.$set(s)},i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){$(e.$$.fragment,t),o=!1},d(t){W(e,t)}}}function to(n){let e;return{c(){e=ee("Revert to board")},l(o){e=te(o,"Revert to board")},m(o,t){D(o,e,t)},d(o){o&&b(e)}}}function oo(n){let e,o;return e=new x({props:{$$slots:{default:[to]},$$scope:{ctx:n}}}),e.$on("click",function(){ae(n[7](n[21]))&&n[7](n[21]).apply(this,arguments)}),{c(){E(e.$$.fragment)},l(t){C(e.$$.fragment,t)},m(t,r){U(e,t,r),o=!0},p(t,r){n=t;const s={};r[1]&1&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){$(e.$$.fragment,t),o=!1},d(t){W(e,t)}}}function ro(n){let e,o,t=n[21]&&Qe(n);return{c(){t&&t.c(),e=V()},l(r){t&&t.l(r),e=z(r)},m(r,s){t&&t.m(r,s),D(r,e,s),o=!0},p(r,s){r[21]?t?(t.p(r,s),s[0]&2097152&&g(t,1)):(t=Qe(r),t.c(),g(t,1),t.m(e.parentNode,e)):t&&(q(),$(t,1,1,()=>{t=null}),O())},i(r){o||(g(t),o=!0)},o(r){$(t),o=!1},d(r){t&&t.d(r),r&&b(e)}}}function et(n,e){let o,t,r;return t=new Tt({props:{dbPath:e[3]+e[18],$$slots:{default:[ro,({boardDoc:s,fetchStrokes:l,listenToStrokes:i,isFetchingStrokes:a,strokesArray:c,handleNewlyDrawnStroke:h,deleteAllStrokesFromDb:u})=>({21:s,22:l,23:i,24:a,25:c,26:h,27:u}),({boardDoc:s,fetchStrokes:l,listenToStrokes:i,isFetchingStrokes:a,strokesArray:c,handleNewlyDrawnStroke:h,deleteAllStrokesFromDb:u})=>[(s?2097152:0)|(l?4194304:0)|(i?8388608:0)|(a?16777216:0)|(c?33554432:0)|(h?67108864:0)|(u?134217728:0)]]},$$scope:{ctx:e}}}),{key:n,first:null,c(){o=H(),E(t.$$.fragment),this.h()},l(s){o=H(),C(t.$$.fragment,s),this.h()},h(){this.first=o},m(s,l){D(s,o,l),U(t,s,l),r=!0},p(s,l){e=s;const i={};l[0]&1&&(i.dbPath=e[3]+e[18]),l[0]&182452231|l[1]&1&&(i.$$scope={dirty:l,ctx:e}),t.$set(i)},i(s){r||(g(t.$$.fragment,s),r=!0)},o(s){$(t.$$.fragment,s),r=!1},d(s){s&&b(o),W(t,s)}}}function no(n){let e,o,t=n[0]&&Ke(n);return{c(){t&&t.c(),e=H()},l(r){t&&t.l(r),e=H()},m(r,s){t&&t.m(r,s),D(r,e,s),o=!0},p(r,s){r[0]?t?(t.p(r,s),s[0]&1&&g(t,1)):(t=Ke(r),t.c(),g(t,1),t.m(e.parentNode,e)):t&&(q(),$(t,1,1,()=>{t=null}),O())},i(r){o||(g(t),o=!0)},o(r){$(t),o=!1},d(r){t&&t.d(r),r&&b(e)}}}function mo({page:n}){return{props:{classID:n.params.class,roomID:n.params.room}}}function so(n,e,o){let t,r,s;B(n,Be,k=>o(14,t=k)),B(n,Re,k=>o(1,r=k)),B(n,be,k=>o(2,s=k));let{classID:l}=e,{roomID:i}=e,a;const c=`classes/${l}/blackboards/`,h=`classes/${l}/rooms/`,u=Y(N(),h+i);t.uid||(console.log("redirecting to tutorial"),wt("/"));async function f(k){console.log("e =",k.srcElement.value);const{value:S}=k.srcElement;await ge(u,{name:S})}async function d(k,S){const{value:j}=k.srcElement,p=Y(N(),c+S);await ge(p,{description:j})}_e(async()=>{we(u,k=>{o(0,a=J({id:k.id},k.data()))})});async function _(){o(0,a=await kt(h+i))}async function P(k,S){console.log("saveVideo(), audioBlob =",k);const j=Fe(),p=Me(j,`audio/${Ge()}`);await _t(p,k);const v=await pt(p),R=Y(N(),c+S);await ge(R,{creatorUID:t.uid,creatorPhoneNumber:t.phoneNumber,date:new Date().toISOString(),audioDownloadURL:v,audioRefFullPath:p.fullPath})}async function y({id:k,audioRefFullPath:S}){const j=Y(N(),c+k),p=Me(Fe(),S),v=[];v.push(gt(p)),v.push(ge(j,{creator:me(),creatorPhoneNumber:me(),date:me(),audioDownloadURL:me(),audioRefFullPath:me()})),await Promise.all(v)}const T=k=>f(k),L=(k,S)=>d(S,k),A=(k,S)=>k(S.detail.newStroke),X=(k,S)=>P(S.detail.audioBlob,k);return n.$$set=k=>{"classID"in k&&o(8,l=k.classID),"roomID"in k&&o(9,i=k.roomID)},n.$$.update=()=>{n.$$.dirty[0]&512&&_()},[a,r,s,c,f,d,P,y,l,i,T,L,A,X]}class _o extends K{constructor(e){super();Q(this,e,so,no,Z,{classID:8,roomID:9},null,[-1,-1])}}export{_o as default,mo as load};

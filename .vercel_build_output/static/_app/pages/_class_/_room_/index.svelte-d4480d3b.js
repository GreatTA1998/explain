var qe=Object.defineProperty;var we=Object.getOwnPropertySymbols;var Je=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable;var ye=(n,e,o)=>e in n?qe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o,x=(n,e)=>{for(var o in e||(e={}))Je.call(e,o)&&ye(n,o,e[o]);if(we)for(var o of we(e))Ge.call(e,o)&&ye(n,o,e[o]);return n};import{S as Y,i as H,s as q,G as ae,H as ce,I as ue,J as fe,x as g,u as b,T as Ke,O as F,M as de,ab as De,aa as Te,af as Qe,ag as Ze,ah as xe,P as et,ai as tt,aj as ve,D as ee,A as me,ak as ot,al as Se,V as te,j as I,m as P,o as C,v as E,k as B,l as z,n as j,f as w,r as M,w as N,d as h,a2 as rt,t as oe,g as re,am as J,an as G,a as U,b as y,a7 as _e,K as ne,e as K,c as Q,ac as le,ao as se,ap as V,aq as Re,X as ge,a9 as Ae,L as O,ad as nt,ae as lt,ar as st,as as it,at,au as ct,av as ut}from"../../../chunks/vendor-569078ae.js";import{f as ft,a as Le}from"../../../chunks/database-66f37af8.js";import{d as Ie,r as he,u as Pe,c as ke}from"../../../chunks/store-27550397.js";import{p as dt,l as Ce}from"../../../chunks/actions-31a3ae93.js";import{g as mt}from"../../../chunks/navigation-51f4a605.js";import"../../../chunks/singletons-12a22614.js";const _t=n=>({boardDoc:n&4,isFetchingStrokes:n&2,strokesArray:n&1}),Ee=n=>({boardDoc:n[2],fetchStrokes:n[3],listenToStrokes:n[4],isFetchingStrokes:n[1],strokesArray:n[0],handleNewlyDrawnStroke:n[5],deleteAllStrokesFromDb:n[6]});function ht(n){let e;const o=n[9].default,t=ae(o,n,n[8],Ee);return{c(){t&&t.c()},l(r){t&&t.l(r)},m(r,l){t&&t.m(r,l),e=!0},p(r,[l]){t&&t.p&&(!e||l&263)&&ce(t,o,r,r[8],e?fe(o,r[8],l,_t):ue(r[8]),Ee)},i(r){e||(g(t,r),e=!0)},o(r){b(t,r),e=!1},d(r){t&&t.d(r)}}}function Ue(n){const e=x({id:n.id},n.data());return e.startTime=0,e.endTime=0,n.data().isErasing||(e.endTime+=.5),e}function pt(n,e,o){let{$$slots:t={},$$scope:r}=e,{dbPath:l}=e,a,u=!1,c,i;const f=Ke(F(),`${l}/strokes`),s=de(F(),l);De(s,$=>{o(2,c=x({id:$.id},$.data()))}),Te(()=>{i&&i()});async function d(){o(1,u=!0),o(0,a=await ft(l+"/strokes"))}async function p(){o(1,u=!0);const $=Qe(f,Ze("timestamp"));i=De($,async D=>{D.docChanges().filter(R=>R.type==="removed").length>0?(o(0,a=[]),await xe(),D.docs.length>0&&D.docs.forEach(R=>{a.push(Ue(R))})):(a||(o(1,u=!1),o(0,a=[])),D.docs.length===a.length||D.docChanges().filter(R=>R.type==="added").forEach(R=>{o(0,a=[...a,Ue(R.doc)])}))})}function _($){a.push($);try{et(de(F(),`${l}/strokes/${$.id}`),x({timestamp:tt()},$))}catch(D){alert(D)}}async function S(){const $=[];let D=ve(F()),L=0;for(const R of a){L>=500&&($.push(D.commit()),D=ve(F()),L=0);const k=de(F(),`${l}/strokes/${R.id}`);D.delete(k),L+=1}$.push(D.commit()),console.log("number of strokes =",a.length),console.log("number of batches to be deleted =",L),await Promise.all($)}return n.$$set=$=>{"dbPath"in $&&o(7,l=$.dbPath),"$$scope"in $&&o(8,r=$.$$scope)},[a,u,c,d,p,_,S,l,r,t]}class gt extends Y{constructor(e){super();H(this,e,pt,ht,q,{dbPath:7})}}const kt=n=>({}),We=n=>({startRecording:n[0],stopRecording:n[1]});function bt(n){let e;const o=n[3].default,t=ae(o,n,n[2],We);return{c(){t&&t.c()},l(r){t&&t.l(r)},m(r,l){t&&t.m(r,l),e=!0},p(r,[l]){t&&t.p&&(!e||l&4)&&ce(t,o,r,r[2],e?fe(o,r[2],l,kt):ue(r[2]),We)},i(r){e||(g(t,r),e=!0)},o(r){b(t,r),e=!1},d(r){t&&t.d(r)}}}function $t(n,e,o){let t;ee(n,Ie,f=>o(5,t=f));let{$$slots:r={},$$scope:l}=e;me(()=>{window.MediaRecorder=ot});const a=Se();let u=null;function c(){return new Promise(async f=>{if(!t){const d=await navigator.mediaDevices.getUserMedia({audio:!0});Ie.set(d)}const s=t.clone();u=new MediaRecorder(s),u.start(),a("record-start"),he.set("mid_record"),f()})}function i(){return new Promise((f,s)=>{he.set("post_record"),u.addEventListener("dataavailable",d=>{const p=d.data;a("record-end",{audioBlob:p}),f(),he.set("pre_record")}),u.stop();for(const d of u.stream.getTracks())d.stop()})}return n.$$set=f=>{"$$scope"in f&&o(2,l=f.$$scope)},[c,i,l,r]}class wt extends Y{constructor(e){super();H(this,e,$t,bt,q,{})}}function ze(n,e,o){const t=n.slice();return t[5]=e[o],t}function yt(n){let e;return{c(){e=oe("Eraser")},l(o){e=re(o,"Eraser")},m(o,t){w(o,e,t)},d(o){o&&h(e)}}}function Dt(n){let e,o,t,r,l,a,u,c,i;return{c(){e=J("svg"),o=J("g"),t=J("path"),r=J("polygon"),a=J("path"),u=J("path"),i=B(),this.h()},l(f){e=G(f,"svg",{preserveAspectRatio:!0,version:!0,id:!0,xmlns:!0,"xmlns:xlink":!0,x:!0,y:!0,width:!0,height:!0,":viewbox":!0,style:!0,"xml:space":!0});var s=U(e);o=G(s,"g",{});var d=U(o);t=G(d,"path",{d:!0}),U(t).forEach(h),r=G(d,"polygon",{style:!0,points:!0}),U(r).forEach(h),a=G(d,"path",{style:!0,d:!0}),U(a).forEach(h),u=G(d,"path",{style:!0,d:!0}),U(u).forEach(h),d.forEach(h),s.forEach(h),i=j(f),this.h()},h(){y(t,"d",`M0,0v72.377c0,1.588,0.234,3.169,0.698,4.706l45.416,150.032C46.633,228.828,48.212,230,50,230s3.367-1.172,3.886-2.883\r
          L99.31,77.079c0.457-1.525,0.69-3.108,0.69-4.702V0.002`),y(r,"style",l=`fill: ${n[5]};`),y(r,"points","50,211.978 38.879,175.24 61.122,175.24"),_e(a,"fill","#424242"),y(a,"d",`M63.581,167.118H36.42L8.765,75.761l10.924-9.63l12.5,11.015c1.54,1.353,3.835,1.35,5.375-0.002\r
            l12.468-11.007l12.464,11.005c1.54,1.357,3.839,1.357,5.377,0l12.465-11.005l10.9,9.623L63.581,167.118z`),y(u,"style",c=`fill: ${n[5]};`),y(u,"d",`M91.878,0v65.486l-8.852-7.813c-1.539-1.353-3.838-1.354-5.377,0.002L65.185,68.679L52.72,57.674\r
            c-1.539-1.356-3.838-1.354-5.377-0.002L34.871,68.683L22.375,57.67c-0.769-0.676-1.725-1.013-2.685-1.013\r
            c-0.959,0-1.919,0.339-2.685,1.013L8.121,65.5L8.098,0.024L91.878,0z`),y(e,"preserveAspectRatio","none"),y(e,"version","1.1"),y(e,"id","Layer_1"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),y(e,"x","0px"),y(e,"y","0px"),y(e,"width","16px"),y(e,"height","35px"),y(e,":viewbox","`0 0 100 230`"),_e(e,"enable-background","new 0 0 100 230"),y(e,"xml:space","preserve")},m(f,s){w(f,e,s),ne(e,o),ne(o,t),ne(o,r),ne(o,a),ne(o,u),w(f,i,s)},p(f,s){s&1&&l!==(l=`fill: ${f[5]};`)&&y(r,"style",l),s&1&&c!==(c=`fill: ${f[5]};`)&&y(u,"style",c)},d(f){f&&h(e),f&&h(i)}}}function Me(n){let e,o;function t(){return n[3](n[5])}return e=new te({props:{$$slots:{default:[Dt]},$$scope:{ctx:n}}}),e.$on("click",t),{c(){I(e.$$.fragment)},l(r){P(e.$$.fragment,r)},m(r,l){C(e,r,l),o=!0},p(r,l){n=r;const a={};l&17&&(a.$$scope={dirty:l,ctx:n}),e.$set(a)},i(r){o||(g(e.$$.fragment,r),o=!0)},o(r){b(e.$$.fragment,r),o=!1},d(r){E(e,r)}}}function Tt(n){let e,o,t,r,l;e=new te({props:{$$slots:{default:[yt]},$$scope:{ctx:n}}}),e.$on("click",n[2]);const a=n[1].default,u=ae(a,n,n[4],null);let c=n[0].pencilColors,i=[];for(let s=0;s<c.length;s+=1)i[s]=Me(ze(n,c,s));const f=s=>b(i[s],1,1,()=>{i[s]=null});return{c(){I(e.$$.fragment),o=B(),u&&u.c(),t=B();for(let s=0;s<i.length;s+=1)i[s].c();r=z()},l(s){P(e.$$.fragment,s),o=j(s),u&&u.l(s),t=j(s);for(let d=0;d<i.length;d+=1)i[d].l(s);r=z()},m(s,d){C(e,s,d),w(s,o,d),u&&u.m(s,d),w(s,t,d);for(let p=0;p<i.length;p+=1)i[p].m(s,d);w(s,r,d),l=!0},p(s,[d]){const p={};if(d&16&&(p.$$scope={dirty:d,ctx:s}),e.$set(p),u&&u.p&&(!l||d&16)&&ce(u,a,s,s[4],l?fe(a,s[4],d,null):ue(s[4]),null),d&1){c=s[0].pencilColors;let _;for(_=0;_<c.length;_+=1){const S=ze(s,c,_);i[_]?(i[_].p(S,d),g(i[_],1)):(i[_]=Me(S),i[_].c(),g(i[_],1),i[_].m(r.parentNode,r))}for(M(),_=c.length;_<i.length;_+=1)f(_);N()}},i(s){if(!l){g(e.$$.fragment,s),g(u,s);for(let d=0;d<c.length;d+=1)g(i[d]);l=!0}},o(s){b(e.$$.fragment,s),b(u,s),i=i.filter(Boolean);for(let d=0;d<i.length;d+=1)b(i[d]);l=!1},d(s){E(e,s),s&&h(o),u&&u.d(s),s&&h(t),rt(i,s),s&&h(r)}}}function vt(n,e,o){let t;ee(n,Pe,c=>o(0,t=c));let{$$slots:r={},$$scope:l}=e;const a=()=>ke.set({type:"eraser",color:"",lineWidth:40}),u=c=>ke.set({type:"pencil",color:c,lineWidth:3});return n.$$set=c=>{"$$scope"in c&&o(4,l=c.$$scope)},[t,r,a,u,l]}class St extends Y{constructor(e){super();H(this,e,vt,Tt,q,{})}}function pe({points:n,color:e,lineWidth:o,isErasing:t},r=null,l,a){return new Promise(async u=>{for(let c=1;c<n.length;c++)be(n,c,t,l,e,o,a),r!==null&&await new Promise(i=>setTimeout(i,r));u()})}function be(n,e,o,t,r="white",l=3,a){Rt(r,l,o,t);const u=n[e-1],c=u.unitX*a.width,i=u.unitY*a.height,f=n[e],s=f.unitX*a.width,d=f.unitY*a.height;t.beginPath(),t.moveTo(c,i),t.lineTo(s,d),t.stroke()}function Rt(n,e,o,t){t.globalCompositeOperation=o?"destination-out":"source-over",t.strokeStyle=n,t.lineWidth=e,t.lineJoin="round",t.lineCap="round"}function Ne(n,{strokesArray:e,specialRedrawFunc:o}){let t=n.getContext("2d");n.style["background-color"]="#2e3131";const r=100;function l(){setTimeout(()=>{a(),o?o():u()},r)}function a(){let c,i;const f=document.getElementById("main-content"),s=f.clientHeight,d=f.clientWidth,p=4/3;d*(1/p)<s?(i=d,c=i*(1/p)):(c=s,i=c*p),n.width=i,n.height=c,window.addEventListener("resize",l)}function u(){for(const c of e)pe(c,null,t,n)}return a(),o?o():u(),{destroy(){window.removeEventListener("resize",l)}}}function Fe(){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let o=0;o<20;o++)e+=n.charAt(Math.floor(Math.random()*n.length));return e}function At(n){let e;const o=n[9].default,t=ae(o,n,n[11],null);return{c(){t&&t.c()},l(r){t&&t.l(r)},m(r,l){t&&t.m(r,l),e=!0},p(r,l){t&&t.p&&(!e||l&2048)&&ce(t,o,r,r[11],e?fe(o,r[11],l,null):ue(r[11]),null)},i(r){e||(g(t,r),e=!0)},o(r){b(t,r),e=!1},d(r){t&&t.d(r)}}}function Lt(n){let e,o,t,r,l,a,u;return e=new St({props:{$$slots:{default:[At]},$$scope:{ctx:n}}}),{c(){I(e.$$.fragment),o=B(),t=K("canvas")},l(c){P(e.$$.fragment,c),o=j(c),t=Q(c,"CANVAS",{});var i=U(t);i.forEach(h)},m(c,i){C(e,c,i),w(c,o,i),w(c,t,i),n[10](t),l=!0,a||(u=[le(r=Ne.call(null,t,{strokesArray:n[0]})),se(t,"touchstart",n[2]),se(t,"touchmove",n[3]),se(t,"touchend",n[4])],a=!0)},p(c,[i]){const f={};i&2048&&(f.$$scope={dirty:i,ctx:c}),e.$set(f),r&&V(r.update)&&i&1&&r.update.call(null,{strokesArray:c[0]})},i(c){l||(g(e.$$.fragment,c),l=!0)},o(c){b(e.$$.fragment,c),l=!1},d(c){E(e,c),c&&h(o),c&&h(t),n[10](null),a=!1,Re(u)}}}function It(n){return(n.endTime-n.startTime)/n.points.length}function Pt(n,e,o){let t;ee(n,ke,m=>o(15,t=m));let{$$slots:r={},$$scope:l}=e,{strokesArray:a}=e,{currentTime:u=0}=e;const c=Se();let i,f=[],s,d=!1,p={x:-1,y:-1},_={points:[]},S;me(()=>{o(6,i=s.getContext("2d"))});function $(m){m.touches.length>1||(m.touches[0].touchType,k(m,{isInitialContact:!0}))}function D(m){if(!!d){if(m.touches.length>1){console.log("touchmove ignored: only 1 finger allowed");return}m.touches[0].touchType,k(m,{isInitialContact:!1})}}function L(m){!d||m.touches.length>0||(m.changedTouches[0].touchType,v(_),d=!1)}function R(m){d=!0,p={x:-1,y:-1},_={strokeNumber:a.length+1,startTime:Number(u.toFixed(1)),color:t.color,lineWidth:t.lineWidth,isErasing:t.type==="eraser",points:[],sessionID:"123"}}function k(m,{isInitialContact:A}){m.preventDefault(),A&&R();const W=Z(m);T(m,W)}function T(m,A){_.points.push({unitX:parseFloat(A.x/s.width).toFixed(4),unitY:parseFloat(A.y/s.height).toFixed(4)}),p.x!==-1&&p.y!==-1&&be([ie(p),ie(A)],1,t.type==="eraser",i,t.color,t.lineWidth,s),p=A}function v(m){m.endTime=Number(u.toFixed(1)),m.id=Fe(),f.push(m),c("stroke-drawn",{newStroke:m})}function Z(m){const{left:A,top:W}=s.getBoundingClientRect();return{x:m.touches[0].pageX-A-window.scrollX,y:m.touches[0].pageY-W-window.scrollY}}function ie({x:m,y:A}){return{unitX:m/s.width,unitY:A/s.height}}function Xe(){i.clearRect(0,0,s.scrollWidth,s.scrollHeight)}function Ye(m){ge[m?"unshift":"push"](()=>{s=m,o(1,s)})}return n.$$set=m=>{"strokesArray"in m&&o(0,a=m.strokesArray),"currentTime"in m&&o(5,u=m.currentTime),"$$scope"in m&&o(11,l=m.$$scope)},n.$$.update=()=>{if(n.$$.dirty&451&&i){let m=f.length,A=a.length;if(m!==A)if(m<A)if(m===0){for(const W of a)pe(W,null,i,s);o(7,f=[...a])}else for(let W=m;W<A;W++){const X=a[W];pe(X,X.startTime!==X.endTime?It(X):null,i,s),f.push(X)}else{let W=function(){Xe(),o(7,f=[]),p={x:-1,y:-1};for(const He of a)pe(He,null,i,s)};(function(){console.log("debounced board reset"),S&&clearTimeout(S),o(8,S=setTimeout(W,1e3))})()}}},[a,s,$,D,L,u,i,f,S,r,Ye,l]}class $e extends Y{constructor(e){super();H(this,e,Pt,Lt,q,{strokesArray:0,currentTime:5})}}function Ct(n){let e,o,t,r,l,a,u;return{c(){e=K("canvas"),t=B(),r=K("audio"),this.h()},l(c){e=Q(c,"CANVAS",{});var i=U(e);i.forEach(h),t=j(c),r=Q(c,"AUDIO",{src:!0,style:!0});var f=U(r);f.forEach(h),this.h()},h(){Ae(r.src,l=n[1])||y(r,"src",l),r.controls=!0,_e(r,"width","100%")},m(c,i){w(c,e,i),n[6](e),w(c,t,i),w(c,r,i),n[7](r),a||(u=[le(o=Ne.call(null,e,{strokesArray:n[0],handleResize:n[5]})),se(e,"resized",n[5]),se(r,"play",n[4])],a=!0)},p(c,[i]){o&&V(o.update)&&i&1&&o.update.call(null,{strokesArray:c[0],handleResize:c[5]}),i&2&&!Ae(r.src,l=c[1])&&y(r,"src",l)},i:O,o:O,d(c){c&&h(e),n[6](null),c&&h(t),c&&h(r),n[7](null),a=!1,Re(u)}}}let Et=1;function Ut(n){return(n.endTime-n.startTime)/n.points.length}function Wt(n,e,o){let{strokesArray:t}=e,{audioDownloadURL:r}=e,l,a=0,u,c,i,f;Te(()=>{f&&clearTimeout(f)}),me(()=>{c=u.getContext("2d");const k=[];for(let T=0;T<t.length;T++)for(let v=1;v<t[T].points.length;v++){const Z={strokeIndex:T,pointIndex:v};k.push(x({startTime:s(Z)},Z))}l=k.sort((T,v)=>T.startTime-v.startTime)});function s({strokeIndex:k,pointIndex:T}){const v=t[k];return v.startTime+(T-1)*Ut(v)}function d(){a=0,c.clearRect(0,0,u.width,u.height),p()}function p(){if(!!i&&(_(),a<l.length)){const k=l[a],T=1e3*(k.startTime-i.currentTime);f=setTimeout(p,T/Et)}}function _(){if(!i)return;const k=l[a];(!k||k.startTime>i.currentTime)&&(c.clearRect(0,0,u.width,u.height),a=0),S()}function S(){const{currentTime:k}=i;for(let T=a;T<l.length;T++){const v=l[T];if(v.startTime>k)break;$(v),a+=1}}function $({strokeIndex:k,pointIndex:T}){const v=t[k],ie=v.lineWidth*(u.scrollWidth/1e3);be(v.points,T,v.isErasing,c,v.color,ie,u)}function D(){return new Promise(async k=>{f?(a=0,this.syncStrokesToAudio()):this.renderFramesUntilCurrentTime(),k()})}function L(k){ge[k?"unshift":"push"](()=>{u=k,o(2,u)})}function R(k){ge[k?"unshift":"push"](()=>{i=k,o(3,i)})}return n.$$set=k=>{"strokesArray"in k&&o(0,t=k.strokesArray),"audioDownloadURL"in k&&o(1,r=k.audioDownloadURL)},[t,r,u,i,d,D,L,R]}class zt extends Y{constructor(e){super();H(this,e,Wt,Ct,q,{strokesArray:0,audioDownloadURL:1})}}function Be(n,e,o){const t=n.slice();return t[11]=e[o],t}function je(n){let e,o=[],t=new Map,r,l,a,u,c=n[0].blackboards;const i=f=>f[11];for(let f=0;f<c.length;f+=1){let s=Be(n,c,f),d=i(s);t.set(d,o[f]=Oe(d,s))}return{c(){e=K("div");for(let f=0;f<o.length;f+=1)o[f].c();this.h()},l(f){e=Q(f,"DIV",{style:!0});var s=U(e);for(let d=0;d<o.length;d+=1)o[d].l(s);s.forEach(h),this.h()},h(){_e(e,"height","100vh")},m(f,s){w(f,e,s);for(let d=0;d<o.length;d+=1)o[d].m(e,null);l=!0,a||(u=le(r=dt.call(null,e,"main-content")),a=!0)},p(f,s){s&16105487&&(c=f[0].blackboards,M(),o=nt(o,s,i,1,f,c,t,e,lt,Oe,null,Be),N())},i(f){if(!l){for(let s=0;s<c.length;s+=1)g(o[s]);l=!0}},o(f){for(let s=0;s<o.length;s+=1)b(o[s]);l=!1},d(f){f&&h(e);for(let s=0;s<o.length;s+=1)o[s].d();a=!1,u()}}}function Ve(n){let e,o,t,r;const l=[Nt,Mt],a=[];function u(c,i){return c[14].audioDownloadURL?0:1}return e=u(n),o=a[e]=l[e](n),{c(){o.c(),t=z()},l(c){o.l(c),t=z()},m(c,i){a[e].m(c,i),w(c,t,i),r=!0},p(c,i){let f=e;e=u(c),e===f?a[e].p(c,i):(M(),b(a[f],1,1,()=>{a[f]=null}),N(),o=a[e],o?o.p(c,i):(o=a[e]=l[e](c),o.c()),g(o,1),o.m(t.parentNode,t))},i(c){r||(g(o),r=!0)},o(c){b(o),r=!1},d(c){a[e].d(c),c&&h(t)}}}function Mt(n){let e,o,t,r,l,a,u;const c=[Bt,Ft],i=[];function f(s,d){return s[18]?1:0}return o=f(n),t=i[o]=c[o](n),{c(){e=K("div"),t.c()},l(s){e=Q(s,"DIV",{});var d=U(e);t.l(d),d.forEach(h)},m(s,d){w(s,e,d),i[o].m(e,null),l=!0,a||(u=le(r=Ce.call(null,e,n[16])),a=!0)},p(s,d){let p=o;o=f(s),o===p?i[o].p(s,d):(M(),b(i[p],1,1,()=>{i[p]=null}),N(),t=i[o],t?t.p(s,d):(t=i[o]=c[o](s),t.c()),g(t,1),t.m(e,null)),r&&V(r.update)&&d&65536&&r.update.call(null,s[16])},i(s){l||(g(t),l=!0)},o(s){b(t),l=!1},d(s){s&&h(e),i[o].d(),a=!1,u()}}}function Nt(n){let e,o,t,r,l,a,u;const c=[Kt,Gt],i=[];function f(s,d){return s[18]?1:0}return o=f(n),t=i[o]=c[o](n),{c(){e=K("div"),t.c()},l(s){e=Q(s,"DIV",{});var d=U(e);t.l(d),d.forEach(h)},m(s,d){w(s,e,d),i[o].m(e,null),l=!0,a||(u=le(r=Ce.call(null,e,n[15])),a=!0)},p(s,d){let p=o;o=f(s),o===p?i[o].p(s,d):(M(),b(i[p],1,1,()=>{i[p]=null}),N(),t=i[o],t?t.p(s,d):(t=i[o]=c[o](s),t.c()),g(t,1),t.m(e,null)),r&&V(r.update)&&d&32768&&r.update.call(null,s[15])},i(s){l||(g(t),l=!0)},o(s){b(t),l=!1},d(s){s&&h(e),i[o].d(),a=!1,u()}}}function Ft(n){let e,o;function t(...r){return n[7](n[11],...r)}return e=new wt({props:{$$slots:{default:[Jt,({startRecording:r,stopRecording:l,currentTime:a})=>({21:r,22:l,23:a}),({startRecording:r,stopRecording:l,currentTime:a})=>(r?2097152:0)|(l?4194304:0)|(a?8388608:0)]},$$scope:{ctx:n}}}),e.$on("record-end",t),{c(){I(e.$$.fragment)},l(r){P(e.$$.fragment,r)},m(r,l){C(e,r,l),o=!0},p(r,l){n=r;const a={};l&32768002&&(a.$$scope={dirty:l,ctx:n}),e.$set(a)},i(r){o||(g(e.$$.fragment,r),o=!0)},o(r){b(e.$$.fragment,r),o=!1},d(r){E(e,r)}}}function Bt(n){let e,o;return e=new $e({props:{strokesArray:[]}}),{c(){I(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,r){C(e,t,r),o=!0},p:O,i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){E(e,t)}}}function jt(n){let e;return{c(){e=oe("Uploading...")},l(o){e=re(o,"Uploading...")},m(o,t){w(o,e,t)},p:O,i:O,o:O,d(o){o&&h(e)}}}function Vt(n){let e,o;return e=new te({props:{$$slots:{default:[Xt]},$$scope:{ctx:n}}}),e.$on("click",function(){V(n[22])&&n[22].apply(this,arguments)}),{c(){I(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,r){C(e,t,r),o=!0},p(t,r){n=t;const l={};r&16777216&&(l.$$scope={dirty:r,ctx:n}),e.$set(l)},i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){E(e,t)}}}function Ot(n){let e,o;return e=new te({props:{$$slots:{default:[Yt]},$$scope:{ctx:n}}}),e.$on("click",function(){V(n[21])&&n[21].apply(this,arguments)}),{c(){I(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,r){C(e,t,r),o=!0},p(t,r){n=t;const l={};r&16777216&&(l.$$scope={dirty:r,ctx:n}),e.$set(l)},i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){E(e,t)}}}function Xt(n){let e;return{c(){e=oe("Stop")},l(o){e=re(o,"Stop")},m(o,t){w(o,e,t)},d(o){o&&h(e)}}}function Yt(n){let e;return{c(){e=oe("Record")},l(o){e=re(o,"Record")},m(o,t){w(o,e,t)},d(o){o&&h(e)}}}function Ht(n){let e;return{c(){e=oe("Wipe board")},l(o){e=re(o,"Wipe board")},m(o,t){w(o,e,t)},d(o){o&&h(e)}}}function qt(n){let e,o,t,r,l;const a=[Ot,Vt,jt],u=[];function c(i,f){return i[1]==="pre_record"?0:i[1]==="mid_record"?1:2}return e=c(n),o=u[e]=a[e](n),r=new te({props:{$$slots:{default:[Ht]},$$scope:{ctx:n}}}),r.$on("click",function(){V(n[20])&&n[20].apply(this,arguments)}),{c(){o.c(),t=B(),I(r.$$.fragment)},l(i){o.l(i),t=j(i),P(r.$$.fragment,i)},m(i,f){u[e].m(i,f),w(i,t,f),C(r,i,f),l=!0},p(i,f){n=i;let s=e;e=c(n),e===s?u[e].p(n,f):(M(),b(u[s],1,1,()=>{u[s]=null}),N(),o=u[e],o?o.p(n,f):(o=u[e]=a[e](n),o.c()),g(o,1),o.m(t.parentNode,t));const d={};f&16777216&&(d.$$scope={dirty:f,ctx:n}),r.$set(d)},i(i){l||(g(o),g(r.$$.fragment,i),l=!0)},o(i){b(o),b(r.$$.fragment,i),l=!1},d(i){u[e].d(i),i&&h(t),E(r,i)}}}function Jt(n){let e,o;function t(...r){return n[6](n[19],...r)}return e=new $e({props:{strokesArray:n[18],currentTime:n[23],$$slots:{default:[qt]},$$scope:{ctx:n}}}),e.$on("stroke-drawn",t),{c(){I(e.$$.fragment)},l(r){P(e.$$.fragment,r)},m(r,l){C(e,r,l),o=!0},p(r,l){n=r;const a={};l&262144&&(a.strokesArray=n[18]),l&8388608&&(a.currentTime=n[23]),l&24117250&&(a.$$scope={dirty:l,ctx:n}),e.$set(a)},i(r){o||(g(e.$$.fragment,r),o=!0)},o(r){b(e.$$.fragment,r),o=!1},d(r){E(e,r)}}}function Gt(n){let e,o;return e=new zt({props:{strokesArray:n[18],audioDownloadURL:n[14].audioDownloadURL}}),{c(){I(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,r){C(e,t,r),o=!0},p(t,r){const l={};r&262144&&(l.strokesArray=t[18]),r&16384&&(l.audioDownloadURL=t[14].audioDownloadURL),e.$set(l)},i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){E(e,t)}}}function Kt(n){let e,o;return e=new $e({props:{strokesArray:[]}}),{c(){I(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,r){C(e,t,r),o=!0},p:O,i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){E(e,t)}}}function Qt(n){let e,o,t=n[14]&&Ve(n);return{c(){t&&t.c(),e=B()},l(r){t&&t.l(r),e=j(r)},m(r,l){t&&t.m(r,l),w(r,e,l),o=!0},p(r,l){r[14]?t?(t.p(r,l),l&16384&&g(t,1)):(t=Ve(r),t.c(),g(t,1),t.m(e.parentNode,e)):t&&(M(),b(t,1,1,()=>{t=null}),N())},i(r){o||(g(t),o=!0)},o(r){b(t),o=!1},d(r){t&&t.d(r),r&&h(e)}}}function Oe(n,e){let o,t,r;return t=new gt({props:{dbPath:e[2]+e[11],$$slots:{default:[Qt,({boardDoc:l,fetchStrokes:a,listenToStrokes:u,isFetchingStrokes:c,strokesArray:i,handleNewlyDrawnStroke:f,deleteAllStrokesFromDb:s})=>({14:l,15:a,16:u,17:c,18:i,19:f,20:s}),({boardDoc:l,fetchStrokes:a,listenToStrokes:u,isFetchingStrokes:c,strokesArray:i,handleNewlyDrawnStroke:f,deleteAllStrokesFromDb:s})=>(l?16384:0)|(a?32768:0)|(u?65536:0)|(c?131072:0)|(i?262144:0)|(f?524288:0)|(s?1048576:0)]},$$scope:{ctx:e}}}),{key:n,first:null,c(){o=z(),I(t.$$.fragment),this.h()},l(l){o=z(),P(t.$$.fragment,l),this.h()},h(){this.first=o},m(l,a){w(l,o,a),C(t,l,a),r=!0},p(l,a){e=l;const u={};a&1&&(u.dbPath=e[2]+e[11]),a&18202627&&(u.$$scope={dirty:a,ctx:e}),t.$set(u)},i(l){r||(g(t.$$.fragment,l),r=!0)},o(l){b(t.$$.fragment,l),r=!1},d(l){l&&h(o),E(t,l)}}}function Zt(n){let e,o,t=n[0]&&je(n);return{c(){t&&t.c(),e=z()},l(r){t&&t.l(r),e=z()},m(r,l){t&&t.m(r,l),w(r,e,l),o=!0},p(r,[l]){r[0]?t?(t.p(r,l),l&1&&g(t,1)):(t=je(r),t.c(),g(t,1),t.m(e.parentNode,e)):t&&(M(),b(t,1,1,()=>{t=null}),N())},i(r){o||(g(t),o=!0)},o(r){b(t),o=!1},d(r){t&&t.d(r),r&&h(e)}}}function io({page:n}){return{props:{classID:n.params.class,roomID:n.params.room}}}function xt(n,e,o){let t,r;ee(n,Pe,_=>o(8,t=_)),ee(n,he,_=>o(1,r=_));let{classID:l}=e,{roomID:a}=e,u;const c=`classes/${l}/blackboards/`,i=`classes/${l}/rooms/`;t.uid||(console.log("redirecting to tutorial"),mt("/")),me(async()=>{o(0,u=await Le(i+a))});async function f(){o(0,u=await Le(i+a))}async function s(_,S){console.log("saveVideo(), audioBlob =",_);const $=st(),D=it($,`audio/${Fe()}`);console.log("audioRef =",D),await at(D,_);const L=await ct(D);console.log("downloadURL =",L);const R=de(F(),c+S);await ut(R,{creatorUID:t.uid,creatorPhoneNumber:t.phoneNumber,date:new Date().toISOString(),audioDownloadURL:L}),console.log("updated doc =",{creatorUID:t.uid,creatorPhoneNumber:t.phoneNumber,date:new Date().toISOString(),audioDownloadURL:L})}const d=(_,S)=>_(S.detail.newStroke),p=(_,S)=>s(S.detail.audioBlob,_);return n.$$set=_=>{"classID"in _&&o(4,l=_.classID),"roomID"in _&&o(5,a=_.roomID)},n.$$.update=()=>{n.$$.dirty&32&&f()},[u,r,c,s,l,a,d,p]}class ao extends Y{constructor(e){super();H(this,e,xt,Zt,q,{classID:4,roomID:5})}}export{ao as default,io as load};

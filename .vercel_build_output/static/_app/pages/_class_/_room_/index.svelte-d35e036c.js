var Ge=Object.defineProperty;var $e=Object.getOwnPropertySymbols;var Ke=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable;var we=(r,e,o)=>e in r?Ge(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o,Z=(r,e)=>{for(var o in e||(e={}))Ke.call(e,o)&&we(r,o,e[o]);if($e)for(var o of $e(e))Qe.call(e,o)&&we(r,o,e[o]);return r};import{S as j,i as V,s as O,G as ae,H as ce,I as ue,J as fe,x as p,u as b,T as Ze,O as N,M as de,ab as ye,aa as De,af as xe,ag as et,ah as tt,P as ot,ai as nt,aj as Te,D as x,A as he,ak as rt,al as ve,j as C,m as E,o as U,v as W,V as ee,k as X,n as Y,f as y,r as z,w as M,a2 as lt,d as g,t as te,g as oe,am as H,an as q,a as A,b as $,a7 as me,K as ne,e as J,c as G,ac as re,ao as le,ap as F,aq as Se,X as ge,a9 as Re,L as se,ad as st,l as K,ae as it,ar as at,as as ct,at as ut,au as ft,av as dt}from"../../../chunks/vendor-569078ae.js";import{f as ht,a as Ae}from"../../../chunks/database-66f37af8.js";import{d as Le,r as _e,u as Ie,c as ke}from"../../../chunks/store-27550397.js";import{p as mt,l as Pe}from"../../../chunks/actions-f4d3704b.js";import{g as _t}from"../../../chunks/navigation-51f4a605.js";import"../../../chunks/singletons-12a22614.js";const pt=r=>({boardDoc:r&4,isFetchingStrokes:r&2,strokesArray:r&1}),Ce=r=>({boardDoc:r[2],fetchStrokes:r[3],listenToStrokes:r[4],isFetchingStrokes:r[1],strokesArray:r[0],handleNewlyDrawnStroke:r[5],deleteAllStrokesFromDb:r[6]});function gt(r){let e;const o=r[9].default,t=ae(o,r,r[8],Ce);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,l){t&&t.m(n,l),e=!0},p(n,[l]){t&&t.p&&(!e||l&263)&&ce(t,o,n,n[8],e?fe(o,n[8],l,pt):ue(n[8]),Ce)},i(n){e||(p(t,n),e=!0)},o(n){b(t,n),e=!1},d(n){t&&t.d(n)}}}function Ee(r){const e=Z({id:r.id},r.data());return e.startTime=0,e.endTime=0,r.data().isErasing||(e.endTime+=.5),e}function kt(r,e,o){let{$$slots:t={},$$scope:n}=e,{dbPath:l}=e,s,u=!1,i,a;const c=Ze(N(),`${l}/strokes`),f=de(N(),l);ye(f,h=>{o(2,i=Z({id:h.id},h.data()))}),De(()=>{a&&a()});async function m(){o(1,u=!0),o(0,s=await ht(l+"/strokes"))}async function k(){o(1,u=!0);const h=xe(c,et("timestamp"));a=ye(h,async w=>{w.docChanges().filter(v=>v.type==="removed").length>0?(o(0,s=[]),await tt(),w.docs.length>0&&w.docs.forEach(v=>{s.push(Ee(v))})):(s||(o(1,u=!1),o(0,s=[])),w.docs.length===s.length||w.docChanges().filter(v=>v.type==="added").forEach(v=>{o(0,s=[...s,Ee(v.doc)])}))})}function R(h){s.push(h);try{ot(de(N(),`${l}/strokes/${h.id}`),Z({timestamp:nt()},h))}catch(w){alert(w)}}async function P(){const h=[];let w=Te(N()),L=0;for(const v of s){L>=500&&(h.push(w.commit()),w=Te(N()),L=0);const _=de(N(),`${l}/strokes/${v.id}`);w.delete(_),L+=1}h.push(w.commit()),console.log("number of strokes =",s.length),console.log("number of batches to be deleted =",L),await Promise.all(h)}return r.$$set=h=>{"dbPath"in h&&o(7,l=h.dbPath),"$$scope"in h&&o(8,n=h.$$scope)},[s,u,i,m,k,R,P,l,n,t]}class bt extends j{constructor(e){super();V(this,e,kt,gt,O,{dbPath:7})}}const $t=r=>({}),Ue=r=>({startRecording:r[0],stopRecording:r[1]});function wt(r){let e;const o=r[3].default,t=ae(o,r,r[2],Ue);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,l){t&&t.m(n,l),e=!0},p(n,[l]){t&&t.p&&(!e||l&4)&&ce(t,o,n,n[2],e?fe(o,n[2],l,$t):ue(n[2]),Ue)},i(n){e||(p(t,n),e=!0)},o(n){b(t,n),e=!1},d(n){t&&t.d(n)}}}function yt(r,e,o){let t;x(r,Le,c=>o(5,t=c));let{$$slots:n={},$$scope:l}=e;he(()=>{window.MediaRecorder=rt});const s=ve();let u=null;function i(){return new Promise(async c=>{if(!t){const m=await navigator.mediaDevices.getUserMedia({audio:!0});Le.set(m)}const f=t.clone();u=new MediaRecorder(f),u.start(),s("record-start"),_e.set("mid_record"),c()})}function a(){return new Promise((c,f)=>{_e.set("post_record"),u.addEventListener("dataavailable",m=>{const k=m.data;s("record-end",{audioBlob:k}),c(),_e.set("pre_record")}),u.stop();for(const m of u.stream.getTracks())m.stop()})}return r.$$set=c=>{"$$scope"in c&&o(2,l=c.$$scope)},[i,a,l,n]}class Dt extends j{constructor(e){super();V(this,e,yt,wt,O,{})}}function We(r,e,o){const t=r.slice();return t[5]=e[o],t}function Tt(r){let e,o,t,n,l,s,u,i;return{c(){e=H("svg"),o=H("g"),t=H("path"),n=H("polygon"),s=H("path"),u=H("path"),this.h()},l(a){e=q(a,"svg",{preserveAspectRatio:!0,version:!0,id:!0,xmlns:!0,"xmlns:xlink":!0,x:!0,y:!0,width:!0,height:!0,":viewbox":!0,style:!0,"xml:space":!0});var c=A(e);o=q(c,"g",{});var f=A(o);t=q(f,"path",{d:!0}),A(t).forEach(g),n=q(f,"polygon",{style:!0,points:!0}),A(n).forEach(g),s=q(f,"path",{style:!0,d:!0}),A(s).forEach(g),u=q(f,"path",{style:!0,d:!0}),A(u).forEach(g),f.forEach(g),c.forEach(g),this.h()},h(){$(t,"d",`M0,0v72.377c0,1.588,0.234,3.169,0.698,4.706l45.416,150.032C46.633,228.828,48.212,230,50,230s3.367-1.172,3.886-2.883\r
          L99.31,77.079c0.457-1.525,0.69-3.108,0.69-4.702V0.002`),$(n,"style",l=`fill: ${r[5]};`),$(n,"points","50,211.978 38.879,175.24 61.122,175.24"),me(s,"fill","#424242"),$(s,"d",`M63.581,167.118H36.42L8.765,75.761l10.924-9.63l12.5,11.015c1.54,1.353,3.835,1.35,5.375-0.002\r
            l12.468-11.007l12.464,11.005c1.54,1.357,3.839,1.357,5.377,0l12.465-11.005l10.9,9.623L63.581,167.118z`),$(u,"style",i=`fill: ${r[5]};`),$(u,"d",`M91.878,0v65.486l-8.852-7.813c-1.539-1.353-3.838-1.354-5.377,0.002L65.185,68.679L52.72,57.674\r
            c-1.539-1.356-3.838-1.354-5.377-0.002L34.871,68.683L22.375,57.67c-0.769-0.676-1.725-1.013-2.685-1.013\r
            c-0.959,0-1.919,0.339-2.685,1.013L8.121,65.5L8.098,0.024L91.878,0z`),$(e,"preserveAspectRatio","none"),$(e,"version","1.1"),$(e,"id","Layer_1"),$(e,"xmlns","http://www.w3.org/2000/svg"),$(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),$(e,"x","0px"),$(e,"y","0px"),$(e,"width","16px"),$(e,"height","35px"),$(e,":viewbox","`0 0 100 230`"),me(e,"enable-background","new 0 0 100 230"),$(e,"xml:space","preserve")},m(a,c){y(a,e,c),ne(e,o),ne(o,t),ne(o,n),ne(o,s),ne(o,u)},p(a,c){c&1&&l!==(l=`fill: ${a[5]};`)&&$(n,"style",l),c&1&&i!==(i=`fill: ${a[5]};`)&&$(u,"style",i)},d(a){a&&g(e)}}}function ze(r){let e,o;function t(){return r[2](r[5])}return e=new ee({props:{$$slots:{default:[Tt]},$$scope:{ctx:r}}}),e.$on("click",t),{c(){C(e.$$.fragment)},l(n){E(e.$$.fragment,n)},m(n,l){U(e,n,l),o=!0},p(n,l){r=n;const s={};l&17&&(s.$$scope={dirty:l,ctx:r}),e.$set(s)},i(n){o||(p(e.$$.fragment,n),o=!0)},o(n){b(e.$$.fragment,n),o=!1},d(n){W(e,n)}}}function vt(r){let e;return{c(){e=te("Eraser")},l(o){e=oe(o,"Eraser")},m(o,t){y(o,e,t)},d(o){o&&g(e)}}}function St(r){let e,o,t,n,l=r[0].pencilColors,s=[];for(let c=0;c<l.length;c+=1)s[c]=ze(We(r,l,c));const u=c=>b(s[c],1,1,()=>{s[c]=null});o=new ee({props:{$$slots:{default:[vt]},$$scope:{ctx:r}}}),o.$on("click",r[3]);const i=r[1].default,a=ae(i,r,r[4],null);return{c(){for(let c=0;c<s.length;c+=1)s[c].c();e=X(),C(o.$$.fragment),t=X(),a&&a.c()},l(c){for(let f=0;f<s.length;f+=1)s[f].l(c);e=Y(c),E(o.$$.fragment,c),t=Y(c),a&&a.l(c)},m(c,f){for(let m=0;m<s.length;m+=1)s[m].m(c,f);y(c,e,f),U(o,c,f),y(c,t,f),a&&a.m(c,f),n=!0},p(c,[f]){if(f&1){l=c[0].pencilColors;let k;for(k=0;k<l.length;k+=1){const R=We(c,l,k);s[k]?(s[k].p(R,f),p(s[k],1)):(s[k]=ze(R),s[k].c(),p(s[k],1),s[k].m(e.parentNode,e))}for(z(),k=l.length;k<s.length;k+=1)u(k);M()}const m={};f&16&&(m.$$scope={dirty:f,ctx:c}),o.$set(m),a&&a.p&&(!n||f&16)&&ce(a,i,c,c[4],n?fe(i,c[4],f,null):ue(c[4]),null)},i(c){if(!n){for(let f=0;f<l.length;f+=1)p(s[f]);p(o.$$.fragment,c),p(a,c),n=!0}},o(c){s=s.filter(Boolean);for(let f=0;f<s.length;f+=1)b(s[f]);b(o.$$.fragment,c),b(a,c),n=!1},d(c){lt(s,c),c&&g(e),W(o,c),c&&g(t),a&&a.d(c)}}}function Rt(r,e,o){let t;x(r,Ie,i=>o(0,t=i));let{$$slots:n={},$$scope:l}=e;const s=i=>ke.set({type:"pencil",color:i,lineWidth:3}),u=()=>ke.set({type:"eraser",color:"",lineWidth:40});return r.$$set=i=>{"$$scope"in i&&o(4,l=i.$$scope)},[t,n,s,u,l]}class At extends j{constructor(e){super();V(this,e,Rt,St,O,{})}}function pe({points:r,color:e,lineWidth:o,isErasing:t},n=null,l,s){return new Promise(async u=>{for(let i=1;i<r.length;i++)be(r,i,t,l,e,o,s),n!==null&&await new Promise(a=>setTimeout(a,n));u()})}function be(r,e,o,t,n="white",l=3,s){Lt(n,l,o,t);const u=r[e-1],i=u.unitX*s.width,a=u.unitY*s.height,c=r[e],f=c.unitX*s.width,m=c.unitY*s.height;t.beginPath(),t.moveTo(i,a),t.lineTo(f,m),t.stroke()}function Lt(r,e,o,t){t.globalCompositeOperation=o?"destination-out":"source-over",t.strokeStyle=r,t.lineWidth=e,t.lineJoin="round",t.lineCap="round"}function Me(r,{strokesArray:e,specialRedrawFunc:o}){let t=r.getContext("2d");r.style["background-color"]="#2e3131";const n=100;function l(){setTimeout(()=>{s(),o?o():u()},n)}function s(){const{height:i,width:a}=Ne();r.width=a,r.height=i,window.addEventListener("resize",l)}function u(){for(const i of e)pe(i,null,t,r)}return s(),o?o():u(),{destroy(){window.removeEventListener("resize",l)}}}function Ne(){const r=document.getElementById("main-content"),e=r.clientHeight,o=r.clientWidth,t=4/3;let n={};return o*(1/t)<e?(n.width=o,n.height=n.width*(1/t)):(n.height=e,n.width=n.height*t),n}function Fe(){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let o=0;o<20;o++)e+=r.charAt(Math.floor(Math.random()*r.length));return e}function It(r){let e;const o=r[9].default,t=ae(o,r,r[11],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,l){t&&t.m(n,l),e=!0},p(n,l){t&&t.p&&(!e||l&2048)&&ce(t,o,n,n[11],e?fe(o,n[11],l,null):ue(n[11]),null)},i(n){e||(p(t,n),e=!0)},o(n){b(t,n),e=!1},d(n){t&&t.d(n)}}}function Pt(r){let e,o,t,n,l,s,u;return e=new At({props:{$$slots:{default:[It]},$$scope:{ctx:r}}}),{c(){C(e.$$.fragment),o=X(),t=J("canvas")},l(i){E(e.$$.fragment,i),o=Y(i),t=G(i,"CANVAS",{});var a=A(t);a.forEach(g)},m(i,a){U(e,i,a),y(i,o,a),y(i,t,a),r[10](t),l=!0,s||(u=[re(n=Me.call(null,t,{strokesArray:r[0]})),le(t,"touchstart",r[2]),le(t,"touchmove",r[3]),le(t,"touchend",r[4])],s=!0)},p(i,[a]){const c={};a&2048&&(c.$$scope={dirty:a,ctx:i}),e.$set(c),n&&F(n.update)&&a&1&&n.update.call(null,{strokesArray:i[0]})},i(i){l||(p(e.$$.fragment,i),l=!0)},o(i){b(e.$$.fragment,i),l=!1},d(i){W(e,i),i&&g(o),i&&g(t),r[10](null),s=!1,Se(u)}}}function Ct(r){return(r.endTime-r.startTime)/r.points.length}function Et(r,e,o){let t;x(r,ke,d=>o(15,t=d));let{$$slots:n={},$$scope:l}=e,{strokesArray:s}=e,{currentTime:u=0}=e;const i=ve();let a,c=[],f,m=!1,k={x:-1,y:-1},R={points:[]},P;he(()=>{o(6,a=f.getContext("2d"))});function h(d){d.touches.length>1||(d.touches[0].touchType,_(d,{isInitialContact:!0}))}function w(d){if(!!m){if(d.touches.length>1){console.log("touchmove ignored: only 1 finger allowed");return}d.touches[0].touchType,_(d,{isInitialContact:!1})}}function L(d){!m||d.touches.length>0||(d.changedTouches[0].touchType,T(R),m=!1)}function v(d){m=!0,k={x:-1,y:-1},R={strokeNumber:s.length+1,startTime:Number(u.toFixed(1)),color:t.color,lineWidth:t.lineWidth,isErasing:t.type==="eraser",points:[],sessionID:"123"}}function _(d,{isInitialContact:S}){d.preventDefault(),S&&v();const I=Q(d);D(d,I)}function D(d,S){R.points.push({unitX:parseFloat(S.x/f.width).toFixed(4),unitY:parseFloat(S.y/f.height).toFixed(4)}),k.x!==-1&&k.y!==-1&&be([ie(k),ie(S)],1,t.type==="eraser",a,t.color,t.lineWidth,f),k=S}function T(d){d.endTime=Number(u.toFixed(1)),d.id=Fe(),c.push(d),i("stroke-drawn",{newStroke:d})}function Q(d){const{left:S,top:I}=f.getBoundingClientRect();return{x:d.touches[0].pageX-S-window.scrollX,y:d.touches[0].pageY-I-window.scrollY}}function ie({x:d,y:S}){return{unitX:d/f.width,unitY:S/f.height}}function He(){a.clearRect(0,0,f.scrollWidth,f.scrollHeight)}function qe(d){ge[d?"unshift":"push"](()=>{f=d,o(1,f)})}return r.$$set=d=>{"strokesArray"in d&&o(0,s=d.strokesArray),"currentTime"in d&&o(5,u=d.currentTime),"$$scope"in d&&o(11,l=d.$$scope)},r.$$.update=()=>{if(r.$$.dirty&451&&a){let d=c.length,S=s.length;if(d!==S)if(d<S)if(d===0){for(const I of s)pe(I,null,a,f);o(7,c=[...s])}else for(let I=d;I<S;I++){const B=s[I];pe(B,B.startTime!==B.endTime?Ct(B):null,a,f),c.push(B)}else{let I=function(){He(),o(7,c=[]),k={x:-1,y:-1};for(const Je of s)pe(Je,null,a,f)};(function(){console.log("debounced board reset"),P&&clearTimeout(P),o(8,P=setTimeout(I,1e3))})()}}},[s,f,h,w,L,u,a,c,P,n,qe,l]}class Ut extends j{constructor(e){super();V(this,e,Et,Pt,O,{strokesArray:0,currentTime:5})}}function Wt(r){let e,o,t,n,l,s,u;return{c(){e=J("canvas"),t=X(),n=J("audio"),this.h()},l(i){e=G(i,"CANVAS",{});var a=A(e);a.forEach(g),t=Y(i),n=G(i,"AUDIO",{src:!0,style:!0});var c=A(n);c.forEach(g),this.h()},h(){Re(n.src,l=r[1])||$(n,"src",l),n.controls=!0,me(n,"width","100%")},m(i,a){y(i,e,a),r[6](e),y(i,t,a),y(i,n,a),r[7](n),s||(u=[re(o=Me.call(null,e,{strokesArray:r[0],handleResize:r[5]})),le(e,"resized",r[5]),le(n,"play",r[4])],s=!0)},p(i,[a]){o&&F(o.update)&&a&1&&o.update.call(null,{strokesArray:i[0],handleResize:i[5]}),a&2&&!Re(n.src,l=i[1])&&$(n,"src",l)},i:se,o:se,d(i){i&&g(e),r[6](null),i&&g(t),i&&g(n),r[7](null),s=!1,Se(u)}}}let zt=1;function Mt(r){return(r.endTime-r.startTime)/r.points.length}function Nt(r,e,o){let{strokesArray:t}=e,{audioDownloadURL:n}=e,l,s=0,u,i,a,c;De(()=>{c&&clearTimeout(c)}),he(()=>{i=u.getContext("2d");const _=[];for(let D=0;D<t.length;D++)for(let T=1;T<t[D].points.length;T++){const Q={strokeIndex:D,pointIndex:T};_.push(Z({startTime:f(Q)},Q))}l=_.sort((D,T)=>D.startTime-T.startTime)});function f({strokeIndex:_,pointIndex:D}){const T=t[_];return T.startTime+(D-1)*Mt(T)}function m(){s=0,i.clearRect(0,0,u.width,u.height),k()}function k(){if(!!a&&(R(),s<l.length)){const _=l[s],D=1e3*(_.startTime-a.currentTime);c=setTimeout(k,D/zt)}}function R(){if(!a)return;const _=l[s];(!_||_.startTime>a.currentTime)&&(i.clearRect(0,0,u.width,u.height),s=0),P()}function P(){const{currentTime:_}=a;for(let D=s;D<l.length;D++){const T=l[D];if(T.startTime>_)break;h(T),s+=1}}function h({strokeIndex:_,pointIndex:D}){const T=t[_],ie=T.lineWidth*(u.scrollWidth/1e3);be(T.points,D,T.isErasing,i,T.color,ie,u)}function w(){return new Promise(async _=>{c?(s=0,this.syncStrokesToAudio()):this.renderFramesUntilCurrentTime(),_()})}function L(_){ge[_?"unshift":"push"](()=>{u=_,o(2,u)})}function v(_){ge[_?"unshift":"push"](()=>{a=_,o(3,a)})}return r.$$set=_=>{"strokesArray"in _&&o(0,t=_.strokesArray),"audioDownloadURL"in _&&o(1,n=_.audioDownloadURL)},[t,n,u,a,m,w,L,v]}class Ft extends j{constructor(e){super();V(this,e,Nt,Wt,O,{strokesArray:0,audioDownloadURL:1})}}function Be(r,e,o){const t=r.slice();return t[13]=e[o],t}function je(r){let e,o=[],t=new Map,n,l,s,u,i=r[0].blackboards;const a=c=>c[13];for(let c=0;c<i.length;c+=1){let f=Be(r,i,c),m=a(f);t.set(m,o[c]=Ye(m,f))}return{c(){e=J("div");for(let c=0;c<o.length;c+=1)o[c].c();this.h()},l(c){e=G(c,"DIV",{style:!0});var f=A(e);for(let m=0;m<o.length;m+=1)o[m].l(f);f.forEach(g),this.h()},h(){me(e,"height","100vh")},m(c,f){y(c,e,f);for(let m=0;m<o.length;m+=1)o[m].m(e,null);l=!0,s||(u=re(n=mt.call(null,e,"main-content")),s=!0)},p(c,f){f&64421951&&(i=c[0].blackboards,z(),o=st(o,f,a,1,c,i,t,e,it,Ye,null,Be),M())},i(c){if(!l){for(let f=0;f<i.length;f+=1)p(o[f]);l=!0}},o(c){for(let f=0;f<o.length;f+=1)b(o[f]);l=!1},d(c){c&&g(e);for(let f=0;f<o.length;f+=1)o[f].d();s=!1,u()}}}function Ve(r){let e,o,t,n;const l=[jt,Bt],s=[];function u(i,a){return i[16].audioDownloadURL?0:1}return e=u(r),o=s[e]=l[e](r),{c(){o.c(),t=K()},l(i){o.l(i),t=K()},m(i,a){s[e].m(i,a),y(i,t,a),n=!0},p(i,a){let c=e;e=u(i),e===c?s[e].p(i,a):(z(),b(s[c],1,1,()=>{s[c]=null}),M(),o=s[e],o?o.p(i,a):(o=s[e]=l[e](i),o.c()),p(o,1),o.m(t.parentNode,t))},i(i){n||(p(o),n=!0)},o(i){b(o),n=!1},d(i){s[e].d(i),i&&g(t)}}}function Bt(r){let e,o,t,n,l,s,u=r[20]&&Oe(r);return{c(){e=J("div"),u&&u.c(),this.h()},l(i){e=G(i,"DIV",{style:!0});var a=A(e);u&&u.l(a),a.forEach(g),this.h()},h(){$(e,"style",o=`width: ${r[1]}px; height: ${r[2]}px`)},m(i,a){y(i,e,a),u&&u.m(e,null),n=!0,l||(s=re(t=Pe.call(null,e,r[18])),l=!0)},p(i,a){i[20]?u?(u.p(i,a),a&1048576&&p(u,1)):(u=Oe(i),u.c(),p(u,1),u.m(e,null)):u&&(z(),b(u,1,1,()=>{u=null}),M()),(!n||a&6&&o!==(o=`width: ${i[1]}px; height: ${i[2]}px`))&&$(e,"style",o),t&&F(t.update)&&a&262144&&t.update.call(null,i[18])},i(i){n||(p(u),n=!0)},o(i){b(u),n=!1},d(i){i&&g(e),u&&u.d(),l=!1,s()}}}function jt(r){let e,o,t,n,l,s,u=r[20]&&Xe(r);return{c(){e=J("div"),u&&u.c(),this.h()},l(i){e=G(i,"DIV",{style:!0});var a=A(e);u&&u.l(a),a.forEach(g),this.h()},h(){$(e,"style",o=`width: ${r[1]}px; height: ${r[2]}px`)},m(i,a){y(i,e,a),u&&u.m(e,null),n=!0,l||(s=re(t=Pe.call(null,e,r[17])),l=!0)},p(i,a){i[20]?u?(u.p(i,a),a&1048576&&p(u,1)):(u=Xe(i),u.c(),p(u,1),u.m(e,null)):u&&(z(),b(u,1,1,()=>{u=null}),M()),(!n||a&6&&o!==(o=`width: ${i[1]}px; height: ${i[2]}px`))&&$(e,"style",o),t&&F(t.update)&&a&131072&&t.update.call(null,i[17])},i(i){n||(p(u),n=!0)},o(i){b(u),n=!1},d(i){i&&g(e),u&&u.d(),l=!1,s()}}}function Oe(r){let e,o;function t(...n){return r[9](r[13],...n)}return e=new Dt({props:{$$slots:{default:[Gt,({startRecording:n,stopRecording:l,currentTime:s})=>({23:n,24:l,25:s}),({startRecording:n,stopRecording:l,currentTime:s})=>(n?8388608:0)|(l?16777216:0)|(s?33554432:0)]},$$scope:{ctx:r}}}),e.$on("record-end",t),{c(){C(e.$$.fragment)},l(n){E(e.$$.fragment,n)},m(n,l){U(e,n,l),o=!0},p(n,l){r=n;const s={};l&131072008&&(s.$$scope={dirty:l,ctx:r}),e.$set(s)},i(n){o||(p(e.$$.fragment,n),o=!0)},o(n){b(e.$$.fragment,n),o=!1},d(n){W(e,n)}}}function Vt(r){let e;return{c(){e=te("Uploading...")},l(o){e=oe(o,"Uploading...")},m(o,t){y(o,e,t)},p:se,i:se,o:se,d(o){o&&g(e)}}}function Ot(r){let e,o;return e=new ee({props:{$$slots:{default:[Yt]},$$scope:{ctx:r}}}),e.$on("click",function(){F(r[24])&&r[24].apply(this,arguments)}),{c(){C(e.$$.fragment)},l(t){E(e.$$.fragment,t)},m(t,n){U(e,t,n),o=!0},p(t,n){r=t;const l={};n&67108864&&(l.$$scope={dirty:n,ctx:r}),e.$set(l)},i(t){o||(p(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){W(e,t)}}}function Xt(r){let e,o;return e=new ee({props:{$$slots:{default:[Ht]},$$scope:{ctx:r}}}),e.$on("click",function(){F(r[23])&&r[23].apply(this,arguments)}),{c(){C(e.$$.fragment)},l(t){E(e.$$.fragment,t)},m(t,n){U(e,t,n),o=!0},p(t,n){r=t;const l={};n&67108864&&(l.$$scope={dirty:n,ctx:r}),e.$set(l)},i(t){o||(p(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){W(e,t)}}}function Yt(r){let e;return{c(){e=te("Stop")},l(o){e=oe(o,"Stop")},m(o,t){y(o,e,t)},d(o){o&&g(e)}}}function Ht(r){let e;return{c(){e=te("Record")},l(o){e=oe(o,"Record")},m(o,t){y(o,e,t)},d(o){o&&g(e)}}}function qt(r){let e;return{c(){e=te("Wipe board")},l(o){e=oe(o,"Wipe board")},m(o,t){y(o,e,t)},d(o){o&&g(e)}}}function Jt(r){let e,o,t,n,l;const s=[Xt,Ot,Vt],u=[];function i(a,c){return a[3]==="pre_record"?0:a[3]==="mid_record"?1:2}return e=i(r),o=u[e]=s[e](r),n=new ee({props:{$$slots:{default:[qt]},$$scope:{ctx:r}}}),n.$on("click",function(){F(r[22])&&r[22].apply(this,arguments)}),{c(){o.c(),t=X(),C(n.$$.fragment)},l(a){o.l(a),t=Y(a),E(n.$$.fragment,a)},m(a,c){u[e].m(a,c),y(a,t,c),U(n,a,c),l=!0},p(a,c){r=a;let f=e;e=i(r),e===f?u[e].p(r,c):(z(),b(u[f],1,1,()=>{u[f]=null}),M(),o=u[e],o?o.p(r,c):(o=u[e]=s[e](r),o.c()),p(o,1),o.m(t.parentNode,t));const m={};c&67108864&&(m.$$scope={dirty:c,ctx:r}),n.$set(m)},i(a){l||(p(o),p(n.$$.fragment,a),l=!0)},o(a){b(o),b(n.$$.fragment,a),l=!1},d(a){u[e].d(a),a&&g(t),W(n,a)}}}function Gt(r){let e,o;function t(...n){return r[8](r[21],...n)}return e=new Ut({props:{strokesArray:r[20],currentTime:r[25],$$slots:{default:[Jt]},$$scope:{ctx:r}}}),e.$on("stroke-drawn",t),{c(){C(e.$$.fragment)},l(n){E(e.$$.fragment,n)},m(n,l){U(e,n,l),o=!0},p(n,l){r=n;const s={};l&1048576&&(s.strokesArray=r[20]),l&33554432&&(s.currentTime=r[25]),l&96469e3&&(s.$$scope={dirty:l,ctx:r}),e.$set(s)},i(n){o||(p(e.$$.fragment,n),o=!0)},o(n){b(e.$$.fragment,n),o=!1},d(n){W(e,n)}}}function Xe(r){let e,o;return e=new Ft({props:{strokesArray:r[20],audioDownloadURL:r[16].audioDownloadURL}}),{c(){C(e.$$.fragment)},l(t){E(e.$$.fragment,t)},m(t,n){U(e,t,n),o=!0},p(t,n){const l={};n&1048576&&(l.strokesArray=t[20]),n&65536&&(l.audioDownloadURL=t[16].audioDownloadURL),e.$set(l)},i(t){o||(p(e.$$.fragment,t),o=!0)},o(t){b(e.$$.fragment,t),o=!1},d(t){W(e,t)}}}function Kt(r){let e,o,t=r[16]&&Ve(r);return{c(){t&&t.c(),e=X()},l(n){t&&t.l(n),e=Y(n)},m(n,l){t&&t.m(n,l),y(n,e,l),o=!0},p(n,l){n[16]?t?(t.p(n,l),l&65536&&p(t,1)):(t=Ve(n),t.c(),p(t,1),t.m(e.parentNode,e)):t&&(z(),b(t,1,1,()=>{t=null}),M())},i(n){o||(p(t),o=!0)},o(n){b(t),o=!1},d(n){t&&t.d(n),n&&g(e)}}}function Ye(r,e){let o,t,n;return t=new bt({props:{dbPath:e[4]+e[13],$$slots:{default:[Kt,({boardDoc:l,fetchStrokes:s,listenToStrokes:u,isFetchingStrokes:i,strokesArray:a,handleNewlyDrawnStroke:c,deleteAllStrokesFromDb:f})=>({16:l,17:s,18:u,19:i,20:a,21:c,22:f}),({boardDoc:l,fetchStrokes:s,listenToStrokes:u,isFetchingStrokes:i,strokesArray:a,handleNewlyDrawnStroke:c,deleteAllStrokesFromDb:f})=>(l?65536:0)|(s?131072:0)|(u?262144:0)|(i?524288:0)|(a?1048576:0)|(c?2097152:0)|(f?4194304:0)]},$$scope:{ctx:e}}}),{key:r,first:null,c(){o=K(),C(t.$$.fragment),this.h()},l(l){o=K(),E(t.$$.fragment,l),this.h()},h(){this.first=o},m(l,s){y(l,o,s),U(t,l,s),n=!0},p(l,s){e=l;const u={};s&1&&(u.dbPath=e[4]+e[13]),s&72810511&&(u.$$scope={dirty:s,ctx:e}),t.$set(u)},i(l){n||(p(t.$$.fragment,l),n=!0)},o(l){b(t.$$.fragment,l),n=!1},d(l){l&&g(o),W(t,l)}}}function Qt(r){let e,o,t=r[0]&&je(r);return{c(){t&&t.c(),e=K()},l(n){t&&t.l(n),e=K()},m(n,l){t&&t.m(n,l),y(n,e,l),o=!0},p(n,[l]){n[0]?t?(t.p(n,l),l&1&&p(t,1)):(t=je(n),t.c(),p(t,1),t.m(e.parentNode,e)):t&&(z(),b(t,1,1,()=>{t=null}),M())},i(n){o||(p(t),o=!0)},o(n){b(t),o=!1},d(n){t&&t.d(n),n&&g(e)}}}function so({page:r}){return{props:{classID:r.params.class,roomID:r.params.room}}}function Zt(r,e,o){let t,n;x(r,Ie,h=>o(10,t=h)),x(r,_e,h=>o(3,n=h));let{classID:l}=e,{roomID:s}=e,u;const i=`classes/${l}/blackboards/`,a=`classes/${l}/rooms/`;let c,f;t.uid||(console.log("redirecting to tutorial"),_t("/")),he(async()=>{o(0,u=await Ae(a+s));const h=Ne();o(1,c=h.width+50),o(2,f=h.height+50)});async function m(){o(0,u=await Ae(a+s))}async function k(h,w){console.log("saveVideo(), audioBlob =",h);const L=at(),v=ct(L,`audio/${Fe()}`);console.log("audioRef =",v),await ut(v,h);const _=await ft(v);console.log("downloadURL =",_);const D=de(N(),i+w);await dt(D,{creatorUID:t.uid,creatorPhoneNumber:t.phoneNumber,date:new Date().toISOString(),audioDownloadURL:_}),console.log("updated doc =",{creatorUID:t.uid,creatorPhoneNumber:t.phoneNumber,date:new Date().toISOString(),audioDownloadURL:_})}const R=(h,w)=>h(w.detail.newStroke),P=(h,w)=>k(w.detail.audioBlob,h);return r.$$set=h=>{"classID"in h&&o(6,l=h.classID),"roomID"in h&&o(7,s=h.roomID)},r.$$.update=()=>{r.$$.dirty&128&&m()},[u,c,f,n,i,k,l,s,R,P]}class io extends j{constructor(e){super();V(this,e,Zt,Qt,O,{classID:6,roomID:7})}}export{io as default,so as load};

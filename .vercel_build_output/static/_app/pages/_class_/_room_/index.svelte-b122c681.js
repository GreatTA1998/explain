var rt=Object.defineProperty;var Se=Object.getOwnPropertySymbols;var nt=Object.prototype.hasOwnProperty,st=Object.prototype.propertyIsEnumerable;var Ae=(n,e,t)=>e in n?rt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,G=(n,e)=>{for(var t in e||(e={}))nt.call(e,t)&&Ae(n,t,e[t]);if(Se)for(var t of Se(e))st.call(e,t)&&Ae(n,t,e[t]);return n};import{S as J,i as K,s as Z,G as ue,H as ce,I as fe,J as de,x as p,u as k,U as lt,O as M,N as Y,ag as we,aa as Le,an as at,ao as it,ap as ut,Q as ct,aq as ft,ar as Ie,D as j,A as _e,as as dt,at as Pe,j as E,m as C,o as U,v as N,W as x,k as z,n as V,f as D,r as O,w as q,a3 as mt,d as b,t as ee,g as te,au as oe,av as re,a as F,b as w,K as pe,L as ne,e as se,c as le,am as me,aw as Ee,Y as ye,a9 as Ce,al as Ue,ah as De,ai as ht,l as H,X as Ne,ax as _t,ay as ge,az as Fe,aA as We,aB as pt,aC as gt,aD as bt,aE as he,aF as ae,M as Te}from"../../../chunks/vendor-c19200ff.js";import{f as kt,a as $t}from"../../../chunks/database-a806175c.js";import{d as Be,b as be,u as Me,e as ve,c as Re,a as je}from"../../../chunks/store-4e284ae9.js";import{d as ke,a as ze,g as Ve,p as wt,l as Oe}from"../../../chunks/canvas-ec00c90d.js";import{g as yt}from"../../../chunks/navigation-51f4a605.js";import"../../../chunks/singletons-12a22614.js";const Dt=n=>({boardDoc:n&4,isFetchingStrokes:n&2,strokesArray:n&1}),qe=n=>({boardDoc:n[2],fetchStrokes:n[3],listenToStrokes:n[4],isFetchingStrokes:n[1],strokesArray:n[0],handleNewlyDrawnStroke:n[5],deleteAllStrokesFromDb:n[6]});function Tt(n){let e;const t=n[9].default,o=ue(t,n,n[8],qe);return{c(){o&&o.c()},l(r){o&&o.l(r)},m(r,s){o&&o.m(r,s),e=!0},p(r,[s]){o&&o.p&&(!e||s&263)&&ce(o,t,r,r[8],e?de(t,r[8],s,Dt):fe(r[8]),qe)},i(r){e||(p(o,r),e=!0)},o(r){k(o,r),e=!1},d(r){o&&o.d(r)}}}function He(n){const e=G({id:n.id},n.data());return e.startTime=0,e.endTime=0,n.data().isErasing||(e.endTime+=.5),e}function vt(n,e,t){let{$$slots:o={},$$scope:r}=e,{dbPath:s}=e,l,u=!1,a,c;const i=lt(M(),`${s}/strokes`),m=Y(M(),s);we(m,y=>{t(2,a=G({id:y.id},y.data()))}),Le(()=>{c&&c()});async function f(){t(1,u=!0),t(0,l=await kt(s+"/strokes"))}async function d(){t(1,u=!0);const y=at(i,it("timestamp"));c=we(y,async T=>{T.docChanges().filter(A=>A.type==="removed").length>0?(t(0,l=[]),await ut(),T.docs.length>0&&T.docs.forEach(A=>{l.push(He(A))})):(l||(t(1,u=!1),t(0,l=[])),T.docs.length===l.length||T.docChanges().filter(A=>A.type==="added").forEach(A=>{t(0,l=[...l,He(A.doc)])}))})}function g(y){l.push(y);try{ct(Y(M(),`${s}/strokes/${y.id}`),G({timestamp:ft()},y))}catch(T){alert(T)}}async function L(){const y=[];let T=Ie(M()),P=0;for(const A of l){P>=500&&(y.push(T.commit()),T=Ie(M()),P=0);const X=Y(M(),`${s}/strokes/${A.id}`);T.delete(X),P+=1}y.push(T.commit()),console.log("number of strokes =",l.length),console.log("number of batches to be deleted =",P),await Promise.all(y)}return n.$$set=y=>{"dbPath"in y&&t(7,s=y.dbPath),"$$scope"in y&&t(8,r=y.$$scope)},[l,u,a,f,d,g,L,s,r,o]}class Rt extends J{constructor(e){super();K(this,e,vt,Tt,Z,{dbPath:7})}}const St=n=>({currentTime:n&1}),Xe=n=>({startRecording:n[1],stopRecording:n[2],currentTime:n[0]});function At(n){let e;const t=n[4].default,o=ue(t,n,n[3],Xe);return{c(){o&&o.c()},l(r){o&&o.l(r)},m(r,s){o&&o.m(r,s),e=!0},p(r,[s]){o&&o.p&&(!e||s&9)&&ce(o,t,r,r[3],e?de(t,r[3],s,St):fe(r[3]),Xe)},i(r){e||(p(o,r),e=!0)},o(r){k(o,r),e=!1},d(r){o&&o.d(r)}}}function Lt(n,e,t){let o;j(n,Be,f=>t(7,o=f));let{$$slots:r={},$$scope:s}=e,l=0,u;_e(()=>{window&&(window.MediaRecorder=dt)});const a=Pe();let c=null;function i(){return new Promise(async f=>{if(!o){const g=await navigator.mediaDevices.getUserMedia({audio:!0});Be.set(g)}const d=o.clone();c=new MediaRecorder(d),c.start(),u=setInterval(()=>t(0,l+=.1),100),a("record-start"),be.set("mid_record"),f()})}function m(){return new Promise((f,d)=>{clearTimeout(u),be.set("post_record"),c.addEventListener("dataavailable",g=>{const L=g.data;a("record-end",{audioBlob:L}),f(),be.set("pre_record")}),c.stop();for(const g of c.stream.getTracks())g.stop()})}return n.$$set=f=>{"$$scope"in f&&t(3,s=f.$$scope)},[l,i,m,s,r]}class It extends J{constructor(e){super();K(this,e,Lt,At,Z,{})}}function Ye(n,e,t){const o=n.slice();return o[5]=e[t],o}function Pt(n){let e,t,o,r,s,l,u,a;return{c(){e=oe("svg"),t=oe("g"),o=oe("path"),r=oe("polygon"),l=oe("path"),u=oe("path"),this.h()},l(c){e=re(c,"svg",{preserveAspectRatio:!0,version:!0,id:!0,xmlns:!0,"xmlns:xlink":!0,x:!0,y:!0,width:!0,height:!0,":viewbox":!0,style:!0,"xml:space":!0});var i=F(e);t=re(i,"g",{});var m=F(t);o=re(m,"path",{d:!0}),F(o).forEach(b),r=re(m,"polygon",{style:!0,points:!0}),F(r).forEach(b),l=re(m,"path",{style:!0,d:!0}),F(l).forEach(b),u=re(m,"path",{style:!0,d:!0}),F(u).forEach(b),m.forEach(b),i.forEach(b),this.h()},h(){w(o,"d",`M0,0v72.377c0,1.588,0.234,3.169,0.698,4.706l45.416,150.032C46.633,228.828,48.212,230,50,230s3.367-1.172,3.886-2.883\r
          L99.31,77.079c0.457-1.525,0.69-3.108,0.69-4.702V0.002`),w(r,"style",s=`fill: ${n[5]};`),w(r,"points","50,211.978 38.879,175.24 61.122,175.24"),pe(l,"fill","#424242"),w(l,"d",`M63.581,167.118H36.42L8.765,75.761l10.924-9.63l12.5,11.015c1.54,1.353,3.835,1.35,5.375-0.002\r
            l12.468-11.007l12.464,11.005c1.54,1.357,3.839,1.357,5.377,0l12.465-11.005l10.9,9.623L63.581,167.118z`),w(u,"style",a=`fill: ${n[5]};`),w(u,"d",`M91.878,0v65.486l-8.852-7.813c-1.539-1.353-3.838-1.354-5.377,0.002L65.185,68.679L52.72,57.674\r
            c-1.539-1.356-3.838-1.354-5.377-0.002L34.871,68.683L22.375,57.67c-0.769-0.676-1.725-1.013-2.685-1.013\r
            c-0.959,0-1.919,0.339-2.685,1.013L8.121,65.5L8.098,0.024L91.878,0z`),w(e,"preserveAspectRatio","none"),w(e,"version","1.1"),w(e,"id","Layer_1"),w(e,"xmlns","http://www.w3.org/2000/svg"),w(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),w(e,"x","0px"),w(e,"y","0px"),w(e,"width","16px"),w(e,"height","35px"),w(e,":viewbox","`0 0 100 230`"),pe(e,"enable-background","new 0 0 100 230"),w(e,"xml:space","preserve")},m(c,i){D(c,e,i),ne(e,t),ne(t,o),ne(t,r),ne(t,l),ne(t,u)},p(c,i){i&1&&s!==(s=`fill: ${c[5]};`)&&w(r,"style",s),i&1&&a!==(a=`fill: ${c[5]};`)&&w(u,"style",a)},d(c){c&&b(e)}}}function Qe(n){let e,t;function o(){return n[2](n[5])}return e=new x({props:{$$slots:{default:[Pt]},$$scope:{ctx:n}}}),e.$on("click",o),{c(){E(e.$$.fragment)},l(r){C(e.$$.fragment,r)},m(r,s){U(e,r,s),t=!0},p(r,s){n=r;const l={};s&17&&(l.$$scope={dirty:s,ctx:n}),e.$set(l)},i(r){t||(p(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Et(n){let e;return{c(){e=ee("Eraser")},l(t){e=te(t,"Eraser")},m(t,o){D(t,e,o)},d(t){t&&b(e)}}}function Ct(n){let e,t,o,r,s=n[0].pencilColors,l=[];for(let i=0;i<s.length;i+=1)l[i]=Qe(Ye(n,s,i));const u=i=>k(l[i],1,1,()=>{l[i]=null});t=new x({props:{$$slots:{default:[Et]},$$scope:{ctx:n}}}),t.$on("click",n[3]);const a=n[1].default,c=ue(a,n,n[4],null);return{c(){for(let i=0;i<l.length;i+=1)l[i].c();e=z(),E(t.$$.fragment),o=z(),c&&c.c()},l(i){for(let m=0;m<l.length;m+=1)l[m].l(i);e=V(i),C(t.$$.fragment,i),o=V(i),c&&c.l(i)},m(i,m){for(let f=0;f<l.length;f+=1)l[f].m(i,m);D(i,e,m),U(t,i,m),D(i,o,m),c&&c.m(i,m),r=!0},p(i,[m]){if(m&1){s=i[0].pencilColors;let d;for(d=0;d<s.length;d+=1){const g=Ye(i,s,d);l[d]?(l[d].p(g,m),p(l[d],1)):(l[d]=Qe(g),l[d].c(),p(l[d],1),l[d].m(e.parentNode,e))}for(O(),d=s.length;d<l.length;d+=1)u(d);q()}const f={};m&16&&(f.$$scope={dirty:m,ctx:i}),t.$set(f),c&&c.p&&(!r||m&16)&&ce(c,a,i,i[4],r?de(a,i[4],m,null):fe(i[4]),null)},i(i){if(!r){for(let m=0;m<s.length;m+=1)p(l[m]);p(t.$$.fragment,i),p(c,i),r=!0}},o(i){l=l.filter(Boolean);for(let m=0;m<l.length;m+=1)k(l[m]);k(t.$$.fragment,i),k(c,i),r=!1},d(i){mt(l,i),i&&b(e),N(t,i),i&&b(o),c&&c.d(i)}}}function Ut(n,e,t){let o;j(n,Me,a=>t(0,o=a));let{$$slots:r={},$$scope:s}=e;const l=a=>ve.set({type:"pencil",color:a,lineWidth:3}),u=()=>ve.set({type:"eraser",color:"",lineWidth:40});return n.$$set=a=>{"$$scope"in a&&t(4,s=a.$$scope)},[o,r,l,u,s]}class Nt extends J{constructor(e){super();K(this,e,Ut,Ct,Z,{})}}function Ft(n){let e;const t=n[11].default,o=ue(t,n,n[13],null);return{c(){o&&o.c()},l(r){o&&o.l(r)},m(r,s){o&&o.m(r,s),e=!0},p(r,s){o&&o.p&&(!e||s&8192)&&ce(o,t,r,r[13],e?de(t,r[13],s,null):fe(r[13]),null)},i(r){e||(p(o,r),e=!0)},o(r){k(o,r),e=!1},d(r){o&&o.d(r)}}}function Wt(n){let e,t,o,r,s,l,u;return e=new Nt({props:{$$slots:{default:[Ft]},$$scope:{ctx:n}}}),{c(){E(e.$$.fragment),t=z(),o=se("canvas"),this.h()},l(a){C(e.$$.fragment,a),t=V(a),o=le(a,"CANVAS",{style:!0});var c=F(o);c.forEach(b),this.h()},h(){w(o,"style",r=`background-color: #2e3131; width: ${n[2]}; height: ${n[1]}`)},m(a,c){U(e,a,c),D(a,t,c),D(a,o,c),n[12](o),s=!0,l||(u=[me(o,"touchstart",n[3]),me(o,"touchmove",n[4]),me(o,"touchend",n[5])],l=!0)},p(a,[c]){const i={};c&8192&&(i.$$scope={dirty:c,ctx:a}),e.$set(i),(!s||c&6&&r!==(r=`background-color: #2e3131; width: ${a[2]}; height: ${a[1]}`))&&w(o,"style",r)},i(a){s||(p(e.$$.fragment,a),s=!0)},o(a){k(e.$$.fragment,a),s=!1},d(a){N(e,a),a&&b(t),a&&b(o),n[12](null),l=!1,Ee(u)}}}function Bt(n){return(n.endTime-n.startTime)/n.points.length}function Mt(n,e,t){let o,r,s;j(n,Re,h=>t(1,o=h)),j(n,je,h=>t(2,r=h)),j(n,ve,h=>t(17,s=h));let{$$slots:l={},$$scope:u}=e,{strokesArray:a}=e,{currentTime:c=0}=e;const i=Pe();let m,f=[],d,g=!1,L={x:-1,y:-1},y={points:[]},T;_e(()=>{t(8,m=d.getContext("2d"))});function P(h){h.touches.length>1||(h.touches[0].touchType,S(h,{isInitialContact:!0}))}function A(h){if(!!g){if(h.touches.length>1){console.log("touchmove ignored: only 1 finger allowed");return}h.touches[0].touchType,S(h,{isInitialContact:!1})}}function X(h){!g||h.touches.length>0||(h.changedTouches[0].touchType,_(y),g=!1)}function $(h){g=!0,L={x:-1,y:-1},y={strokeNumber:a.length+1,startTime:Number(c.toFixed(1)),color:s.color,lineWidth:s.lineWidth,isErasing:s.type==="eraser",points:[],sessionID:"123"}}function S(h,{isInitialContact:I}){h.preventDefault(),I&&$();const B=v(h);W(h,B)}function W(h,I){y.points.push({unitX:parseFloat(I.x/d.width).toFixed(4),unitY:parseFloat(I.y/d.height).toFixed(4)}),L.x!==-1&&L.y!==-1&&ze([R(L),R(I)],1,s.type==="eraser",m,s.color,s.lineWidth,d),L=I}function _(h){h.endTime=Number(c.toFixed(1)),h.id=Ve(),f.push(h),i("stroke-drawn",{newStroke:h})}function v(h){const{left:I,top:B}=d.getBoundingClientRect();return{x:h.touches[0].pageX-I-window.scrollX,y:h.touches[0].pageY-B-window.scrollY}}function R({x:h,y:I}){return{unitX:h/d.width,unitY:I/d.height}}function ie(){m.clearRect(0,0,r,o)}function $e(h){ye[h?"unshift":"push"](()=>{d=h,t(0,d),t(8,m),t(2,r),t(1,o),t(6,a)})}return n.$$set=h=>{"strokesArray"in h&&t(6,a=h.strokesArray),"currentTime"in h&&t(7,c=h.currentTime),"$$scope"in h&&t(13,u=h.$$scope)},n.$$.update=()=>{if(n.$$.dirty&327&&m){t(0,d.width=r,d),t(0,d.height=o,d);for(const h of a)ke(h,null,m,d)}if(n.$$.dirty&1857&&m){let h=f.length,I=a.length;if(h!==I)if(h<I)if(h===0){for(const B of a)ke(B,null,m,d);t(9,f=[...a])}else for(let B=h;B<I;B++){const Q=a[B];ke(Q,Q.startTime!==Q.endTime?Bt(Q):null,m,d),f.push(Q)}else{let B=function(){ie(),t(9,f=[]),L={x:-1,y:-1};for(const ot of a)ke(ot,null,m,d)};(function(){console.log("debounced board reset"),T&&clearTimeout(T),t(10,T=setTimeout(B,1e3))})()}}},[d,o,r,P,A,X,a,c,m,f,T,l,$e,u]}class jt extends J{constructor(e){super();K(this,e,Mt,Wt,Z,{strokesArray:6,currentTime:7})}}function zt(n){let e,t,o,r,s,l,u,a,c;const i=n[10].default,m=ue(i,n,n[9],null);return{c(){m&&m.c(),e=z(),t=se("canvas"),r=z(),s=se("audio"),this.h()},l(f){m&&m.l(f),e=V(f),t=le(f,"CANVAS",{style:!0});var d=F(t);d.forEach(b),r=V(f),s=le(f,"AUDIO",{src:!0,style:!0});var g=F(s);g.forEach(b),this.h()},h(){w(t,"style",o=`background-color: #2e3131; width: ${n[3]}; height: ${n[2]}`),Ce(s.src,l=n[0])||w(s,"src",l),s.controls=!0,pe(s,"width","100%")},m(f,d){m&&m.m(f,d),D(f,e,d),D(f,t,d),n[11](t),D(f,r,d),D(f,s,d),n[12](s),u=!0,a||(c=[me(s,"play",n[5]),me(s,"seeking",n[6])],a=!0)},p(f,[d]){m&&m.p&&(!u||d&512)&&ce(m,i,f,f[9],u?de(i,f[9],d,null):fe(f[9]),null),(!u||d&12&&o!==(o=`background-color: #2e3131; width: ${f[3]}; height: ${f[2]}`))&&w(t,"style",o),(!u||d&1&&!Ce(s.src,l=f[0]))&&w(s,"src",l)},i(f){u||(p(m,f),u=!0)},o(f){k(m,f),u=!1},d(f){m&&m.d(f),f&&b(e),f&&b(t),n[11](null),f&&b(r),f&&b(s),n[12](null),a=!1,Ee(c)}}}let Vt=1;function Ot(n){return(n.endTime-n.startTime)/n.points.length}function qt(n,e,t){let o,r;j(n,Re,_=>t(2,o=_)),j(n,je,_=>t(3,r=_));let{$$slots:s={},$$scope:l}=e,{strokesArray:u}=e,{audioDownloadURL:a}=e,c,i=0,m,f,d,g;Le(()=>{g&&clearTimeout(g)}),_e(()=>{t(8,f=m.getContext("2d"));const _=[];for(let v=0;v<u.length;v++)for(let R=1;R<u[v].points.length;R++){const ie={strokeIndex:v,pointIndex:R};_.push(G({startTime:L(ie)},ie))}c=_.sort((v,R)=>v.startTime-R.startTime)});function L({strokeIndex:_,pointIndex:v}){const R=u[_];return R.startTime+(v-1)*Ot(R)}function y(){i=0,f.clearRect(0,0,r,o),T()}function T(){if(!!d&&(P(),i<c.length)){const _=c[i],v=1e3*(_.startTime-d.currentTime);g=setTimeout(T,v/Vt)}}function P(){if(!d)return;const _=c[i];(!_||_.startTime>d.currentTime)&&(f.clearRect(0,0,m.width,m.height),i=0),A()}function A(){const{currentTime:_}=d;for(let v=i;v<c.length;v++){const R=c[v];if(R.startTime>_)break;X(R),i+=1}}function X({strokeIndex:_,pointIndex:v}){const R=u[_],$e=R.lineWidth*(m.scrollWidth/1e3);ze(R.points,v,R.isErasing,f,R.color,$e,m)}function $(){return new Promise(async _=>{g?(i=0,P()):A(),_()})}function S(_){ye[_?"unshift":"push"](()=>{m=_,t(4,m),t(8,f),t(1,d),t(3,r),t(2,o)})}function W(_){ye[_?"unshift":"push"](()=>{d=_,t(1,d)})}return n.$$set=_=>{"strokesArray"in _&&t(7,u=_.strokesArray),"audioDownloadURL"in _&&t(0,a=_.audioDownloadURL),"$$scope"in _&&t(9,l=_.$$scope)},n.$$.update=()=>{n.$$.dirty&270&&f&&d&&(t(4,m.width=r,m),t(4,m.height=o,m),$())},[a,d,o,r,m,y,P,u,f,l,s,S,W]}class Ht extends J{constructor(e){super();K(this,e,qt,zt,Z,{strokesArray:7,audioDownloadURL:0})}}function Ge(n,e,t){const o=n.slice();return o[18]=e[t],o}function Je(n){let e,t,o,r=[],s=new Map,l,u,a,c;t=new Ne({props:{value:n[0].name,class:"room-title",style:"width: 100%; margin-bottom: 20px;"}}),t.$on("input",n[10]);let i=n[0].blackboards;const m=f=>f[18];for(let f=0;f<i.length;f+=1){let d=Ge(n,i,f),g=m(d);s.set(g,r[f]=tt(g,d))}return{c(){e=se("div"),E(t.$$.fragment),o=z();for(let f=0;f<r.length;f+=1)r[f].c();this.h()},l(f){e=le(f,"DIV",{style:!0});var d=F(e);C(t.$$.fragment,d),o=V(d);for(let g=0;g<r.length;g+=1)r[g].l(d);d.forEach(b),this.h()},h(){pe(e,"padding","16px"),Ue(e,"question",n[0].name.charAt(n[0].name.length-1)==="?")},m(f,d){D(f,e,d),U(t,e,null),ne(e,o);for(let g=0;g<r.length;g+=1)r[g].m(e,null);u=!0,a||(c=De(l=wt.call(null,e,"main-content")),a=!0)},p(f,d){const g={};d&1&&(g.value=f[0].name),t.$set(g),d&1038090479&&(i=f[0].blackboards,O(),r=ht(r,d,m,1,f,i,s,e,_t,tt,null,Ge),q()),d&1&&Ue(e,"question",f[0].name.charAt(f[0].name.length-1)==="?")},i(f){if(!u){p(t.$$.fragment,f);for(let d=0;d<i.length;d+=1)p(r[d]);u=!0}},o(f){k(t.$$.fragment,f);for(let d=0;d<r.length;d+=1)k(r[d]);u=!1},d(f){f&&b(e),N(t);for(let d=0;d<r.length;d+=1)r[d].d();a=!1,c()}}}function Ke(n){let e,t,o,r,s,l=n[24]&&Ze(n);const u=[Yt,Xt],a=[];function c(i,m){return i[21].audioDownloadURL?0:1}return t=c(n),o=a[t]=u[t](n),{c(){l&&l.c(),e=z(),o.c(),r=H()},l(i){l&&l.l(i),e=V(i),o.l(i),r=H()},m(i,m){l&&l.m(i,m),D(i,e,m),a[t].m(i,m),D(i,r,m),s=!0},p(i,m){i[24]?l?(l.p(i,m),m&16777216&&p(l,1)):(l=Ze(i),l.c(),p(l,1),l.m(e.parentNode,e)):l&&(O(),k(l,1,1,()=>{l=null}),q());let f=t;t=c(i),t===f?a[t].p(i,m):(O(),k(a[f],1,1,()=>{a[f]=null}),q(),o=a[t],o?o.p(i,m):(o=a[t]=u[t](i),o.c()),p(o,1),o.m(r.parentNode,r))},i(i){s||(p(l),p(o),s=!0)},o(i){k(l),k(o),s=!1},d(i){l&&l.d(i),i&&b(e),a[t].d(i),i&&b(r)}}}function Ze(n){let e,t;function o(...r){return n[11](n[18],...r)}return e=new Ne({props:{textarea:!0,value:n[21].description||"",style:"width: 100%; margin-bottom: 10px"}}),e.$on("input",o),{c(){E(e.$$.fragment)},l(r){C(e.$$.fragment,r)},m(r,s){U(e,r,s),t=!0},p(r,s){n=r;const l={};s&2097152&&(l.value=n[21].description||""),e.$set(l)},i(r){t||(p(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Xt(n){let e,t,o,r,s,l,u=n[24]&&xe(n);return{c(){e=se("div"),u&&u.c(),this.h()},l(a){e=le(a,"DIV",{style:!0});var c=F(e);u&&u.l(c),c.forEach(b),this.h()},h(){w(e,"style",t=`width: 100%; height: ${n[1]+80}px`)},m(a,c){D(a,e,c),u&&u.m(e,null),r=!0,s||(l=De(o=Oe.call(null,e,n[23])),s=!0)},p(a,c){a[24]?u?(u.p(a,c),c&16777216&&p(u,1)):(u=xe(a),u.c(),p(u,1),u.m(e,null)):u&&(O(),k(u,1,1,()=>{u=null}),q()),(!r||c&2&&t!==(t=`width: 100%; height: ${a[1]+80}px`))&&w(e,"style",t),o&&ae(o.update)&&c&8388608&&o.update.call(null,a[23])},i(a){r||(p(u),r=!0)},o(a){k(u),r=!1},d(a){a&&b(e),u&&u.d(),s=!1,l()}}}function Yt(n){let e,t,o,r,s,l,u=n[24]&&et(n);return{c(){e=se("div"),u&&u.c(),this.h()},l(a){e=le(a,"DIV",{style:!0});var c=F(e);u&&u.l(c),c.forEach(b),this.h()},h(){w(e,"style",t=`width: 100%; height: ${n[1]+80}px`)},m(a,c){D(a,e,c),u&&u.m(e,null),r=!0,s||(l=De(o=Oe.call(null,e,n[22])),s=!0)},p(a,c){a[24]?u?(u.p(a,c),c&16777216&&p(u,1)):(u=et(a),u.c(),p(u,1),u.m(e,null)):u&&(O(),k(u,1,1,()=>{u=null}),q()),(!r||c&2&&t!==(t=`width: 100%; height: ${a[1]+80}px`))&&w(e,"style",t),o&&ae(o.update)&&c&4194304&&o.update.call(null,a[22])},i(a){r||(p(u),r=!0)},o(a){k(u),r=!1},d(a){a&&b(e),u&&u.d(),s=!1,l()}}}function xe(n){let e,t;function o(...r){return n[13](n[18],...r)}return e=new It({props:{$$slots:{default:[to,({startRecording:r,stopRecording:s,currentTime:l})=>({27:r,28:s,29:l}),({startRecording:r,stopRecording:s,currentTime:l})=>(r?134217728:0)|(s?268435456:0)|(l?536870912:0)]},$$scope:{ctx:n}}}),e.$on("record-end",o),{c(){E(e.$$.fragment)},l(r){C(e.$$.fragment,r)},m(r,s){U(e,r,s),t=!0},p(r,s){n=r;const l={};s&2097152004&&(l.$$scope={dirty:s,ctx:n}),e.$set(l)},i(r){t||(p(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function Qt(n){let e;return{c(){e=ee("Uploading...")},l(t){e=te(t,"Uploading...")},m(t,o){D(t,e,o)},p:Te,i:Te,o:Te,d(t){t&&b(e)}}}function Gt(n){let e,t;return e=new x({props:{$$slots:{default:[Kt]},$$scope:{ctx:n}}}),e.$on("click",function(){ae(n[28])&&n[28].apply(this,arguments)}),{c(){E(e.$$.fragment)},l(o){C(e.$$.fragment,o)},m(o,r){U(e,o,r),t=!0},p(o,r){n=o;const s={};r&1073741824&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(o){t||(p(e.$$.fragment,o),t=!0)},o(o){k(e.$$.fragment,o),t=!1},d(o){N(e,o)}}}function Jt(n){let e,t,o,r;return e=new x({props:{$$slots:{default:[Zt]},$$scope:{ctx:n}}}),e.$on("click",function(){ae(n[27])&&n[27].apply(this,arguments)}),o=new x({props:{$$slots:{default:[xt]},$$scope:{ctx:n}}}),o.$on("click",function(){ae(n[26])&&n[26].apply(this,arguments)}),{c(){E(e.$$.fragment),t=z(),E(o.$$.fragment)},l(s){C(e.$$.fragment,s),t=V(s),C(o.$$.fragment,s)},m(s,l){U(e,s,l),D(s,t,l),U(o,s,l),r=!0},p(s,l){n=s;const u={};l&1073741824&&(u.$$scope={dirty:l,ctx:n}),e.$set(u);const a={};l&1073741824&&(a.$$scope={dirty:l,ctx:n}),o.$set(a)},i(s){r||(p(e.$$.fragment,s),p(o.$$.fragment,s),r=!0)},o(s){k(e.$$.fragment,s),k(o.$$.fragment,s),r=!1},d(s){N(e,s),s&&b(t),N(o,s)}}}function Kt(n){let e;return{c(){e=ee("Stop")},l(t){e=te(t,"Stop")},m(t,o){D(t,e,o)},d(t){t&&b(e)}}}function Zt(n){let e;return{c(){e=ee("Record")},l(t){e=te(t,"Record")},m(t,o){D(t,e,o)},d(t){t&&b(e)}}}function xt(n){let e;return{c(){e=ee("Wipe board")},l(t){e=te(t,"Wipe board")},m(t,o){D(t,e,o)},d(t){t&&b(e)}}}function eo(n){let e,t,o,r;const s=[Jt,Gt,Qt],l=[];function u(a,c){return a[2]==="pre_record"?0:a[2]==="mid_record"?1:2}return e=u(n),t=l[e]=s[e](n),{c(){t.c(),o=H()},l(a){t.l(a),o=H()},m(a,c){l[e].m(a,c),D(a,o,c),r=!0},p(a,c){let i=e;e=u(a),e===i?l[e].p(a,c):(O(),k(l[i],1,1,()=>{l[i]=null}),q(),t=l[e],t?t.p(a,c):(t=l[e]=s[e](a),t.c()),p(t,1),t.m(o.parentNode,o))},i(a){r||(p(t),r=!0)},o(a){k(t),r=!1},d(a){l[e].d(a),a&&b(o)}}}function to(n){let e,t;function o(...r){return n[12](n[25],...r)}return e=new jt({props:{strokesArray:n[24],currentTime:n[29],$$slots:{default:[eo]},$$scope:{ctx:n}}}),e.$on("stroke-drawn",o),{c(){E(e.$$.fragment)},l(r){C(e.$$.fragment,r)},m(r,s){U(e,r,s),t=!0},p(r,s){n=r;const l={};s&16777216&&(l.strokesArray=n[24]),s&536870912&&(l.currentTime=n[29]),s&1543503876&&(l.$$scope={dirty:s,ctx:n}),e.$set(l)},i(r){t||(p(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){N(e,r)}}}function et(n){let e,t;return e=new Ht({props:{strokesArray:n[24],audioDownloadURL:n[21].audioDownloadURL,$$slots:{default:[ro]},$$scope:{ctx:n}}}),{c(){E(e.$$.fragment)},l(o){C(e.$$.fragment,o)},m(o,r){U(e,o,r),t=!0},p(o,r){const s={};r&16777216&&(s.strokesArray=o[24]),r&2097152&&(s.audioDownloadURL=o[21].audioDownloadURL),r&1075838976&&(s.$$scope={dirty:r,ctx:o}),e.$set(s)},i(o){t||(p(e.$$.fragment,o),t=!0)},o(o){k(e.$$.fragment,o),t=!1},d(o){N(e,o)}}}function oo(n){let e;return{c(){e=ee("Revert to board")},l(t){e=te(t,"Revert to board")},m(t,o){D(t,e,o)},d(t){t&&b(e)}}}function ro(n){let e,t;return e=new x({props:{$$slots:{default:[oo]},$$scope:{ctx:n}}}),e.$on("click",function(){ae(n[7](n[21]))&&n[7](n[21]).apply(this,arguments)}),{c(){E(e.$$.fragment)},l(o){C(e.$$.fragment,o)},m(o,r){U(e,o,r),t=!0},p(o,r){n=o;const s={};r&1073741824&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(o){t||(p(e.$$.fragment,o),t=!0)},o(o){k(e.$$.fragment,o),t=!1},d(o){N(e,o)}}}function no(n){let e,t,o=n[21]&&Ke(n);return{c(){o&&o.c(),e=z()},l(r){o&&o.l(r),e=V(r)},m(r,s){o&&o.m(r,s),D(r,e,s),t=!0},p(r,s){r[21]?o?(o.p(r,s),s&2097152&&p(o,1)):(o=Ke(r),o.c(),p(o,1),o.m(e.parentNode,e)):o&&(O(),k(o,1,1,()=>{o=null}),q())},i(r){t||(p(o),t=!0)},o(r){k(o),t=!1},d(r){o&&o.d(r),r&&b(e)}}}function tt(n,e){let t,o,r;return o=new Rt({props:{dbPath:e[3]+e[18],$$slots:{default:[no,({boardDoc:s,fetchStrokes:l,listenToStrokes:u,strokesArray:a,handleNewlyDrawnStroke:c,deleteAllStrokesFromDb:i})=>({21:s,22:l,23:u,24:a,25:c,26:i}),({boardDoc:s,fetchStrokes:l,listenToStrokes:u,strokesArray:a,handleNewlyDrawnStroke:c,deleteAllStrokesFromDb:i})=>(s?2097152:0)|(l?4194304:0)|(u?8388608:0)|(a?16777216:0)|(c?33554432:0)|(i?67108864:0)]},$$scope:{ctx:e}}}),{key:n,first:null,c(){t=H(),E(o.$$.fragment),this.h()},l(s){t=H(),C(o.$$.fragment,s),this.h()},h(){this.first=t},m(s,l){D(s,t,l),U(o,s,l),r=!0},p(s,l){e=s;const u={};l&1&&(u.dbPath=e[3]+e[18]),l&1172307975&&(u.$$scope={dirty:l,ctx:e}),o.$set(u)},i(s){r||(p(o.$$.fragment,s),r=!0)},o(s){k(o.$$.fragment,s),r=!1},d(s){s&&b(t),N(o,s)}}}function so(n){let e,t,o=n[0]&&Je(n);return{c(){o&&o.c(),e=H()},l(r){o&&o.l(r),e=H()},m(r,s){o&&o.m(r,s),D(r,e,s),t=!0},p(r,[s]){r[0]?o?(o.p(r,s),s&1&&p(o,1)):(o=Je(r),o.c(),p(o,1),o.m(e.parentNode,e)):o&&(O(),k(o,1,1,()=>{o=null}),q())},i(r){t||(p(o),t=!0)},o(r){k(o),t=!1},d(r){o&&o.d(r),r&&b(e)}}}function _o({page:n}){return{props:{classID:n.params.class,roomID:n.params.room}}}function lo(n,e,t){let o,r,s,l;j(n,Me,$=>t(15,r=$)),j(n,Re,$=>t(1,s=$)),j(n,be,$=>t(2,l=$));let{classID:u}=e,{roomID:a}=e,c;const i=`classes/${u}/blackboards/`,m=`classes/${u}/rooms/`;r.uid||yt("/");async function f($){const{value:S}=$.srcElement;await ge(o,{name:S})}async function d($,S){const{value:W}=$.srcElement,_=Y(M(),i+S);await ge(_,{description:W})}_e(async()=>{we(o,$=>{t(0,c=G({id:$.id},$.data()))})});async function g(){t(0,c=await $t(m+a))}async function L($,S){console.log("saveVideo(), audioBlob =",$);const W=Fe(),_=We(W,`audio/${Ve()}`);await pt(_,$);const v=await gt(_),R=Y(M(),i+S);await ge(R,{creatorUID:r.uid,creatorPhoneNumber:r.phoneNumber,date:new Date().toISOString(),audioDownloadURL:v,audioRefFullPath:_.fullPath})}async function y({id:$,audioRefFullPath:S}){const W=[],_=Y(M(),i+$);if(S){const v=We(Fe(),S);W.push(bt(v))}W.push(ge(_,{creator:he(),creatorPhoneNumber:he(),date:he(),audioDownloadURL:he(),audioRefFullPath:he()})),await Promise.all(W)}const T=$=>f($),P=($,S)=>d(S,$),A=($,S)=>$(S.detail.newStroke),X=($,S)=>L(S.detail.audioBlob,$);return n.$$set=$=>{"classID"in $&&t(8,u=$.classID),"roomID"in $&&t(9,a=$.roomID)},n.$$.update=()=>{n.$$.dirty&512&&(o=Y(M(),m+a)),n.$$.dirty&512&&g()},[c,s,l,i,f,d,L,y,u,a,T,P,A,X]}class po extends J{constructor(e){super();K(this,e,lo,so,Z,{classID:8,roomID:9})}}export{po as default,_o as load};

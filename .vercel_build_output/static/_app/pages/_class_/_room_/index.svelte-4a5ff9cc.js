var ot=Object.defineProperty;var Se=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable;var Ae=(n,e,o)=>e in n?ot(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o,J=(n,e)=>{for(var o in e||(e={}))rt.call(e,o)&&Ae(n,o,e[o]);if(Se)for(var o of Se(e))nt.call(e,o)&&Ae(n,o,e[o]);return n};import{S as K,i as Q,s as Z,G as ue,H as ce,I as fe,J as de,x as g,u as $,T as st,O as M,M as Y,ag as we,aa as Le,an as lt,ao as at,ap as it,P as ut,aq as ct,ar as Pe,D as j,A as _e,as as ft,at as Ie,j as E,m as C,o as U,v as F,V as x,k as z,n as V,f as D,r as q,w as O,a3 as dt,d as b,t as ee,g as te,au as oe,av as re,a as W,b as w,a1 as pe,K as ne,e as se,c as le,aw as me,ax as Ee,X as ye,a9 as Ce,am as Ue,ah as De,ai as mt,l as H,W as Fe,aj as ht,ay as ge,az as We,aA as Ne,aB as _t,aC as pt,aD as gt,aE as he,aF as ae,L as Te}from"../../../chunks/vendor-2c66186c.js";import{f as bt,a as kt}from"../../../chunks/database-2896136c.js";import{d as Be,b as be,u as Me,e as ve,c as Re,a as je}from"../../../chunks/store-addbe31a.js";import{d as ke,a as ze,g as Ve,p as $t,l as qe}from"../../../chunks/canvas-ec00c90d.js";import{g as wt}from"../../../chunks/navigation-51f4a605.js";import"../../../chunks/singletons-12a22614.js";const yt=n=>({boardDoc:n&4,isFetchingStrokes:n&2,strokesArray:n&1}),Oe=n=>({boardDoc:n[2],fetchStrokes:n[3],listenToStrokes:n[4],isFetchingStrokes:n[1],strokesArray:n[0],handleNewlyDrawnStroke:n[5],deleteAllStrokesFromDb:n[6]});function Dt(n){let e;const o=n[9].default,t=ue(o,n,n[8],Oe);return{c(){t&&t.c()},l(r){t&&t.l(r)},m(r,s){t&&t.m(r,s),e=!0},p(r,[s]){t&&t.p&&(!e||s&263)&&ce(t,o,r,r[8],e?de(o,r[8],s,yt):fe(r[8]),Oe)},i(r){e||(g(t,r),e=!0)},o(r){$(t,r),e=!1},d(r){t&&t.d(r)}}}function He(n){const e=J({id:n.id},n.data());return e.startTime=0,e.endTime=0,n.data().isErasing||(e.endTime+=.5),e}function Tt(n,e,o){let{$$slots:t={},$$scope:r}=e,{dbPath:s}=e,a,i=!1,l,u;const m=st(M(),`${s}/strokes`),c=Y(M(),s);we(c,y=>{o(2,l=J({id:y.id},y.data()))}),Le(()=>{u&&u()});async function f(){o(1,i=!0),o(0,a=await bt(s+"/strokes"))}async function d(){o(1,i=!0);const y=lt(m,at("timestamp"));u=we(y,async T=>{T.docChanges().filter(A=>A.type==="removed").length>0?(o(0,a=[]),await it(),T.docs.length>0&&T.docs.forEach(A=>{a.push(He(A))})):(a||(o(1,i=!1),o(0,a=[])),T.docs.length===a.length||T.docChanges().filter(A=>A.type==="added").forEach(A=>{o(0,a=[...a,He(A.doc)])}))})}function _(y){a.push(y);try{ut(Y(M(),`${s}/strokes/${y.id}`),J({timestamp:ct()},y))}catch(T){alert(T)}}async function L(){const y=[];let T=Pe(M()),I=0;for(const A of a){I>=500&&(y.push(T.commit()),T=Pe(M()),I=0);const X=Y(M(),`${s}/strokes/${A.id}`);T.delete(X),I+=1}y.push(T.commit()),console.log("number of strokes =",a.length),console.log("number of batches to be deleted =",I),await Promise.all(y)}return n.$$set=y=>{"dbPath"in y&&o(7,s=y.dbPath),"$$scope"in y&&o(8,r=y.$$scope)},[a,i,l,f,d,_,L,s,r,t]}class vt extends K{constructor(e){super();Q(this,e,Tt,Dt,Z,{dbPath:7})}}const Rt=n=>({currentTime:n&1}),Xe=n=>({startRecording:n[1],stopRecording:n[2],currentTime:n[0]});function St(n){let e;const o=n[4].default,t=ue(o,n,n[3],Xe);return{c(){t&&t.c()},l(r){t&&t.l(r)},m(r,s){t&&t.m(r,s),e=!0},p(r,[s]){t&&t.p&&(!e||s&9)&&ce(t,o,r,r[3],e?de(o,r[3],s,Rt):fe(r[3]),Xe)},i(r){e||(g(t,r),e=!0)},o(r){$(t,r),e=!1},d(r){t&&t.d(r)}}}function At(n,e,o){let t;j(n,Be,f=>o(7,t=f));let{$$slots:r={},$$scope:s}=e,a=0,i;_e(()=>{window.MediaRecorder=ft});const l=Ie();let u=null;function m(){return new Promise(async f=>{if(!t){const _=await navigator.mediaDevices.getUserMedia({audio:!0});Be.set(_)}const d=t.clone();u=new MediaRecorder(d),u.start(),i=setInterval(()=>o(0,a+=.1),100),l("record-start"),be.set("mid_record"),f()})}function c(){return new Promise((f,d)=>{clearTimeout(i),be.set("post_record"),u.addEventListener("dataavailable",_=>{const L=_.data;l("record-end",{audioBlob:L}),f(),be.set("pre_record")}),u.stop();for(const _ of u.stream.getTracks())_.stop()})}return n.$$set=f=>{"$$scope"in f&&o(3,s=f.$$scope)},[a,m,c,s,r]}class Lt extends K{constructor(e){super();Q(this,e,At,St,Z,{})}}function Ye(n,e,o){const t=n.slice();return t[5]=e[o],t}function Pt(n){let e,o,t,r,s,a,i,l;return{c(){e=oe("svg"),o=oe("g"),t=oe("path"),r=oe("polygon"),a=oe("path"),i=oe("path"),this.h()},l(u){e=re(u,"svg",{preserveAspectRatio:!0,version:!0,id:!0,xmlns:!0,"xmlns:xlink":!0,x:!0,y:!0,width:!0,height:!0,":viewbox":!0,style:!0,"xml:space":!0});var m=W(e);o=re(m,"g",{});var c=W(o);t=re(c,"path",{d:!0}),W(t).forEach(b),r=re(c,"polygon",{style:!0,points:!0}),W(r).forEach(b),a=re(c,"path",{style:!0,d:!0}),W(a).forEach(b),i=re(c,"path",{style:!0,d:!0}),W(i).forEach(b),c.forEach(b),m.forEach(b),this.h()},h(){w(t,"d",`M0,0v72.377c0,1.588,0.234,3.169,0.698,4.706l45.416,150.032C46.633,228.828,48.212,230,50,230s3.367-1.172,3.886-2.883\r
          L99.31,77.079c0.457-1.525,0.69-3.108,0.69-4.702V0.002`),w(r,"style",s=`fill: ${n[5]};`),w(r,"points","50,211.978 38.879,175.24 61.122,175.24"),pe(a,"fill","#424242"),w(a,"d",`M63.581,167.118H36.42L8.765,75.761l10.924-9.63l12.5,11.015c1.54,1.353,3.835,1.35,5.375-0.002\r
            l12.468-11.007l12.464,11.005c1.54,1.357,3.839,1.357,5.377,0l12.465-11.005l10.9,9.623L63.581,167.118z`),w(i,"style",l=`fill: ${n[5]};`),w(i,"d",`M91.878,0v65.486l-8.852-7.813c-1.539-1.353-3.838-1.354-5.377,0.002L65.185,68.679L52.72,57.674\r
            c-1.539-1.356-3.838-1.354-5.377-0.002L34.871,68.683L22.375,57.67c-0.769-0.676-1.725-1.013-2.685-1.013\r
            c-0.959,0-1.919,0.339-2.685,1.013L8.121,65.5L8.098,0.024L91.878,0z`),w(e,"preserveAspectRatio","none"),w(e,"version","1.1"),w(e,"id","Layer_1"),w(e,"xmlns","http://www.w3.org/2000/svg"),w(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),w(e,"x","0px"),w(e,"y","0px"),w(e,"width","16px"),w(e,"height","35px"),w(e,":viewbox","`0 0 100 230`"),pe(e,"enable-background","new 0 0 100 230"),w(e,"xml:space","preserve")},m(u,m){D(u,e,m),ne(e,o),ne(o,t),ne(o,r),ne(o,a),ne(o,i)},p(u,m){m&1&&s!==(s=`fill: ${u[5]};`)&&w(r,"style",s),m&1&&l!==(l=`fill: ${u[5]};`)&&w(i,"style",l)},d(u){u&&b(e)}}}function Ge(n){let e,o;function t(){return n[2](n[5])}return e=new x({props:{$$slots:{default:[Pt]},$$scope:{ctx:n}}}),e.$on("click",t),{c(){E(e.$$.fragment)},l(r){C(e.$$.fragment,r)},m(r,s){U(e,r,s),o=!0},p(r,s){n=r;const a={};s&17&&(a.$$scope={dirty:s,ctx:n}),e.$set(a)},i(r){o||(g(e.$$.fragment,r),o=!0)},o(r){$(e.$$.fragment,r),o=!1},d(r){F(e,r)}}}function It(n){let e;return{c(){e=ee("Eraser")},l(o){e=te(o,"Eraser")},m(o,t){D(o,e,t)},d(o){o&&b(e)}}}function Et(n){let e,o,t,r,s=n[0].pencilColors,a=[];for(let m=0;m<s.length;m+=1)a[m]=Ge(Ye(n,s,m));const i=m=>$(a[m],1,1,()=>{a[m]=null});o=new x({props:{$$slots:{default:[It]},$$scope:{ctx:n}}}),o.$on("click",n[3]);const l=n[1].default,u=ue(l,n,n[4],null);return{c(){for(let m=0;m<a.length;m+=1)a[m].c();e=z(),E(o.$$.fragment),t=z(),u&&u.c()},l(m){for(let c=0;c<a.length;c+=1)a[c].l(m);e=V(m),C(o.$$.fragment,m),t=V(m),u&&u.l(m)},m(m,c){for(let f=0;f<a.length;f+=1)a[f].m(m,c);D(m,e,c),U(o,m,c),D(m,t,c),u&&u.m(m,c),r=!0},p(m,[c]){if(c&1){s=m[0].pencilColors;let d;for(d=0;d<s.length;d+=1){const _=Ye(m,s,d);a[d]?(a[d].p(_,c),g(a[d],1)):(a[d]=Ge(_),a[d].c(),g(a[d],1),a[d].m(e.parentNode,e))}for(q(),d=s.length;d<a.length;d+=1)i(d);O()}const f={};c&16&&(f.$$scope={dirty:c,ctx:m}),o.$set(f),u&&u.p&&(!r||c&16)&&ce(u,l,m,m[4],r?de(l,m[4],c,null):fe(m[4]),null)},i(m){if(!r){for(let c=0;c<s.length;c+=1)g(a[c]);g(o.$$.fragment,m),g(u,m),r=!0}},o(m){a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)$(a[c]);$(o.$$.fragment,m),$(u,m),r=!1},d(m){dt(a,m),m&&b(e),F(o,m),m&&b(t),u&&u.d(m)}}}function Ct(n,e,o){let t;j(n,Me,l=>o(0,t=l));let{$$slots:r={},$$scope:s}=e;const a=l=>ve.set({type:"pencil",color:l,lineWidth:3}),i=()=>ve.set({type:"eraser",color:"",lineWidth:40});return n.$$set=l=>{"$$scope"in l&&o(4,s=l.$$scope)},[t,r,a,i,s]}class Ut extends K{constructor(e){super();Q(this,e,Ct,Et,Z,{})}}function Ft(n){let e;const o=n[11].default,t=ue(o,n,n[13],null);return{c(){t&&t.c()},l(r){t&&t.l(r)},m(r,s){t&&t.m(r,s),e=!0},p(r,s){t&&t.p&&(!e||s&8192)&&ce(t,o,r,r[13],e?de(o,r[13],s,null):fe(r[13]),null)},i(r){e||(g(t,r),e=!0)},o(r){$(t,r),e=!1},d(r){t&&t.d(r)}}}function Wt(n){let e,o,t,r,s,a,i;return e=new Ut({props:{$$slots:{default:[Ft]},$$scope:{ctx:n}}}),{c(){E(e.$$.fragment),o=z(),t=se("canvas"),this.h()},l(l){C(e.$$.fragment,l),o=V(l),t=le(l,"CANVAS",{style:!0});var u=W(t);u.forEach(b),this.h()},h(){w(t,"style",r=`background-color: #2e3131; width: ${n[2]}; height: ${n[1]}`)},m(l,u){U(e,l,u),D(l,o,u),D(l,t,u),n[12](t),s=!0,a||(i=[me(t,"touchstart",n[3]),me(t,"touchmove",n[4]),me(t,"touchend",n[5])],a=!0)},p(l,[u]){const m={};u&8192&&(m.$$scope={dirty:u,ctx:l}),e.$set(m),(!s||u&6&&r!==(r=`background-color: #2e3131; width: ${l[2]}; height: ${l[1]}`))&&w(t,"style",r)},i(l){s||(g(e.$$.fragment,l),s=!0)},o(l){$(e.$$.fragment,l),s=!1},d(l){F(e,l),l&&b(o),l&&b(t),n[12](null),a=!1,Ee(i)}}}function Nt(n){return(n.endTime-n.startTime)/n.points.length}function Bt(n,e,o){let t,r,s;j(n,Re,h=>o(1,t=h)),j(n,je,h=>o(2,r=h)),j(n,ve,h=>o(17,s=h));let{$$slots:a={},$$scope:i}=e,{strokesArray:l}=e,{currentTime:u=0}=e;const m=Ie();let c,f=[],d,_=!1,L={x:-1,y:-1},y={points:[]},T;_e(()=>{o(8,c=d.getContext("2d"))});function I(h){h.touches.length>1||(h.touches[0].touchType,S(h,{isInitialContact:!0}))}function A(h){if(!!_){if(h.touches.length>1){console.log("touchmove ignored: only 1 finger allowed");return}h.touches[0].touchType,S(h,{isInitialContact:!1})}}function X(h){!_||h.touches.length>0||(h.changedTouches[0].touchType,p(y),_=!1)}function k(h){_=!0,L={x:-1,y:-1},y={strokeNumber:l.length+1,startTime:Number(u.toFixed(1)),color:s.color,lineWidth:s.lineWidth,isErasing:s.type==="eraser",points:[],sessionID:"123"}}function S(h,{isInitialContact:P}){h.preventDefault(),P&&k();const B=v(h);N(h,B)}function N(h,P){y.points.push({unitX:parseFloat(P.x/d.width).toFixed(4),unitY:parseFloat(P.y/d.height).toFixed(4)}),L.x!==-1&&L.y!==-1&&ze([R(L),R(P)],1,s.type==="eraser",c,s.color,s.lineWidth,d),L=P}function p(h){h.endTime=Number(u.toFixed(1)),h.id=Ve(),f.push(h),m("stroke-drawn",{newStroke:h})}function v(h){const{left:P,top:B}=d.getBoundingClientRect();return{x:h.touches[0].pageX-P-window.scrollX,y:h.touches[0].pageY-B-window.scrollY}}function R({x:h,y:P}){return{unitX:h/d.width,unitY:P/d.height}}function ie(){c.clearRect(0,0,r,t)}function $e(h){ye[h?"unshift":"push"](()=>{d=h,o(0,d),o(8,c),o(2,r),o(1,t),o(6,l)})}return n.$$set=h=>{"strokesArray"in h&&o(6,l=h.strokesArray),"currentTime"in h&&o(7,u=h.currentTime),"$$scope"in h&&o(13,i=h.$$scope)},n.$$.update=()=>{if(n.$$.dirty&327&&c){o(0,d.width=r,d),o(0,d.height=t,d);for(const h of l)ke(h,null,c,d)}if(n.$$.dirty&1857&&c){let h=f.length,P=l.length;if(h!==P)if(h<P)if(h===0){for(const B of l)ke(B,null,c,d);o(9,f=[...l])}else for(let B=h;B<P;B++){const G=l[B];ke(G,G.startTime!==G.endTime?Nt(G):null,c,d),f.push(G)}else{let B=function(){ie(),o(9,f=[]),L={x:-1,y:-1};for(const tt of l)ke(tt,null,c,d)};(function(){console.log("debounced board reset"),T&&clearTimeout(T),o(10,T=setTimeout(B,1e3))})()}}},[d,t,r,I,A,X,l,u,c,f,T,a,$e,i]}class Mt extends K{constructor(e){super();Q(this,e,Bt,Wt,Z,{strokesArray:6,currentTime:7})}}function jt(n){let e,o,t,r,s,a,i,l,u;const m=n[10].default,c=ue(m,n,n[9],null);return{c(){c&&c.c(),e=z(),o=se("canvas"),r=z(),s=se("audio"),this.h()},l(f){c&&c.l(f),e=V(f),o=le(f,"CANVAS",{style:!0});var d=W(o);d.forEach(b),r=V(f),s=le(f,"AUDIO",{src:!0,style:!0});var _=W(s);_.forEach(b),this.h()},h(){w(o,"style",t=`background-color: #2e3131; width: ${n[3]}; height: ${n[2]}`),Ce(s.src,a=n[0])||w(s,"src",a),s.controls=!0,pe(s,"width","100%")},m(f,d){c&&c.m(f,d),D(f,e,d),D(f,o,d),n[11](o),D(f,r,d),D(f,s,d),n[12](s),i=!0,l||(u=[me(s,"play",n[5]),me(s,"seeking",n[6])],l=!0)},p(f,[d]){c&&c.p&&(!i||d&512)&&ce(c,m,f,f[9],i?de(m,f[9],d,null):fe(f[9]),null),(!i||d&12&&t!==(t=`background-color: #2e3131; width: ${f[3]}; height: ${f[2]}`))&&w(o,"style",t),(!i||d&1&&!Ce(s.src,a=f[0]))&&w(s,"src",a)},i(f){i||(g(c,f),i=!0)},o(f){$(c,f),i=!1},d(f){c&&c.d(f),f&&b(e),f&&b(o),n[11](null),f&&b(r),f&&b(s),n[12](null),l=!1,Ee(u)}}}let zt=1;function Vt(n){return(n.endTime-n.startTime)/n.points.length}function qt(n,e,o){let t,r;j(n,Re,p=>o(2,t=p)),j(n,je,p=>o(3,r=p));let{$$slots:s={},$$scope:a}=e,{strokesArray:i}=e,{audioDownloadURL:l}=e,u,m=0,c,f,d,_;Le(()=>{_&&clearTimeout(_)}),_e(()=>{o(8,f=c.getContext("2d"));const p=[];for(let v=0;v<i.length;v++)for(let R=1;R<i[v].points.length;R++){const ie={strokeIndex:v,pointIndex:R};p.push(J({startTime:L(ie)},ie))}u=p.sort((v,R)=>v.startTime-R.startTime)});function L({strokeIndex:p,pointIndex:v}){const R=i[p];return R.startTime+(v-1)*Vt(R)}function y(){m=0,f.clearRect(0,0,r,t),T()}function T(){if(!!d&&(I(),m<u.length)){const p=u[m],v=1e3*(p.startTime-d.currentTime);_=setTimeout(T,v/zt)}}function I(){if(!d)return;const p=u[m];(!p||p.startTime>d.currentTime)&&(f.clearRect(0,0,c.width,c.height),m=0),A()}function A(){const{currentTime:p}=d;for(let v=m;v<u.length;v++){const R=u[v];if(R.startTime>p)break;X(R),m+=1}}function X({strokeIndex:p,pointIndex:v}){const R=i[p],$e=R.lineWidth*(c.scrollWidth/1e3);ze(R.points,v,R.isErasing,f,R.color,$e,c)}function k(){return new Promise(async p=>{_?(m=0,I()):A(),p()})}function S(p){ye[p?"unshift":"push"](()=>{c=p,o(4,c),o(8,f),o(1,d),o(3,r),o(2,t)})}function N(p){ye[p?"unshift":"push"](()=>{d=p,o(1,d)})}return n.$$set=p=>{"strokesArray"in p&&o(7,i=p.strokesArray),"audioDownloadURL"in p&&o(0,l=p.audioDownloadURL),"$$scope"in p&&o(9,a=p.$$scope)},n.$$.update=()=>{n.$$.dirty&270&&f&&d&&(o(4,c.width=r,c),o(4,c.height=t,c),k())},[l,d,t,r,c,y,I,i,f,a,s,S,N]}class Ot extends K{constructor(e){super();Q(this,e,qt,jt,Z,{strokesArray:7,audioDownloadURL:0})}}function Je(n,e,o){const t=n.slice();return t[18]=e[o],t}function Ke(n){let e,o,t,r=[],s=new Map,a,i,l,u;o=new Fe({props:{value:n[0].name,style:"width: 100%; margin-bottom: 20px;"}}),o.$on("input",n[10]);let m=n[0].blackboards;const c=f=>f[18];for(let f=0;f<m.length;f+=1){let d=Je(n,m,f),_=c(d);s.set(_,r[f]=et(_,d))}return{c(){e=se("div"),E(o.$$.fragment),t=z();for(let f=0;f<r.length;f+=1)r[f].c();this.h()},l(f){e=le(f,"DIV",{style:!0,class:!0});var d=W(e);C(o.$$.fragment,d),t=V(d);for(let _=0;_<r.length;_+=1)r[_].l(d);d.forEach(b),this.h()},h(){pe(e,"height","100vh"),w(e,"class","svelte-8vfgqd"),Ue(e,"question-room",n[0].name.charAt(n[0].name.length-1)==="?")},m(f,d){D(f,e,d),U(o,e,null),ne(e,t);for(let _=0;_<r.length;_+=1)r[_].m(e,null);i=!0,l||(u=De(a=$t.call(null,e,"main-content")),l=!0)},p(f,d){const _={};d&1&&(_.value=f[0].name),o.$set(_),d&1038090479&&(m=f[0].blackboards,q(),r=mt(r,d,c,1,f,m,s,e,ht,et,null,Je),O()),d&1&&Ue(e,"question-room",f[0].name.charAt(f[0].name.length-1)==="?")},i(f){if(!i){g(o.$$.fragment,f);for(let d=0;d<m.length;d+=1)g(r[d]);i=!0}},o(f){$(o.$$.fragment,f);for(let d=0;d<r.length;d+=1)$(r[d]);i=!1},d(f){f&&b(e),F(o);for(let d=0;d<r.length;d+=1)r[d].d();l=!1,u()}}}function Qe(n){let e,o,t,r,s,a;function i(...c){return n[11](n[18],...c)}e=new Fe({props:{textarea:!0,value:n[21].description||"",style:"width: 100%; margin-bottom: 10px"}}),e.$on("input",i);const l=[Xt,Ht],u=[];function m(c,f){return c[21].audioDownloadURL?0:1}return t=m(n),r=u[t]=l[t](n),{c(){E(e.$$.fragment),o=z(),r.c(),s=H()},l(c){C(e.$$.fragment,c),o=V(c),r.l(c),s=H()},m(c,f){U(e,c,f),D(c,o,f),u[t].m(c,f),D(c,s,f),a=!0},p(c,f){n=c;const d={};f&2097152&&(d.value=n[21].description||""),e.$set(d);let _=t;t=m(n),t===_?u[t].p(n,f):(q(),$(u[_],1,1,()=>{u[_]=null}),O(),r=u[t],r?r.p(n,f):(r=u[t]=l[t](n),r.c()),g(r,1),r.m(s.parentNode,s))},i(c){a||(g(e.$$.fragment,c),g(r),a=!0)},o(c){$(e.$$.fragment,c),$(r),a=!1},d(c){F(e,c),c&&b(o),u[t].d(c),c&&b(s)}}}function Ht(n){let e,o,t,r,s,a,i=n[24]&&Ze(n);return{c(){e=se("div"),i&&i.c(),this.h()},l(l){e=le(l,"DIV",{style:!0});var u=W(e);i&&i.l(u),u.forEach(b),this.h()},h(){w(e,"style",o=`width: 100%; height: ${n[1]+80}px`)},m(l,u){D(l,e,u),i&&i.m(e,null),r=!0,s||(a=De(t=qe.call(null,e,n[23])),s=!0)},p(l,u){l[24]?i?(i.p(l,u),u&16777216&&g(i,1)):(i=Ze(l),i.c(),g(i,1),i.m(e,null)):i&&(q(),$(i,1,1,()=>{i=null}),O()),(!r||u&2&&o!==(o=`width: 100%; height: ${l[1]+80}px`))&&w(e,"style",o),t&&ae(t.update)&&u&8388608&&t.update.call(null,l[23])},i(l){r||(g(i),r=!0)},o(l){$(i),r=!1},d(l){l&&b(e),i&&i.d(),s=!1,a()}}}function Xt(n){let e,o,t,r,s,a,i=n[24]&&xe(n);return{c(){e=se("div"),i&&i.c(),this.h()},l(l){e=le(l,"DIV",{style:!0});var u=W(e);i&&i.l(u),u.forEach(b),this.h()},h(){w(e,"style",o=`width: 100%; height: ${n[1]+80}px`)},m(l,u){D(l,e,u),i&&i.m(e,null),r=!0,s||(a=De(t=qe.call(null,e,n[22])),s=!0)},p(l,u){l[24]?i?(i.p(l,u),u&16777216&&g(i,1)):(i=xe(l),i.c(),g(i,1),i.m(e,null)):i&&(q(),$(i,1,1,()=>{i=null}),O()),(!r||u&2&&o!==(o=`width: 100%; height: ${l[1]+80}px`))&&w(e,"style",o),t&&ae(t.update)&&u&4194304&&t.update.call(null,l[22])},i(l){r||(g(i),r=!0)},o(l){$(i),r=!1},d(l){l&&b(e),i&&i.d(),s=!1,a()}}}function Ze(n){let e,o;function t(...r){return n[13](n[18],...r)}return e=new Lt({props:{$$slots:{default:[eo,({startRecording:r,stopRecording:s,currentTime:a})=>({27:r,28:s,29:a}),({startRecording:r,stopRecording:s,currentTime:a})=>(r?134217728:0)|(s?268435456:0)|(a?536870912:0)]},$$scope:{ctx:n}}}),e.$on("record-end",t),{c(){E(e.$$.fragment)},l(r){C(e.$$.fragment,r)},m(r,s){U(e,r,s),o=!0},p(r,s){n=r;const a={};s&2097152004&&(a.$$scope={dirty:s,ctx:n}),e.$set(a)},i(r){o||(g(e.$$.fragment,r),o=!0)},o(r){$(e.$$.fragment,r),o=!1},d(r){F(e,r)}}}function Yt(n){let e;return{c(){e=ee("Uploading...")},l(o){e=te(o,"Uploading...")},m(o,t){D(o,e,t)},p:Te,i:Te,o:Te,d(o){o&&b(e)}}}function Gt(n){let e,o;return e=new x({props:{$$slots:{default:[Kt]},$$scope:{ctx:n}}}),e.$on("click",function(){ae(n[28])&&n[28].apply(this,arguments)}),{c(){E(e.$$.fragment)},l(t){C(e.$$.fragment,t)},m(t,r){U(e,t,r),o=!0},p(t,r){n=t;const s={};r&1073741824&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){$(e.$$.fragment,t),o=!1},d(t){F(e,t)}}}function Jt(n){let e,o,t,r;return e=new x({props:{$$slots:{default:[Qt]},$$scope:{ctx:n}}}),e.$on("click",function(){ae(n[27])&&n[27].apply(this,arguments)}),t=new x({props:{$$slots:{default:[Zt]},$$scope:{ctx:n}}}),t.$on("click",function(){ae(n[26])&&n[26].apply(this,arguments)}),{c(){E(e.$$.fragment),o=z(),E(t.$$.fragment)},l(s){C(e.$$.fragment,s),o=V(s),C(t.$$.fragment,s)},m(s,a){U(e,s,a),D(s,o,a),U(t,s,a),r=!0},p(s,a){n=s;const i={};a&1073741824&&(i.$$scope={dirty:a,ctx:n}),e.$set(i);const l={};a&1073741824&&(l.$$scope={dirty:a,ctx:n}),t.$set(l)},i(s){r||(g(e.$$.fragment,s),g(t.$$.fragment,s),r=!0)},o(s){$(e.$$.fragment,s),$(t.$$.fragment,s),r=!1},d(s){F(e,s),s&&b(o),F(t,s)}}}function Kt(n){let e;return{c(){e=ee("Stop")},l(o){e=te(o,"Stop")},m(o,t){D(o,e,t)},d(o){o&&b(e)}}}function Qt(n){let e;return{c(){e=ee("Record")},l(o){e=te(o,"Record")},m(o,t){D(o,e,t)},d(o){o&&b(e)}}}function Zt(n){let e;return{c(){e=ee("Wipe board")},l(o){e=te(o,"Wipe board")},m(o,t){D(o,e,t)},d(o){o&&b(e)}}}function xt(n){let e,o,t,r;const s=[Jt,Gt,Yt],a=[];function i(l,u){return l[2]==="pre_record"?0:l[2]==="mid_record"?1:2}return e=i(n),o=a[e]=s[e](n),{c(){o.c(),t=H()},l(l){o.l(l),t=H()},m(l,u){a[e].m(l,u),D(l,t,u),r=!0},p(l,u){let m=e;e=i(l),e===m?a[e].p(l,u):(q(),$(a[m],1,1,()=>{a[m]=null}),O(),o=a[e],o?o.p(l,u):(o=a[e]=s[e](l),o.c()),g(o,1),o.m(t.parentNode,t))},i(l){r||(g(o),r=!0)},o(l){$(o),r=!1},d(l){a[e].d(l),l&&b(t)}}}function eo(n){let e,o;function t(...r){return n[12](n[25],...r)}return e=new Mt({props:{strokesArray:n[24],currentTime:n[29],$$slots:{default:[xt]},$$scope:{ctx:n}}}),e.$on("stroke-drawn",t),{c(){E(e.$$.fragment)},l(r){C(e.$$.fragment,r)},m(r,s){U(e,r,s),o=!0},p(r,s){n=r;const a={};s&16777216&&(a.strokesArray=n[24]),s&536870912&&(a.currentTime=n[29]),s&1543503876&&(a.$$scope={dirty:s,ctx:n}),e.$set(a)},i(r){o||(g(e.$$.fragment,r),o=!0)},o(r){$(e.$$.fragment,r),o=!1},d(r){F(e,r)}}}function xe(n){let e,o;return e=new Ot({props:{strokesArray:n[24],audioDownloadURL:n[21].audioDownloadURL,$$slots:{default:[oo]},$$scope:{ctx:n}}}),{c(){E(e.$$.fragment)},l(t){C(e.$$.fragment,t)},m(t,r){U(e,t,r),o=!0},p(t,r){const s={};r&16777216&&(s.strokesArray=t[24]),r&2097152&&(s.audioDownloadURL=t[21].audioDownloadURL),r&1075838976&&(s.$$scope={dirty:r,ctx:t}),e.$set(s)},i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){$(e.$$.fragment,t),o=!1},d(t){F(e,t)}}}function to(n){let e;return{c(){e=ee("Revert to board")},l(o){e=te(o,"Revert to board")},m(o,t){D(o,e,t)},d(o){o&&b(e)}}}function oo(n){let e,o;return e=new x({props:{$$slots:{default:[to]},$$scope:{ctx:n}}}),e.$on("click",function(){ae(n[7](n[21]))&&n[7](n[21]).apply(this,arguments)}),{c(){E(e.$$.fragment)},l(t){C(e.$$.fragment,t)},m(t,r){U(e,t,r),o=!0},p(t,r){n=t;const s={};r&1073741824&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(t){o||(g(e.$$.fragment,t),o=!0)},o(t){$(e.$$.fragment,t),o=!1},d(t){F(e,t)}}}function ro(n){let e,o,t=n[21]&&Qe(n);return{c(){t&&t.c(),e=z()},l(r){t&&t.l(r),e=V(r)},m(r,s){t&&t.m(r,s),D(r,e,s),o=!0},p(r,s){r[21]?t?(t.p(r,s),s&2097152&&g(t,1)):(t=Qe(r),t.c(),g(t,1),t.m(e.parentNode,e)):t&&(q(),$(t,1,1,()=>{t=null}),O())},i(r){o||(g(t),o=!0)},o(r){$(t),o=!1},d(r){t&&t.d(r),r&&b(e)}}}function et(n,e){let o,t,r;return t=new vt({props:{dbPath:e[3]+e[18],$$slots:{default:[ro,({boardDoc:s,fetchStrokes:a,listenToStrokes:i,strokesArray:l,handleNewlyDrawnStroke:u,deleteAllStrokesFromDb:m})=>({21:s,22:a,23:i,24:l,25:u,26:m}),({boardDoc:s,fetchStrokes:a,listenToStrokes:i,strokesArray:l,handleNewlyDrawnStroke:u,deleteAllStrokesFromDb:m})=>(s?2097152:0)|(a?4194304:0)|(i?8388608:0)|(l?16777216:0)|(u?33554432:0)|(m?67108864:0)]},$$scope:{ctx:e}}}),{key:n,first:null,c(){o=H(),E(t.$$.fragment),this.h()},l(s){o=H(),C(t.$$.fragment,s),this.h()},h(){this.first=o},m(s,a){D(s,o,a),U(t,s,a),r=!0},p(s,a){e=s;const i={};a&1&&(i.dbPath=e[3]+e[18]),a&1172307975&&(i.$$scope={dirty:a,ctx:e}),t.$set(i)},i(s){r||(g(t.$$.fragment,s),r=!0)},o(s){$(t.$$.fragment,s),r=!1},d(s){s&&b(o),F(t,s)}}}function no(n){let e,o,t=n[0]&&Ke(n);return{c(){t&&t.c(),e=H()},l(r){t&&t.l(r),e=H()},m(r,s){t&&t.m(r,s),D(r,e,s),o=!0},p(r,[s]){r[0]?t?(t.p(r,s),s&1&&g(t,1)):(t=Ke(r),t.c(),g(t,1),t.m(e.parentNode,e)):t&&(q(),$(t,1,1,()=>{t=null}),O())},i(r){o||(g(t),o=!0)},o(r){$(t),o=!1},d(r){t&&t.d(r),r&&b(e)}}}function ho({page:n}){return{props:{classID:n.params.class,roomID:n.params.room}}}function so(n,e,o){let t,r,s,a;j(n,Me,k=>o(15,r=k)),j(n,Re,k=>o(1,s=k)),j(n,be,k=>o(2,a=k));let{classID:i}=e,{roomID:l}=e,u;const m=`classes/${i}/blackboards/`,c=`classes/${i}/rooms/`;r.uid||wt("/");async function f(k){const{value:S}=k.srcElement;await ge(t,{name:S})}async function d(k,S){const{value:N}=k.srcElement,p=Y(M(),m+S);await ge(p,{description:N})}_e(async()=>{we(t,k=>{o(0,u=J({id:k.id},k.data()))})});async function _(){o(0,u=await kt(c+l))}async function L(k,S){console.log("saveVideo(), audioBlob =",k);const N=We(),p=Ne(N,`audio/${Ve()}`);await _t(p,k);const v=await pt(p),R=Y(M(),m+S);await ge(R,{creatorUID:r.uid,creatorPhoneNumber:r.phoneNumber,date:new Date().toISOString(),audioDownloadURL:v,audioRefFullPath:p.fullPath})}async function y({id:k,audioRefFullPath:S}){const N=[],p=Y(M(),m+k);if(S){const v=Ne(We(),S);N.push(gt(v))}N.push(ge(p,{creator:he(),creatorPhoneNumber:he(),date:he(),audioDownloadURL:he(),audioRefFullPath:he()})),await Promise.all(N)}const T=k=>f(k),I=(k,S)=>d(S,k),A=(k,S)=>k(S.detail.newStroke),X=(k,S)=>L(S.detail.audioBlob,k);return n.$$set=k=>{"classID"in k&&o(8,i=k.classID),"roomID"in k&&o(9,l=k.roomID)},n.$$.update=()=>{n.$$.dirty&512&&(t=Y(M(),c+l)),n.$$.dirty&512&&_()},[u,s,a,m,f,d,L,y,i,l,T,I,A,X]}class _o extends K{constructor(e){super();Q(this,e,so,no,Z,{classID:8,roomID:9})}}export{_o as default,ho as load};

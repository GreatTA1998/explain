var Ot=Object.defineProperty;var st=Object.getOwnPropertySymbols;var Wt=Object.prototype.hasOwnProperty,qt=Object.prototype.propertyIsEnumerable;var at=(o,e,t)=>e in o?Ot(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,Le=(o,e)=>{for(var t in e||(e={}))Wt.call(e,t)&&at(o,t,e[t]);if(st)for(var t of st(e))qt.call(e,t)&&at(o,t,e[t]);return o};import{S as ie,i as ue,s as ce,aE as Qt,k as M,e as N,n as z,c as C,b as D,M as $,W as Ht,aD as re,f as v,a1 as K,aH as fe,t as B,a as A,aI as de,d as g,g as V,N as U,ag as Xt,I as ge,j,m as F,o as O,aF as Gt,aG as Yt,h as pe,J as be,K as ke,L as $e,x as R,u as I,v as W,F as X,r as oe,w as ne,a2 as it,aJ as xe,A as ut,X as et,O as le,ab as Kt,a3 as we,ae as Jt,ai as Ae,aK as ve,aL as Zt,aA as Ue,a6 as ct,Q,a7 as ft,a8 as xt,a4 as dt,aM as er,T as pt,P as G,aN as tr,a5 as mt,aB as rr,l as J,aO as or,aC as nr,aP as lr,_ as Y,aw as tt,av as rt,aQ as _t,aR as ht,aS as me,ax as sr,ay as ar,aT as ir,a9 as ur,au as cr,af as fr,aU as dr,an as pr,Y as mr,aV as _r}from"../../../chunks/vendor-d35e056c.js";import{R as hr,a as gr,D as br}from"../../../chunks/RenderlessFetchStrokes-201d03c6.js";import{_ as kr}from"../../../chunks/preload-helper-ec9aa979.js";import{o as ot,u as gt,j as Ee,a as bt,c as nt,d as Ne,f as $r,e as wr,k as Ce,b as vr,g as yr,w as kt}from"../../../chunks/navigation-4873d97b.js";/* empty css                                                                */import{d as Be,r as Dr,a as Rr}from"../../../chunks/canvas-74f91cf9.js";import"../../../chunks/singletons-12a22614.js";const Ir=o=>({}),$t=o=>({});function wt(o,e,t){const r=o.slice();return r[8]=e[t],r}function vt(o){let e,t,r,n,l,s=o[1].pencilColors,a=[];for(let c=0;c<s.length;c+=1)a[c]=yt(wt(o,s,c));return{c(){for(let c=0;c<a.length;c+=1)a[c].c();e=M(),t=N("img"),this.h()},l(c){for(let u=0;u<a.length;u+=1)a[u].l(c);e=z(c),t=C(c,"IMG",{width:!0,height:!0,style:!0,src:!0,alt:!0,class:!0}),this.h()},h(){D(t,"width","46"),D(t,"height","33"),$(t,"margin-left","8px"),$(t,"margin-right","8px"),Ht(t.src,r="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR30G9gEErDXNf8qxm0-vvSLs2zaE8V6v-pDqxNg-CUaoeORwmoosKPF-DC2SUG772Tm3A&usqp=CAU")||D(t,"src",r),D(t,"alt","eraser"),D(t,"class","svelte-1bgxyxs"),re(t,"eraser-selected",o[2].type==="eraser")},m(c,u){for(let d=0;d<a.length;d+=1)a[d].m(c,u);v(c,e,u),v(c,t,u),n||(l=K(t,"click",o[7]),n=!0)},p(c,u){if(u&6){s=c[1].pencilColors;let d;for(d=0;d<s.length;d+=1){const i=wt(c,s,d);a[d]?a[d].p(i,u):(a[d]=yt(i),a[d].c(),a[d].m(e.parentNode,e))}for(;d<a.length;d+=1)a[d].d(1);a.length=s.length}u&4&&re(t,"eraser-selected",c[2].type==="eraser")},d(c){Xt(a,c),c&&g(e),c&&g(t),n=!1,l()}}}function yt(o){let e,t,r,n,l,s,a,c,u,d,i,b;function w(){return o[6](o[8])}return{c(){e=N("div"),t=fe("svg"),r=fe("g"),n=fe("path"),l=B(`;\r
            `),s=fe("polygon"),c=fe("path"),u=fe("path"),this.h()},l(m){e=C(m,"DIV",{style:!0,class:!0});var p=A(e);t=de(p,"svg",{preserveAspectRatio:!0,version:!0,id:!0,xmlns:!0,"xmlns:xlink":!0,x:!0,y:!0,width:!0,height:!0,viewBox:!0,style:!0,"xml:space":!0,class:!0});var h=A(t);r=de(h,"g",{});var _=A(r);n=de(_,"path",{d:!0}),A(n).forEach(g),l=V(_,`;\r
            `),s=de(_,"polygon",{style:!0,points:!0}),A(s).forEach(g),c=de(_,"path",{style:!0,d:!0}),A(c).forEach(g),u=de(_,"path",{style:!0,d:!0}),A(u).forEach(g),_.forEach(g),h.forEach(g),p.forEach(g),this.h()},h(){D(n,"d",`M0,0v72.377c0,1.588,0.234,3.169,0.698,4.706l45.416,150.032C46.633,228.828,48.212,230,50,230s3.367-1.172,3.886-2.883\r
              L99.31,77.079c0.457-1.525,0.69-3.108,0.69-4.702V0.002`),D(s,"style",a=`fill: ${o[8]};`),D(s,"points","50,211.978 38.879,175.24 61.122,175.24"),$(c,"fill","#424242"),D(c,"d",`M63.581,167.118H36.42L8.765,75.761l10.924-9.63l12.5,11.015c1.54,1.353,3.835,1.35,5.375-0.002\r
                l12.468-11.007l12.464,11.005c1.54,1.357,3.839,1.357,5.377,0l12.465-11.005l10.9,9.623L63.581,167.118z`),D(u,"style",d=`fill: ${o[8]};`),D(u,"d",`M91.878,0v65.486l-8.852-7.813c-1.539-1.353-3.838-1.354-5.377,0.002L65.185,68.679L52.72,57.674\r
                c-1.539-1.356-3.838-1.354-5.377-0.002L34.871,68.683L22.375,57.67c-0.769-0.676-1.725-1.013-2.685-1.013\r
                c-0.959,0-1.919,0.339-2.685,1.013L8.121,65.5L8.098,0.024L91.878,0z`),D(t,"preserveAspectRatio","none"),D(t,"version","1.1"),D(t,"id","Layer_1"),D(t,"xmlns","http://www.w3.org/2000/svg"),D(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),D(t,"x","0px"),D(t,"y","0px"),D(t,"width","16px"),D(t,"height","30px"),D(t,"viewBox","0 0 100 230"),$(t,"enable-background","new 0 0 100 230"),D(t,"xml:space","preserve"),D(t,"class","svelte-1bgxyxs"),$(e,"margin","0 4px"),$(e,"width","30px"),$(e,"height","42px"),$(e,"border-radius","3px"),$(e,"align-items","center"),$(e,"display","flex"),$(e,"justify-content","center"),D(e,"class","svelte-1bgxyxs"),re(e,"pencil-selected",o[2].color===o[8])},m(m,p){v(m,e,p),U(e,t),U(t,r),U(r,n),U(r,l),U(r,s),U(r,c),U(r,u),i||(b=K(e,"click",w),i=!0)},p(m,p){o=m,p&2&&a!==(a=`fill: ${o[8]};`)&&D(s,"style",a),p&2&&d!==(d=`fill: ${o[8]};`)&&D(u,"style",d),p&6&&re(e,"pencil-selected",o[2].color===o[8])},d(m){m&&g(e),i=!1,b()}}}function Tr(o){let e,t,r,n,l,s=(o[0]?"No touch":"Touch draw")+"",a,c,u=Object.keys(o[1]).length>0,d,i,b,w,m;r=new Qt({props:{icons:!1,checked:!o[0],style:"margin: 0 !important"}});let p=u&&vt(o);const h=o[5].default,_=ge(h,o,o[4],null),S=o[5]["dropdown-menu"],L=ge(S,o,o[4],$t);return{c(){e=N("div"),t=N("div"),j(r.$$.fragment),n=M(),l=N("div"),a=B(s),c=M(),p&&p.c(),d=M(),_&&_.c(),i=M(),L&&L.c(),this.h()},l(y){e=C(y,"DIV",{style:!0});var P=A(e);t=C(P,"DIV",{style:!0});var q=A(t);F(r.$$.fragment,q),n=z(q),l=C(q,"DIV",{style:!0});var ee=A(l);a=V(ee,s),ee.forEach(g),q.forEach(g),c=z(P),p&&p.l(P),d=z(P),_&&_.l(P),i=z(P),L&&L.l(P),P.forEach(g),this.h()},h(){$(l,"margin-top","2px"),$(l,"font-size","0.55rem"),$(l,"font-family","Roboto,sans-serif"),$(l,"color","white"),$(t,"margin-right","10px"),$(t,"text-align","center"),$(e,"position","absolute"),$(e,"display","flex"),$(e,"align-items","center"),$(e,"height","50px"),$(e,"left","0"),$(e,"right","auto"),$(e,"top","0"),$(e,"bottom","auto"),$(e,"z-index","100"),$(e,"background-color","grey"),$(e,"padding-left","10px"),$(e,"border-radius","2px")},m(y,P){v(y,e,P),U(e,t),O(r,t,null),U(t,n),U(t,l),U(l,a),U(e,c),p&&p.m(e,null),U(e,d),_&&_.m(e,null),U(e,i),L&&L.m(e,null),b=!0,w||(m=K(t,"click",Gt(Yt(o[3]))),w=!0)},p(y,[P]){const q={};P&1&&(q.checked=!y[0]),r.$set(q),(!b||P&1)&&s!==(s=(y[0]?"No touch":"Touch draw")+"")&&pe(a,s),P&2&&(u=Object.keys(y[1]).length>0),u?p?p.p(y,P):(p=vt(y),p.c(),p.m(e,d)):p&&(p.d(1),p=null),_&&_.p&&(!b||P&16)&&be(_,h,y,y[4],b?$e(h,y[4],P,null):ke(y[4]),null),L&&L.p&&(!b||P&16)&&be(L,S,y,y[4],b?$e(S,y[4],P,Ir):ke(y[4]),$t)},i(y){b||(R(r.$$.fragment,y),R(_,y),R(L,y),b=!0)},o(y){I(r.$$.fragment,y),I(_,y),I(L,y),b=!1},d(y){y&&g(e),W(r),p&&p.d(),_&&_.d(y),L&&L.d(y),w=!1,m()}}}function Sr(o,e,t){let r,n,l;X(o,ot,i=>t(0,r=i)),X(o,gt,i=>t(1,n=i)),X(o,Ee,i=>t(2,l=i));let{$$slots:s={},$$scope:a}=e;function c(){ot.set(!r)}const u=i=>Ee.set({type:"pencil",color:i,lineWidth:3}),d=()=>Ee.set({type:"eraser",color:"",lineWidth:40});return o.$$set=i=>{"$$scope"in i&&t(4,a=i.$$scope)},[r,n,l,c,a,s,u,d]}class Pr extends ie{constructor(e){super();ue(this,e,Sr,Tr,ce,{})}}function Dt(o){let e,t;return e=new Pr({props:{$$slots:{"dropdown-menu":[zr],default:[Lr]},$$scope:{ctx:o}}}),{c(){j(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,n){O(e,r,n),t=!0},p(r,n){const l={};n[0]&536871302&&(l.$$scope={dirty:n,ctx:r}),e.$set(l)},i(r){t||(R(e.$$.fragment,r),t=!0)},o(r){I(e.$$.fragment,r),t=!1},d(r){W(e,r)}}}function Lr(o){let e;const t=o[22].default,r=ge(t,o,o[29],null);return{c(){r&&r.c()},l(n){r&&r.l(n)},m(n,l){r&&r.m(n,l),e=!0},p(n,l){r&&r.p&&(!e||l[0]&536870912)&&be(r,t,n,n[29],e?$e(t,n[29],l,null):ke(n[29]),null)},i(n){e||(R(r,n),e=!0)},o(n){I(r,n),e=!1},d(n){r&&r.d(n)}}}function Rt(o){let e,t,r,n;return{c(){e=N("span"),t=B("more_horiz"),this.h()},l(l){e=C(l,"SPAN",{class:!0,style:!0});var s=A(e);t=V(s,"more_horiz"),s.forEach(g),this.h()},h(){D(e,"class","material-icons"),$(e,"margin-right","10px"),$(e,"color","white"),$(e,"font-size","2rem")},m(l,s){v(l,e,s),U(e,t),r||(n=K(e,"click",o[23]),r=!0)},p:le,d(l){l&&g(e),r=!1,n()}}}function Ar(o){let e,t;return e=new Ae({props:{$$slots:{default:[Er]},$$scope:{ctx:o}}}),e.$on("click",o[9]),{c(){j(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,n){O(e,r,n),t=!0},p(r,n){const l={};n[0]&536870912&&(l.$$scope={dirty:n,ctx:r}),e.$set(l)},i(r){t||(R(e.$$.fragment,r),t=!0)},o(r){I(e.$$.fragment,r),t=!1},d(r){W(e,r)}}}function Ur(o){let e,t;return e=new Ae({props:{$$slots:{default:[Nr]},$$scope:{ctx:o}}}),e.$on("click",o[11]),{c(){j(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,n){O(e,r,n),t=!0},p(r,n){const l={};n[0]&536870912&&(l.$$scope={dirty:n,ctx:r}),e.$set(l)},i(r){t||(R(e.$$.fragment,r),t=!0)},o(r){I(e.$$.fragment,r),t=!1},d(r){W(e,r)}}}function Er(o){let e;return{c(){e=B("Set background")},l(t){e=V(t,"Set background")},m(t,r){v(t,e,r)},d(t){t&&g(e)}}}function Nr(o){let e;return{c(){e=B("Remove background")},l(t){e=V(t,"Remove background")},m(t,r){v(t,e,r)},d(t){t&&g(e)}}}function Cr(o){let e;return{c(){e=B("Wipe board")},l(t){e=V(t,"Wipe board")},m(t,r){v(t,e,r)},d(t){t&&g(e)}}}function Br(o){let e;return{c(){e=B("Delete board")},l(t){e=V(t,"Delete board")},m(t,r){v(t,e,r)},d(t){t&&g(e)}}}function Vr(o){let e,t,r,n,l,s,a;const c=[Ur,Ar],u=[];function d(i,b){return i[1]?0:1}return e=d(o),t=u[e]=c[e](o),n=new Ae({props:{$$slots:{default:[Cr]},$$scope:{ctx:o}}}),n.$on("SMUI:action",o[12]),s=new Ae({props:{$$slots:{default:[Br]},$$scope:{ctx:o}}}),s.$on("SMUI:action",o[13]),{c(){t.c(),r=M(),j(n.$$.fragment),l=M(),j(s.$$.fragment)},l(i){t.l(i),r=z(i),F(n.$$.fragment,i),l=z(i),F(s.$$.fragment,i)},m(i,b){u[e].m(i,b),v(i,r,b),O(n,i,b),v(i,l,b),O(s,i,b),a=!0},p(i,b){let w=e;e=d(i),e===w?u[e].p(i,b):(oe(),I(u[w],1,1,()=>{u[w]=null}),ne(),t=u[e],t?t.p(i,b):(t=u[e]=c[e](i),t.c()),R(t,1),t.m(r.parentNode,r));const m={};b[0]&536870912&&(m.$$scope={dirty:b,ctx:i}),n.$set(m);const p={};b[0]&536870912&&(p.$$scope={dirty:b,ctx:i}),s.$set(p)},i(i){a||(R(t),R(n.$$.fragment,i),R(s.$$.fragment,i),a=!0)},o(i){I(t),I(n.$$.fragment,i),I(s.$$.fragment,i),a=!1},d(i){u[e].d(i),i&&g(r),W(n,i),i&&g(l),W(s,i)}}}function Mr(o){let e,t;return e=new Jt({props:{$$slots:{default:[Vr]},$$scope:{ctx:o}}}),{c(){j(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,n){O(e,r,n),t=!0},p(r,n){const l={};n[0]&536870914&&(l.$$scope={dirty:n,ctx:r}),e.$set(l)},i(r){t||(R(e.$$.fragment,r),t=!0)},o(r){I(e.$$.fragment,r),t=!1},d(r){W(e,r)}}}function zr(o){let e,t,r,n,l,s,a,c,u=o[2]==="pre_record"&&Rt(o),d={style:"width: 300px",$$slots:{default:[Mr]},$$scope:{ctx:o}};return l=new Kt({props:d}),o[26](l),{c(){e=N("div"),u&&u.c(),t=M(),r=N("input"),n=M(),j(l.$$.fragment),this.h()},l(i){e=C(i,"DIV",{slot:!0});var b=A(e);u&&u.l(b),t=z(b),r=C(b,"INPUT",{style:!0,type:!0,accept:!0}),n=z(b),F(l.$$.fragment,b),b.forEach(g),this.h()},h(){$(r,"display","none"),D(r,"type","file"),D(r,"accept","image/gif, image/jpeg, image/png"),D(e,"slot","dropdown-menu")},m(i,b){v(i,e,b),u&&u.m(e,null),U(e,t),U(e,r),o[24](r),U(e,n),O(l,e,null),s=!0,a||(c=K(r,"change",o[25]),a=!0)},p(i,b){i[2]==="pre_record"?u?u.p(i,b):(u=Rt(i),u.c(),u.m(e,t)):u&&(u.d(1),u=null);const w={};b[0]&536870914&&(w.$$scope={dirty:b,ctx:i}),l.$set(w)},i(i){s||(R(l.$$.fragment,i),s=!0)},o(i){I(l.$$.fragment,i),s=!1},d(i){i&&g(e),u&&u.d(),o[24](null),o[26](null),W(l),a=!1,c()}}}function jr(o){let e,t,r,n,l,s,a,c,u,d=o[0]&&Dt(o);return{c(){d&&d.c(),e=M(),t=N("canvas"),n=M(),l=N("canvas"),this.h()},l(i){d&&d.l(i),e=z(i),t=C(i,"CANVAS",{style:!0});var b=A(t);b.forEach(g),n=z(i),l=C(i,"CANVAS",{style:!0});var w=A(l);w.forEach(g),this.h()},h(){D(t,"style",r=`position: absolute; z-index: 1; margin-top: 0; margin-left: 0; width: ${o[6]}px; height: ${o[5]}px`),D(l,"style",s=`position: absolute;
  top: 0;
  left: 0;
  z-index: 0;
  display: block;
  background-color: rgb(46, 49, 49); width: ${o[6]}px; height: ${o[5]}px`)},m(i,b){d&&d.m(i,b),v(i,e,b),v(i,t,b),o[27](t),v(i,n,b),v(i,l,b),o[28](l),a=!0,c||(u=[K(t,"touchstart",o[14]),K(t,"touchmove",o[15]),K(t,"touchend",o[16])],c=!0)},p(i,b){i[0]?d?(d.p(i,b),b[0]&1&&R(d,1)):(d=Dt(i),d.c(),R(d,1),d.m(e.parentNode,e)):d&&(oe(),I(d,1,1,()=>{d=null}),ne()),(!a||b[0]&96&&r!==(r=`position: absolute; z-index: 1; margin-top: 0; margin-left: 0; width: ${i[6]}px; height: ${i[5]}px`))&&D(t,"style",r),(!a||b[0]&96&&s!==(s=`position: absolute;
  top: 0;
  left: 0;
  z-index: 0;
  display: block;
  background-color: rgb(46, 49, 49); width: ${i[6]}px; height: ${i[5]}px`))&&D(l,"style",s)},i(i){a||(R(d),a=!0)},o(i){I(d),a=!1},d(i){d&&d.d(i),i&&g(e),i&&g(t),o[27](null),i&&g(n),i&&g(l),o[28](null),c=!1,it(u)}}}function Fr(o){return(o.endTime-o.startTime)/o.points.length}function Or(o,e,t){let r,n,l,s;X(o,bt,f=>t(5,r=f)),X(o,nt,f=>t(6,n=f)),X(o,Ee,f=>t(33,l=f)),X(o,ot,f=>t(34,s=f));let{$$slots:a={},$$scope:c}=e,{strokesArray:u}=e,{currentTime:d=0}=e,{backgroundImageDownloadURL:i=""}=e,{recordState:b=""}=e;const w=xe();let m,p,h,_,S=[],L=!1,y={x:-1,y:-1},P={points:[]},q,ee,se;ut(()=>{t(18,m=h.getContext("2d")),t(19,p=_.getContext("2d")),window.addEventListener("popstate",ye),window.onbeforeunload=function(f){b==="mid_record"&&(f.returnValue="")}}),et(()=>{window.removeEventListener("popstate",ye)});function ye(){b==="mid_record"&&(confirm("This will interrupt your current recording, are you sure?")||history.pushState(null,document.title,location.href))}function Ve(){se.click()}function De(f){w("background-upload",{imageFile:f.target.files[0]})}function Re(){w("background-reset")}function Me(){w("board-wipe")}function ze(){w("board-delete")}function Ie(f){if(f.touches.length>1)return;const T=f.touches[0].touchType==="stylus";if(s&&!T){console.log("error: cannot use finger during Apple Pencil mode");return}_e(f,{isInitialContact:!0})}function Te(f){if(!L)return;if(f.touches.length>1){console.log("touchmove ignored: only 1 finger allowed");return}const T=f.touches[0].touchType==="stylus";if(s&&!T){console.log("error: cannot use finger during Apple Pencil mode");return}_e(f,{isInitialContact:!1})}function Se(f){if(!L||f.touches.length>0)return;const T=f.changedTouches[0].touchType==="stylus";if(s&&!T){console.log("error: cannot use finger during Apple Pencil mode");return}Oe(P),L=!1}function je(f){L=!0,y={x:-1,y:-1},P={strokeNumber:u.length+1,startTime:Number(d.toFixed(1)),color:l.color,lineWidth:l.lineWidth,isErasing:l.type==="eraser",points:[],sessionID:"123"}}function _e(f,{isInitialContact:T}){f.preventDefault(),T&&je();const E=We(f);Fe(f,E)}function Fe(f,T){P.points.push({unitX:parseFloat(T.x/h.width).toFixed(4),unitY:parseFloat(T.y/h.height).toFixed(4)}),y.x!==-1&&y.y!==-1&&Rr([Pe(y),Pe(T)],1,l.type==="eraser",m,l.color,l.lineWidth,h),y=T}function Oe(f){f.endTime=Number(d.toFixed(1)),f.id=Ne(),S.push(f),w("stroke-drawn",{newStroke:f})}function We(f){const{left:T,top:E}=h.getBoundingClientRect();return{x:f.touches[0].pageX-T-window.scrollX,y:f.touches[0].pageY-E-window.scrollY}}function Pe({x:f,y:T}){return{unitX:f/h.width,unitY:T/h.height}}function qe(){m.clearRect(0,0,n,r)}const Qe=()=>ee.setOpen(!0);function He(f){we[f?"unshift":"push"](()=>{se=f,t(8,se)})}const Xe=f=>De(f);function Ge(f){we[f?"unshift":"push"](()=>{ee=f,t(7,ee)})}function Ye(f){we[f?"unshift":"push"](()=>{h=f,t(3,h),t(18,m),t(6,n),t(5,r),t(0,u)})}function k(f){we[f?"unshift":"push"](()=>{_=f,t(4,_),t(18,m),t(6,n),t(5,r),t(0,u),t(3,h)})}return o.$$set=f=>{"strokesArray"in f&&t(0,u=f.strokesArray),"currentTime"in f&&t(17,d=f.currentTime),"backgroundImageDownloadURL"in f&&t(1,i=f.backgroundImageDownloadURL),"recordState"in f&&t(2,b=f.recordState),"$$scope"in f&&t(29,c=f.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&262249&&m&&(t(3,h.width=n,h),t(3,h.height=r,h),t(4,_.width=n,_),t(4,_.height=r,_),u))for(const f of u)Be(f,null,m,h);if(o.$$.dirty[0]&524314&&p&&(p.clearRect(0,0,_.scrollWidth,_.scrollHeight),Dr(i,h,p)),o.$$.dirty[0]&3407881&&m&&u){let f=S.length,T=u.length;if(f!==T)if(f<T)if(f===0){for(const E of u)Be(E,null,m,h);t(20,S=[...u])}else for(let E=f;E<T;E++){const H=u[E];Be(H,H.startTime!==H.endTime?Fr(H):null,m,h),S.push(H)}else{let E=function(){qe(),t(20,S=[]),y={x:-1,y:-1};for(const Z of u)Be(Z,null,m,h)};(function(){console.log("debounced board reset"),q&&clearTimeout(q),t(21,q=setTimeout(E,1e3))})()}}},[u,i,b,h,_,r,n,ee,se,Ve,De,Re,Me,ze,Ie,Te,Se,d,m,p,S,q,a,Qe,He,Xe,Ge,Ye,k,c]}class Wr extends ie{constructor(e){super();ue(this,e,Or,jr,ce,{strokesArray:0,currentTime:17,backgroundImageDownloadURL:1,recordState:2},null,[-1,-1])}}const qr=o=>({currentTime:o&1}),It=o=>({startRecording:o[1],stopRecording:o[2],currentTime:o[0]});function Qr(o){let e;const t=o[4].default,r=ge(t,o,o[3],It);return{c(){r&&r.c()},l(n){r&&r.l(n)},m(n,l){r&&r.m(n,l),e=!0},p(n,[l]){r&&r.p&&(!e||l&9)&&be(r,t,n,n[3],e?$e(t,n[3],l,qr):ke(n[3]),It)},i(n){e||(R(r,n),e=!0)},o(n){I(r,n),e=!1},d(n){r&&r.d(n)}}}function Hr(o,e,t){let r,n;X(o,$r,m=>t(8,r=m)),X(o,wr,m=>t(9,n=m));let{$$slots:l={},$$scope:s}=e,a,c=0,u;ut(async()=>{window&&(a=await kr(()=>import("../../../chunks/index-f195c495.js"),[]),window.MediaRecorder=a.default)});const d=xe();let i=null;function b(){return new Promise(async(m,p)=>{let h;if(r)if(n.local.audio)h=r.clone();else{alert('Cannot start recording because your mic is muted - click the switch next to your "beaver #n" to unmute'),p("Cannot start recording because mic stream is muted");return}else try{h=await navigator.mediaDevices.getUserMedia({audio:!0})}catch{return alert(`Don't forget to enable your your mic! Click the "aA" / "i" button beside the URL bar "https://explain.mit.edu", then click "website settings" / "microphone"`),p("Can't access mic stream")}i=new MediaRecorder(h),i.start(),u=setInterval(()=>t(0,c+=.1),100),d("record-start"),m()})}function w(){return new Promise((m,p)=>{clearTimeout(u),i.addEventListener("dataavailable",h=>{const _=h.data;d("record-end",{audioBlob:_}),m()}),i.stop();for(const h of i.stream.getTracks())h.stop()})}return o.$$set=m=>{"$$scope"in m&&t(3,s=m.$$scope)},[c,b,w,s,l]}class Xr extends ie{constructor(e){super();ue(this,e,Hr,Qr,ce,{})}}function Gr(o,e){let t=document.getElementById(e);return t==null||t.appendChild(o),{destroy(){o.remove()}}}function Tt(o,e){let t=new IntersectionObserver(r=>{for(const n of r)if(n.isIntersecting){e(),t.unobserve(o);return}},{root:null,threshold:.2,rootMargin:"0px"});t.observe(o)}function Yr(o){let e,t,r,n,l;return{c(){e=N("div"),t=N("textarea"),this.h()},l(s){e=C(s,"DIV",{class:!0,style:!0});var a=A(e);t=C(a,"TEXTAREA",{rows:!0,style:!0,class:!0}),A(t).forEach(g),a.forEach(g),this.h()},h(){t.value=o[0],D(t,"rows","1"),$(t,"width",o[1]+"px"),D(t,"class","svelte-1xi77cs"),D(e,"class","grow-wrap svelte-1xi77cs"),$(e,"display","grid")},m(s,a){v(s,e,a),U(e,t),o[7](e),n||(l=[K(t,"input",o[6]),ve(o[5].call(null,e)),ve(r=Zt.call(null,e,o[3]))],n=!0)},p(s,[a]){a&1&&(t.value=s[0]),a&2&&$(t,"width",s[1]+"px"),r&&Ue(r.update)&&a&8&&r.update.call(null,s[3])},i:le,o:le,d(s){s&&g(e),o[7](null),n=!1,it(l)}}}function Kr(o,e,t){let r,n;X(o,nt,i=>t(1,n=i));let{value:l}=e,s;const a=xe();function c(i){i.dataset.replicatedValue=l}const u=i=>{t(2,s.dataset.replicatedValue=i.target.value,s),a("input",i.target.value)};function d(i){we[i?"unshift":"push"](()=>{s=i,t(2,s)})}return o.$$set=i=>{"value"in i&&t(0,l=i.value)},o.$$.update=()=>{o.$$.dirty&2&&t(3,r={width:`${n}px`})},[l,n,s,r,a,c,u,d]}class Jr extends ie{constructor(e){super();ue(this,e,Kr,Yr,ce,{value:0})}}const Zr=o=>({strokesArray:o&1}),St=o=>({listenToStrokes:o[1],strokesArray:o[0],handleNewlyDrawnStroke:o[2],deleteAllStrokesFromDb:o[3]});function xr(o){let e;const t=o[6].default,r=ge(t,o,o[5],St);return{c(){r&&r.c()},l(n){r&&r.l(n)},m(n,l){r&&r.m(n,l),e=!0},p(n,[l]){r&&r.p&&(!e||l&33)&&be(r,t,n,n[5],e?$e(t,n[5],l,Zr):ke(n[5]),St)},i(n){e||(R(r,n),e=!0)},o(n){I(r,n),e=!1},d(n){r&&r.d(n)}}}function Pt(o){const e=Le({id:o.id},o.data());return e.startTime=0,e.endTime=0,o.data().isErasing||(e.endTime+=.5),e}function eo(o,e,t){let{$$slots:r={},$$scope:n}=e,{dbPath:l}=e,s,a;const c=ct(Q(),`${l}/strokes`),u=ft(c,xt("timestamp"));et(()=>{a&&a()});async function d(){a=dt(u,async w=>{w.docChanges().filter(p=>p.type==="removed").length>0?(t(0,s=[]),await er(),w.docs.length>0&&w.docs.forEach(p=>{s.push(Pt(p))})):(s||t(0,s=[]),w.docs.length===s.length||w.docChanges().filter(p=>p.type==="added").forEach(p=>{t(0,s=[...s,Pt(p.doc)])}))})}function i(w){s.push(w);try{pt(G(Q(),`${l}/strokes/${w.id}`),Le({timestamp:tr()},w))}catch(m){alert(m)}}async function b(){return new Promise(async w=>{const m=[];let p=mt(Q()),h=0;for(const _ of s){h>=500&&(m.push(p.commit()),p=mt(Q()),h=0);const S=G(Q(),`${l}/strokes/${_.id}`);p.delete(S),h+=1}m.push(p.commit()),await Promise.all(m),t(0,s=[]),w()})}return o.$$set=w=>{"dbPath"in w&&t(4,l=w.dbPath),"$$scope"in w&&t(5,n=w.$$scope)},[s,d,i,b,l,n,r]}class to extends ie{constructor(e){super();ue(this,e,eo,xr,ce,{dbPath:4})}}function Lt(o,e,t){const r=o.slice();return r[43]=e[t],r[45]=t,r}function At(o){let e,t,r,n,l,s=[],a=new Map,c,u,d,i;t=new or({props:{disabled:te(o[0].name)&&o[0].askerUID&&o[6].uid!==o[0].askerUID,value:o[0].name,class:"room-title",style:`width: ${o[8]}px;`,$$slots:{helper:[so]},$$scope:{ctx:o}}}),t.$on("input",o[23]);let b=o[0].blackboards;const w=m=>m[43];for(let m=0;m<b.length;m+=1){let p=Lt(o,b,m),h=w(p);a.set(h,s[m]=Bt(h,p))}return{c(){e=N("div"),j(t.$$.fragment),r=M(),n=N("div"),l=M();for(let m=0;m<s.length;m+=1)s[m].c();this.h()},l(m){e=C(m,"DIV",{style:!0});var p=A(e);F(t.$$.fragment,p),r=z(p),n=C(p,"DIV",{style:!0}),A(n).forEach(g),l=z(p);for(let h=0;h<s.length;h+=1)s[h].l(p);p.forEach(g),this.h()},h(){$(n,"margin-bottom","20px"),$(e,"padding","16px"),re(e,"question",te(o[0].name))},m(m,p){v(m,e,p),O(t,e,null),U(e,r),U(e,n),U(e,l);for(let h=0;h<s.length;h+=1)s[h].m(e,null);u=!0,d||(i=ve(c=Gr.call(null,e,"main-content")),d=!0)},p(m,p){const h={};p[0]&65&&(h.disabled=te(m[0].name)&&m[0].askerUID&&m[6].uid!==m[0].askerUID),p[0]&1&&(h.value=m[0].name),p[0]&256&&(h.style=`width: ${m[8]}px;`),p[0]&31|p[1]&16777216&&(h.$$scope={dirty:p,ctx:m}),t.$set(h),p[0]&1032161|p[1]&9404416&&(b=m[0].blackboards,oe(),s=rr(s,p,w,1,m,b,a,e,nr,Bt,null,Lt),ne()),p[0]&1&&re(e,"question",te(m[0].name))},i(m){if(!u){R(t.$$.fragment,m);for(let p=0;p<b.length;p+=1)R(s[p]);u=!0}},o(m){I(t.$$.fragment,m);for(let p=0;p<s.length;p+=1)I(s[p]);u=!1},d(m){m&&g(e),W(t);for(let p=0;p<s.length;p+=1)s[p].d();d=!1,i()}}}function ro(o){let e=o[0].askerName+"",t,r,n=Ce(o[0].dateAsked)+"",l;return{c(){t=B(e),r=B(" asked on "),l=B(n)},l(s){t=V(s,e),r=V(s," asked on "),l=V(s,n)},m(s,a){v(s,t,a),v(s,r,a),v(s,l,a)},p(s,a){a[0]&1&&e!==(e=s[0].askerName+"")&&pe(t,e),a[0]&1&&n!==(n=Ce(s[0].dateAsked)+"")&&pe(l,n)},d(s){s&&g(t),s&&g(r),s&&g(l)}}}function oo(o){let e,t,r;return{c(){e=B("Resolving this question in "),t=B(o[4]),r=B(", cancel by re-adding ?")},l(n){e=V(n,"Resolving this question in "),t=V(n,o[4]),r=V(n,", cancel by re-adding ?")},m(n,l){v(n,e,l),v(n,t,l),v(n,r,l)},p(n,l){l[0]&16&&pe(t,n[4])},d(n){n&&g(e),n&&g(t),n&&g(r)}}}function no(o){let e,t,r;return{c(){e=B("Pinging server members in "),t=B(o[2]),r=B(", cancel by backtracking the ?")},l(n){e=V(n,"Pinging server members in "),t=V(n,o[2]),r=V(n,", cancel by backtracking the ?")},m(n,l){v(n,e,l),v(n,t,l),v(n,r,l)},p(n,l){l[0]&4&&pe(t,n[2])},d(n){n&&g(e),n&&g(t),n&&g(r)}}}function Ut(o){let e,t=Ce(o[0].dateResolved)+"",r;return{c(){e=B(", resolved "),r=B(t)},l(n){e=V(n,", resolved "),r=V(n,t)},m(n,l){v(n,e,l),v(n,r,l)},p(n,l){l[0]&1&&t!==(t=Ce(n[0].dateResolved)+"")&&pe(r,t)},d(n){n&&g(e),n&&g(r)}}}function lo(o){let e,t;function r(a,c){if(a[1])return no;if(a[3])return oo;if(a[0].askerName&&a[0].askerUID&&a[0].date)return ro}let n=r(o),l=n&&n(o),s=o[0].dateResolved&&Ut(o);return{c(){l&&l.c(),e=M(),s&&s.c(),t=J()},l(a){l&&l.l(a),e=z(a),s&&s.l(a),t=J()},m(a,c){l&&l.m(a,c),v(a,e,c),s&&s.m(a,c),v(a,t,c)},p(a,c){n===(n=r(a))&&l?l.p(a,c):(l&&l.d(1),l=n&&n(a),l&&(l.c(),l.m(e.parentNode,e))),a[0].dateResolved?s?s.p(a,c):(s=Ut(a),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},d(a){l&&l.d(a),a&&g(e),s&&s.d(a),a&&g(t)}}}function so(o){let e,t;return e=new lr({props:{slot:"helper",persistent:!0,$$slots:{default:[lo]},$$scope:{ctx:o}}}),{c(){j(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,n){O(e,r,n),t=!0},p(r,n){const l={};n[0]&31|n[1]&16777216&&(l.$$scope={dirty:n,ctx:r}),e.$set(l)},i(r){t||(R(e.$$.fragment,r),t=!0)},o(r){I(e.$$.fragment,r),t=!1},d(r){W(e,r)}}}function Et(o){let e,t,r,n,l,s,a,c,u,d,i;function b(..._){return o[24](o[43],..._)}r=new Jr({props:{value:o[46].description||""}}),r.$on("input",b);const w=[io,ao],m=[];function p(_,S){return _[46].audioDownloadURL?0:1}a=p(o),c=m[a]=w[a](o);let h=o[45]===o[0].blackboards.length-1&&Ct(o);return{c(){e=N("div"),t=M(),j(r.$$.fragment),n=M(),l=N("div"),s=M(),c.c(),u=M(),h&&h.c(),d=J(),this.h()},l(_){e=C(_,"DIV",{style:!0}),A(e).forEach(g),t=z(_),F(r.$$.fragment,_),n=z(_),l=C(_,"DIV",{style:!0}),A(l).forEach(g),s=z(_),c.l(_),u=z(_),h&&h.l(_),d=J(),this.h()},h(){$(e,"margin-top","10px"),$(l,"margin-bottom","10px")},m(_,S){v(_,e,S),v(_,t,S),O(r,_,S),v(_,n,S),v(_,l,S),v(_,s,S),m[a].m(_,S),v(_,u,S),h&&h.m(_,S),v(_,d,S),i=!0},p(_,S){o=_;const L={};S[1]&32768&&(L.value=o[46].description||""),r.$set(L);let y=a;a=p(o),a===y?m[a].p(o,S):(oe(),I(m[y],1,1,()=>{m[y]=null}),ne(),c=m[a],c?c.p(o,S):(c=m[a]=w[a](o),c.c()),R(c,1),c.m(u.parentNode,u)),o[45]===o[0].blackboards.length-1?h?h.p(o,S):(h=Ct(o),h.c(),h.m(d.parentNode,d)):h&&(h.d(1),h=null)},i(_){i||(R(r.$$.fragment,_),R(c),i=!0)},o(_){I(r.$$.fragment,_),I(c),i=!1},d(_){_&&g(e),_&&g(t),W(r,_),_&&g(n),_&&g(l),_&&g(s),m[a].d(_),_&&g(u),h&&h.d(_),_&&g(d)}}}function ao(o){let e,t;return e=new to({props:{dbPath:o[5]+o[43],$$slots:{default:[_o,({listenToStrokes:r,strokesArray:n,handleNewlyDrawnStroke:l,deleteAllStrokesFromDb:s})=>({50:r,48:n,51:l,49:s}),({listenToStrokes:r,strokesArray:n,handleNewlyDrawnStroke:l,deleteAllStrokesFromDb:s})=>[0,(r?524288:0)|(n?131072:0)|(l?1048576:0)|(s?262144:0)]]},$$scope:{ctx:o}}}),{c(){j(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,n){O(e,r,n),t=!0},p(r,n){const l={};n[0]&33&&(l.dbPath=r[5]+r[43]),n[0]&897|n[1]&17727488&&(l.$$scope={dirty:n,ctx:r}),e.$set(l)},i(r){t||(R(e.$$.fragment,r),t=!0)},o(r){I(e.$$.fragment,r),t=!1},d(r){W(e,r)}}}function io(o){let e,t;return e=new gr({props:{dbPath:o[5]+o[43],$$slots:{default:[bo,({fetchStrokes:r,strokesArray:n,deleteAllStrokesFromDb:l})=>({47:r,48:n,49:l}),({fetchStrokes:r,strokesArray:n,deleteAllStrokesFromDb:l})=>[0,(r?65536:0)|(n?131072:0)|(l?262144:0)]]},$$scope:{ctx:o}}}),{c(){j(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,n){O(e,r,n),t=!0},p(r,n){const l={};n[0]&33&&(l.dbPath=r[5]+r[43]),n[0]&832|n[1]&17006592&&(l.$$scope={dirty:n,ctx:r}),e.$set(l)},i(r){t||(R(e.$$.fragment,r),t=!0)},o(r){I(e.$$.fragment,r),t=!1},d(r){W(e,r)}}}function uo(o){let e,t,r;return t=new _r({props:{class:"my-four-colors",style:"height: 32px; width: 32px;",indeterminate:!0,fourColor:!0}}),{c(){e=N("div"),j(t.$$.fragment),this.h()},l(n){e=C(n,"DIV",{style:!0});var l=A(e);F(t.$$.fragment,l),l.forEach(g),this.h()},h(){$(e,"display","flex"),$(e,"justify-content","center"),$(e,"margin-left","20px"),$(e,"margin-right","20px")},m(n,l){v(n,e,l),O(t,e,null),r=!0},p:le,i(n){r||(R(t.$$.fragment,n),r=!0)},o(n){I(t.$$.fragment,n),r=!1},d(n){n&&g(e),W(t)}}}function co(o){let e,t,r,n;function l(){return o[27](o[53],o[43])}return{c(){e=N("span"),t=B("stop_circle"),this.h()},l(s){e=C(s,"SPAN",{class:!0,style:!0});var a=A(e);t=V(a,"stop_circle"),a.forEach(g),this.h()},h(){D(e,"class","material-icons svelte-53fhoc"),$(e,"font-size","2.5rem"),$(e,"color","cyan"),$(e,"margin-left","22px"),$(e,"margin-right","26px"),re(e,"unclickable",o[7]!==o[46].recorderBrowserTabID)},m(s,a){v(s,e,a),U(e,t),r||(n=K(e,"click",l),r=!0)},p(s,a){o=s,a[0]&128|a[1]&32768&&re(e,"unclickable",o[7]!==o[46].recorderBrowserTabID)},i:le,o:le,d(s){s&&g(e),r=!1,n()}}}function fo(o){let e,t,r,n;function l(){return o[26](o[52],o[43])}return{c(){e=N("span"),t=B("album"),this.h()},l(s){e=C(s,"SPAN",{class:!0,style:!0});var a=A(e);t=V(a,"album"),a.forEach(g),this.h()},h(){D(e,"class","material-icons"),$(e,"font-size","2.5rem"),$(e,"color","cyan"),$(e,"margin-left","22px"),$(e,"margin-right","26px")},m(s,a){v(s,e,a),U(e,t),r||(n=K(e,"click",l),r=!0)},p(s,a){o=s},i:le,o:le,d(s){s&&g(e),r=!1,n()}}}function po(o){let e,t,r,n;const l=[fo,co,uo],s=[];function a(c,u){return c[46].recordState==="pre_record"?0:c[46].recordState==="mid_record"?1:2}return e=a(o),t=s[e]=l[e](o),{c(){t.c(),r=J()},l(c){t.l(c),r=J()},m(c,u){s[e].m(c,u),v(c,r,u),n=!0},p(c,u){let d=e;e=a(c),e===d?s[e].p(c,u):(oe(),I(s[d],1,1,()=>{s[d]=null}),ne(),t=s[e],t?t.p(c,u):(t=s[e]=l[e](c),t.c()),R(t,1),t.m(r.parentNode,r))},i(c){n||(R(t),n=!0)},o(c){I(t),n=!1},d(c){s[e].d(c),c&&g(r)}}}function mo(o){let e,t;function r(...a){return o[28](o[43],...a)}function n(){return o[29](o[43])}function l(...a){return o[30](o[51],...a)}function s(){return o[31](o[43],o[49])}return e=new Wr({props:{strokesArray:o[48],currentTime:o[54],backgroundImageDownloadURL:o[46].backgroundImageDownloadURL,recordState:o[46].recordState,$$slots:{default:[po]},$$scope:{ctx:o}}}),e.$on("background-upload",r),e.$on("background-reset",n),e.$on("stroke-drawn",l),e.$on("board-wipe",function(){Ue(o[49])&&o[49].apply(this,arguments)}),e.$on("board-delete",s),{c(){j(e.$$.fragment)},l(a){F(e.$$.fragment,a)},m(a,c){O(e,a,c),t=!0},p(a,c){o=a;const u={};c[1]&131072&&(u.strokesArray=o[48]),c[1]&8388608&&(u.currentTime=o[54]),c[1]&32768&&(u.backgroundImageDownloadURL=o[46].backgroundImageDownloadURL),c[1]&32768&&(u.recordState=o[46].recordState),c[0]&129|c[1]&16809984&&(u.$$scope={dirty:c,ctx:o}),e.$set(u)},i(a){t||(R(e.$$.fragment,a),t=!0)},o(a){I(e.$$.fragment,a),t=!1},d(a){W(e,a)}}}function _o(o){let e,t,r,n,l,s,a;function c(...u){return o[32](o[48],o[43],...u)}return t=new Xr({props:{$$slots:{default:[mo,({startRecording:u,stopRecording:d,currentTime:i})=>({52:u,53:d,54:i}),({startRecording:u,stopRecording:d,currentTime:i})=>[0,(u?2097152:0)|(d?4194304:0)|(i?8388608:0)]]},$$scope:{ctx:o}}}),t.$on("record-end",c),{c(){e=N("div"),j(t.$$.fragment),this.h()},l(u){e=C(u,"DIV",{style:!0});var d=A(e);F(t.$$.fragment,d),d.forEach(g),this.h()},h(){D(e,"style",r=`width: ${o[8]}px; height: ${o[9]}px; position: relative`)},m(u,d){v(u,e,d),O(t,e,null),l=!0,s||(a=ve(n=Tt.call(null,e,o[50])),s=!0)},p(u,d){o=u;const i={};d[0]&129|d[1]&25591808&&(i.$$scope={dirty:d,ctx:o}),t.$set(i),(!l||d[0]&768&&r!==(r=`width: ${o[8]}px; height: ${o[9]}px; position: relative`))&&D(e,"style",r),n&&Ue(n.update)&&d[1]&524288&&n.update.call(null,o[50])},i(u){l||(R(t.$$.fragment,u),l=!0)},o(u){I(t.$$.fragment,u),l=!1},d(u){u&&g(e),W(t),s=!1,a()}}}function Nt(o){let e,t;function r(){return o[25](o[46],o[49])}return e=new mr({props:{color:"primary",$$slots:{default:[ho]},$$scope:{ctx:o}}}),e.$on("click",r),{c(){j(e.$$.fragment)},l(n){F(e.$$.fragment,n)},m(n,l){O(e,n,l),t=!0},p(n,l){o=n;const s={};l[1]&16777216&&(s.$$scope={dirty:l,ctx:o}),e.$set(s)},i(n){t||(R(e.$$.fragment,n),t=!0)},o(n){I(e.$$.fragment,n),t=!1},d(n){W(e,n)}}}function ho(o){let e;return{c(){e=B("Delete video")},l(t){e=V(t,"Delete video")},m(t,r){v(t,e,r)},d(t){t&&g(e)}}}function go(o){let e,t,r=(o[6].uid===o[46].creatorUID||!o[46].creatorUID)&&Nt(o);return{c(){r&&r.c(),e=J()},l(n){r&&r.l(n),e=J()},m(n,l){r&&r.m(n,l),v(n,e,l),t=!0},p(n,l){n[6].uid===n[46].creatorUID||!n[46].creatorUID?r?(r.p(n,l),l[0]&64|l[1]&32768&&R(r,1)):(r=Nt(n),r.c(),R(r,1),r.m(e.parentNode,e)):r&&(oe(),I(r,1,1,()=>{r=null}),ne())},i(n){t||(R(r),t=!0)},o(n){I(r),t=!1},d(n){r&&r.d(n),n&&g(e)}}}function bo(o){let e,t,r,n,l,s,a;return t=new br({props:{strokesArray:o[48],audioDownloadURL:o[46].audioDownloadURL,backgroundImageDownloadURL:o[46].backgroundImageDownloadURL,$$slots:{default:[go]},$$scope:{ctx:o}}}),{c(){e=N("div"),j(t.$$.fragment),this.h()},l(c){e=C(c,"DIV",{style:!0});var u=A(e);F(t.$$.fragment,u),u.forEach(g),this.h()},h(){D(e,"style",r=`width: ${o[8]}px; height: ${o[9]+40}px; position: relative`)},m(c,u){v(c,e,u),O(t,e,null),l=!0,s||(a=ve(n=Tt.call(null,e,o[47])),s=!0)},p(c,u){const d={};u[1]&131072&&(d.strokesArray=c[48]),u[1]&32768&&(d.audioDownloadURL=c[46].audioDownloadURL),u[1]&32768&&(d.backgroundImageDownloadURL=c[46].backgroundImageDownloadURL),u[0]&64|u[1]&16809984&&(d.$$scope={dirty:u,ctx:c}),t.$set(d),(!l||u[0]&768&&r!==(r=`width: ${c[8]}px; height: ${c[9]+40}px; position: relative`))&&D(e,"style",r),n&&Ue(n.update)&&u[1]&65536&&n.update.call(null,c[47])},i(c){l||(R(t.$$.fragment,c),l=!0)},o(c){I(t.$$.fragment,c),l=!1},d(c){c&&g(e),W(t),s=!1,a()}}}function Ct(o){let e,t,r,n;return{c(){e=N("div"),t=B("New blackboard"),this.h()},l(l){e=C(l,"DIV",{style:!0});var s=A(e);t=V(s,"New blackboard"),s.forEach(g),this.h()},h(){$(e,"display","flex"),$(e,"justify-content","center"),$(e,"align-items","center"),$(e,"margin-top","40px"),$(e,"background-color","#2e3131"),$(e,"font-family","Roboto, sans-serif"),$(e,"text-transform","uppercase"),$(e,"color","white"),$(e,"height","35px"),$(e,"width",o[8]+"px")},m(l,s){v(l,e,s),U(e,t),r||(n=K(e,"click",o[18]),r=!0)},p(l,s){s[0]&256&&$(e,"width",l[8]+"px")},d(l){l&&g(e),r=!1,n()}}}function ko(o){let e,t,r=o[46]&&Et(o);return{c(){r&&r.c(),e=M()},l(n){r&&r.l(n),e=z(n)},m(n,l){r&&r.m(n,l),v(n,e,l),t=!0},p(n,l){n[46]?r?(r.p(n,l),l[1]&32768&&R(r,1)):(r=Et(n),r.c(),R(r,1),r.m(e.parentNode,e)):r&&(oe(),I(r,1,1,()=>{r=null}),ne())},i(n){t||(R(r),t=!0)},o(n){I(r),t=!1},d(n){r&&r.d(n),n&&g(e)}}}function Bt(o,e){let t,r,n;return r=new hr({props:{dbPath:e[5]+e[43],$$slots:{default:[ko,({boardDoc:l})=>({46:l}),({boardDoc:l})=>[0,l?32768:0]]},$$scope:{ctx:e}}}),{key:o,first:null,c(){t=J(),j(r.$$.fragment),this.h()},l(l){t=J(),F(r.$$.fragment,l),this.h()},h(){this.first=t},m(l,s){v(l,t,s),O(r,l,s),n=!0},p(l,s){e=l;const a={};s[0]&33&&(a.dbPath=e[5]+e[43]),s[0]&993|s[1]&16809984&&(a.$$scope={dirty:s,ctx:e}),r.$set(a)},i(l){n||(R(r.$$.fragment,l),n=!0)},o(l){I(r.$$.fragment,l),n=!1},d(l){l&&g(t),W(r,l)}}}function $o(o){let e,t,r=o[0]&&At(o);return{c(){r&&r.c(),e=J()},l(n){r&&r.l(n),e=J()},m(n,l){r&&r.m(n,l),v(n,e,l),t=!0},p(n,l){n[0]?r?(r.p(n,l),l[0]&1&&R(r,1)):(r=At(n),r.c(),R(r,1),r.m(e.parentNode,e)):r&&(oe(),I(r,1,1,()=>{r=null}),ne())},i(n){t||(R(r),t=!0)},o(n){I(r),t=!1},d(n){r&&r.d(n),n&&g(e)}}}async function Lo({page:o}){return{props:{classID:o.params.class,roomID:o.params.room}}}async function Vt(...o){for(const e of o)try{await e()}catch(t){alert(t);return}}function te(o){return o?o.charAt(o.length-1)==="?":!1}function lt(o){return o.askerName&&o.dateAsked&&o.askerUID}function wo(o,e,t){let r,n,l,s,a,c,u;X(o,gt,k=>t(6,s=k)),X(o,vr,k=>t(7,a=k)),X(o,nt,k=>t(8,c=k)),X(o,bt,k=>t(9,u=k));let{classID:d}=e,{roomID:i}=e,b,w={name:"",blackboards:[]};async function m(){b&&b(),b=dt(l,k=>{k.exists()?t(0,w=Le({id:k.id},k.data())):yr(`/${d}/${d}`)})}et(()=>{b()});function p(k){const f=G(Q(),r+k);Y(f,{recorderBrowserTabID:a})}function h(k,f){const T=G(Q(),r+k);Y(T,{recordState:f})}async function _(k,f){const T=G(Q(),r+f);if(!!k)if(k.type.split("/")[0]==="image"){const E=tt(),H=rt(E,`images/${Ne()}`);await _t(H,k);const Z=await ht(H);Y(T,{backgroundImageDownloadURL:Z})}else alert("Error: only images can be used")}function S(k){const f=G(Q(),r+k);Y(f,{backgroundImageDownloadURL:me()})}let L="",y=5,P,q=5;async function ee({srcElement:k}){const{value:f}=k,T={name:f};!te(w.name)&&te(f)&&!lt(w)?se():L&&!te(f)?Re():!te(f)&&lt(w)?ye():P&&te(f)&&lt(w)&&De(),await Y(l,T)}function se(){t(2,y=5),t(1,L=setInterval(()=>{t(2,y-=1),y===0&&(Me(),ze(),Re())},1e3))}function ye(){t(4,q=5),t(3,P=setInterval(()=>{t(4,q-=1),q===0&&Ve()},1e3))}function Ve(){Y(l,{dateResolved:new Date().toISOString()})}function De(){clearTimeout(P),t(3,P="")}function Re(){clearTimeout(L),t(1,L="")}function Me(){Y(l,{askerName:s.name||"Beaver #999",askerUID:s.uid,dateAsked:new Date().toISOString()})}async function ze(){const k=[],f=sr(),T=ar(f,"sendTextMessage"),E=ct(Q(),"users"),H=ft(E,ir("willReceiveText","==",!0)),Z=await ur(H);if(Z.docs)for(const he of Z.docs){console.log("phoneNumber =",he.data().phoneNumber);try{he.id!==s.uid&&k.push(T({content:`${s.name} asked on https://ihtfp.app: "${w.name||"Fake question here"}"`,toWho:he.data().phoneNumber}))}catch(Ke){alert(Ke)}}await Promise.all(k),console.log("success, sent all texts.")}async function Ie({detail:k},f){const T=G(Q(),r+f);await Y(T,{description:k})}async function Te(k,f,T){function E(x){return x.startTime!==0&&x.endTime!==H}const H=.5,Z=[],he=f.length;for(let x=0;x<he;x++){if(!E(f[x])){let ae=x-1;for(;ae>=0;){if(E(f[ae])){f[x].startTime=f[ae].endTime,f[x].endTime=f[x].startTime+H,Z.push(x);break}ae-=1}}for(let ae of Z){const Ze=f[ae],jt=r+T,Ft=G(Q(),`${jt}/strokes/${Ze.id}`);Y(Ft,{startTime:Ze.startTime,endTime:Ze.endTime})}}const Ke=tt(),Je=rt(Ke,`audio/${Ne()}`);await _t(Je,k);const Mt=await ht(Je),zt=G(Q(),r+T);await Y(zt,{creatorUID:s.uid||"",creatorPhoneNumber:s.phoneNumber||"",date:new Date().toISOString(),audioDownloadURL:Mt,audioRefFullPath:Je.fullPath}),h(T,"pre_record")}async function Se({id:k,audioRefFullPath:f},T){const E=[],H=G(Q(),r+k);if(f){const Z=rt(tt(),f);E.push(cr(Z))}E.push(Y(H,{creator:me(),creatorPhoneNumber:me(),date:me(),audioDownloadURL:me(),audioRefFullPath:me()})),E.push(T()),await Promise.all(E)}async function je(){const k=Ne(),f=G(Q(),r+k);await Promise.all([pt(f,{recordState:"pre_record"}),Y(l,{blackboards:fr(k)})])}function _e(k,f){if(w.blackboards.length===1){alert("Can't delete the last blackboard");return}Y(l,{blackboards:dr(k)}),f(),pr(G(Q(),r+k))}const Fe=k=>ee(k),Oe=(k,f)=>Ie(f,k),We=(k,f)=>Se(k,f),Pe=(k,f)=>Vt(k,()=>h(f,"mid_record"),()=>p(f),()=>kt.set(!0)),qe=(k,f)=>Vt(k,()=>h(f,"post_record"),()=>kt.set(!1)),Qe=(k,f)=>_(f.detail.imageFile,k),He=k=>S(k),Xe=(k,f)=>k(f.detail.newStroke),Ge=(k,f)=>_e(k,f),Ye=(k,f,T)=>Te(T.detail.audioBlob,k,f);return o.$$set=k=>{"classID"in k&&t(20,d=k.classID),"roomID"in k&&t(21,i=k.roomID)},o.$$.update=()=>{o.$$.dirty[0]&1048576&&t(5,r=`classes/${d}/blackboards/`),o.$$.dirty[0]&1048576&&t(22,n=`classes/${d}/rooms/`),o.$$.dirty[0]&6291456&&(l=G(Q(),n+i)),o.$$.dirty[0]&2097152&&m()},[w,L,y,P,q,r,s,a,c,u,p,h,_,S,ee,Ie,Te,Se,je,_e,d,i,n,Fe,Oe,We,Pe,qe,Qe,He,Xe,Ge,Ye]}class Ao extends ie{constructor(e){super();ue(this,e,wo,$o,ce,{classID:20,roomID:21},null,[-1,-1])}}export{Ao as default,Lo as load};

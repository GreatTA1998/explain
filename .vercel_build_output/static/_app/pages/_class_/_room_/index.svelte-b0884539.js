var Ge=Object.defineProperty;var ke=Object.getOwnPropertySymbols;var Ke=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable;var be=(n,e,l)=>e in n?Ge(n,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[e]=l,te=(n,e)=>{for(var l in e||(e={}))Ke.call(e,l)&&be(n,l,e[l]);if(ke)for(var l of ke(e))Qe.call(e,l)&&be(n,l,e[l]);return n};import{S as J,i as G,s as K,G as re,H as se,I as ie,J as ae,x as _,u as k,T as Ze,O as Q,aa as $e,ab as xe,ac as et,ad as tt,P as ot,M as ye,ae as lt,af as we,ag as nt,V as ue,j as z,m as N,o as F,v as M,k as U,l as C,n as B,f as $,r as P,w as R,d as m,a2 as ve,D as ce,t as fe,g as de,ah as Y,ai as H,a as I,b as y,a7 as oe,K as Z,e as j,c as O,aj as q,ak as x,al as ee,am as De,an as rt,A as he,X as me,a9 as Te,L as Ae,ao as st,a3 as it,h as at,ap as ut}from"../../../chunks/vendor-6b05a12f.js";import{f as _e,a as Se}from"../../../chunks/database-01857712.js";import{u as Ie,c as pe}from"../../../chunks/store-6ec2b432.js";import{g as Ee}from"../../../chunks/navigation-51f4a605.js";import"../../../chunks/singletons-12a22614.js";const ct=n=>({boardDoc:n&2,isFetchingStrokes:n&1,strokesArray:n&4}),Ce=n=>({boardDoc:n[1],fetchStrokes:n[3],listenToStrokes:n[4],isFetchingStrokes:n[0],strokesArray:n[2],handleNewlyDrawnStroke:n[5],deleteAllStrokesFromDb:n[6]});function ft(n){let e;const l=n[9].default,o=re(l,n,n[8],Ce);return{c(){o&&o.c()},l(t){o&&o.l(t)},m(t,r){o&&o.m(t,r),e=!0},p(t,[r]){o&&o.p&&(!e||r&263)&&se(o,l,t,t[8],e?ae(l,t[8],r,ct):ie(t[8]),Ce)},i(t){e||(_(o,t),e=!0)},o(t){k(o,t),e=!1},d(t){o&&o.d(t)}}}function Le(n){const e=te({id:n.id},n.data());return e.startTime=0,e.endTime=0,n.data().isErasing||(e.endTime+=.5),e}function dt(n,e,l){let{$$slots:o={},$$scope:t}=e,{dbPath:r}=e,s=!1,a,i,u;const f=Ze(Q(),`${r}/strokes`);async function c(){const w=await _e(r);l(1,a=w)}c();async function d(){l(0,s=!0),l(2,i=await Se(r+"/strokes"))}async function p(){l(0,s=!0);const w=xe(f,et("timestamp"));u=tt(w,async T=>{console.log("snapshot =",T),T.docChanges().filter(A=>A.type==="removed").length>0?(l(2,i=[]),await nt(),T.docs.length>0&&T.docs.forEach(A=>{i.push(Le(A))})):(i||(l(0,s=!1),l(2,i=[])),T.docs.length===i.length||T.docChanges().filter(A=>A.type==="added").forEach(A=>{i.push(Le(A.doc))}))})}function b(w){i.push(w);try{ot(ye(Q(),`${r}/strokes/${w.id}`),te({timestamp:lt()},w))}catch(T){alert(T)}}$e(()=>{u&&u()});async function W(){const w=[];let T=we(Q()),L=0;for(const A of i){L>=500&&(w.push(T.commit()),T=we(Q()),L=0);const g=ye(Q(),`${r}/strokes/${A.id}`);T.delete(g),L+=1}w.push(T.commit()),console.log("number of strokes =",i.length),console.log("number of batches to be deleted =",L),await Promise.all(w)}return n.$$set=w=>{"dbPath"in w&&l(7,r=w.dbPath),"$$scope"in w&&l(8,t=w.$$scope)},[s,a,i,d,p,b,W,r,t,o]}class ht extends J{constructor(e){super();G(this,e,dt,ft,K,{dbPath:7})}}function Pe(n,e,l){const o=n.slice();return o[5]=e[l],o}function mt(n){let e;return{c(){e=fe("Eraser")},l(l){e=de(l,"Eraser")},m(l,o){$(l,e,o)},d(l){l&&m(e)}}}function _t(n){let e,l,o,t,r,s,a,i,u;return{c(){e=Y("svg"),l=Y("g"),o=Y("path"),t=Y("polygon"),s=Y("path"),a=Y("path"),u=U(),this.h()},l(f){e=H(f,"svg",{preserveAspectRatio:!0,version:!0,id:!0,xmlns:!0,"xmlns:xlink":!0,x:!0,y:!0,width:!0,height:!0,":viewbox":!0,style:!0,"xml:space":!0});var c=I(e);l=H(c,"g",{});var d=I(l);o=H(d,"path",{d:!0}),I(o).forEach(m),t=H(d,"polygon",{style:!0,points:!0}),I(t).forEach(m),s=H(d,"path",{style:!0,d:!0}),I(s).forEach(m),a=H(d,"path",{style:!0,d:!0}),I(a).forEach(m),d.forEach(m),c.forEach(m),u=B(f),this.h()},h(){y(o,"d",`M0,0v72.377c0,1.588,0.234,3.169,0.698,4.706l45.416,150.032C46.633,228.828,48.212,230,50,230s3.367-1.172,3.886-2.883\r
          L99.31,77.079c0.457-1.525,0.69-3.108,0.69-4.702V0.002`),y(t,"style",r=`fill: ${n[5]};`),y(t,"points","50,211.978 38.879,175.24 61.122,175.24"),oe(s,"fill","#424242"),y(s,"d",`M63.581,167.118H36.42L8.765,75.761l10.924-9.63l12.5,11.015c1.54,1.353,3.835,1.35,5.375-0.002\r
            l12.468-11.007l12.464,11.005c1.54,1.357,3.839,1.357,5.377,0l12.465-11.005l10.9,9.623L63.581,167.118z`),y(a,"style",i=`fill: ${n[5]};`),y(a,"d",`M91.878,0v65.486l-8.852-7.813c-1.539-1.353-3.838-1.354-5.377,0.002L65.185,68.679L52.72,57.674\r
            c-1.539-1.356-3.838-1.354-5.377-0.002L34.871,68.683L22.375,57.67c-0.769-0.676-1.725-1.013-2.685-1.013\r
            c-0.959,0-1.919,0.339-2.685,1.013L8.121,65.5L8.098,0.024L91.878,0z`),y(e,"preserveAspectRatio","none"),y(e,"version","1.1"),y(e,"id","Layer_1"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),y(e,"x","0px"),y(e,"y","0px"),y(e,"width","16px"),y(e,"height","35px"),y(e,":viewbox","`0 0 100 230`"),oe(e,"enable-background","new 0 0 100 230"),y(e,"xml:space","preserve")},m(f,c){$(f,e,c),Z(e,l),Z(l,o),Z(l,t),Z(l,s),Z(l,a),$(f,u,c)},p(f,c){c&1&&r!==(r=`fill: ${f[5]};`)&&y(t,"style",r),c&1&&i!==(i=`fill: ${f[5]};`)&&y(a,"style",i)},d(f){f&&m(e),f&&m(u)}}}function Re(n){let e,l;function o(){return n[3](n[5])}return e=new ue({props:{$$slots:{default:[_t]},$$scope:{ctx:n}}}),e.$on("click",o),{c(){z(e.$$.fragment)},l(t){N(e.$$.fragment,t)},m(t,r){F(e,t,r),l=!0},p(t,r){n=t;const s={};r&17&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(t){l||(_(e.$$.fragment,t),l=!0)},o(t){k(e.$$.fragment,t),l=!1},d(t){M(e,t)}}}function pt(n){let e,l,o,t,r;e=new ue({props:{$$slots:{default:[mt]},$$scope:{ctx:n}}}),e.$on("click",n[2]);const s=n[1].default,a=re(s,n,n[4],null);let i=n[0].pencilColors,u=[];for(let c=0;c<i.length;c+=1)u[c]=Re(Pe(n,i,c));const f=c=>k(u[c],1,1,()=>{u[c]=null});return{c(){z(e.$$.fragment),l=U(),a&&a.c(),o=U();for(let c=0;c<u.length;c+=1)u[c].c();t=C()},l(c){N(e.$$.fragment,c),l=B(c),a&&a.l(c),o=B(c);for(let d=0;d<u.length;d+=1)u[d].l(c);t=C()},m(c,d){F(e,c,d),$(c,l,d),a&&a.m(c,d),$(c,o,d);for(let p=0;p<u.length;p+=1)u[p].m(c,d);$(c,t,d),r=!0},p(c,[d]){const p={};if(d&16&&(p.$$scope={dirty:d,ctx:c}),e.$set(p),a&&a.p&&(!r||d&16)&&se(a,s,c,c[4],r?ae(s,c[4],d,null):ie(c[4]),null),d&1){i=c[0].pencilColors;let b;for(b=0;b<i.length;b+=1){const W=Pe(c,i,b);u[b]?(u[b].p(W,d),_(u[b],1)):(u[b]=Re(W),u[b].c(),_(u[b],1),u[b].m(t.parentNode,t))}for(P(),b=i.length;b<u.length;b+=1)f(b);R()}},i(c){if(!r){_(e.$$.fragment,c),_(a,c);for(let d=0;d<i.length;d+=1)_(u[d]);r=!0}},o(c){k(e.$$.fragment,c),k(a,c),u=u.filter(Boolean);for(let d=0;d<u.length;d+=1)k(u[d]);r=!1},d(c){M(e,c),c&&m(l),a&&a.d(c),c&&m(o),ve(u,c),c&&m(t)}}}function gt(n,e,l){let o;ce(n,Ie,i=>l(0,o=i));let{$$slots:t={},$$scope:r}=e;const s=()=>pe.set({type:"eraser",color:"",lineWidth:40}),a=i=>pe.set({type:"pencil",color:i,lineWidth:3});return n.$$set=i=>{"$$scope"in i&&l(4,r=i.$$scope)},[o,t,s,a,r]}class kt extends J{constructor(e){super();G(this,e,gt,pt,K,{})}}function le({points:n,color:e,lineWidth:l,isErasing:o},t=null,r,s){return new Promise(async a=>{for(let i=1;i<n.length;i++)ge(n,i,o,r,e,l,s),t!==null&&await new Promise(u=>setTimeout(u,t));a()})}function ge(n,e,l,o,t="white",r=3,s){bt(t,r,l,o);const a=n[e-1],i=a.unitX*s.width,u=a.unitY*s.height,f=n[e],c=f.unitX*s.width,d=f.unitY*s.height;o.beginPath(),o.moveTo(i,u),o.lineTo(c,d),o.stroke()}function bt(n,e,l,o){o.globalCompositeOperation=l?"destination-out":"source-over",o.strokeStyle=n,o.lineWidth=e,o.lineJoin="round",o.lineCap="round"}function We(n,{strokesArray:e,specialRedrawFunc:l}){let o=n.getContext("2d");n.style["background-color"]="#2e3131";const t=100;function r(){setTimeout(()=>{s(),l?l():a()},t)}function s(){let i,u;const f=document.getElementById("main-content"),c=f.clientHeight,d=f.clientWidth,p=4/3;d*(1/p)<c?(u=d,i=u*(1/p)):(i=c,u=i*p),n.width=u,n.height=i,window.addEventListener("resize",r)}function a(){for(const i of e)le(i,null,o,n)}return s(),l?l():a(),{destroy(){window.removeEventListener("resize",r)}}}const $t=function(){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let l=0;l<20;l++)e+=n.charAt(Math.floor(Math.random()*n.length));return e};function yt(n){let e;const l=n[8].default,o=re(l,n,n[10],null);return{c(){o&&o.c()},l(t){o&&o.l(t)},m(t,r){o&&o.m(t,r),e=!0},p(t,r){o&&o.p&&(!e||r&1024)&&se(o,l,t,t[10],e?ae(l,t[10],r,null):ie(t[10]),null)},i(t){e||(_(o,t),e=!0)},o(t){k(o,t),e=!1},d(t){o&&o.d(t)}}}function wt(n){let e,l,o,t,r,s,a;return e=new kt({props:{$$slots:{default:[yt]},$$scope:{ctx:n}}}),{c(){z(e.$$.fragment),l=U(),o=j("canvas")},l(i){N(e.$$.fragment,i),l=B(i),o=O(i,"CANVAS",{});var u=I(o);u.forEach(m)},m(i,u){F(e,i,u),$(i,l,u),$(i,o,u),n[9](o),r=!0,s||(a=[q(t=We.call(null,o,{strokesArray:n[0]})),x(o,"touchstart",n[2]),x(o,"touchmove",n[3]),x(o,"touchend",n[4])],s=!0)},p(i,[u]){const f={};u&1024&&(f.$$scope={dirty:u,ctx:i}),e.$set(f),t&&ee(t.update)&&u&1&&t.update.call(null,{strokesArray:i[0]})},i(i){r||(_(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){M(e,i),i&&m(l),i&&m(o),n[9](null),s=!1,De(a)}}}let ze=0;function vt(n,e,l){let o;ce(n,pe,h=>l(14,o=h));let{$$slots:t={},$$scope:r}=e,{strokesArray:s}=e;const a=rt();let i,u=[],f,c=!1,d={x:-1,y:-1},p={points:[]},b;he(()=>{l(5,i=f.getContext("2d"))});function W(h){h.touches.length>1||(h.touches[0].touchType,A(h,{isInitialContact:!0}))}function w(h){if(!!c){if(h.touches.length>1){console.log("touchmove ignored: only 1 finger allowed");return}h.touches[0].touchType,A(h,{isInitialContact:!1})}}function T(h){!c||h.touches.length>0||(h.changedTouches[0].touchType,v(p),c=!1)}function L(h){c=!0,d={x:-1,y:-1},p={strokeNumber:s.length+1,startTime:Number(ze.toFixed(1)),color:o.color,lineWidth:o.lineWidth,isErasing:o.type==="eraser",points:[],sessionID:"123"}}function A(h,{isInitialContact:S}){h.preventDefault(),S&&L();const E=D(h);g(h,E)}function g(h,S){p.points.push({unitX:parseFloat(S.x/f.width).toFixed(4),unitY:parseFloat(S.y/f.height).toFixed(4)}),d.x!==-1&&d.y!==-1&&ge([V(d),V(S)],1,o.type==="eraser",i,o.color,o.lineWidth,f),d=S}function v(h){h.endTime=Number(ze.toFixed(1)),h.id=$t(),u.push(h),a("stroke-drawn",{newStroke:h})}function D(h){const{left:S,top:E}=f.getBoundingClientRect();return{x:h.touches[0].pageX-S-window.scrollX,y:h.touches[0].pageY-E-window.scrollY}}function V({x:h,y:S}){return{unitX:h/f.width,unitY:S/f.height}}function ne(){i.clearRect(0,0,f.scrollWidth,f.scrollHeight)}function qe(h){me[h?"unshift":"push"](()=>{f=h,l(1,f)})}return n.$$set=h=>{"strokesArray"in h&&l(0,s=h.strokesArray),"$$scope"in h&&l(10,r=h.$$scope)},n.$$.update=()=>{if(n.$$.dirty&227&&s&&i){console.log("strokesArray changed and NOT localStrokesArray");let h=u.length,S=s.length;if(h!==S)if(h<S)if(h===0){for(const E of s)le(E,null,i,f);l(6,u=[...s])}else for(let E=h;E<S;E++){const X=this.strokesArray[E];le(X,X.startTime!==X.endTime?this.$_getPointDuration(X):null,i,f),u.push(X)}else{let E=function(){ne(),l(6,u=[]),d={x:-1,y:-1};for(const Je of s)le(Je,null,i,f)};(function(){console.log("debounced board reset"),b&&clearTimeout(b),l(7,b=setTimeout(E,1e3))})()}}},[s,f,W,w,T,i,u,b,t,qe,r]}class Dt extends J{constructor(e){super();G(this,e,vt,wt,K,{strokesArray:0})}}function Tt(n){let e,l,o,t,r,s,a;return{c(){e=j("canvas"),o=U(),t=j("audio"),this.h()},l(i){e=O(i,"CANVAS",{});var u=I(e);u.forEach(m),o=B(i),t=O(i,"AUDIO",{src:!0,style:!0});var f=I(t);f.forEach(m),this.h()},h(){Te(t.src,r=n[1])||y(t,"src",r),t.controls=!0,oe(t,"width","100%")},m(i,u){$(i,e,u),n[6](e),$(i,o,u),$(i,t,u),n[7](t),s||(a=[q(l=We.call(null,e,{strokesArray:n[0],handleResize:n[5]})),x(e,"resized",n[5]),x(t,"play",n[4])],s=!0)},p(i,[u]){l&&ee(l.update)&&u&1&&l.update.call(null,{strokesArray:i[0],handleResize:i[5]}),u&2&&!Te(t.src,r=i[1])&&y(t,"src",r)},i:Ae,o:Ae,d(i){i&&m(e),n[6](null),i&&m(o),i&&m(t),n[7](null),s=!1,De(a)}}}let At=1;function St(n){return(n.endTime-n.startTime)/n.points.length}function It(n,e,l){let{strokesArray:o}=e,{audioDownloadURL:t}=e,r,s=0,a,i,u,f;$e(()=>{f&&clearTimeout(f)}),he(()=>{i=a.getContext("2d");const g=[];for(let v=0;v<o.length;v++)for(let D=1;D<o[v].points.length;D++){const V={strokeIndex:v,pointIndex:D};g.push(te({startTime:c(V)},V))}r=g.sort((v,D)=>v.startTime-D.startTime)});function c({strokeIndex:g,pointIndex:v}){const D=o[g];return D.startTime+(v-1)*St(D)}function d(){s=0,i.clearRect(0,0,a.width,a.height),p()}function p(){if(!!u&&(b(),s<r.length)){const g=r[s],v=1e3*(g.startTime-u.currentTime);f=setTimeout(p,v/At)}}function b(){if(!u)return;const g=r[s];(!g||g.startTime>u.currentTime)&&(i.clearRect(0,0,a.width,a.height),s=0),W()}function W(){const{currentTime:g}=u;for(let v=s;v<r.length;v++){const D=r[v];if(D.startTime>g)break;w(D),s+=1}}function w({strokeIndex:g,pointIndex:v}){const D=o[g],ne=D.lineWidth*(a.scrollWidth/1e3);ge(D.points,v,D.isErasing,i,D.color,ne,a)}function T(){return new Promise(async g=>{f?(s=0,this.syncStrokesToAudio()):this.renderFramesUntilCurrentTime(),g()})}function L(g){me[g?"unshift":"push"](()=>{a=g,l(2,a)})}function A(g){me[g?"unshift":"push"](()=>{u=g,l(3,u)})}return n.$$set=g=>{"strokesArray"in g&&l(0,o=g.strokesArray),"audioDownloadURL"in g&&l(1,t=g.audioDownloadURL)},[o,t,a,u,d,T,L,A]}class Et extends J{constructor(e){super();G(this,e,It,Tt,K,{strokesArray:0,audioDownloadURL:1})}}function Ne(n,e){let l=document.getElementById(e);return l==null||l.appendChild(n),{destroy(){n.remove()}}}function Fe(n,e,l){const o=n.slice();return o[10]=e[l],o}function Me(n,e,l){const o=n.slice();return o[3]=e[l],o}function Ue(n){let e,l,o,t,r,s=n[2],a=[];for(let u=0;u<s.length;u+=1)a[u]=je(Me(n,s,u));const i=u=>k(a[u],1,1,()=>{a[u]=null});return{c(){e=j("div");for(let u=0;u<a.length;u+=1)a[u].c()},l(u){e=O(u,"DIV",{});var f=I(e);for(let c=0;c<a.length;c+=1)a[c].l(f);f.forEach(m)},m(u,f){$(u,e,f);for(let c=0;c<a.length;c+=1)a[c].m(e,null);o=!0,t||(r=q(l=Ne.call(null,e,"side-drawer-list")),t=!0)},p(u,f){if(f&7){s=u[2];let c;for(c=0;c<s.length;c+=1){const d=Me(u,s,c);a[c]?(a[c].p(d,f),_(a[c],1)):(a[c]=je(d),a[c].c(),_(a[c],1),a[c].m(e,null))}for(P(),c=s.length;c<a.length;c+=1)i(c);R()}},i(u){if(!o){for(let f=0;f<s.length;f+=1)_(a[f]);o=!0}},o(u){a=a.filter(Boolean);for(let f=0;f<a.length;f+=1)k(a[f]);o=!1},d(u){u&&m(e),ve(a,u),t=!1,r()}}}function Be(n){let e,l;function o(){return n[5](n[3])}return e=new it({props:{selected:n[3].id===n[1],$$slots:{default:[Ct]},$$scope:{ctx:n}}}),e.$on("click",o),{c(){z(e.$$.fragment)},l(t){N(e.$$.fragment,t)},m(t,r){F(e,t,r),l=!0},p(t,r){n=t;const s={};r&6&&(s.selected=n[3].id===n[1]),r&4194308&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(t){l||(_(e.$$.fragment,t),l=!0)},o(t){k(e.$$.fragment,t),l=!1},d(t){M(e,t)}}}function Ct(n){let e=n[3].name+"",l,o;return{c(){l=fe(e),o=U()},l(t){l=de(t,e),o=B(t)},m(t,r){$(t,l,r),$(t,o,r)},p(t,r){r&4&&e!==(e=t[3].name+"")&&at(l,e)},d(t){t&&m(l),t&&m(o)}}}function je(n){let e,l,o=n[3].name&&Be(n);return{c(){o&&o.c(),e=C()},l(t){o&&o.l(t),e=C()},m(t,r){o&&o.m(t,r),$(t,e,r),l=!0},p(t,r){t[3].name?o?(o.p(t,r),r&4&&_(o,1)):(o=Be(t),o.c(),_(o,1),o.m(e.parentNode,e)):o&&(P(),k(o,1,1,()=>{o=null}),R())},i(t){l||(_(o),l=!0)},o(t){k(o),l=!1},d(t){o&&o.d(t),t&&m(e)}}}function Oe(n){let e,l=[],o=new Map,t,r,s,a,i=n[3].blackboards;const u=f=>f[10];for(let f=0;f<i.length;f+=1){let c=Fe(n,i,f),d=u(c);o.set(d,l[f]=Ye(d,c))}return{c(){e=j("div");for(let f=0;f<l.length;f+=1)l[f].c();this.h()},l(f){e=O(f,"DIV",{style:!0});var c=I(e);for(let d=0;d<l.length;d+=1)l[d].l(c);c.forEach(m),this.h()},h(){oe(e,"height","100vh")},m(f,c){$(f,e,c);for(let d=0;d<l.length;d+=1)l[d].m(e,null);r=!0,s||(a=q(t=Ne.call(null,e,"main-content")),s=!0)},p(f,c){c&712728&&(i=f[3].blackboards,P(),l=st(l,c,u,1,f,i,o,e,ut,Ye,null,Fe),R())},i(f){if(!r){for(let c=0;c<i.length;c+=1)_(l[c]);r=!0}},o(f){for(let c=0;c<l.length;c+=1)k(l[c]);r=!1},d(f){f&&m(e);for(let c=0;c<l.length;c+=1)l[c].d();s=!1,a()}}}function Ve(n){let e,l,o,t;const r=[Pt,Lt],s=[];function a(i,u){return i[13].audioDownloadURL?0:1}return e=a(n),l=s[e]=r[e](n),{c(){l.c(),o=C()},l(i){l.l(i),o=C()},m(i,u){s[e].m(i,u),$(i,o,u),t=!0},p(i,u){let f=e;e=a(i),e===f?s[e].p(i,u):(P(),k(s[f],1,1,()=>{s[f]=null}),R(),l=s[e],l?l.p(i,u):(l=s[e]=r[e](i),l.c()),_(l,1),l.m(o.parentNode,o))},i(i){t||(_(l),t=!0)},o(i){k(l),t=!1},d(i){s[e].d(i),i&&m(o)}}}function Lt(n){let e,l,o,t,r,s=n[17]&&Xe(n);return{c(){e=j("div"),s&&s.c()},l(a){e=O(a,"DIV",{});var i=I(e);s&&s.l(i),i.forEach(m)},m(a,i){$(a,e,i),s&&s.m(e,null),o=!0,t||(r=q(l=He.call(null,e,n[15])),t=!0)},p(a,i){a[17]?s?(s.p(a,i),i&131072&&_(s,1)):(s=Xe(a),s.c(),_(s,1),s.m(e,null)):s&&(P(),k(s,1,1,()=>{s=null}),R()),l&&ee(l.update)&&i&32768&&l.update.call(null,a[15])},i(a){o||(_(s),o=!0)},o(a){k(s),o=!1},d(a){a&&m(e),s&&s.d(),t=!1,r()}}}function Pt(n){let e,l,o,t,r,s;return l=new Et({props:{strokesArray:n[17],audioDownloadURL:n[13].audioDownloadURL}}),{c(){e=j("div"),z(l.$$.fragment)},l(a){e=O(a,"DIV",{});var i=I(e);N(l.$$.fragment,i),i.forEach(m)},m(a,i){$(a,e,i),F(l,e,null),t=!0,r||(s=q(o=He.call(null,e,n[14])),r=!0)},p(a,i){const u={};i&131072&&(u.strokesArray=a[17]),i&8192&&(u.audioDownloadURL=a[13].audioDownloadURL),l.$set(u),o&&ee(o.update)&&i&16384&&o.update.call(null,a[14])},i(a){t||(_(l.$$.fragment,a),t=!0)},o(a){k(l.$$.fragment,a),t=!1},d(a){a&&m(e),M(l),r=!1,s()}}}function Xe(n){let e,l;function o(...t){return n[6](n[18],...t)}return e=new Dt({props:{strokesArray:n[17],$$slots:{default:[Wt]},$$scope:{ctx:n}}}),e.$on("stroke-drawn",o),{c(){z(e.$$.fragment)},l(t){N(e.$$.fragment,t)},m(t,r){F(e,t,r),l=!0},p(t,r){n=t;const s={};r&131072&&(s.strokesArray=n[17]),r&4718592&&(s.$$scope={dirty:r,ctx:n}),e.$set(s)},i(t){l||(_(e.$$.fragment,t),l=!0)},o(t){k(e.$$.fragment,t),l=!1},d(t){M(e,t)}}}function Rt(n){let e;return{c(){e=fe("Wipe board")},l(l){e=de(l,"Wipe board")},m(l,o){$(l,e,o)},d(l){l&&m(e)}}}function Wt(n){let e,l;return e=new ue({props:{$$slots:{default:[Rt]},$$scope:{ctx:n}}}),e.$on("click",function(){ee(n[19])&&n[19].apply(this,arguments)}),{c(){z(e.$$.fragment)},l(o){N(e.$$.fragment,o)},m(o,t){F(e,o,t),l=!0},p(o,t){n=o;const r={};t&4194304&&(r.$$scope={dirty:t,ctx:n}),e.$set(r)},i(o){l||(_(e.$$.fragment,o),l=!0)},o(o){k(e.$$.fragment,o),l=!1},d(o){M(e,o)}}}function zt(n){let e,l,o=n[13]&&Ve(n);return{c(){o&&o.c(),e=U()},l(t){o&&o.l(t),e=B(t)},m(t,r){o&&o.m(t,r),$(t,e,r),l=!0},p(t,r){t[13]?o?(o.p(t,r),r&8192&&_(o,1)):(o=Ve(t),o.c(),_(o,1),o.m(e.parentNode,e)):o&&(P(),k(o,1,1,()=>{o=null}),R())},i(t){l||(_(o),l=!0)},o(t){k(o),l=!1},d(t){o&&o.d(t),t&&m(e)}}}function Ye(n,e){let l,o,t;return o=new ht({props:{dbPath:e[4]+e[10],$$slots:{default:[zt,({boardDoc:r,fetchStrokes:s,listenToStrokes:a,isFetchingStrokes:i,strokesArray:u,handleNewlyDrawnStroke:f,deleteAllStrokesFromDb:c})=>({13:r,14:s,15:a,16:i,17:u,18:f,19:c}),({boardDoc:r,fetchStrokes:s,listenToStrokes:a,isFetchingStrokes:i,strokesArray:u,handleNewlyDrawnStroke:f,deleteAllStrokesFromDb:c})=>(r?8192:0)|(s?16384:0)|(a?32768:0)|(i?65536:0)|(u?131072:0)|(f?262144:0)|(c?524288:0)]},$$scope:{ctx:e}}}),{key:n,first:null,c(){l=C(),z(o.$$.fragment),this.h()},l(r){l=C(),N(o.$$.fragment,r),this.h()},h(){this.first=l},m(r,s){$(r,l,s),F(o,r,s),t=!0},p(r,s){e=r;const a={};s&8&&(a.dbPath=e[4]+e[10]),s&4907008&&(a.$$scope={dirty:s,ctx:e}),o.$set(a)},i(r){t||(_(o.$$.fragment,r),t=!0)},o(r){k(o.$$.fragment,r),t=!1},d(r){r&&m(l),M(o,r)}}}function Nt(n){let e,l,o,t=n[2].length>0&&Ue(n),r=n[3]&&Oe(n);return{c(){t&&t.c(),e=U(),r&&r.c(),l=C()},l(s){t&&t.l(s),e=B(s),r&&r.l(s),l=C()},m(s,a){t&&t.m(s,a),$(s,e,a),r&&r.m(s,a),$(s,l,a),o=!0},p(s,[a]){s[2].length>0?t?(t.p(s,a),a&4&&_(t,1)):(t=Ue(s),t.c(),_(t,1),t.m(e.parentNode,e)):t&&(P(),k(t,1,1,()=>{t=null}),R()),s[3]?r?(r.p(s,a),a&8&&_(r,1)):(r=Oe(s),r.c(),_(r,1),r.m(l.parentNode,l)):r&&(P(),k(r,1,1,()=>{r=null}),R())},i(s){o||(_(t),_(r),o=!0)},o(s){k(t),k(r),o=!1},d(s){t&&t.d(s),s&&m(e),r&&r.d(s),s&&m(l)}}}function Xt({page:n}){return console.log("load function from [room].svelte"),{props:{classID:n.params.class,roomID:n.params.room}}}function He(n,e){let l=new IntersectionObserver(o=>{for(const t of o)if(t.isIntersecting){e(),l.unobserve(n);return}},{root:null,threshold:.1,rootMargin:"0px"});l.observe(n)}function Ft(n,e,l){let o;ce(n,Ie,p=>l(7,o=p));let{classID:t}=e,{roomID:r}=e,s,a=[];const i=`classes/${t}/blackboards/`,u=`classes/${t}/rooms/`;o.uid||(console.log("redirecting to tutorial"),Ee("/")),he(async()=>{l(2,a=await Se(u)),l(3,s=await _e(u+r))});async function f(){l(3,s=await _e(u+r))}const c=p=>Ee(`/${t}/${p.id}`),d=(p,b)=>p(b.detail.newStroke);return n.$$set=p=>{"classID"in p&&l(0,t=p.classID),"roomID"in p&&l(1,r=p.roomID)},n.$$.update=()=>{n.$$.dirty&2&&f()},[t,r,a,s,i,c,d]}class Yt extends J{constructor(e){super();G(this,e,Ft,Nt,K,{classID:0,roomID:1})}}export{Yt as default,Xt as load};

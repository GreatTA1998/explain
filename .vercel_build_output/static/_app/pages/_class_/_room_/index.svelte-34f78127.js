var Re=Object.defineProperty;var x=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var ee=(l,e,o)=>e in l?Re(l,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[e]=o,te=(l,e)=>{for(var o in e||(e={}))Ie.call(e,o)&&ee(l,o,e[o]);if(x)for(var o of x(e))ye.call(e,o)&&ee(l,o,e[o]);return l};import{S as Ne,i as Ue,s as Le,e as q,j as v,k as E,c as H,a as F,m as D,n as z,d as b,K as Q,W as oe,f as g,o as R,L as Y,a1 as Z,az as Be,aA as Pe,w as U,x as m,u as h,v as I,l as y,D as K,A as Se,N as O,O as V,Z as ne,a2 as G,r as L,aE as Ae,av as C,ag as je,aF as le,aG as ae,aH as Me,aI as Ee,aJ as ze,Q as Oe,aK as Ve,Y as Ce,_ as We,t as S,g as A,aL as W,b as T,a8 as M,M as X,al as Te,a4 as qe,am as He,an as Fe}from"../../../chunks/vendor-60dbf49e.js";import{R as Ke,a as Ge,B as Je,D as Qe}from"../../../chunks/RenderlessBoardMethods-8a36537a.js";import{a as Ye}from"../../../chunks/database-63c5af1e.js";import{g as Ze}from"../../../chunks/canvas-e5ae1966.js";import{g as re,u as Xe,c as xe,a as et,r as tt}from"../../../chunks/store-620103ad.js";import"../../../chunks/preload-helper-ec9aa979.js";import"../../../chunks/singletons-12a22614.js";function ot(l,e){let o=document.getElementById(e);return o==null||o.appendChild(l),{destroy(){l.remove()}}}function se(l,e){let o=new IntersectionObserver(t=>{for(const n of t)if(n.isIntersecting){e(),o.unobserve(l);return}},{root:null,threshold:.2,rootMargin:"0px"});o.observe(l)}function ie(l,e,o){const t=l.slice();return t[23]=e[o],t}function fe(l){let e,o,t,n=[],a=new Map,r,s,i,f,u,c;o=new ne({props:{value:l[1].name,class:"room-title",style:`width: ${l[2]}px; margin-bottom: 20px;`}}),o.$on("input",l[13]);let _=l[1].blackboards;const N=p=>p[23];for(let p=0;p<_.length;p+=1){let $=ie(l,_,p),k=N($);a.set(k,n[p]=$e(k,$))}return s=new G({props:{variant:"unelevated",color:"#2e3131",style:`width: ${l[2]}px; margin-top: 40px`,$$slots:{default:[gt]},$$scope:{ctx:l}}}),s.$on("click",l[10]),{c(){e=q("div"),v(o.$$.fragment),t=E();for(let p=0;p<n.length;p+=1)n[p].c();r=E(),v(s.$$.fragment),this.h()},l(p){e=H(p,"DIV",{style:!0});var $=F(e);D(o.$$.fragment,$),t=z($);for(let k=0;k<n.length;k+=1)n[k].l($);r=z($),D(s.$$.fragment,$),$.forEach(b),this.h()},h(){Q(e,"padding","16px"),oe(e,"question",l[1].name.charAt(l[1].name.length-1)==="?")},m(p,$){g(p,e,$),R(o,e,null),Y(e,t);for(let k=0;k<n.length;k+=1)n[k].m(e,null);Y(e,r),R(s,e,null),f=!0,u||(c=Z(i=ot.call(null,e,"main-content")),u=!0)},p(p,$){const k={};$[0]&2&&(k.value=p[1].name),$[0]&4&&(k.style=`width: ${p[2]}px; margin-bottom: 20px;`),o.$set(k),$[0]&1006633919|$[1]&15&&(_=p[1].blackboards,L(),n=Be(n,$,N,1,p,_,a,e,Pe,$e,r,ie),U());const j={};$[0]&4&&(j.style=`width: ${p[2]}px; margin-top: 40px`),$[1]&16&&(j.$$scope={dirty:$,ctx:p}),s.$set(j),$[0]&2&&oe(e,"question",p[1].name.charAt(p[1].name.length-1)==="?")},i(p){if(!f){m(o.$$.fragment,p);for(let $=0;$<_.length;$+=1)m(n[$]);m(s.$$.fragment,p),f=!0}},o(p){h(o.$$.fragment,p);for(let $=0;$<n.length;$+=1)h(n[$]);h(s.$$.fragment,p),f=!1},d(p){p&&b(e),I(o);for(let $=0;$<n.length;$+=1)n[$].d();I(s),u=!1,c()}}}function ue(l){let e,o,t,n,a,r=l[29]&&ce(l);const s=[lt,nt],i=[];function f(u,c){return u[26].audioDownloadURL?0:1}return o=f(l),t=i[o]=s[o](l),{c(){r&&r.c(),e=E(),t.c(),n=y()},l(u){r&&r.l(u),e=z(u),t.l(u),n=y()},m(u,c){r&&r.m(u,c),g(u,e,c),i[o].m(u,c),g(u,n,c),a=!0},p(u,c){u[29]?r?(r.p(u,c),c[0]&536870912&&m(r,1)):(r=ce(u),r.c(),m(r,1),r.m(e.parentNode,e)):r&&(L(),h(r,1,1,()=>{r=null}),U());let _=o;o=f(u),o===_?i[o].p(u,c):(L(),h(i[_],1,1,()=>{i[_]=null}),U(),t=i[o],t?t.p(u,c):(t=i[o]=s[o](u),t.c()),m(t,1),t.m(n.parentNode,n))},i(u){a||(m(r),m(t),a=!0)},o(u){h(r),h(t),a=!1},d(u){r&&r.d(u),u&&b(e),i[o].d(u),u&&b(n)}}}function ce(l){let e,o;function t(...n){return l[14](l[23],...n)}return e=new ne({props:{textarea:!0,value:l[26].description||"",style:`width: ${l[2]}px; margin-bottom: 10px`}}),e.$on("input",t),{c(){v(e.$$.fragment)},l(n){D(e.$$.fragment,n)},m(n,a){R(e,n,a),o=!0},p(n,a){l=n;const r={};a[0]&67108864&&(r.value=l[26].description||""),a[0]&4&&(r.style=`width: ${l[2]}px; margin-bottom: 10px`),e.$set(r)},i(n){o||(m(e.$$.fragment,n),o=!0)},o(n){h(e.$$.fragment,n),o=!1},d(n){I(e,n)}}}function nt(l){let e,o,t,n,a,r,s=l[29]&&de(l);return{c(){e=q("div"),s&&s.c(),this.h()},l(i){e=H(i,"DIV",{style:!0});var f=F(e);s&&s.l(f),f.forEach(b),this.h()},h(){T(e,"style",o=`width: ${l[2]}px; height: ${l[3]}px; position: relative`)},m(i,f){g(i,e,f),s&&s.m(e,null),n=!0,a||(r=Z(t=se.call(null,e,l[28])),a=!0)},p(i,f){i[29]?s?(s.p(i,f),f[0]&536870912&&m(s,1)):(s=de(i),s.c(),m(s,1),s.m(e,null)):s&&(L(),h(s,1,1,()=>{s=null}),U()),(!n||f[0]&12&&o!==(o=`width: ${i[2]}px; height: ${i[3]}px; position: relative`))&&T(e,"style",o),t&&M(t.update)&&f[0]&268435456&&t.update.call(null,i[28])},i(i){n||(m(s),n=!0)},o(i){h(s),n=!1},d(i){i&&b(e),s&&s.d(),a=!1,r()}}}function lt(l){let e,o,t,n,a,r,s=l[29]&&pe(l);return{c(){e=q("div"),s&&s.c(),this.h()},l(i){e=H(i,"DIV",{style:!0});var f=F(e);s&&s.l(f),f.forEach(b),this.h()},h(){T(e,"style",o=`width: ${l[2]}px; height: ${l[3]+80}px; position: relative`)},m(i,f){g(i,e,f),s&&s.m(e,null),n=!0,a||(r=Z(t=se.call(null,e,l[27])),a=!0)},p(i,f){i[29]?s?(s.p(i,f),f[0]&536870912&&m(s,1)):(s=pe(i),s.c(),m(s,1),s.m(e,null)):s&&(L(),h(s,1,1,()=>{s=null}),U()),(!n||f[0]&12&&o!==(o=`width: ${i[2]}px; height: ${i[3]+80}px; position: relative`))&&T(e,"style",o),t&&M(t.update)&&f[0]&134217728&&t.update.call(null,i[27])},i(i){n||(m(s),n=!0)},o(i){h(s),n=!1},d(i){i&&b(e),s&&s.d(),a=!1,r()}}}function de(l){let e,o;function t(...n){return l[18](l[23],...n)}return e=new Ge({props:{$$slots:{default:[$t,({startRecording:n,stopRecording:a,currentTime:r})=>({32:n,33:a,34:r}),({startRecording:n,stopRecording:a,currentTime:r})=>[0,(n?2:0)|(a?4:0)|(r?8:0)]]},$$scope:{ctx:l}}}),e.$on("record-end",t),{c(){v(e.$$.fragment)},l(n){D(e.$$.fragment,n)},m(n,a){R(e,n,a),o=!0},p(n,a){l=n;const r={};a[0]&536870929|a[1]&31&&(r.$$scope={dirty:a,ctx:l}),e.$set(r)},i(n){o||(m(e.$$.fragment,n),o=!0)},o(n){h(e.$$.fragment,n),o=!1},d(n){I(e,n)}}}function at(l){let e;return{c(){e=S("Uploading...")},l(o){e=A(o,"Uploading...")},m(o,t){g(o,e,t)},p:X,i:X,o:X,d(o){o&&b(e)}}}function rt(l){let e,o;return e=new G({props:{color:"secondary",$$slots:{default:[it]},$$scope:{ctx:l}}}),e.$on("click",function(){M(l[33])&&l[33].apply(this,arguments)}),{c(){v(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,n){R(e,t,n),o=!0},p(t,n){l=t;const a={};n[1]&16&&(a.$$scope={dirty:n,ctx:l}),e.$set(a)},i(t){o||(m(e.$$.fragment,t),o=!0)},o(t){h(e.$$.fragment,t),o=!1},d(t){I(e,t)}}}function st(l){let e,o,t,n,a,r,s,i,f;e=new G({props:{style:"color: #f5862c",$$slots:{default:[ft]},$$scope:{ctx:l}}}),e.$on("click",function(){M(l[32])&&l[32].apply(this,arguments)});let u={style:"left: 100px; top: 50px; width: 300px",$$slots:{default:[dt]},$$scope:{ctx:l}};return r=new Te({props:u}),l[16](r),{c(){v(e.$$.fragment),o=E(),t=q("span"),n=S("more_horiz"),a=E(),v(r.$$.fragment),this.h()},l(c){D(e.$$.fragment,c),o=z(c),t=H(c,"SPAN",{class:!0,style:!0});var _=F(t);n=A(_,"more_horiz"),_.forEach(b),a=z(c),D(r.$$.fragment,c),this.h()},h(){T(t,"class","material-icons"),Q(t,"margin-right","10px"),Q(t,"color","white")},m(c,_){R(e,c,_),g(c,o,_),g(c,t,_),Y(t,n),g(c,a,_),R(r,c,_),s=!0,i||(f=qe(t,"click",l[15]),i=!0)},p(c,_){l=c;const N={};_[1]&16&&(N.$$scope={dirty:_,ctx:l}),e.$set(N);const p={};_[1]&17&&(p.$$scope={dirty:_,ctx:l}),r.$set(p)},i(c){s||(m(e.$$.fragment,c),m(r.$$.fragment,c),s=!0)},o(c){h(e.$$.fragment,c),h(r.$$.fragment,c),s=!1},d(c){I(e,c),c&&b(o),c&&b(t),c&&b(a),l[16](null),I(r,c),i=!1,f()}}}function it(l){let e;return{c(){e=S("Stop")},l(o){e=A(o,"Stop")},m(o,t){g(o,e,t)},d(o){o&&b(e)}}}function ft(l){let e;return{c(){e=S("Record")},l(o){e=A(o,"Record")},m(o,t){g(o,e,t)},d(o){o&&b(e)}}}function ut(l){let e;return{c(){e=S("Wipe board")},l(o){e=A(o,"Wipe board")},m(o,t){g(o,e,t)},d(o){o&&b(e)}}}function ct(l){let e,o;return e=new Fe({props:{$$slots:{default:[ut]},$$scope:{ctx:l}}}),e.$on("SMUI:action",function(){M(l[31])&&l[31].apply(this,arguments)}),{c(){v(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,n){R(e,t,n),o=!0},p(t,n){l=t;const a={};n[1]&16&&(a.$$scope={dirty:n,ctx:l}),e.$set(a)},i(t){o||(m(e.$$.fragment,t),o=!0)},o(t){h(e.$$.fragment,t),o=!1},d(t){I(e,t)}}}function dt(l){let e,o;return e=new He({props:{$$slots:{default:[ct]},$$scope:{ctx:l}}}),{c(){v(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,n){R(e,t,n),o=!0},p(t,n){const a={};n[1]&17&&(a.$$scope={dirty:n,ctx:t}),e.$set(a)},i(t){o||(m(e.$$.fragment,t),o=!0)},o(t){h(e.$$.fragment,t),o=!1},d(t){I(e,t)}}}function pt(l){let e,o,t,n;const a=[st,rt,at],r=[];function s(i,f){return i[4]==="pre_record"?0:i[4]==="mid_record"?1:2}return e=s(l),o=r[e]=a[e](l),{c(){o.c(),t=y()},l(i){o.l(i),t=y()},m(i,f){r[e].m(i,f),g(i,t,f),n=!0},p(i,f){let u=e;e=s(i),e===u?r[e].p(i,f):(L(),h(r[u],1,1,()=>{r[u]=null}),U(),o=r[e],o?o.p(i,f):(o=r[e]=a[e](i),o.c()),m(o,1),o.m(t.parentNode,t))},i(i){n||(m(o),n=!0)},o(i){h(o),n=!1},d(i){r[e].d(i),i&&b(t)}}}function $t(l){let e,o;function t(...n){return l[17](l[30],...n)}return e=new Je({props:{strokesArray:l[29],currentTime:l[34],$$slots:{default:[pt]},$$scope:{ctx:l}}}),e.$on("stroke-drawn",t),{c(){v(e.$$.fragment)},l(n){D(e.$$.fragment,n)},m(n,a){R(e,n,a),o=!0},p(n,a){l=n;const r={};a[0]&536870912&&(r.strokesArray=l[29]),a[1]&8&&(r.currentTime=l[34]),a[0]&17|a[1]&23&&(r.$$scope={dirty:a,ctx:l}),e.$set(r)},i(n){o||(m(e.$$.fragment,n),o=!0)},o(n){h(e.$$.fragment,n),o=!1},d(n){I(e,n)}}}function pe(l){let e,o;return e=new Qe({props:{strokesArray:l[29],audioDownloadURL:l[26].audioDownloadURL,$$slots:{default:[_t]},$$scope:{ctx:l}}}),{c(){v(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,n){R(e,t,n),o=!0},p(t,n){const a={};n[0]&536870912&&(a.strokesArray=t[29]),n[0]&67108864&&(a.audioDownloadURL=t[26].audioDownloadURL),n[0]&67108864|n[1]&16&&(a.$$scope={dirty:n,ctx:t}),e.$set(a)},i(t){o||(m(e.$$.fragment,t),o=!0)},o(t){h(e.$$.fragment,t),o=!1},d(t){I(e,t)}}}function mt(l){let e;return{c(){e=S("Revert to board")},l(o){e=A(o,"Revert to board")},m(o,t){g(o,e,t)},d(o){o&&b(e)}}}function _t(l){let e,o;return e=new G({props:{$$slots:{default:[mt]},$$scope:{ctx:l}}}),e.$on("click",function(){M(l[9](l[26]))&&l[9](l[26]).apply(this,arguments)}),{c(){v(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,n){R(e,t,n),o=!0},p(t,n){l=t;const a={};n[1]&16&&(a.$$scope={dirty:n,ctx:l}),e.$set(a)},i(t){o||(m(e.$$.fragment,t),o=!0)},o(t){h(e.$$.fragment,t),o=!1},d(t){I(e,t)}}}function ht(l){let e,o,t=l[26]&&ue(l);return{c(){t&&t.c(),e=y()},l(n){t&&t.l(n),e=y()},m(n,a){t&&t.m(n,a),g(n,e,a),o=!0},p(n,a){n[26]?t?(t.p(n,a),a[0]&67108864&&m(t,1)):(t=ue(n),t.c(),m(t,1),t.m(e.parentNode,e)):t&&(L(),h(t,1,1,()=>{t=null}),U())},i(n){o||(m(t),o=!0)},o(n){h(t),o=!1},d(n){t&&t.d(n),n&&b(e)}}}function $e(l,e){let o,t,n;return t=new Ke({props:{dbPath:e[5]+e[23],$$slots:{default:[ht,({boardDoc:a,fetchStrokes:r,listenToStrokes:s,strokesArray:i,handleNewlyDrawnStroke:f,deleteAllStrokesFromDb:u})=>({26:a,27:r,28:s,29:i,30:f,31:u}),({boardDoc:a,fetchStrokes:r,listenToStrokes:s,strokesArray:i,handleNewlyDrawnStroke:f,deleteAllStrokesFromDb:u})=>[(a?67108864:0)|(r?134217728:0)|(s?268435456:0)|(i?536870912:0)|(f?1073741824:0),u?1:0]]},$$scope:{ctx:e}}}),{key:l,first:null,c(){o=y(),v(t.$$.fragment),this.h()},l(a){o=y(),D(t.$$.fragment,a),this.h()},h(){this.first=o},m(a,r){g(a,o,r),R(t,a,r),n=!0},p(a,r){e=a;const s={};r[0]&2&&(s.dbPath=e[5]+e[23]),r[0]&1006632991|r[1]&17&&(s.$$scope={dirty:r,ctx:e}),t.$set(s)},i(a){n||(m(t.$$.fragment,a),n=!0)},o(a){h(t.$$.fragment,a),n=!1},d(a){a&&b(o),I(t,a)}}}function bt(l){let e;return{c(){e=S("New blackboard")},l(o){e=A(o,"New blackboard")},m(o,t){g(o,e,t)},d(o){o&&b(e)}}}function gt(l){let e,o;return e=new Ae({props:{$$slots:{default:[bt]},$$scope:{ctx:l}}}),{c(){v(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,n){R(e,t,n),o=!0},p(t,n){const a={};n[1]&16&&(a.$$scope={dirty:n,ctx:t}),e.$set(a)},i(t){o||(m(e.$$.fragment,t),o=!0)},o(t){h(e.$$.fragment,t),o=!1},d(t){I(e,t)}}}function kt(l){let e,o,t=l[1]&&fe(l);return{c(){t&&t.c(),e=y()},l(n){t&&t.l(n),e=y()},m(n,a){t&&t.m(n,a),g(n,e,a),o=!0},p(n,a){n[1]?t?(t.p(n,a),a[0]&2&&m(t,1)):(t=fe(n),t.c(),m(t,1),t.m(e.parentNode,e)):t&&(L(),h(t,1,1,()=>{t=null}),U())},i(n){o||(m(t),o=!0)},o(n){h(t),o=!1},d(n){t&&t.d(n),n&&b(e)}}}async function Bt({page:l}){return{props:{classID:l.params.class,roomID:l.params.room}}}function wt(l,e,o){let t,n,a,r,s;K(l,Xe,d=>o(20,n=d)),K(l,xe,d=>o(2,a=d)),K(l,et,d=>o(3,r=d)),K(l,tt,d=>o(4,s=d));let{classID:i}=e,{roomID:f}=e,u,c;const _=`classes/${i}/blackboards/`,N=`classes/${i}/rooms/`;n.uid||Ze("/");async function p(d){const{value:w}=d.srcElement;await C(t,{name:w})}async function $(d,w){const{value:B}=d.srcElement,P=O(V(),_+w);await C(P,{description:B})}Se(async()=>{je(t,d=>{o(1,c=te({id:d.id},d.data()))})});async function k(){o(1,c=await Ye(N+f))}async function j(d,w){console.log("saveVideo(), audioBlob =",d);const B=le(),P=ae(B,`audio/${re()}`);await Me(P,d);const J=await Ee(P),De=O(V(),_+w);await C(De,{creatorUID:n.uid,creatorPhoneNumber:n.phoneNumber,date:new Date().toISOString(),audioDownloadURL:J,audioRefFullPath:P.fullPath})}async function me({id:d,audioRefFullPath:w}){const B=[],P=O(V(),_+d);if(w){const J=ae(le(),w);B.push(ze(J))}B.push(C(P,{creator:W(),creatorPhoneNumber:W(),date:W(),audioDownloadURL:W(),audioRefFullPath:W()})),await Promise.all(B)}async function _e(){const d=re(),w=O(V(),_+d);await Promise.all([Oe(w,{}),C(t,{blackboards:Ve(d)})]),await Ce()}const he=d=>p(d),be=(d,w)=>$(w,d),ge=()=>u.setOpen(!0);function ke(d){We[d?"unshift":"push"](()=>{u=d,o(0,u)})}const we=(d,w)=>d(w.detail.newStroke),ve=(d,w)=>j(w.detail.audioBlob,d);return l.$$set=d=>{"classID"in d&&o(11,i=d.classID),"roomID"in d&&o(12,f=d.roomID)},l.$$.update=()=>{l.$$.dirty[0]&4096&&(t=O(V(),N+f)),l.$$.dirty[0]&4096&&k()},[u,c,a,r,s,_,p,$,j,me,_e,i,f,he,be,ge,ke,we,ve]}class Pt extends Ne{constructor(e){super();Ue(this,e,wt,kt,Le,{classID:11,roomID:12},null,[-1,-1])}}export{Pt as default,Bt as load};

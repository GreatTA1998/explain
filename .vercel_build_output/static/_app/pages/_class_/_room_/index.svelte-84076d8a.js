var nt=Object.defineProperty;var he=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,rt=Object.prototype.propertyIsEnumerable;var $e=(s,e,n)=>e in s?nt(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,ne=(s,e)=>{for(var n in e||(e={}))st.call(e,n)&&$e(s,n,e[n]);if(he)for(var n of he(e))rt.call(e,n)&&$e(s,n,e[n]);return s};import{S as ge,i as ke,s as be,H as at,I as lt,J as it,K as ut,x as g,u as b,al as we,P as S,am as ve,an as ft,aj as De,ak as Re,a7 as ct,R as Ie,O as M,aE as dt,ap as ye,e as Q,j as N,k as W,t as I,c as q,a as O,m as P,n as J,d as p,g as y,L as v,U as Ue,f as h,o as T,M as z,a3 as se,a0 as le,aC as mt,aD as pt,w as X,v as A,a4 as _t,l as B,E as re,X as ht,r as Y,$ as $t,aF as ie,aG as ue,aH as Le,aI as Se,_ as V,aJ as gt,aK as kt,aL as bt,ao as wt,aM as vt,aN as Dt,h as Z,aO as x,b as j,a8 as ee,aq as Ne,a1 as Rt,aP as It,N as oe}from"../../../chunks/vendor-4d76b2cf.js";import{R as yt,T as Ut,a as Lt,b as St,D as Nt,B as Pt}from"../../../chunks/RenderlessFetchStrokes-1efa94a8.js";import{g as Tt}from"../../../chunks/canvas-226d237d.js";import{g as fe,r as Pe,k as ae,u as At,c as Ct,a as Bt}from"../../../chunks/store-f14bdcfc.js";import"../../../chunks/preload-helper-ec9aa979.js";import"../../../chunks/singletons-12a22614.js";function Et(s,e){let n=document.getElementById(e);return n==null||n.appendChild(s),{destroy(){s.remove()}}}function Te(s,e){let n=new IntersectionObserver(o=>{for(const t of o)if(t.isIntersecting){e(),n.unobserve(s);return}},{root:null,threshold:.2,rootMargin:"0px"});n.observe(s)}const jt=s=>({strokesArray:s&1}),Ae=s=>({listenToStrokes:s[1],strokesArray:s[0],handleNewlyDrawnStroke:s[2],deleteAllStrokesFromDb:s[3]});function Qt(s){let e;const n=s[6].default,o=at(n,s,s[5],Ae);return{c(){o&&o.c()},l(t){o&&o.l(t)},m(t,r){o&&o.m(t,r),e=!0},p(t,[r]){o&&o.p&&(!e||r&33)&&lt(o,n,t,t[5],e?ut(n,t[5],r,jt):it(t[5]),Ae)},i(t){e||(g(o,t),e=!0)},o(t){b(o,t),e=!1},d(t){o&&o.d(t)}}}function Ce(s){const e=ne({id:s.id},s.data());return e.startTime=0,e.endTime=0,s.data().isErasing||(e.endTime+=.5),e}function qt(s,e,n){let{$$slots:o={},$$scope:t}=e,{dbPath:r}=e,a,i;const u=we(S(),`${r}/strokes`),l=ve(u,ft("timestamp"));De(()=>{i&&i()});async function f(){i=Re(l,async k=>{k.docChanges().filter(D=>D.type==="removed").length>0?(n(0,a=[]),await ct(),k.docs.length>0&&k.docs.forEach(D=>{a.push(Ce(D))})):(a||n(0,a=[]),k.docs.length===a.length||k.docChanges().filter(D=>D.type==="added").forEach(D=>{n(0,a=[...a,Ce(D.doc)])}))})}function m(k){a.push(k);try{Ie(M(S(),`${r}/strokes/${k.id}`),ne({timestamp:dt()},k))}catch(U){alert(U)}}async function w(){return new Promise(async k=>{const U=[];let D=ye(S()),C=0;for(const _ of a){C>=500&&(U.push(D.commit()),D=ye(S()),C=0);const d=M(S(),`${r}/strokes/${_.id}`);D.delete(d),C+=1}U.push(D.commit()),await Promise.all(U),n(0,a=[]),k()})}return s.$$set=k=>{"dbPath"in k&&n(4,r=k.dbPath),"$$scope"in k&&n(5,t=k.$$scope)},[a,f,m,w,r,t,o]}class Ft extends ge{constructor(e){super();ke(this,e,qt,Qt,be,{dbPath:4})}}function Be(s,e,n){const o=s.slice();return o[36]=e[n],o}function Ee(s){let e,n,o,t,r,a=[],i=new Map,u,l,f,m,w,k,U;n=new ht({props:{disabled:H(s[0].name)&&s[0].askerUID&&s[5].uid!==s[0].askerUID,value:s[0].name,class:"room-title",style:`width: ${s[6]}px;`,$$slots:{helper:[Ht]},$$scope:{ctx:s}}}),n.$on("input",s[19]);let D=s[0].blackboards;const C=_=>_[36];for(let _=0;_<D.length;_+=1){let d=Be(s,D,_),R=C(d);i.set(R,a[_]=Fe(R,d))}return{c(){e=Q("div"),N(n.$$.fragment),o=W(),t=Q("div"),r=W();for(let _=0;_<a.length;_+=1)a[_].c();u=W(),l=Q("div"),f=I("New blackboard"),this.h()},l(_){e=q(_,"DIV",{style:!0});var d=O(e);P(n.$$.fragment,d),o=J(d),t=q(d,"DIV",{style:!0}),O(t).forEach(p),r=J(d);for(let G=0;G<a.length;G+=1)a[G].l(d);u=J(d),l=q(d,"DIV",{style:!0});var R=O(l);f=y(R,"New blackboard"),R.forEach(p),d.forEach(p),this.h()},h(){v(t,"margin-bottom","20px"),v(l,"display","flex"),v(l,"justify-content","center"),v(l,"align-items","center"),v(l,"margin-top","40px"),v(l,"background-color","#2e3131"),v(l,"font-family","Roboto, sans-serif"),v(l,"text-transform","uppercase"),v(l,"height","35px"),v(e,"padding","16px"),Ue(e,"question",H(s[0].name))},m(_,d){h(_,e,d),T(n,e,null),z(e,o),z(e,t),z(e,r);for(let R=0;R<a.length;R+=1)a[R].m(e,null);z(e,u),z(e,l),z(l,f),w=!0,k||(U=[se(l,"click",s[16]),le(m=Et.call(null,e,"main-content"))],k=!0)},p(_,d){const R={};d[0]&33&&(R.disabled=H(_[0].name)&&_[0].askerUID&&_[5].uid!==_[0].askerUID),d[0]&1&&(R.value=_[0].name),d[0]&64&&(R.style=`width: ${_[6]}px;`),d[0]&31|d[1]&131072&&(R.$$scope={dirty:d,ctx:_}),n.$set(R),d[0]&61409|d[1]&122624&&(D=_[0].blackboards,Y(),a=mt(a,d,C,1,_,D,i,e,pt,Fe,u,Be),X()),d[0]&1&&Ue(e,"question",H(_[0].name))},i(_){if(!w){g(n.$$.fragment,_);for(let d=0;d<D.length;d+=1)g(a[d]);w=!0}},o(_){b(n.$$.fragment,_);for(let d=0;d<a.length;d+=1)b(a[d]);w=!1},d(_){_&&p(e),A(n);for(let d=0;d<a.length;d+=1)a[d].d();k=!1,_t(U)}}}function Mt(s){let e=s[0].askerName+"",n,o,t=ae(s[0].dateAsked)+"",r;return{c(){n=I(e),o=I(" asked on "),r=I(t)},l(a){n=y(a,e),o=y(a," asked on "),r=y(a,t)},m(a,i){h(a,n,i),h(a,o,i),h(a,r,i)},p(a,i){i[0]&1&&e!==(e=a[0].askerName+"")&&Z(n,e),i[0]&1&&t!==(t=ae(a[0].dateAsked)+"")&&Z(r,t)},d(a){a&&p(n),a&&p(o),a&&p(r)}}}function Ot(s){let e,n,o;return{c(){e=I("Resolving this question in "),n=I(s[4]),o=I(", cancel by re-adding ?")},l(t){e=y(t,"Resolving this question in "),n=y(t,s[4]),o=y(t,", cancel by re-adding ?")},m(t,r){h(t,e,r),h(t,n,r),h(t,o,r)},p(t,r){r[0]&16&&Z(n,t[4])},d(t){t&&p(e),t&&p(n),t&&p(o)}}}function zt(s){let e,n,o;return{c(){e=I("Pinging server members in "),n=I(s[2]),o=I(", cancel by backtracking the ?")},l(t){e=y(t,"Pinging server members in "),n=y(t,s[2]),o=y(t,", cancel by backtracking the ?")},m(t,r){h(t,e,r),h(t,n,r),h(t,o,r)},p(t,r){r[0]&4&&Z(n,t[2])},d(t){t&&p(e),t&&p(n),t&&p(o)}}}function je(s){let e,n=ae(s[0].dateResolved)+"",o;return{c(){e=I(", resolved "),o=I(n)},l(t){e=y(t,", resolved "),o=y(t,n)},m(t,r){h(t,e,r),h(t,o,r)},p(t,r){r[0]&1&&n!==(n=ae(t[0].dateResolved)+"")&&Z(o,n)},d(t){t&&p(e),t&&p(o)}}}function Vt(s){let e,n;function o(i,u){if(i[1])return zt;if(i[3])return Ot;if(i[0].askerName&&i[0].askerUID&&i[0].date)return Mt}let t=o(s),r=t&&t(s),a=s[0].dateResolved&&je(s);return{c(){r&&r.c(),e=W(),a&&a.c(),n=B()},l(i){r&&r.l(i),e=J(i),a&&a.l(i),n=B()},m(i,u){r&&r.m(i,u),h(i,e,u),a&&a.m(i,u),h(i,n,u)},p(i,u){t===(t=o(i))&&r?r.p(i,u):(r&&r.d(1),r=t&&t(i),r&&(r.c(),r.m(e.parentNode,e))),i[0].dateResolved?a?a.p(i,u):(a=je(i),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},d(i){r&&r.d(i),i&&p(e),a&&a.d(i),i&&p(n)}}}function Ht(s){let e,n;return e=new $t({props:{slot:"helper",persistent:!0,$$slots:{default:[Vt]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},l(o){P(e.$$.fragment,o)},m(o,t){T(e,o,t),n=!0},p(o,t){const r={};t[0]&31|t[1]&131072&&(r.$$scope={dirty:t,ctx:o}),e.$set(r)},i(o){n||(g(e.$$.fragment,o),n=!0)},o(o){b(e.$$.fragment,o),n=!1},d(o){A(e,o)}}}function Qe(s){let e,n,o,t,r,a;function i(...m){return s[20](s[36],...m)}e=new Ut({props:{value:s[39].description||""}}),e.$on("input",i);const u=[Jt,Wt],l=[];function f(m,w){return m[39].audioDownloadURL?0:1}return o=f(s),t=l[o]=u[o](s),{c(){N(e.$$.fragment),n=W(),t.c(),r=B()},l(m){P(e.$$.fragment,m),n=J(m),t.l(m),r=B()},m(m,w){T(e,m,w),h(m,n,w),l[o].m(m,w),h(m,r,w),a=!0},p(m,w){s=m;const k={};w[1]&256&&(k.value=s[39].description||""),e.$set(k);let U=o;o=f(s),o===U?l[o].p(s,w):(Y(),b(l[U],1,1,()=>{l[U]=null}),X(),t=l[o],t?t.p(s,w):(t=l[o]=u[o](s),t.c()),g(t,1),t.m(r.parentNode,r))},i(m){a||(g(e.$$.fragment,m),g(t),a=!0)},o(m){b(e.$$.fragment,m),b(t),a=!1},d(m){A(e,m),m&&p(n),l[o].d(m),m&&p(r)}}}function Wt(s){let e,n;return e=new Ft({props:{dbPath:s[9]+s[36],$$slots:{default:[oo,({listenToStrokes:o,strokesArray:t,handleNewlyDrawnStroke:r,deleteAllStrokesFromDb:a})=>({43:o,41:t,44:r,42:a}),({listenToStrokes:o,strokesArray:t,handleNewlyDrawnStroke:r,deleteAllStrokesFromDb:a})=>[0,(o?4096:0)|(t?1024:0)|(r?8192:0)|(a?2048:0)]]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},l(o){P(e.$$.fragment,o)},m(o,t){T(e,o,t),n=!0},p(o,t){const r={};t[0]&1&&(r.dbPath=o[9]+o[36]),t[0]&449|t[1]&138496&&(r.$$scope={dirty:t,ctx:o}),e.$set(r)},i(o){n||(g(e.$$.fragment,o),n=!0)},o(o){b(e.$$.fragment,o),n=!1},d(o){A(e,o)}}}function Jt(s){let e,n;return e=new Lt({props:{dbPath:s[9]+s[36],$$slots:{default:[ro,({fetchStrokes:o,strokesArray:t,deleteAllStrokesFromDb:r})=>({40:o,41:t,42:r}),({fetchStrokes:o,strokesArray:t,deleteAllStrokesFromDb:r})=>[0,(o?512:0)|(t?1024:0)|(r?2048:0)]]},$$scope:{ctx:s}}}),{c(){N(e.$$.fragment)},l(o){P(e.$$.fragment,o)},m(o,t){T(e,o,t),n=!0},p(o,t){const r={};t[0]&1&&(r.dbPath=o[9]+o[36]),t[0]&224|t[1]&132864&&(r.$$scope={dirty:t,ctx:o}),e.$set(r)},i(o){n||(g(e.$$.fragment,o),n=!0)},o(o){b(e.$$.fragment,o),n=!1},d(o){A(e,o)}}}function Kt(s){let e,n,o;return n=new It({props:{class:"my-four-colors",style:"height: 32px; width: 32px;",indeterminate:!0,fourColor:!0}}),{c(){e=Q("div"),N(n.$$.fragment),this.h()},l(t){e=q(t,"DIV",{style:!0});var r=O(e);P(n.$$.fragment,r),r.forEach(p),this.h()},h(){v(e,"display","flex"),v(e,"justify-content","center"),v(e,"margin-left","20px"),v(e,"margin-right","20px")},m(t,r){h(t,e,r),T(n,e,null),o=!0},p:oe,i(t){o||(g(n.$$.fragment,t),o=!0)},o(t){b(n.$$.fragment,t),o=!1},d(t){t&&p(e),A(n)}}}function Gt(s){let e,n,o,t;return{c(){e=Q("span"),n=I("stop_circle"),this.h()},l(r){e=q(r,"SPAN",{class:!0,style:!0});var a=O(e);n=y(a,"stop_circle"),a.forEach(p),this.h()},h(){j(e,"class","material-icons"),v(e,"font-size","2.5rem"),v(e,"color","cyan"),v(e,"margin-left","30px"),v(e,"margin-right","26px")},m(r,a){h(r,e,a),z(e,n),o||(t=se(e,"click",function(){ee(s[46])&&s[46].apply(this,arguments)}),o=!0)},p(r,a){s=r},i:oe,o:oe,d(r){r&&p(e),o=!1,t()}}}function Xt(s){let e,n,o,t;return{c(){e=Q("span"),n=I("radio_button_checked"),this.h()},l(r){e=q(r,"SPAN",{class:!0,style:!0});var a=O(e);n=y(a,"radio_button_checked"),a.forEach(p),this.h()},h(){j(e,"class","material-icons"),v(e,"font-size","2.5rem"),v(e,"color","cyan"),v(e,"margin-left","30px"),v(e,"margin-right","26px")},m(r,a){h(r,e,a),z(e,n),o||(t=se(e,"click",function(){ee(s[45])&&s[45].apply(this,arguments)}),o=!0)},p(r,a){s=r},i:oe,o:oe,d(r){r&&p(e),o=!1,t()}}}function Yt(s){let e,n,o,t;const r=[Xt,Gt,Kt],a=[];function i(u,l){return u[8]==="pre_record"?0:u[8]==="mid_record"?1:2}return e=i(s),n=a[e]=r[e](s),{c(){n.c(),o=B()},l(u){n.l(u),o=B()},m(u,l){a[e].m(u,l),h(u,o,l),t=!0},p(u,l){let f=e;e=i(u),e===f?a[e].p(u,l):(Y(),b(a[f],1,1,()=>{a[f]=null}),X(),n=a[e],n?n.p(u,l):(n=a[e]=r[e](u),n.c()),g(n,1),n.m(o.parentNode,o))},i(u){t||(g(n),t=!0)},o(u){b(n),t=!1},d(u){a[e].d(u),u&&p(o)}}}function Zt(s){let e;return{c(){e=I("Wipe board")},l(n){e=y(n,"Wipe board")},m(n,o){h(n,e,o)},d(n){n&&p(e)}}}function xt(s){let e=(s[39].backgroundImageDownloadURL?"Remove background":"Set background")+"",n,o,t,r,a,i;function u(...l){return s[22](s[39],...l)}return{c(){n=I(e),o=W(),t=Q("input"),this.h()},l(l){n=y(l,e),o=J(l),t=q(l,"INPUT",{id:!0,style:!0,type:!0,accept:!0}),this.h()},h(){j(t,"id",r="input-"+s[39].id),v(t,"display","none"),j(t,"type","file"),j(t,"accept","image/gif, image/jpeg, image/png")},m(l,f){h(l,n,f),h(l,o,f),h(l,t,f),a||(i=se(t,"change",u),a=!0)},p(l,f){s=l,f[1]&256&&e!==(e=(s[39].backgroundImageDownloadURL?"Remove background":"Set background")+"")&&Z(n,e),f[1]&256&&r!==(r="input-"+s[39].id)&&j(t,"id",r)},d(l){l&&p(n),l&&p(o),l&&p(t),a=!1,i()}}}function eo(s){let e,n,o,t,r;return n=new Ne({props:{slot:"dropdown-menu",$$slots:{default:[Zt]},$$scope:{ctx:s}}}),n.$on("SMUI:action",function(){ee(s[42])&&s[42].apply(this,arguments)}),t=new Ne({props:{$$slots:{default:[xt]},$$scope:{ctx:s}}}),t.$on("click",function(){ee(s[39].backgroundImageDownloadURL?s[11](s[39].id):Me(s[39].id))&&(s[39].backgroundImageDownloadURL?s[11](s[39].id):Me(s[39].id)).apply(this,arguments)}),{c(){e=Q("div"),N(n.$$.fragment),o=W(),N(t.$$.fragment),this.h()},l(a){e=q(a,"DIV",{slot:!0});var i=O(e);P(n.$$.fragment,i),o=J(i),P(t.$$.fragment,i),i.forEach(p),this.h()},h(){j(e,"slot","dropdown-menu")},m(a,i){h(a,e,i),T(n,e,null),z(e,o),T(t,e,null),r=!0},p(a,i){s=a;const u={};i[1]&131072&&(u.$$scope={dirty:i,ctx:s}),n.$set(u);const l={};i[1]&131328&&(l.$$scope={dirty:i,ctx:s}),t.$set(l)},i(a){r||(g(n.$$.fragment,a),g(t.$$.fragment,a),r=!0)},o(a){b(n.$$.fragment,a),b(t.$$.fragment,a),r=!1},d(a){a&&p(e),A(n),A(t)}}}function to(s){let e,n;function o(...t){return s[23](s[44],...t)}return e=new Pt({props:{strokesArray:s[41],currentTime:s[47],backgroundImageDownloadURL:s[39].backgroundImageDownloadURL,$$slots:{"dropdown-menu":[eo],default:[Yt]},$$scope:{ctx:s}}}),e.$on("stroke-drawn",o),{c(){N(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,r){T(e,t,r),n=!0},p(t,r){s=t;const a={};r[1]&1024&&(a.strokesArray=s[41]),r[1]&65536&&(a.currentTime=s[47]),r[1]&256&&(a.backgroundImageDownloadURL=s[39].backgroundImageDownloadURL),r[0]&256|r[1]&182528&&(a.$$scope={dirty:r,ctx:s}),e.$set(a)},i(t){n||(g(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){A(e,t)}}}function oo(s){let e,n,o,t,r,a,i;function u(...l){return s[24](s[36],...l)}return n=new St({props:{$$slots:{default:[to,({startRecording:l,stopRecording:f,currentTime:m})=>({45:l,46:f,47:m}),({startRecording:l,stopRecording:f,currentTime:m})=>[0,(l?16384:0)|(f?32768:0)|(m?65536:0)]]},$$scope:{ctx:s}}}),n.$on("record-end",u),{c(){e=Q("div"),N(n.$$.fragment),this.h()},l(l){e=q(l,"DIV",{style:!0});var f=O(e);P(n.$$.fragment,f),f.forEach(p),this.h()},h(){j(e,"style",o=`width: ${s[6]}px; height: ${s[7]}px; position: relative`)},m(l,f){h(l,e,f),T(n,e,null),r=!0,a||(i=le(t=Te.call(null,e,s[43])),a=!0)},p(l,f){s=l;const m={};f[0]&256|f[1]&249088&&(m.$$scope={dirty:f,ctx:s}),n.$set(m),(!r||f[0]&192&&o!==(o=`width: ${s[6]}px; height: ${s[7]}px; position: relative`))&&j(e,"style",o),t&&ee(t.update)&&f[1]&4096&&t.update.call(null,s[43])},i(l){r||(g(n.$$.fragment,l),r=!0)},o(l){b(n.$$.fragment,l),r=!1},d(l){l&&p(e),A(n),a=!1,i()}}}function qe(s){let e,n;function o(){return s[21](s[39],s[42])}return e=new Rt({props:{color:"primary",$$slots:{default:[no]},$$scope:{ctx:s}}}),e.$on("click",o),{c(){N(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,r){T(e,t,r),n=!0},p(t,r){s=t;const a={};r[1]&131072&&(a.$$scope={dirty:r,ctx:s}),e.$set(a)},i(t){n||(g(e.$$.fragment,t),n=!0)},o(t){b(e.$$.fragment,t),n=!1},d(t){A(e,t)}}}function no(s){let e;return{c(){e=I("Delete video")},l(n){e=y(n,"Delete video")},m(n,o){h(n,e,o)},d(n){n&&p(e)}}}function so(s){let e,n,o=s[5].uid===s[39].creatorUID&&qe(s);return{c(){o&&o.c(),e=B()},l(t){o&&o.l(t),e=B()},m(t,r){o&&o.m(t,r),h(t,e,r),n=!0},p(t,r){t[5].uid===t[39].creatorUID?o?(o.p(t,r),r[0]&32|r[1]&256&&g(o,1)):(o=qe(t),o.c(),g(o,1),o.m(e.parentNode,e)):o&&(Y(),b(o,1,1,()=>{o=null}),X())},i(t){n||(g(o),n=!0)},o(t){b(o),n=!1},d(t){o&&o.d(t),t&&p(e)}}}function ro(s){let e,n,o,t,r,a,i;return n=new Nt({props:{strokesArray:s[41],audioDownloadURL:s[39].audioDownloadURL,backgroundImageDownloadURL:s[39].backgroundImageDownloadURL,$$slots:{default:[so]},$$scope:{ctx:s}}}),{c(){e=Q("div"),N(n.$$.fragment),this.h()},l(u){e=q(u,"DIV",{style:!0});var l=O(e);P(n.$$.fragment,l),l.forEach(p),this.h()},h(){j(e,"style",o=`width: ${s[6]}px; height: ${s[7]+40}px; position: relative`)},m(u,l){h(u,e,l),T(n,e,null),r=!0,a||(i=le(t=Te.call(null,e,s[40])),a=!0)},p(u,l){const f={};l[1]&1024&&(f.strokesArray=u[41]),l[1]&256&&(f.audioDownloadURL=u[39].audioDownloadURL),l[1]&256&&(f.backgroundImageDownloadURL=u[39].backgroundImageDownloadURL),l[0]&32|l[1]&131328&&(f.$$scope={dirty:l,ctx:u}),n.$set(f),(!r||l[0]&192&&o!==(o=`width: ${u[6]}px; height: ${u[7]+40}px; position: relative`))&&j(e,"style",o),t&&ee(t.update)&&l[1]&512&&t.update.call(null,u[40])},i(u){r||(g(n.$$.fragment,u),r=!0)},o(u){b(n.$$.fragment,u),r=!1},d(u){u&&p(e),A(n),a=!1,i()}}}function ao(s){let e,n,o=s[39]&&Qe(s);return{c(){o&&o.c(),e=W()},l(t){o&&o.l(t),e=J(t)},m(t,r){o&&o.m(t,r),h(t,e,r),n=!0},p(t,r){t[39]?o?(o.p(t,r),r[1]&256&&g(o,1)):(o=Qe(t),o.c(),g(o,1),o.m(e.parentNode,e)):o&&(Y(),b(o,1,1,()=>{o=null}),X())},i(t){n||(g(o),n=!0)},o(t){b(o),n=!1},d(t){o&&o.d(t),t&&p(e)}}}function Fe(s,e){let n,o,t;return o=new yt({props:{dbPath:e[9]+e[36],$$slots:{default:[ao,({boardDoc:r})=>({39:r}),({boardDoc:r})=>[0,r?256:0]]},$$scope:{ctx:e}}}),{key:s,first:null,c(){n=B(),N(o.$$.fragment),this.h()},l(r){n=B(),P(o.$$.fragment,r),this.h()},h(){this.first=n},m(r,a){h(r,n,a),T(o,r,a),t=!0},p(r,a){e=r;const i={};a[0]&1&&(i.dbPath=e[9]+e[36]),a[0]&481|a[1]&131328&&(i.$$scope={dirty:a,ctx:e}),o.$set(i)},i(r){t||(g(o.$$.fragment,r),t=!0)},o(r){b(o.$$.fragment,r),t=!1},d(r){r&&p(n),A(o,r)}}}function lo(s){let e,n,o=s[0]&&Ee(s);return{c(){o&&o.c(),e=B()},l(t){o&&o.l(t),e=B()},m(t,r){o&&o.m(t,r),h(t,e,r),n=!0},p(t,r){t[0]?o?(o.p(t,r),r[0]&1&&g(o,1)):(o=Ee(t),o.c(),g(o,1),o.m(e.parentNode,e)):o&&(Y(),b(o,1,1,()=>{o=null}),X())},i(t){n||(g(o),n=!0)},o(t){b(o),n=!1},d(t){o&&o.d(t),t&&p(e)}}}async function $o({page:s}){return{props:{classID:s.params.class,roomID:s.params.room}}}function Me(s){document.getElementById(`input-${s}`).click()}function H(s){return s.charAt(s.length-1)==="?"}function ce(s){return s.askerName&&s.dateAsked&&s.askerUID}function io(s,e,n){let o,t,r,a,i;re(s,At,c=>n(5,t=c)),re(s,Ct,c=>n(6,r=c)),re(s,Bt,c=>n(7,a=c)),re(s,Pe,c=>n(8,i=c));let{classID:u}=e,{roomID:l}=e,f,m;const w=`classes/${u}/blackboards/`,k=`classes/${u}/rooms/`;t.uid||Tt("/");async function U(c,$){const E=M(S(),w+$),L=c.target.files[0];if(!!L)if(L.type.split("/")[0]==="image"){const K=ie(),F=ue(K,`images/${fe()}`);await Le(F,L);const te=await Se(F);V(E,{backgroundImageDownloadURL:te})}else alert("Error: only images can be used")}function D(c){const $=M(S(),w+c);V($,{backgroundImageDownloadURL:x()})}let C="",_=5,d,R=5;async function G({srcElement:c}){const{value:$}=c,E={name:$};!H(m.name)&&H($)&&!ce(m)?Oe():C&&!H($)?de():!H($)&&ce(m)?ze():d&&H($)&&ce(m)&&He(),await V(o,E)}function Oe(){n(2,_=5),n(1,C=setInterval(()=>{n(2,_-=1),_===0&&(We(),Je(),de())},1e3))}function ze(){n(4,R=5),n(3,d=setInterval(()=>{n(4,R-=1),R===0&&Ve()},1e3))}function Ve(){V(o,{dateResolved:new Date().toISOString()})}function He(){clearTimeout(d),n(3,d="")}function de(){clearTimeout(C),n(1,C="")}function We(){V(o,{askerName:t.name||"Beaver #999",askerUID:t.uid,dateAsked:new Date().toISOString()})}async function Je(){const c=[],$=gt(),E=kt($,"sendTextMessage"),L=we(S(),"users"),K=ve(L,bt("willReceiveText","==",!0)),F=await wt(K);if(F.docs)for(const te of F.docs){console.log("phoneNumber =",te.data().phoneNumber);try{te.id!==t.uid&&c.push(E({content:`${t.name} asked on https://ihtfp.app: "${m.name||"Fake question here"}"`,toWho:te.data().phoneNumber}))}catch(ot){alert(ot)}}await Promise.all(c),console.log("success, sent all texts.")}async function me({detail:c},$){const E=M(S(),w+$);await V(E,{description:c})}async function Ke(){f&&f(),f=Re(o,c=>{n(0,m=ne({id:c.id},c.data()))})}De(()=>{f()});async function pe(c,$){const E=ie(),L=ue(E,`audio/${fe()}`);await Le(L,c);const K=await Se(L),F=M(S(),w+$);await V(F,{creatorUID:t.uid,creatorPhoneNumber:t.phoneNumber,date:new Date().toISOString(),audioDownloadURL:K,audioRefFullPath:L.fullPath}),Pe.set("pre_record")}async function _e({id:c,audioRefFullPath:$},E){const L=[],K=M(S(),w+c);if($){const F=ue(ie(),$);L.push(vt(F))}L.push(V(K,{creator:x(),creatorPhoneNumber:x(),date:x(),audioDownloadURL:x(),audioRefFullPath:x()})),L.push(E()),await Promise.all(L)}async function Ge(){const c=fe(),$=M(S(),w+c);await Promise.all([Ie($,{}),V(o,{blackboards:Dt(c)})])}const Xe=c=>G(c),Ye=(c,$)=>me($,c),Ze=(c,$)=>_e(c,$),xe=(c,$)=>U($,c.id),et=(c,$)=>c($.detail.newStroke),tt=(c,$)=>pe($.detail.audioBlob,c);return s.$$set=c=>{"classID"in c&&n(17,u=c.classID),"roomID"in c&&n(18,l=c.roomID)},s.$$.update=()=>{s.$$.dirty[0]&262144&&(o=M(S(),k+l)),s.$$.dirty[0]&262144&&Ke()},[m,C,_,d,R,t,r,a,i,w,U,D,G,me,pe,_e,Ge,u,l,Xe,Ye,Ze,xe,et,tt]}class go extends ge{constructor(e){super();ke(this,e,io,lo,be,{classID:17,roomID:18},null,[-1,-1])}}export{go as default,$o as load};

var nn=Object.defineProperty;var gt=Object.getOwnPropertySymbols;var on=Object.prototype.hasOwnProperty,rn=Object.prototype.propertyIsEnumerable;var bt=(n,e,t)=>e in n?nn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Re=(n,e)=>{for(var t in e||(e={}))on.call(e,t)&&bt(n,t,e[t]);if(gt)for(var t of gt(e))rn.call(e,t)&&bt(n,t,e[t]);return n};import{S as de,i as me,s as pe,aI as ln,k as Q,e as E,n as H,c as N,W as kt,b as D,M as b,aH as ae,f as y,a4 as J,aL as _e,t as C,a as A,aM as ge,d as _,g as L,N as U,ak as sn,a5 as it,I as be,j,m as F,o as W,aJ as an,aK as un,h as ie,J as ke,K as we,L as $e,x as R,u as T,v as q,F as G,r as ue,w as ce,a6 as ut,A as wt,Z as ze,O as re,ae as cn,a2 as Te,ai as fn,al as Oe,aN as Se,aO as dn,aE as Pe,a9 as je,Q as z,aa as ct,ab as $t,a7 as ft,aP as mn,T as vt,P as Y,aQ as pn,a8 as yt,aR as hn,_ as X,V as Dt,aF as _n,l as ee,aS as gn,aG as bn,aT as kn,aA as dt,az as mt,aU as It,aV as Rt,aW as ve,aB as wn,aC as $n,aX as vn,ac as yn,ay as Dn,aj as Tt,aY as St,ar as In,X as Pt,aZ as Rn}from"../../../chunks/vendor-3cd1c581.js";import{R as Tn,a as Sn,D as Pn}from"../../../chunks/RenderlessFetchStrokes-ac6e0826.js";import{_ as Un}from"../../../chunks/preload-helper-ec9aa979.js";import{f as Ue,o as pt,u as ht,a as Ut,c as Ct,g as Fe,e as Cn,d as Ln,j as We,b as An,w as Lt}from"../../../chunks/store-d69d6870.js";/* empty css                                                                */import{d as qe,r as En,a as Nn}from"../../../chunks/canvas-fe9cb9fb.js";import{g as Vn}from"../../../chunks/navigation-51f4a605.js";import"../../../chunks/singletons-12a22614.js";const Mn=n=>({}),At=n=>({});function Et(n,e,t){const o=n.slice();return o[10]=e[t],o}function Nt(n){let e,t,o,r,l,s,i,f,u=n[3].pencilColors,c=[];for(let a=0;a<u.length;a+=1)c[a]=Vt(Et(n,u,a));return{c(){for(let a=0;a<c.length;a+=1)c[a].c();e=Q(),t=E("img"),r=Q(),l=E("img"),this.h()},l(a){for(let h=0;h<c.length;h+=1)c[h].l(a);e=H(a),t=N(a,"IMG",{src:!0,width:!0,height:!0,style:!0,alt:!0}),r=H(a),l=N(a,"IMG",{width:!0,height:!0,style:!0,src:!0,alt:!0,class:!0}),this.h()},h(){kt(t.src,o="https://i.imgur.com/qshS7Vi.png")||D(t,"src",o),D(t,"width","30"),D(t,"height","30"),b(t,"margin-left","8px"),D(t,"alt","Random color dice"),D(l,"width","46"),D(l,"height","40"),b(l,"margin-left","15px"),b(l,"margin-right","8px"),kt(l.src,s="https://i.imgur.com/Klln1yP.png")||D(l,"src",s),D(l,"alt","eraser"),D(l,"class","svelte-1bgxyxs"),ae(l,"eraser-selected",n[1].type==="eraser")},m(a,h){for(let p=0;p<c.length;p+=1)c[p].m(a,h);y(a,e,h),y(a,t,h),y(a,r,h),y(a,l,h),i||(f=[J(t,"click",n[5]),J(l,"click",n[9])],i=!0)},p(a,h){if(h&11){u=a[3].pencilColors;let p;for(p=0;p<u.length;p+=1){const m=Et(a,u,p);c[p]?c[p].p(m,h):(c[p]=Vt(m),c[p].c(),c[p].m(e.parentNode,e))}for(;p<c.length;p+=1)c[p].d(1);c.length=u.length}h&2&&ae(l,"eraser-selected",a[1].type==="eraser")},d(a){sn(c,a),a&&_(e),a&&_(t),a&&_(r),a&&_(l),i=!1,it(f)}}}function Vt(n){let e,t,o,r,l,s,i,f,u,c,a,h;function p(){return n[8](n[10])}return{c(){e=E("div"),t=_e("svg"),o=_e("g"),r=_e("path"),l=C(`;\r
            `),s=_e("polygon"),f=_e("path"),u=_e("path"),this.h()},l(m){e=N(m,"DIV",{style:!0,class:!0});var d=A(e);t=ge(d,"svg",{preserveAspectRatio:!0,version:!0,id:!0,xmlns:!0,"xmlns:xlink":!0,x:!0,y:!0,width:!0,height:!0,viewBox:!0,style:!0,"xml:space":!0,class:!0});var w=A(t);o=ge(w,"g",{});var v=A(o);r=ge(v,"path",{d:!0}),A(r).forEach(_),l=L(v,`;\r
            `),s=ge(v,"polygon",{style:!0,points:!0}),A(s).forEach(_),f=ge(v,"path",{style:!0,d:!0}),A(f).forEach(_),u=ge(v,"path",{style:!0,d:!0}),A(u).forEach(_),v.forEach(_),w.forEach(_),d.forEach(_),this.h()},h(){D(r,"d",`M0,0v72.377c0,1.588,0.234,3.169,0.698,4.706l45.416,150.032C46.633,228.828,48.212,230,50,230s3.367-1.172,3.886-2.883\r
              L99.31,77.079c0.457-1.525,0.69-3.108,0.69-4.702V0.002`),D(s,"style",i=`fill: ${n[10]};`),D(s,"points","50,211.978 38.879,175.24 61.122,175.24"),b(f,"fill","#424242"),D(f,"d",`M63.581,167.118H36.42L8.765,75.761l10.924-9.63l12.5,11.015c1.54,1.353,3.835,1.35,5.375-0.002\r
                l12.468-11.007l12.464,11.005c1.54,1.357,3.839,1.357,5.377,0l12.465-11.005l10.9,9.623L63.581,167.118z`),D(u,"style",c=`fill: ${n[10]};`),D(u,"d",`M91.878,0v65.486l-8.852-7.813c-1.539-1.353-3.838-1.354-5.377,0.002L65.185,68.679L52.72,57.674\r
                c-1.539-1.356-3.838-1.354-5.377-0.002L34.871,68.683L22.375,57.67c-0.769-0.676-1.725-1.013-2.685-1.013\r
                c-0.959,0-1.919,0.339-2.685,1.013L8.121,65.5L8.098,0.024L91.878,0z`),D(t,"preserveAspectRatio","none"),D(t,"version","1.1"),D(t,"id","Layer_1"),D(t,"xmlns","http://www.w3.org/2000/svg"),D(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),D(t,"x","0px"),D(t,"y","0px"),D(t,"width","16px"),D(t,"height","30px"),D(t,"viewBox","0 0 100 230"),b(t,"enable-background","new 0 0 100 230"),D(t,"xml:space","preserve"),D(t,"class","svelte-1bgxyxs"),b(e,"margin","0 4px"),b(e,"width","30px"),b(e,"height","42px"),b(e,"border-radius","3px"),b(e,"align-items","center"),b(e,"display","flex"),b(e,"justify-content","center"),D(e,"class","svelte-1bgxyxs"),ae(e,"pencil-selected",n[1].color===n[10]&&n[1].color!==n[0])},m(m,d){y(m,e,d),U(e,t),U(t,o),U(o,r),U(o,l),U(o,s),U(o,f),U(o,u),a||(h=J(e,"click",p),a=!0)},p(m,d){n=m,d&8&&i!==(i=`fill: ${n[10]};`)&&D(s,"style",i),d&8&&c!==(c=`fill: ${n[10]};`)&&D(u,"style",c),d&11&&ae(e,"pencil-selected",n[1].color===n[10]&&n[1].color!==n[0])},d(m){m&&_(e),a=!1,h()}}}function Bn(n){let e,t,o,r,l,s=(n[2]?"No touch":"Touch draw")+"",i,f,u=Object.keys(n[3]).length>0,c,a,h,p,m;o=new ln({props:{icons:!1,checked:!n[2],style:"margin: 0 !important"}});let d=u&&Nt(n);const w=n[7].default,v=be(w,n,n[6],null),V=n[7]["dropdown-menu"],S=be(V,n,n[6],At);return{c(){e=E("div"),t=E("div"),j(o.$$.fragment),r=Q(),l=E("div"),i=C(s),f=Q(),d&&d.c(),c=Q(),v&&v.c(),a=Q(),S&&S.c(),this.h()},l(I){e=N(I,"DIV",{style:!0});var P=A(e);t=N(P,"DIV",{style:!0});var O=A(t);F(o.$$.fragment,O),r=H(O),l=N(O,"DIV",{style:!0});var Z=A(l);i=L(Z,s),Z.forEach(_),O.forEach(_),f=H(P),d&&d.l(P),c=H(P),v&&v.l(P),a=H(P),S&&S.l(P),P.forEach(_),this.h()},h(){b(l,"margin-top","1px"),b(l,"margin-left","1px"),b(l,"font-size","0.52rem"),b(l,"font-family","Roboto,sans-serif"),b(l,"color","white"),b(t,"margin-right","10px"),b(t,"text-align","center"),b(e,"position","absolute"),b(e,"display","flex"),b(e,"align-items","center"),b(e,"height","50px"),b(e,"left","0"),b(e,"right","auto"),b(e,"top","0"),b(e,"bottom","auto"),b(e,"z-index","2"),b(e,"background-color","grey"),b(e,"padding-left","10px"),b(e,"border-radius","2px")},m(I,P){y(I,e,P),U(e,t),W(o,t,null),U(t,r),U(t,l),U(l,i),U(e,f),d&&d.m(e,null),U(e,c),v&&v.m(e,null),U(e,a),S&&S.m(e,null),h=!0,p||(m=J(t,"click",an(un(n[4]))),p=!0)},p(I,[P]){const O={};P&4&&(O.checked=!I[2]),o.$set(O),(!h||P&4)&&s!==(s=(I[2]?"No touch":"Touch draw")+"")&&ie(i,s),P&8&&(u=Object.keys(I[3]).length>0),u?d?d.p(I,P):(d=Nt(I),d.c(),d.m(e,c)):d&&(d.d(1),d=null),v&&v.p&&(!h||P&64)&&ke(v,w,I,I[6],h?$e(w,I[6],P,null):we(I[6]),null),S&&S.p&&(!h||P&64)&&ke(S,V,I,I[6],h?$e(V,I[6],P,Mn):we(I[6]),At)},i(I){h||(R(o.$$.fragment,I),R(v,I),R(S,I),h=!0)},o(I){T(o.$$.fragment,I),T(v,I),T(S,I),h=!1},d(I){I&&_(e),q(o),d&&d.d(),v&&v.d(I),S&&S.d(I),p=!1,m()}}}function zn(){return"hsla("+~~(360*Math.random())+",100%,60%,1)"}function On(n,e,t){let o,r,l;G(n,Ue,p=>t(1,o=p)),G(n,pt,p=>t(2,r=p)),G(n,ht,p=>t(3,l=p));let{$$slots:s={},$$scope:i}=e,f="";function u(){pt.set(!r)}function c(p,m){(!f||o.color===f)&&t(0,f=zn()),Ue.set({type:"pencil",color:f,lineWidth:3})}const a=p=>Ue.set({type:"pencil",color:p,lineWidth:3}),h=()=>Ue.set({type:"eraser",color:"",lineWidth:32});return n.$$set=p=>{"$$scope"in p&&t(6,i=p.$$scope)},[f,o,r,l,u,c,i,s,a,h]}class jn extends de{constructor(e){super();me(this,e,On,Bn,pe,{})}}function Mt(n){let e,t;return e=new jn({props:{$$slots:{"dropdown-menu":[Jn],default:[Fn]},$$scope:{ctx:n}}}),{c(){j(e.$$.fragment)},l(o){F(e.$$.fragment,o)},m(o,r){W(e,o,r),t=!0},p(o,r){const l={};r[0]&536871694&&(l.$$scope={dirty:r,ctx:o}),e.$set(l)},i(o){t||(R(e.$$.fragment,o),t=!0)},o(o){T(e.$$.fragment,o),t=!1},d(o){q(e,o)}}}function Fn(n){let e;const t=n[22].default,o=be(t,n,n[29],null);return{c(){o&&o.c()},l(r){o&&o.l(r)},m(r,l){o&&o.m(r,l),e=!0},p(r,l){o&&o.p&&(!e||l[0]&536870912)&&ke(o,t,r,r[29],e?$e(t,r[29],l,null):we(r[29]),null)},i(r){e||(R(o,r),e=!0)},o(r){T(o,r),e=!1},d(r){o&&o.d(r)}}}function Bt(n){let e,t,o,r;return{c(){e=E("span"),t=C("more_vert"),this.h()},l(l){e=N(l,"SPAN",{class:!0,style:!0});var s=A(e);t=L(s,"more_vert"),s.forEach(_),this.h()},h(){D(e,"class","material-icons"),b(e,"margin-right","10px"),b(e,"color","white"),b(e,"font-size","2rem")},m(l,s){y(l,e,s),U(e,t),o||(r=J(e,"click",n[23]),o=!0)},p:re,d(l){l&&_(e),o=!1,r()}}}function Wn(n){let e,t;return e=new Oe({props:{$$slots:{default:[Qn]},$$scope:{ctx:n}}}),e.$on("click",n[10]),{c(){j(e.$$.fragment)},l(o){F(e.$$.fragment,o)},m(o,r){W(e,o,r),t=!0},p(o,r){const l={};r[0]&536870912&&(l.$$scope={dirty:r,ctx:o}),e.$set(l)},i(o){t||(R(e.$$.fragment,o),t=!0)},o(o){T(e.$$.fragment,o),t=!1},d(o){q(e,o)}}}function qn(n){let e,t;return e=new Oe({props:{$$slots:{default:[Hn]},$$scope:{ctx:n}}}),e.$on("click",n[12]),{c(){j(e.$$.fragment)},l(o){F(e.$$.fragment,o)},m(o,r){W(e,o,r),t=!0},p(o,r){const l={};r[0]&536870912&&(l.$$scope={dirty:r,ctx:o}),e.$set(l)},i(o){t||(R(e.$$.fragment,o),t=!0)},o(o){T(e.$$.fragment,o),t=!1},d(o){q(e,o)}}}function Qn(n){let e;return{c(){e=C("Set background")},l(t){e=L(t,"Set background")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Hn(n){let e;return{c(){e=C("Remove background")},l(t){e=L(t,"Remove background")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Xn(n){let e;return{c(){e=C("Wipe board")},l(t){e=L(t,"Wipe board")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Yn(n){let e;return{c(){e=C("Delete board")},l(t){e=L(t,"Delete board")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Gn(n){let e,t,o,r,l,s,i;const f=[qn,Wn],u=[];function c(a,h){return a[2]?0:1}return e=c(n),t=u[e]=f[e](n),r=new Oe({props:{$$slots:{default:[Xn]},$$scope:{ctx:n}}}),r.$on("SMUI:action",n[13]),s=new Oe({props:{$$slots:{default:[Yn]},$$scope:{ctx:n}}}),s.$on("SMUI:action",n[14]),{c(){t.c(),o=Q(),j(r.$$.fragment),l=Q(),j(s.$$.fragment)},l(a){t.l(a),o=H(a),F(r.$$.fragment,a),l=H(a),F(s.$$.fragment,a)},m(a,h){u[e].m(a,h),y(a,o,h),W(r,a,h),y(a,l,h),W(s,a,h),i=!0},p(a,h){let p=e;e=c(a),e===p?u[e].p(a,h):(ue(),T(u[p],1,1,()=>{u[p]=null}),ce(),t=u[e],t?t.p(a,h):(t=u[e]=f[e](a),t.c()),R(t,1),t.m(o.parentNode,o));const m={};h[0]&536870912&&(m.$$scope={dirty:h,ctx:a}),r.$set(m);const d={};h[0]&536870912&&(d.$$scope={dirty:h,ctx:a}),s.$set(d)},i(a){i||(R(t),R(r.$$.fragment,a),R(s.$$.fragment,a),i=!0)},o(a){T(t),T(r.$$.fragment,a),T(s.$$.fragment,a),i=!1},d(a){u[e].d(a),a&&_(o),q(r,a),a&&_(l),q(s,a)}}}function Kn(n){let e,t;return e=new fn({props:{$$slots:{default:[Gn]},$$scope:{ctx:n}}}),{c(){j(e.$$.fragment)},l(o){F(e.$$.fragment,o)},m(o,r){W(e,o,r),t=!0},p(o,r){const l={};r[0]&536870916&&(l.$$scope={dirty:r,ctx:o}),e.$set(l)},i(o){t||(R(e.$$.fragment,o),t=!0)},o(o){T(e.$$.fragment,o),t=!1},d(o){q(e,o)}}}function Jn(n){let e,t,o,r,l,s,i,f,u=(n[3]==="pre_record"||n[1]===0)&&Bt(n),c={style:"width: 300px",$$slots:{default:[Kn]},$$scope:{ctx:n}};return l=new cn({props:c}),n[26](l),{c(){e=E("div"),u&&u.c(),t=Q(),o=E("input"),r=Q(),j(l.$$.fragment),this.h()},l(a){e=N(a,"DIV",{slot:!0});var h=A(e);u&&u.l(h),t=H(h),o=N(h,"INPUT",{style:!0,type:!0,accept:!0}),r=H(h),F(l.$$.fragment,h),h.forEach(_),this.h()},h(){b(o,"display","none"),D(o,"type","file"),D(o,"accept","image/gif, image/jpeg, image/png"),D(e,"slot","dropdown-menu")},m(a,h){y(a,e,h),u&&u.m(e,null),U(e,t),U(e,o),n[24](o),U(e,r),W(l,e,null),s=!0,i||(f=J(o,"change",n[25]),i=!0)},p(a,h){a[3]==="pre_record"||a[1]===0?u?u.p(a,h):(u=Bt(a),u.c(),u.m(e,t)):u&&(u.d(1),u=null);const p={};h[0]&536870916&&(p.$$scope={dirty:h,ctx:a}),l.$set(p)},i(a){s||(R(l.$$.fragment,a),s=!0)},o(a){T(l.$$.fragment,a),s=!1},d(a){a&&_(e),u&&u.d(),n[24](null),n[26](null),q(l),i=!1,f()}}}function Zn(n){let e,t,o,r,l,s,i,f,u,c=n[0]&&Mt(n);return{c(){c&&c.c(),e=Q(),t=E("canvas"),r=Q(),l=E("canvas"),this.h()},l(a){c&&c.l(a),e=H(a),t=N(a,"CANVAS",{style:!0});var h=A(t);h.forEach(_),r=H(a),l=N(a,"CANVAS",{style:!0});var p=A(l);p.forEach(_),this.h()},h(){D(t,"style",o=`position: absolute; z-index: 1; margin-top: 0; margin-left: 0; width: ${n[7]}px; height: ${n[6]}px`),D(l,"style",s=`position: absolute;
  top: 0;
  left: 0;
  z-index: 0;
  display: block;
  background-color: rgb(46, 49, 49); width: ${n[7]}px; height: ${n[6]}px`)},m(a,h){c&&c.m(a,h),y(a,e,h),y(a,t,h),n[27](t),y(a,r,h),y(a,l,h),n[28](l),i=!0,f||(u=[J(t,"touchstart",n[15]),J(t,"touchmove",n[16]),J(t,"touchend",n[17])],f=!0)},p(a,h){a[0]?c?(c.p(a,h),h[0]&1&&R(c,1)):(c=Mt(a),c.c(),R(c,1),c.m(e.parentNode,e)):c&&(ue(),T(c,1,1,()=>{c=null}),ce()),(!i||h[0]&192&&o!==(o=`position: absolute; z-index: 1; margin-top: 0; margin-left: 0; width: ${a[7]}px; height: ${a[6]}px`))&&D(t,"style",o),(!i||h[0]&192&&s!==(s=`position: absolute;
  top: 0;
  left: 0;
  z-index: 0;
  display: block;
  background-color: rgb(46, 49, 49); width: ${a[7]}px; height: ${a[6]}px`))&&D(l,"style",s)},i(a){i||(R(c),i=!0)},o(a){T(c),i=!1},d(a){c&&c.d(a),a&&_(e),a&&_(t),n[27](null),a&&_(r),a&&_(l),n[28](null),f=!1,it(u)}}}function xn(n){return(n.endTime-n.startTime)/n.points.length}function eo(n,e,t){let o,r,l,s;G(n,Ut,k=>t(6,o=k)),G(n,Ct,k=>t(7,r=k)),G(n,Ue,k=>t(33,l=k)),G(n,pt,k=>t(34,s=k));let{$$slots:i={},$$scope:f}=e,{strokesArray:u}=e,{currentTime:c=0}=e,{backgroundImageDownloadURL:a=""}=e,{recordState:h=""}=e;const p=ut();let m,d,w,v,V=[],S=!1,I={x:-1,y:-1},P={points:[]},O,Z,fe;wt(()=>{t(18,m=w.getContext("2d")),t(19,d=v.getContext("2d")),window.addEventListener("popstate",Le),window.onbeforeunload=function(k){h==="mid_record"&&(k.returnValue="")}}),ze(()=>{window.removeEventListener("popstate",Le)});function Le(){h==="mid_record"&&(confirm("This will interrupt your current recording, are you sure?")||history.pushState(null,document.title,location.href))}function Qe(){fe.click()}function Ae(k){p("background-upload",{imageFile:k.target.files[0]})}function He(){p("background-reset")}function Ee(){p("board-wipe")}function Xe(){p("board-delete")}function Ye(k){if(k.touches.length>1)return;const M=k.touches[0].touchType==="stylus";if(s&&!M){console.log("error: cannot use finger during Apple Pencil mode");return}Ve(k,{isInitialContact:!0})}function ye(k){if(!S)return;if(k.touches.length>1){console.log("touchmove ignored: only 1 finger allowed");return}const M=k.touches[0].touchType==="stylus";if(s&&!M){console.log("error: cannot use finger during Apple Pencil mode");return}Ve(k,{isInitialContact:!1})}function Ge(k){if(!S||k.touches.length>0)return;const M=k.changedTouches[0].touchType==="stylus";if(s&&!M){console.log("error: cannot use finger during Apple Pencil mode");return}Be(P),S=!1}function Ne(k){S=!0,I={x:-1,y:-1},P={strokeNumber:u.length+1,startTime:c,color:l.color,lineWidth:l.lineWidth,canvasWidth:r,isErasing:l.type==="eraser",points:[],sessionID:"123"}}function Ve(k,{isInitialContact:M}){k.preventDefault(),M&&Ne();const K=Ke(k);Me(k,K)}function Me(k,M){P.points.push({unitX:parseFloat(M.x/w.width).toFixed(4),unitY:parseFloat(M.y/w.height).toFixed(4)}),I.x!==-1&&I.y!==-1&&Nn([De(I),De(M)],1,l.type==="eraser",m,l.color,l.lineWidth,w),I=M}function Be(k){k.endTime=c,k.id=Fe(),V.push(k),p("stroke-drawn",{newStroke:k})}function Ke(k){const{left:M,top:K}=w.getBoundingClientRect();return{x:k.touches[0].pageX-M-window.scrollX,y:k.touches[0].pageY-K-window.scrollY}}function De({x:k,y:M}){return{unitX:k/w.width,unitY:M/w.height}}function Je(){m.clearRect(0,0,r,o)}const Ze=()=>Z.setOpen(!0);function xe(k){Te[k?"unshift":"push"](()=>{fe=k,t(9,fe)})}const et=k=>Ae(k);function tt(k){Te[k?"unshift":"push"](()=>{Z=k,t(8,Z)})}function nt(k){Te[k?"unshift":"push"](()=>{w=k,t(4,w),t(18,m),t(7,r),t(6,o),t(0,u)})}function ot(k){Te[k?"unshift":"push"](()=>{v=k,t(5,v),t(18,m),t(7,r),t(6,o),t(0,u),t(4,w)})}return n.$$set=k=>{"strokesArray"in k&&t(0,u=k.strokesArray),"currentTime"in k&&t(1,c=k.currentTime),"backgroundImageDownloadURL"in k&&t(2,a=k.backgroundImageDownloadURL),"recordState"in k&&t(3,h=k.recordState),"$$scope"in k&&t(29,f=k.$$scope)},n.$$.update=()=>{if(n.$$.dirty[0]&262353&&m&&(t(4,w.width=r,w),t(4,w.height=o,w),t(5,v.width=r,v),t(5,v.height=o,v),u))for(const k of u)qe(k,null,m,w);if(n.$$.dirty[0]&524340&&d&&(d.clearRect(0,0,v.scrollWidth,v.scrollHeight),En(a,w,d)),n.$$.dirty[0]&3407889&&m&&u){let k=V.length,M=u.length;if(k!==M)if(k<M)if(k===0){for(const K of u)qe(K,null,m,w);t(20,V=[...u])}else for(let K=k;K<M;K++){const se=u[K];qe(se,se.startTime!==se.endTime?xn(se):null,m,w),V.push(se)}else{let K=function(){Je(),t(20,V=[]),I={x:-1,y:-1};for(const rt of u)qe(rt,null,m,w)};(function(){console.log("debounced board reset"),O&&clearTimeout(O),t(21,O=setTimeout(K,1e3))})()}}},[u,c,a,h,w,v,o,r,Z,fe,Qe,Ae,He,Ee,Xe,Ye,ye,Ge,m,d,V,O,i,Ze,xe,et,tt,nt,ot,f]}class to extends de{constructor(e){super();me(this,e,eo,Zn,pe,{strokesArray:0,currentTime:1,backgroundImageDownloadURL:2,recordState:3},null,[-1,-1])}}const no=n=>({currentTime:n&1}),zt=n=>({startRecording:n[1],stopRecording:n[2],currentTime:n[0]});function oo(n){let e;const t=n[4].default,o=be(t,n,n[3],zt);return{c(){o&&o.c()},l(r){o&&o.l(r)},m(r,l){o&&o.m(r,l),e=!0},p(r,[l]){o&&o.p&&(!e||l&9)&&ke(o,t,r,r[3],e?$e(t,r[3],l,no):we(r[3]),zt)},i(r){e||(R(o,r),e=!0)},o(r){T(o,r),e=!1},d(r){o&&o.d(r)}}}const Ce=100;function ro(n,e){var t=Math.pow(10,e);return(Math.round(n*t)/t).toFixed(e)}function lo(n,e,t){let o,r;G(n,Cn,S=>t(10,o=S)),G(n,Ln,S=>t(11,r=S));let{$$slots:l={},$$scope:s}=e,i,f=null,u=null,c=0,a="";function h(){f=Date.now(),u=f+Ce,a=setTimeout(m,Ce)}function p(){clearTimeout(a),a="",t(0,c=0),u=null}function m(){const S=Date.now()-u;S>Ce&&console.log("setTimeout is lagging greatly"),u+=Ce;const I=1e3,P=1;t(0,c=ro((u-f)/I,P)),a=setTimeout(m,Math.max(0,Ce-S))}wt(async()=>{window&&(i=await Un(()=>import("../../../chunks/index-f195c495.js"),[]),window.MediaRecorder=i.default)});const d=ut();let w=null;function v(){return new Promise(async(S,I)=>{let P;if(o)if(r.local.audio)P=o.clone();else{alert("Cannot start recording because your mic is muted - click the switch next to your name to unmute"),I("Cannot start recording because mic stream is muted");return}else try{P=await navigator.mediaDevices.getUserMedia({audio:!0})}catch{return alert(`Don't forget to enable your your mic! Click the "aA" / "i" button beside the URL bar "https://explain.mit.edu", then click "website settings" / "microphone"`),I("Can't access mic stream")}w=new MediaRecorder(P),w.start(),h(),d("record-start"),S()})}function V(){return new Promise((S,I)=>{p(),w.addEventListener("dataavailable",P=>{const O=P.data;d("record-end",{audioBlob:O}),S()}),w.stop();for(const P of w.stream.getTracks())P.stop()})}return n.$$set=S=>{"$$scope"in S&&t(3,s=S.$$scope)},[c,v,V,s,l]}class so extends de{constructor(e){super();me(this,e,lo,oo,pe,{})}}function ao(n,e){let t=document.getElementById(e);return t==null||t.appendChild(n),{destroy(){n.remove()}}}function Ot(n,e){let t=new IntersectionObserver(o=>{for(const r of o)if(r.isIntersecting){e(),t.unobserve(n);return}},{root:null,threshold:.2,rootMargin:"0px"});t.observe(n)}function io(n){let e,t,o,r,l;return{c(){e=E("div"),t=E("textarea"),this.h()},l(s){e=N(s,"DIV",{style:!0,class:!0});var i=A(e);t=N(i,"TEXTAREA",{placeholder:!0,rows:!0,style:!0,class:!0}),A(t).forEach(_),i.forEach(_),this.h()},h(){t.value=n[0],D(t,"placeholder",n[1]),D(t,"rows","1"),b(t,"width",100+"%"),D(t,"class","svelte-1iax4ps"),b(e,"display","grid"),D(e,"class","grow-wrap svelte-1iax4ps")},m(s,i){y(s,e,i),U(e,t),n[7](e),r||(l=[J(t,"input",n[6]),Se(n[5].call(null,e)),Se(o=dn.call(null,e,n[3]))],r=!0)},p(s,[i]){i&1&&(t.value=s[0]),i&2&&D(t,"placeholder",s[1]),o&&Pe(o.update)&&i&8&&o.update.call(null,s[3])},i:re,o:re,d(s){s&&_(e),n[7](null),r=!1,it(l)}}}function uo(n,e,t){let o,{value:r}=e,{placeholder:l}=e,s;const i=ut();function f(a){a.dataset.replicatedValue=r}const u=a=>{t(2,s.dataset.replicatedValue=a.target.value,s),i("input",a.target.value)};function c(a){Te[a?"unshift":"push"](()=>{s=a,t(2,s)})}return n.$$set=a=>{"value"in a&&t(0,r=a.value),"placeholder"in a&&t(1,l=a.placeholder)},t(3,o={width:"100%"}),[r,l,s,o,i,f,u,c]}class co extends de{constructor(e){super();me(this,e,uo,io,pe,{value:0,placeholder:1})}}const fo=n=>({strokesArray:n&1}),jt=n=>({listenToStrokes:n[1],strokesArray:n[0],handleNewlyDrawnStroke:n[2],deleteAllStrokesFromDb:n[3]});function mo(n){let e;const t=n[6].default,o=be(t,n,n[5],jt);return{c(){o&&o.c()},l(r){o&&o.l(r)},m(r,l){o&&o.m(r,l),e=!0},p(r,[l]){o&&o.p&&(!e||l&33)&&ke(o,t,r,r[5],e?$e(t,r[5],l,fo):we(r[5]),jt)},i(r){e||(R(o,r),e=!0)},o(r){T(o,r),e=!1},d(r){o&&o.d(r)}}}function Ft(n){const e=Re({id:n.id},n.data());return e.startTime=0,e.endTime=0,n.data().isErasing||(e.endTime+=.5),e}function po(n,e,t){let{$$slots:o={},$$scope:r}=e,{dbPath:l}=e,s,i;const f=je(z(),`${l}/strokes`),u=ct(f,$t("timestamp"));ze(()=>{i&&i()});async function c(){i=ft(u,async p=>{p.docChanges().filter(d=>d.type==="removed").length>0?(t(0,s=[]),await mn(),p.docs.length>0&&p.docs.forEach(d=>{s.push(Ft(d))})):(s||t(0,s=[]),p.docs.length===s.length||p.docChanges().filter(d=>d.type==="added").forEach(d=>{t(0,s=[...s,Ft(d.doc)])}))})}function a(p){s.push(p);try{vt(Y(z(),`${l}/strokes/${p.id}`),Re({timestamp:pn()},p))}catch(m){alert(m)}}async function h(){return new Promise(async p=>{const m=[];let d=yt(z()),w=0;for(const v of s){w>=500&&(m.push(d.commit()),d=yt(z()),w=0);const V=Y(z(),`${l}/strokes/${v.id}`);d.delete(V),w+=1}m.push(d.commit()),await Promise.all(m),t(0,s=[]),p()})}return n.$$set=p=>{"dbPath"in p&&t(4,l=p.dbPath),"$$scope"in p&&t(5,r=p.$$scope)},[s,c,a,h,l,r,o]}class ho extends de{constructor(e){super();me(this,e,po,mo,pe,{dbPath:4})}}const _o=n=>({allComments:n&1,newComment:n&2,isShowingComments:n&4}),Wt=n=>({listenToComments:n[3],allComments:n[0],newComment:n[1],bindLocalValue:n[4],submitNewComment:n[5],isShowingComments:n[2],hideComments:n[6]});function go(n){let e;const t=n[9].default,o=be(t,n,n[8],Wt);return{c(){o&&o.c()},l(r){o&&o.l(r)},m(r,l){o&&o.m(r,l),e=!0},p(r,[l]){o&&o.p&&(!e||l&263)&&ke(o,t,r,r[8],e?$e(t,r[8],l,_o):we(r[8]),Wt)},i(r){e||(R(o,r),e=!0)},o(r){T(o,r),e=!1},d(r){o&&o.d(r)}}}function bo(n,e,t){let o;G(n,ht,v=>t(11,o=v));let{$$slots:r={},$$scope:l}=e,{dbPath:s}=e,i;const f=je(z(),`${s}/comments`),u=ct(f,$t("isoStringOfDate"));let c=null,a="",h=!1;ze(()=>{c&&c()});async function p(){c=ft(u,v=>{const V=[];for(const S of v.docs)V.push(Re({id:S.id},S.data()));t(0,i=V),t(2,h=!0)})}function m(v){console.log("e =",v),t(1,a=v)}async function d(){const v=je(z(),`${s}/comments`);hn(v,{content:a,isoStringOfDate:new Date().toISOString(),creatorUID:o.uid,creatorName:o.name});const V=Y(z(),s);X(V,{numOfComments:Dt(1)})}function w(){t(2,h=!1)}return n.$$set=v=>{"dbPath"in v&&t(7,s=v.dbPath),"$$scope"in v&&t(8,l=v.$$scope)},[i,a,h,p,m,d,w,s,l,r]}class ko extends de{constructor(e){super();me(this,e,bo,go,pe,{dbPath:7})}}function qt(n,e,t){const o=n.slice();return o[49]=e[t],o[51]=t,o}function Qt(n){let e,t,o,r,l,s=[],i=new Map,f,u,c,a;t=new gn({props:{disabled:le(n[0].name)&&n[0].askerUID&&n[6].uid!==n[0].askerUID,value:n[0].name,class:"room-title",style:`width: ${n[8]}px;`,$$slots:{helper:[Io]},$$scope:{ctx:n}}}),t.$on("input",n[25]);let h=n[0].blackboards;const p=m=>m[49];for(let m=0;m<h.length;m+=1){let d=qt(n,h,m),w=p(d);i.set(w,s[m]=Kt(w,d))}return{c(){e=E("div"),j(t.$$.fragment),o=Q(),r=E("div"),l=Q();for(let m=0;m<s.length;m+=1)s[m].c();this.h()},l(m){e=N(m,"DIV",{style:!0});var d=A(e);F(t.$$.fragment,d),o=H(d),r=N(d,"DIV",{style:!0}),A(r).forEach(_),l=H(d);for(let w=0;w<s.length;w+=1)s[w].l(d);d.forEach(_),this.h()},h(){b(r,"margin-bottom","14px"),b(e,"padding","16px"),ae(e,"question",le(n[0].name))},m(m,d){y(m,e,d),W(t,e,null),U(e,o),U(e,r),U(e,l);for(let w=0;w<s.length;w+=1)s[w].m(e,null);u=!0,c||(a=Se(f=ao.call(null,e,"main-content")),c=!0)},p(m,d){const w={};d[0]&65&&(w.disabled=le(m[0].name)&&m[0].askerUID&&m[6].uid!==m[0].askerUID),d[0]&1&&(w.value=m[0].name),d[0]&256&&(w.style=`width: ${m[8]}px;`),d[0]&31|d[2]&64&&(w.$$scope={dirty:d,ctx:m}),t.$set(w),d[0]&4161505|d[1]&31457280|d[2]&34&&(h=m[0].blackboards,ue(),s=_n(s,d,p,1,m,h,i,e,bn,Kt,null,qt),ce()),d[0]&1&&ae(e,"question",le(m[0].name))},i(m){if(!u){R(t.$$.fragment,m);for(let d=0;d<h.length;d+=1)R(s[d]);u=!0}},o(m){T(t.$$.fragment,m);for(let d=0;d<s.length;d+=1)T(s[d]);u=!1},d(m){m&&_(e),q(t);for(let d=0;d<s.length;d+=1)s[d].d();c=!1,a()}}}function wo(n){let e=n[0].askerName+"",t,o,r=We(n[0].dateAsked)+"",l;return{c(){t=C(e),o=C(" asked on "),l=C(r)},l(s){t=L(s,e),o=L(s," asked on "),l=L(s,r)},m(s,i){y(s,t,i),y(s,o,i),y(s,l,i)},p(s,i){i[0]&1&&e!==(e=s[0].askerName+"")&&ie(t,e),i[0]&1&&r!==(r=We(s[0].dateAsked)+"")&&ie(l,r)},d(s){s&&_(t),s&&_(o),s&&_(l)}}}function $o(n){let e,t,o;return{c(){e=C("Resolving this question in "),t=C(n[4]),o=C(", cancel by re-adding ?")},l(r){e=L(r,"Resolving this question in "),t=L(r,n[4]),o=L(r,", cancel by re-adding ?")},m(r,l){y(r,e,l),y(r,t,l),y(r,o,l)},p(r,l){l[0]&16&&ie(t,r[4])},d(r){r&&_(e),r&&_(t),r&&_(o)}}}function vo(n){let e,t,o;return{c(){e=C("Pinging server members in "),t=C(n[2]),o=C(', cancel by backtracking the "?""')},l(r){e=L(r,"Pinging server members in "),t=L(r,n[2]),o=L(r,', cancel by backtracking the "?""')},m(r,l){y(r,e,l),y(r,t,l),y(r,o,l)},p(r,l){l[0]&4&&ie(t,r[2])},d(r){r&&_(e),r&&_(t),r&&_(o)}}}function yo(n){let e;return{c(){e=C('To ask the server a question, end your title with a question mark "?"')},l(t){e=L(t,'To ask the server a question, end your title with a question mark "?"')},m(t,o){y(t,e,o)},p:re,d(t){t&&_(e)}}}function Ht(n){let e,t=We(n[0].dateResolved)+"",o;return{c(){e=C(", resolved "),o=C(t)},l(r){e=L(r,", resolved "),o=L(r,t)},m(r,l){y(r,e,l),y(r,o,l)},p(r,l){l[0]&1&&t!==(t=We(r[0].dateResolved)+"")&&ie(o,t)},d(r){r&&_(e),r&&_(o)}}}function Do(n){let e,t;function o(i,f){if(!i[1]&&!i[3]&&!i[0].askerUID)return yo;if(i[1])return vo;if(i[3])return $o;if(i[0].askerName&&i[0].askerUID&&i[0].date)return wo}let r=o(n),l=r&&r(n),s=n[0].dateResolved&&Ht(n);return{c(){l&&l.c(),e=Q(),s&&s.c(),t=ee()},l(i){l&&l.l(i),e=H(i),s&&s.l(i),t=ee()},m(i,f){l&&l.m(i,f),y(i,e,f),s&&s.m(i,f),y(i,t,f)},p(i,f){r===(r=o(i))&&l?l.p(i,f):(l&&l.d(1),l=r&&r(i),l&&(l.c(),l.m(e.parentNode,e))),i[0].dateResolved?s?s.p(i,f):(s=Ht(i),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},d(i){l&&l.d(i),i&&_(e),s&&s.d(i),i&&_(t)}}}function Io(n){let e,t;return e=new kn({props:{slot:"helper",$$slots:{default:[Do]},$$scope:{ctx:n}}}),{c(){j(e.$$.fragment)},l(o){F(e.$$.fragment,o)},m(o,r){W(e,o,r),t=!0},p(o,r){const l={};r[0]&31|r[2]&64&&(l.$$scope={dirty:r,ctx:o}),e.$set(l)},i(o){t||(R(e.$$.fragment,o),t=!0)},o(o){T(e.$$.fragment,o),t=!1},d(o){q(e,o)}}}function Xt(n){let e,t,o,r,l,s,i,f;function u(...m){return n[26](n[49],...m)}t=new co({props:{value:n[52].description||"",placeholder:"Describe the blackboard..."}}),t.$on("input",u);const c=[To,Ro],a=[];function h(m,d){return m[52].audioDownloadURL?0:1}r=h(n),l=a[r]=c[r](n);let p=n[51]===n[0].blackboards.length-1&&Gt(n);return{c(){e=E("div"),j(t.$$.fragment),o=Q(),l.c(),s=Q(),p&&p.c(),i=ee(),this.h()},l(m){e=N(m,"DIV",{style:!0});var d=A(e);F(t.$$.fragment,d),d.forEach(_),o=H(m),l.l(m),s=H(m),p&&p.l(m),i=ee(),this.h()},h(){b(e,"width",n[8]+"px"),b(e,"margin-top","10px"),b(e,"margin-bottom","0px")},m(m,d){y(m,e,d),W(t,e,null),y(m,o,d),a[r].m(m,d),y(m,s,d),p&&p.m(m,d),y(m,i,d),f=!0},p(m,d){n=m;const w={};d[1]&2097152&&(w.value=n[52].description||""),t.$set(w),(!f||d[0]&256)&&b(e,"width",n[8]+"px");let v=r;r=h(n),r===v?a[r].p(n,d):(ue(),T(a[v],1,1,()=>{a[v]=null}),ce(),l=a[r],l?l.p(n,d):(l=a[r]=c[r](n),l.c()),R(l,1),l.m(s.parentNode,s)),n[51]===n[0].blackboards.length-1?p?p.p(n,d):(p=Gt(n),p.c(),p.m(i.parentNode,i)):p&&(p.d(1),p=null)},i(m){f||(R(t.$$.fragment,m),R(l),f=!0)},o(m){T(t.$$.fragment,m),T(l),f=!1},d(m){m&&_(e),q(t),m&&_(o),a[r].d(m),m&&_(s),p&&p.d(m),m&&_(i)}}}function Ro(n){let e,t;return e=new ho({props:{dbPath:n[5]+n[49],$$slots:{default:[Ao,({listenToStrokes:o,strokesArray:r,handleNewlyDrawnStroke:l,deleteAllStrokesFromDb:s})=>({63:o,54:r,64:l,55:s}),({listenToStrokes:o,strokesArray:r,handleNewlyDrawnStroke:l,deleteAllStrokesFromDb:s})=>[0,(r?8388608:0)|(s?16777216:0),(o?2:0)|(l?4:0)]]},$$scope:{ctx:n}}}),{c(){j(e.$$.fragment)},l(o){F(e.$$.fragment,o)},m(o,r){W(e,o,r),t=!0},p(o,r){const l={};r[0]&33&&(l.dbPath=o[5]+o[49]),r[0]&897|r[1]&27262976|r[2]&66&&(l.$$scope={dirty:r,ctx:o}),e.$set(l)},i(o){t||(R(e.$$.fragment,o),t=!0)},o(o){T(e.$$.fragment,o),t=!1},d(o){q(e,o)}}}function To(n){let e,t,o,r;return e=new ko({props:{dbPath:n[5]+n[49],$$slots:{default:[Eo,({listenToComments:l,allComments:s,newComment:i,bindLocalValue:f,submitNewComment:u,isShowingComments:c,hideComments:a})=>({56:l,57:s,58:i,59:f,60:u,61:c,62:a}),({listenToComments:l,allComments:s,newComment:i,bindLocalValue:f,submitNewComment:u,isShowingComments:c,hideComments:a})=>[0,(l?33554432:0)|(s?67108864:0)|(i?134217728:0)|(f?268435456:0)|(u?536870912:0)|(c?1073741824:0),a?1:0]]},$$scope:{ctx:n}}}),o=new Sn({props:{dbPath:n[5]+n[49],$$slots:{default:[Bo,({fetchStrokes:l,strokesArray:s,deleteAllStrokesFromDb:i})=>({53:l,54:s,55:i}),({fetchStrokes:l,strokesArray:s,deleteAllStrokesFromDb:i})=>[0,(l?4194304:0)|(s?8388608:0)|(i?16777216:0)]]},$$scope:{ctx:n}}}),{c(){j(e.$$.fragment),t=Q(),j(o.$$.fragment)},l(l){F(e.$$.fragment,l),t=H(l),F(o.$$.fragment,l)},m(l,s){W(e,l,s),y(l,t,s),W(o,l,s),r=!0},p(l,s){const i={};s[0]&33&&(i.dbPath=l[5]+l[49]),s[1]&2097152|s[2]&64&&(i.$$scope={dirty:s,ctx:l}),e.$set(i);const f={};s[0]&33&&(f.dbPath=l[5]+l[49]),s[0]&833|s[1]&14680064|s[2]&64&&(f.$$scope={dirty:s,ctx:l}),o.$set(f)},i(l){r||(R(e.$$.fragment,l),R(o.$$.fragment,l),r=!0)},o(l){T(e.$$.fragment,l),T(o.$$.fragment,l),r=!1},d(l){q(e,l),l&&_(t),q(o,l)}}}function So(n){let e,t,o,r;function l(){return n[30](n[66],n[49])}return{c(){e=E("span"),t=C("stop_circle"),this.h()},l(s){e=N(s,"SPAN",{class:!0,style:!0});var i=A(e);t=L(i,"stop_circle"),i.forEach(_),this.h()},h(){D(e,"class","material-icons svelte-53fhoc"),b(e,"font-size","2.5rem"),b(e,"color","cyan"),b(e,"margin-left","22px"),b(e,"margin-right","26px"),ae(e,"unclickable",n[7]!==n[52].recorderBrowserTabID)},m(s,i){y(s,e,i),U(e,t),o||(r=J(e,"click",l),o=!0)},p(s,i){n=s,i[0]&128|i[1]&2097152&&ae(e,"unclickable",n[7]!==n[52].recorderBrowserTabID)},i:re,o:re,d(s){s&&_(e),o=!1,r()}}}function Po(n){let e,t,o,r;function l(){return n[29](n[65],n[49])}return{c(){e=E("span"),t=C("circle"),this.h()},l(s){e=N(s,"SPAN",{class:!0,style:!0});var i=A(e);t=L(i,"circle"),i.forEach(_),this.h()},h(){D(e,"class","material-icons"),b(e,"font-size","2.5rem"),b(e,"color","red"),b(e,"margin-left","22px"),b(e,"margin-right","26px")},m(s,i){y(s,e,i),U(e,t),o||(r=J(e,"click",l),o=!0)},p(s,i){n=s},i:re,o:re,d(s){s&&_(e),o=!1,r()}}}function Uo(n){let e,t,o;return t=new Rn({props:{class:"my-four-colors",style:"height: 32px; width: 32px;",indeterminate:!0,fourColor:!0}}),{c(){e=E("div"),j(t.$$.fragment),this.h()},l(r){e=N(r,"DIV",{style:!0});var l=A(e);F(t.$$.fragment,l),l.forEach(_),this.h()},h(){b(e,"display","flex"),b(e,"justify-content","center"),b(e,"margin-left","20px"),b(e,"margin-right","20px")},m(r,l){y(r,e,l),W(t,e,null),o=!0},p:re,i(r){o||(R(t.$$.fragment,r),o=!0)},o(r){T(t.$$.fragment,r),o=!1},d(r){r&&_(e),q(t)}}}function Co(n){let e,t,o,r;const l=[Uo,Po,So],s=[];function i(f,u){return f[52].recordState==="post_record"?0:f[52].recordState==="pre_record"||f[67]===0?1:f[52].recordState==="mid_record"?2:-1}return~(e=i(n))&&(t=s[e]=l[e](n)),{c(){t&&t.c(),o=ee()},l(f){t&&t.l(f),o=ee()},m(f,u){~e&&s[e].m(f,u),y(f,o,u),r=!0},p(f,u){let c=e;e=i(f),e===c?~e&&s[e].p(f,u):(t&&(ue(),T(s[c],1,1,()=>{s[c]=null}),ce()),~e?(t=s[e],t?t.p(f,u):(t=s[e]=l[e](f),t.c()),R(t,1),t.m(o.parentNode,o)):t=null)},i(f){r||(R(t),r=!0)},o(f){T(t),r=!1},d(f){~e&&s[e].d(f),f&&_(o)}}}function Lo(n){let e,t;function o(...i){return n[31](n[49],...i)}function r(){return n[32](n[49])}function l(...i){return n[33](n[64],...i)}function s(){return n[34](n[49],n[55])}return e=new to({props:{strokesArray:n[54],currentTime:n[67],backgroundImageDownloadURL:n[52].backgroundImageDownloadURL,recordState:n[52].recordState,$$slots:{default:[Co]},$$scope:{ctx:n}}}),e.$on("background-upload",o),e.$on("background-reset",r),e.$on("stroke-drawn",l),e.$on("board-wipe",function(){Pe(n[55])&&n[55].apply(this,arguments)}),e.$on("board-delete",s),{c(){j(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,f){W(e,i,f),t=!0},p(i,f){n=i;const u={};f[1]&8388608&&(u.strokesArray=n[54]),f[2]&32&&(u.currentTime=n[67]),f[1]&2097152&&(u.backgroundImageDownloadURL=n[52].backgroundImageDownloadURL),f[1]&2097152&&(u.recordState=n[52].recordState),f[0]&129|f[1]&2097152|f[2]&96&&(u.$$scope={dirty:f,ctx:n}),e.$set(u)},i(i){t||(R(e.$$.fragment,i),t=!0)},o(i){T(e.$$.fragment,i),t=!1},d(i){q(e,i)}}}function Ao(n){let e,t,o,r,l,s,i;function f(...u){return n[35](n[54],n[49],...u)}return t=new so({props:{$$slots:{default:[Lo,({startRecording:u,stopRecording:c,currentTime:a})=>({65:u,66:c,67:a}),({startRecording:u,stopRecording:c,currentTime:a})=>[0,0,(u?8:0)|(c?16:0)|(a?32:0)]]},$$scope:{ctx:n}}}),t.$on("record-end",f),{c(){e=E("div"),j(t.$$.fragment),this.h()},l(u){e=N(u,"DIV",{style:!0});var c=A(e);F(t.$$.fragment,c),c.forEach(_),this.h()},h(){D(e,"style",o=`width: ${n[8]}px; height: ${n[9]}px; position: relative`)},m(u,c){y(u,e,c),W(t,e,null),l=!0,s||(i=Se(r=Ot.call(null,e,n[63])),s=!0)},p(u,c){n=u;const a={};c[0]&129|c[1]&27262976|c[2]&96&&(a.$$scope={dirty:c,ctx:n}),t.$set(a),(!l||c[0]&768&&o!==(o=`width: ${n[8]}px; height: ${n[9]}px; position: relative`))&&D(e,"style",o),r&&Pe(r.update)&&c[2]&2&&r.update.call(null,n[63])},i(u){l||(R(t.$$.fragment,u),l=!0)},o(u){T(t.$$.fragment,u),l=!1},d(u){u&&_(e),q(t),s=!1,i()}}}function Eo(n){let e,t,o=(n[52].eurekaUIDs?n[52].eurekaUIDs.length:0)+"",r,l,s=(n[52].viewMinutes?n[52].viewMinutes.toFixed(1):0)+"",i,f;return{c(){e=E("div"),t=E("div"),r=C(o),l=C(` eurekas, \r
                  `),i=C(s),f=C(" minutes viewed"),this.h()},l(u){e=N(u,"DIV",{style:!0});var c=A(e);t=N(c,"DIV",{style:!0});var a=A(t);r=L(a,o),l=L(a,` eurekas, \r
                  `),i=L(a,s),f=L(a," minutes viewed"),a.forEach(_),c.forEach(_),this.h()},h(){b(t,"color","grey"),b(t,"font-size","0.7rem"),b(t,"margin-left","2px"),b(t,"margin-top","4px"),b(t,"margin-bottom","4px"),b(e,"display","flex"),b(e,"align-items","center")},m(u,c){y(u,e,c),U(e,t),U(t,r),U(t,l),U(t,i),U(t,f)},p(u,c){c[1]&2097152&&o!==(o=(u[52].eurekaUIDs?u[52].eurekaUIDs.length:0)+"")&&ie(r,o),c[1]&2097152&&s!==(s=(u[52].viewMinutes?u[52].viewMinutes.toFixed(1):0)+"")&&ie(i,s)},d(u){u&&_(e)}}}function No(n){let e;return{c(){e=C("Eureka")},l(t){e=L(t,"Eureka")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Yt(n){let e,t;function o(){return n[27](n[52],n[55])}return e=new Pt({props:{style:"margin-left: "+(n[8]-240-70)+"px; background-color: rgba(255,255,255,0.5); color: white",$$slots:{default:[Vo]},$$scope:{ctx:n}}}),e.$on("click",o),{c(){j(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,l){W(e,r,l),t=!0},p(r,l){n=r;const s={};l[0]&256&&(s.style="margin-left: "+(n[8]-240-70)+"px; background-color: rgba(255,255,255,0.5); color: white"),l[2]&64&&(s.$$scope={dirty:l,ctx:n}),e.$set(s)},i(r){t||(R(e.$$.fragment,r),t=!0)},o(r){T(e.$$.fragment,r),t=!1},d(r){q(e,r)}}}function Vo(n){let e;return{c(){e=C("Delete video")},l(t){e=L(t,"Delete video")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Mo(n){let e,t,o,r;e=new Pt({props:{style:`\r
                    background-color: `+(n[52].eurekaUIDs&&n[52].eurekaUIDs.includes(n[6].uid)?"orange":"rgba(255,255,255,0.5)")+`;\r
                    color: white;\r
                    margin-left: 8px;`,$$slots:{default:[No]},$$scope:{ctx:n}}}),e.$on("click",function(){Pe(n[21](n[52]))&&n[21](n[52]).apply(this,arguments)});let l=(n[6].uid===n[52].creatorUID||!n[52].creatorUID)&&Yt(n);return{c(){j(e.$$.fragment),t=Q(),l&&l.c(),o=ee()},l(s){F(e.$$.fragment,s),t=H(s),l&&l.l(s),o=ee()},m(s,i){W(e,s,i),y(s,t,i),l&&l.m(s,i),y(s,o,i),r=!0},p(s,i){n=s;const f={};i[0]&64|i[1]&2097152&&(f.style=`\r
                    background-color: `+(n[52].eurekaUIDs&&n[52].eurekaUIDs.includes(n[6].uid)?"orange":"rgba(255,255,255,0.5)")+`;\r
                    color: white;\r
                    margin-left: 8px;`),i[2]&64&&(f.$$scope={dirty:i,ctx:n}),e.$set(f),n[6].uid===n[52].creatorUID||!n[52].creatorUID?l?(l.p(n,i),i[0]&64|i[1]&2097152&&R(l,1)):(l=Yt(n),l.c(),R(l,1),l.m(o.parentNode,o)):l&&(ue(),T(l,1,1,()=>{l=null}),ce())},i(s){r||(R(e.$$.fragment,s),R(l),r=!0)},o(s){T(e.$$.fragment,s),T(l),r=!1},d(s){q(e,s),s&&_(t),l&&l.d(s),s&&_(o)}}}function Bo(n){let e,t,o,r,l,s,i;function f(...u){return n[28](n[49],...u)}return t=new Pn({props:{strokesArray:n[54],audioDownloadURL:n[52].audioDownloadURL,backgroundImageDownloadURL:n[52].backgroundImageDownloadURL,$$slots:{default:[Mo]},$$scope:{ctx:n}}}),t.$on("six-seconds-elapsed",f),{c(){e=E("div"),j(t.$$.fragment),this.h()},l(u){e=N(u,"DIV",{style:!0});var c=A(e);F(t.$$.fragment,c),c.forEach(_),this.h()},h(){D(e,"style",o=`width: ${n[8]}px; height: ${n[9]+40}px; position: relative`)},m(u,c){y(u,e,c),W(t,e,null),l=!0,s||(i=Se(r=Ot.call(null,e,n[53])),s=!0)},p(u,c){n=u;const a={};c[1]&8388608&&(a.strokesArray=n[54]),c[1]&2097152&&(a.audioDownloadURL=n[52].audioDownloadURL),c[1]&2097152&&(a.backgroundImageDownloadURL=n[52].backgroundImageDownloadURL),c[0]&320|c[1]&2097152|c[2]&64&&(a.$$scope={dirty:c,ctx:n}),t.$set(a),(!l||c[0]&768&&o!==(o=`width: ${n[8]}px; height: ${n[9]+40}px; position: relative`))&&D(e,"style",o),r&&Pe(r.update)&&c[1]&4194304&&r.update.call(null,n[53])},i(u){l||(R(t.$$.fragment,u),l=!0)},o(u){T(t.$$.fragment,u),l=!1},d(u){u&&_(e),q(t),s=!1,i()}}}function Gt(n){let e,t,o,r;return{c(){e=E("div"),t=C("New blackboard"),this.h()},l(l){e=N(l,"DIV",{style:!0});var s=A(e);t=L(s,"New blackboard"),s.forEach(_),this.h()},h(){b(e,"display","flex"),b(e,"justify-content","center"),b(e,"align-items","center"),b(e,"margin-top","40px"),b(e,"background-color","#2e3131"),b(e,"font-family","Roboto, sans-serif"),b(e,"text-transform","uppercase"),b(e,"color","white"),b(e,"height","35px"),b(e,"width",n[8]+"px")},m(l,s){y(l,e,s),U(e,t),o||(r=J(e,"click",n[19]),o=!0)},p(l,s){s[0]&256&&b(e,"width",l[8]+"px")},d(l){l&&_(e),o=!1,r()}}}function zo(n){let e,t,o=n[52]&&Xt(n);return{c(){o&&o.c(),e=Q()},l(r){o&&o.l(r),e=H(r)},m(r,l){o&&o.m(r,l),y(r,e,l),t=!0},p(r,l){r[52]?o?(o.p(r,l),l[1]&2097152&&R(o,1)):(o=Xt(r),o.c(),R(o,1),o.m(e.parentNode,e)):o&&(ue(),T(o,1,1,()=>{o=null}),ce())},i(r){t||(R(o),t=!0)},o(r){T(o),t=!1},d(r){o&&o.d(r),r&&_(e)}}}function Kt(n,e){let t,o,r;return o=new Tn({props:{dbPath:e[5]+e[49],$$slots:{default:[zo,({boardDoc:l})=>({52:l}),({boardDoc:l})=>[0,l?2097152:0]]},$$scope:{ctx:e}}}),{key:n,first:null,c(){t=ee(),j(o.$$.fragment),this.h()},l(l){t=ee(),F(o.$$.fragment,l),this.h()},h(){this.first=t},m(l,s){y(l,t,s),W(o,l,s),r=!0},p(l,s){e=l;const i={};s[0]&33&&(i.dbPath=e[5]+e[49]),s[0]&993|s[1]&2097152|s[2]&64&&(i.$$scope={dirty:s,ctx:e}),o.$set(i)},i(l){r||(R(o.$$.fragment,l),r=!0)},o(l){T(o.$$.fragment,l),r=!1},d(l){l&&_(t),q(o,l)}}}function Oo(n){let e,t,o=n[0]&&Qt(n);return{c(){o&&o.c(),e=ee()},l(r){o&&o.l(r),e=ee()},m(r,l){o&&o.m(r,l),y(r,e,l),t=!0},p(r,l){r[0]?o?(o.p(r,l),l[0]&1&&R(o,1)):(o=Qt(r),o.c(),R(o,1),o.m(e.parentNode,e)):o&&(ue(),T(o,1,1,()=>{o=null}),ce())},i(r){t||(R(o),t=!0)},o(r){T(o),t=!1},d(r){o&&o.d(r),r&&_(e)}}}async function Zo({page:n}){return{props:{classID:n.params.class,roomID:n.params.room}}}async function Jt(...n){for(const e of n)try{await e()}catch(t){alert(t);return}}function le(n){return n?n.charAt(n.length-1)==="?":!1}function _t(n){return n.askerName&&n.dateAsked&&n.askerUID}function jo(n){let e;return{promise:new Promise((o,r)=>{e=r,setTimeout(o,n)}),cancel:e}}function Fo(n,e,t){let o,r,l,s,i,f,u;G(n,ht,g=>t(6,s=g)),G(n,An,g=>t(7,i=g)),G(n,Ct,g=>t(8,f=g)),G(n,Ut,g=>t(9,u=g));let{classID:c}=e,{roomID:a}=e,h,p={name:"",blackboards:[]};async function m(){h&&h(),h=ft(l,g=>{g.exists()?t(0,p=Re({id:g.id},g.data())):Vn(`/${c}/${c}`)})}ze(()=>{h()});function d(g,$){const B=Y(z(),o+g);X(B,{viewMinutes:Dt(.1*$)})}function w(g){const $=Y(z(),o+g);X($,{recorderBrowserTabID:i})}function v(g,$){const B=Y(z(),o+g);X(B,{recordState:$})}async function V(g,$){const B=Y(z(),o+$);if(!!g)if(g.type.split("/")[0]==="image"){const x=dt(),ne=mt(x,`images/${Fe()}`);await It(ne,g);const oe=await Rt(ne);X(B,{backgroundImageDownloadURL:oe})}else alert("Error: only images can be used")}function S(g){const $=Y(z(),o+g);X($,{backgroundImageDownloadURL:ve()})}let I="",P=5,O,Z=5;async function fe({srcElement:g}){const{value:$}=g,B={name:$};!le(p.name)&&le($)&&!_t(p)?Le():I&&!le($)?Ee():!le($)&&_t(p)?Qe():O&&le($)&&_t(p)&&He(),await X(l,B)}function Le(){t(2,P=5),t(1,I=setInterval(()=>{t(2,P-=1),P===0&&(Xe(),Ye(),Ee())},1e3))}function Qe(){t(4,Z=5),t(3,O=setInterval(()=>{t(4,Z-=1),Z===0&&Ae()},1e3))}function Ae(){X(l,{dateResolved:new Date().toISOString()})}function He(){clearTimeout(O),t(3,O="")}function Ee(){clearTimeout(I),t(1,I="")}function Xe(){X(l,{askerName:s.name||"Beaver #999",askerUID:s.uid,dateAsked:new Date().toISOString()})}async function Ye(){const g=[],$=wn(),B=$n($,"sendTextMessage"),x=je(z(),"users"),ne=ct(x,vn("willReceiveText","==",!0)),oe=await yn(ne);if(oe.docs)for(const Ie of oe.docs){console.log("phoneNumber =",Ie.data().phoneNumber);try{Ie.id!==s.uid&&g.push(B({content:`${s.name} asked on https://ihtfp.app: "${p.name||"Fake question here"}"`,toWho:Ie.data().phoneNumber}))}catch(lt){alert(lt)}}await Promise.all(g),console.log("success, sent all texts.")}let ye={promise:null,cancel:g=>{}};function Ge(g,$){return async(...B)=>{try{ye.cancel(),ye=jo($),await ye.promise,await g(...B)}catch{}}}async function Ne({detail:g},$){Ge(()=>Ve({detail:g},$),3e3)({detail:g},$)}async function Ve({detail:g},$){const B=Y(z(),o+$);await X(B,{description:g})}async function Me(g,$,B){function x(te){return te.startTime!==0&&te.endTime!==ne}const ne=.5,oe=[],Ie=$.length;for(let te=0;te<Ie;te++){if(!x($[te])){let he=te-1;for(;he>=0;){if(x($[he])){$[te].startTime=$[he].endTime,$[te].endTime=$[te].startTime+ne,oe.push(te);break}he-=1}}for(let he of oe){const at=$[he],en=o+B,tn=Y(z(),`${en}/strokes/${at.id}`);X(tn,{startTime:at.startTime,endTime:at.endTime})}}const lt=dt(),st=mt(lt,`audio/${Fe()}`);await It(st,g);const Zt=await Rt(st),xt=Y(z(),o+B);await X(xt,{creatorUID:s.uid||"",creatorPhoneNumber:s.phoneNumber||"",date:new Date().toISOString(),audioDownloadURL:Zt,audioRefFullPath:st.fullPath}),v(B,"pre_record")}async function Be({id:g,audioRefFullPath:$},B){const x=[],ne=Y(z(),o+g);if($){const oe=mt(dt(),$);x.push(Dn(oe))}x.push(X(ne,{creator:ve(),creatorPhoneNumber:ve(),date:ve(),audioDownloadURL:ve(),audioRefFullPath:ve()})),x.push(B()),await Promise.all(x)}async function Ke(){const g=Fe(),$=Y(z(),o+g);await Promise.all([vt($,{recordState:"pre_record"}),X(l,{blackboards:Tt(g)})])}function De(g,$){if(p.blackboards.length===1){alert("Can't delete the last blackboard");return}X(l,{blackboards:St(g)}),$(),In(Y(z(),o+g))}function Je(g){const $=Y(z(),o+g.id);if(g.eurekaUIDs instanceof Array&&g.eurekaUIDs.includes(s.uid)){X($,{eurekaUIDs:St(s.uid)});return}X($,{eurekaUIDs:Tt(s.uid)})}const Ze=g=>fe(g),xe=(g,$)=>Ne($,g),et=(g,$)=>Be(g,$),tt=(g,$)=>d(g,$.detail.playbackSpeed),nt=(g,$)=>Jt(g,()=>v($,"mid_record"),()=>w($),()=>Lt.set(!0)),ot=(g,$)=>Jt(g,()=>v($,"post_record"),()=>Lt.set(!1)),k=(g,$)=>V($.detail.imageFile,g),M=g=>S(g),K=(g,$)=>g($.detail.newStroke),se=(g,$)=>De(g,$),rt=(g,$,B)=>Me(B.detail.audioBlob,g,$);return n.$$set=g=>{"classID"in g&&t(22,c=g.classID),"roomID"in g&&t(23,a=g.roomID)},n.$$.update=()=>{n.$$.dirty[0]&4194304&&t(5,o=`classes/${c}/blackboards/`),n.$$.dirty[0]&4194304&&t(24,r=`classes/${c}/rooms/`),n.$$.dirty[0]&25165824&&(l=Y(z(),r+a)),n.$$.dirty[0]&8388608&&m()},[p,I,P,O,Z,o,s,i,f,u,d,w,v,V,S,fe,Ne,Me,Be,Ke,De,Je,c,a,r,Ze,xe,et,tt,nt,ot,k,M,K,se,rt]}class xo extends de{constructor(e){super();me(this,e,Fo,Oo,pe,{classID:22,roomID:23},null,[-1,-1,-1])}}export{xo as default,Zo as load};

var ke=Object.defineProperty;var X=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var Z=(a,e,o)=>e in a?ke(a,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[e]=o,x=(a,e)=>{for(var o in e||(e={}))we.call(e,o)&&Z(a,o,e[o]);if(X)for(var o of X(e))ve.call(e,o)&&Z(a,o,e[o]);return a};import{S as De,i as Re,s as ye,e as K,j as v,k as z,c as G,a as J,m as D,n as T,d as h,K as Ie,W as ee,f as k,o as R,L as te,$ as Q,ay as Ne,az as Ue,w as N,x as p,u as m,v as y,l as I,D as q,A as Be,N as E,O as V,Y as oe,a0 as C,r as U,aF as Le,au as O,ae as Pe,aG as ne,aH as ae,aI as Se,aJ as je,aK as Ae,Q as Me,aL as Ee,a3 as Ve,t as P,g as S,aM as W,b as H,a5 as j,M as Y}from"../../../chunks/vendor-9a185f2a.js";import{R as Ce,a as Oe,B as We,D as ze}from"../../../chunks/RenderlessBoardMethods-e6c6cf5f.js";import{a as Te}from"../../../chunks/database-9b97f416.js";import{g as qe}from"../../../chunks/canvas-257efe3e.js";import{g as le,u as He,a as Fe,c as Ke,r as Ge}from"../../../chunks/store-cdeddc4e.js";import"../../../chunks/preload-helper-ec9aa979.js";import"../../../chunks/singletons-12a22614.js";function Je(a,e){let o=document.getElementById(e);return o==null||o.appendChild(a),{destroy(){a.remove()}}}function re(a,e){let o=new IntersectionObserver(t=>{for(const n of t)if(n.isIntersecting){e(),o.unobserve(a);return}},{root:null,threshold:.2,rootMargin:"0px"});o.observe(a)}function se(a,e,o){const t=a.slice();return t[20]=e[o],t}function ie(a){let e,o,t,n=[],l=new Map,r,s,i,f,u,$;o=new oe({props:{value:a[0].name,class:"room-title",style:"width: 100%; margin-bottom: 20px;"}}),o.$on("input",a[12]);let w=a[0].blackboards;const A=_=>_[20];for(let _=0;_<w.length;_+=1){let d=se(a,w,_),b=A(d);l.set(b,n[_]=_e(b,d))}return s=new C({props:{variant:"unelevated",color:"#2e3131",style:`width: ${a[1]}px; margin-top: 40px`,$$slots:{default:[ft]},$$scope:{ctx:a}}}),s.$on("click",a[9]),{c(){e=K("div"),v(o.$$.fragment),t=z();for(let _=0;_<n.length;_+=1)n[_].c();r=z(),v(s.$$.fragment),this.h()},l(_){e=G(_,"DIV",{style:!0});var d=J(e);D(o.$$.fragment,d),t=T(d);for(let b=0;b<n.length;b+=1)n[b].l(d);r=T(d),D(s.$$.fragment,d),d.forEach(h),this.h()},h(){Ie(e,"padding","16px"),ee(e,"question",a[0].name.charAt(a[0].name.length-1)==="?")},m(_,d){k(_,e,d),R(o,e,null),te(e,t);for(let b=0;b<n.length;b+=1)n[b].m(e,null);te(e,r),R(s,e,null),f=!0,u||($=Q(i=Je.call(null,e,"main-content")),u=!0)},p(_,d){const b={};d[0]&1&&(b.value=_[0].name),o.$set(b),d[0]&2004877791|d[1]&1&&(w=_[0].blackboards,U(),n=Ne(n,d,A,1,_,w,l,e,Ue,_e,r,se),N());const M={};d[0]&2&&(M.style=`width: ${_[1]}px; margin-top: 40px`),d[1]&2&&(M.$$scope={dirty:d,ctx:_}),s.$set(M),d[0]&1&&ee(e,"question",_[0].name.charAt(_[0].name.length-1)==="?")},i(_){if(!f){p(o.$$.fragment,_);for(let d=0;d<w.length;d+=1)p(n[d]);p(s.$$.fragment,_),f=!0}},o(_){m(o.$$.fragment,_);for(let d=0;d<n.length;d+=1)m(n[d]);m(s.$$.fragment,_),f=!1},d(_){_&&h(e),y(o);for(let d=0;d<n.length;d+=1)n[d].d();y(s),u=!1,$()}}}function fe(a){let e,o,t,n,l,r=a[26]&&ue(a);const s=[Ye,Qe],i=[];function f(u,$){return u[23].audioDownloadURL?0:1}return o=f(a),t=i[o]=s[o](a),{c(){r&&r.c(),e=z(),t.c(),n=I()},l(u){r&&r.l(u),e=T(u),t.l(u),n=I()},m(u,$){r&&r.m(u,$),k(u,e,$),i[o].m(u,$),k(u,n,$),l=!0},p(u,$){u[26]?r?(r.p(u,$),$[0]&67108864&&p(r,1)):(r=ue(u),r.c(),p(r,1),r.m(e.parentNode,e)):r&&(U(),m(r,1,1,()=>{r=null}),N());let w=o;o=f(u),o===w?i[o].p(u,$):(U(),m(i[w],1,1,()=>{i[w]=null}),N(),t=i[o],t?t.p(u,$):(t=i[o]=s[o](u),t.c()),p(t,1),t.m(n.parentNode,n))},i(u){l||(p(r),p(t),l=!0)},o(u){m(r),m(t),l=!1},d(u){r&&r.d(u),u&&h(e),i[o].d(u),u&&h(n)}}}function ue(a){let e,o;function t(...n){return a[13](a[20],...n)}return e=new oe({props:{textarea:!0,value:a[23].description||"",style:`width: ${a[1]}px; margin-bottom: 10px`}}),e.$on("input",t),{c(){v(e.$$.fragment)},l(n){D(e.$$.fragment,n)},m(n,l){R(e,n,l),o=!0},p(n,l){a=n;const r={};l[0]&8388608&&(r.value=a[23].description||""),l[0]&2&&(r.style=`width: ${a[1]}px; margin-bottom: 10px`),e.$set(r)},i(n){o||(p(e.$$.fragment,n),o=!0)},o(n){m(e.$$.fragment,n),o=!1},d(n){y(e,n)}}}function Qe(a){let e,o,t,n,l,r,s=a[26]&&ce(a);return{c(){e=K("div"),s&&s.c(),this.h()},l(i){e=G(i,"DIV",{style:!0});var f=J(e);s&&s.l(f),f.forEach(h),this.h()},h(){H(e,"style",o=`width: ${a[1]}px; height: ${a[2]}px; position: relative`)},m(i,f){k(i,e,f),s&&s.m(e,null),n=!0,l||(r=Q(t=re.call(null,e,a[25])),l=!0)},p(i,f){i[26]?s?(s.p(i,f),f[0]&67108864&&p(s,1)):(s=ce(i),s.c(),p(s,1),s.m(e,null)):s&&(U(),m(s,1,1,()=>{s=null}),N()),(!n||f[0]&6&&o!==(o=`width: ${i[1]}px; height: ${i[2]}px; position: relative`))&&H(e,"style",o),t&&j(t.update)&&f[0]&33554432&&t.update.call(null,i[25])},i(i){n||(p(s),n=!0)},o(i){m(s),n=!1},d(i){i&&h(e),s&&s.d(),l=!1,r()}}}function Ye(a){let e,o,t,n,l,r,s=a[26]&&de(a);return{c(){e=K("div"),s&&s.c(),this.h()},l(i){e=G(i,"DIV",{style:!0});var f=J(e);s&&s.l(f),f.forEach(h),this.h()},h(){H(e,"style",o=`width: ${a[1]}px; height: ${a[2]+80}px; position: relative`)},m(i,f){k(i,e,f),s&&s.m(e,null),n=!0,l||(r=Q(t=re.call(null,e,a[24])),l=!0)},p(i,f){i[26]?s?(s.p(i,f),f[0]&67108864&&p(s,1)):(s=de(i),s.c(),p(s,1),s.m(e,null)):s&&(U(),m(s,1,1,()=>{s=null}),N()),(!n||f[0]&6&&o!==(o=`width: ${i[1]}px; height: ${i[2]+80}px; position: relative`))&&H(e,"style",o),t&&j(t.update)&&f[0]&16777216&&t.update.call(null,i[24])},i(i){n||(p(s),n=!0)},o(i){m(s),n=!1},d(i){i&&h(e),s&&s.d(),l=!1,r()}}}function ce(a){let e,o;function t(...n){return a[15](a[20],...n)}return e=new Oe({props:{$$slots:{default:[at,({startRecording:n,stopRecording:l,currentTime:r})=>({29:n,30:l,31:r}),({startRecording:n,stopRecording:l,currentTime:r})=>[(n?536870912:0)|(l?1073741824:0),r?1:0]]},$$scope:{ctx:a}}}),e.$on("record-end",t),{c(){v(e.$$.fragment)},l(n){D(e.$$.fragment,n)},m(n,l){R(e,n,l),o=!0},p(n,l){a=n;const r={};l[0]&1946157064|l[1]&3&&(r.$$scope={dirty:l,ctx:a}),e.$set(r)},i(n){o||(p(e.$$.fragment,n),o=!0)},o(n){m(e.$$.fragment,n),o=!1},d(n){y(e,n)}}}function Xe(a){let e;return{c(){e=P("Uploading...")},l(o){e=S(o,"Uploading...")},m(o,t){k(o,e,t)},p:Y,i:Y,o:Y,d(o){o&&h(e)}}}function Ze(a){let e,o;return e=new C({props:{$$slots:{default:[et]},$$scope:{ctx:a}}}),e.$on("click",function(){j(a[30])&&a[30].apply(this,arguments)}),{c(){v(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,n){R(e,t,n),o=!0},p(t,n){a=t;const l={};n[1]&2&&(l.$$scope={dirty:n,ctx:a}),e.$set(l)},i(t){o||(p(e.$$.fragment,t),o=!0)},o(t){m(e.$$.fragment,t),o=!1},d(t){y(e,t)}}}function xe(a){let e,o,t,n;return e=new C({props:{$$slots:{default:[tt]},$$scope:{ctx:a}}}),e.$on("click",function(){j(a[29])&&a[29].apply(this,arguments)}),t=new C({props:{$$slots:{default:[ot]},$$scope:{ctx:a}}}),t.$on("click",function(){j(a[28])&&a[28].apply(this,arguments)}),{c(){v(e.$$.fragment),o=z(),v(t.$$.fragment)},l(l){D(e.$$.fragment,l),o=T(l),D(t.$$.fragment,l)},m(l,r){R(e,l,r),k(l,o,r),R(t,l,r),n=!0},p(l,r){a=l;const s={};r[1]&2&&(s.$$scope={dirty:r,ctx:a}),e.$set(s);const i={};r[1]&2&&(i.$$scope={dirty:r,ctx:a}),t.$set(i)},i(l){n||(p(e.$$.fragment,l),p(t.$$.fragment,l),n=!0)},o(l){m(e.$$.fragment,l),m(t.$$.fragment,l),n=!1},d(l){y(e,l),l&&h(o),y(t,l)}}}function et(a){let e;return{c(){e=P("Stop")},l(o){e=S(o,"Stop")},m(o,t){k(o,e,t)},d(o){o&&h(e)}}}function tt(a){let e;return{c(){e=P("Record")},l(o){e=S(o,"Record")},m(o,t){k(o,e,t)},d(o){o&&h(e)}}}function ot(a){let e;return{c(){e=P("Wipe board")},l(o){e=S(o,"Wipe board")},m(o,t){k(o,e,t)},d(o){o&&h(e)}}}function nt(a){let e,o,t,n;const l=[xe,Ze,Xe],r=[];function s(i,f){return i[3]==="pre_record"?0:i[3]==="mid_record"?1:2}return e=s(a),o=r[e]=l[e](a),{c(){o.c(),t=I()},l(i){o.l(i),t=I()},m(i,f){r[e].m(i,f),k(i,t,f),n=!0},p(i,f){let u=e;e=s(i),e===u?r[e].p(i,f):(U(),m(r[u],1,1,()=>{r[u]=null}),N(),o=r[e],o?o.p(i,f):(o=r[e]=l[e](i),o.c()),p(o,1),o.m(t.parentNode,t))},i(i){n||(p(o),n=!0)},o(i){m(o),n=!1},d(i){r[e].d(i),i&&h(t)}}}function at(a){let e,o;function t(...n){return a[14](a[27],...n)}return e=new We({props:{strokesArray:a[26],currentTime:a[31],$$slots:{default:[nt]},$$scope:{ctx:a}}}),e.$on("stroke-drawn",t),{c(){v(e.$$.fragment)},l(n){D(e.$$.fragment,n)},m(n,l){R(e,n,l),o=!0},p(n,l){a=n;const r={};l[0]&67108864&&(r.strokesArray=a[26]),l[1]&1&&(r.currentTime=a[31]),l[0]&1879048200|l[1]&2&&(r.$$scope={dirty:l,ctx:a}),e.$set(r)},i(n){o||(p(e.$$.fragment,n),o=!0)},o(n){m(e.$$.fragment,n),o=!1},d(n){y(e,n)}}}function de(a){let e,o;return e=new ze({props:{strokesArray:a[26],audioDownloadURL:a[23].audioDownloadURL,$$slots:{default:[rt]},$$scope:{ctx:a}}}),{c(){v(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,n){R(e,t,n),o=!0},p(t,n){const l={};n[0]&67108864&&(l.strokesArray=t[26]),n[0]&8388608&&(l.audioDownloadURL=t[23].audioDownloadURL),n[0]&8388608|n[1]&2&&(l.$$scope={dirty:n,ctx:t}),e.$set(l)},i(t){o||(p(e.$$.fragment,t),o=!0)},o(t){m(e.$$.fragment,t),o=!1},d(t){y(e,t)}}}function lt(a){let e;return{c(){e=P("Revert to board")},l(o){e=S(o,"Revert to board")},m(o,t){k(o,e,t)},d(o){o&&h(e)}}}function rt(a){let e,o;return e=new C({props:{$$slots:{default:[lt]},$$scope:{ctx:a}}}),e.$on("click",function(){j(a[8](a[23]))&&a[8](a[23]).apply(this,arguments)}),{c(){v(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,n){R(e,t,n),o=!0},p(t,n){a=t;const l={};n[1]&2&&(l.$$scope={dirty:n,ctx:a}),e.$set(l)},i(t){o||(p(e.$$.fragment,t),o=!0)},o(t){m(e.$$.fragment,t),o=!1},d(t){y(e,t)}}}function st(a){let e,o,t=a[23]&&fe(a);return{c(){t&&t.c(),e=I()},l(n){t&&t.l(n),e=I()},m(n,l){t&&t.m(n,l),k(n,e,l),o=!0},p(n,l){n[23]?t?(t.p(n,l),l[0]&8388608&&p(t,1)):(t=fe(n),t.c(),p(t,1),t.m(e.parentNode,e)):t&&(U(),m(t,1,1,()=>{t=null}),N())},i(n){o||(p(t),o=!0)},o(n){m(t),o=!1},d(n){t&&t.d(n),n&&h(e)}}}function _e(a,e){let o,t,n;return t=new Ce({props:{dbPath:e[4]+e[20],$$slots:{default:[st,({boardDoc:l,fetchStrokes:r,listenToStrokes:s,strokesArray:i,handleNewlyDrawnStroke:f,deleteAllStrokesFromDb:u})=>({23:l,24:r,25:s,26:i,27:f,28:u}),({boardDoc:l,fetchStrokes:r,listenToStrokes:s,strokesArray:i,handleNewlyDrawnStroke:f,deleteAllStrokesFromDb:u})=>[(l?8388608:0)|(r?16777216:0)|(s?33554432:0)|(i?67108864:0)|(f?134217728:0)|(u?268435456:0)]]},$$scope:{ctx:e}}}),{key:a,first:null,c(){o=I(),v(t.$$.fragment),this.h()},l(l){o=I(),D(t.$$.fragment,l),this.h()},h(){this.first=o},m(l,r){k(l,o,r),R(t,l,r),n=!0},p(l,r){e=l;const s={};r[0]&1&&(s.dbPath=e[4]+e[20]),r[0]&394264591|r[1]&2&&(s.$$scope={dirty:r,ctx:e}),t.$set(s)},i(l){n||(p(t.$$.fragment,l),n=!0)},o(l){m(t.$$.fragment,l),n=!1},d(l){l&&h(o),y(t,l)}}}function it(a){let e;return{c(){e=P("New blackboard")},l(o){e=S(o,"New blackboard")},m(o,t){k(o,e,t)},d(o){o&&h(e)}}}function ft(a){let e,o;return e=new Le({props:{$$slots:{default:[it]},$$scope:{ctx:a}}}),{c(){v(e.$$.fragment)},l(t){D(e.$$.fragment,t)},m(t,n){R(e,t,n),o=!0},p(t,n){const l={};n[1]&2&&(l.$$scope={dirty:n,ctx:t}),e.$set(l)},i(t){o||(p(e.$$.fragment,t),o=!0)},o(t){m(e.$$.fragment,t),o=!1},d(t){y(e,t)}}}function ut(a){let e,o,t=a[0]&&ie(a);return{c(){t&&t.c(),e=I()},l(n){t&&t.l(n),e=I()},m(n,l){t&&t.m(n,l),k(n,e,l),o=!0},p(n,l){n[0]?t?(t.p(n,l),l[0]&1&&p(t,1)):(t=ie(n),t.c(),p(t,1),t.m(e.parentNode,e)):t&&(U(),m(t,1,1,()=>{t=null}),N())},i(n){o||(p(t),o=!0)},o(n){m(t),o=!1},d(n){t&&t.d(n),n&&h(e)}}}async function kt({page:a}){return{props:{classID:a.params.class,roomID:a.params.room}}}function ct(a,e,o){let t,n,l,r,s;q(a,He,c=>o(17,n=c)),q(a,Fe,c=>o(1,l=c)),q(a,Ke,c=>o(2,r=c)),q(a,Ge,c=>o(3,s=c));let{classID:i}=e,{roomID:f}=e,u;const $=`classes/${i}/blackboards/`,w=`classes/${i}/rooms/`;n.uid||qe("/");async function A(c){const{value:g}=c.srcElement;await O(t,{name:g})}async function _(c,g){const{value:B}=c.srcElement,L=E(V(),$+g);await O(L,{description:B})}Be(async()=>{Pe(t,c=>{o(0,u=x({id:c.id},c.data()))})});async function d(){o(0,u=await Te(w+f))}async function b(c,g){console.log("saveVideo(), audioBlob =",c);const B=ne(),L=ae(B,`audio/${le()}`);await Se(L,c);const F=await je(L),ge=E(V(),$+g);await O(ge,{creatorUID:n.uid,creatorPhoneNumber:n.phoneNumber,date:new Date().toISOString(),audioDownloadURL:F,audioRefFullPath:L.fullPath})}async function M({id:c,audioRefFullPath:g}){const B=[],L=E(V(),$+c);if(g){const F=ae(ne(),g);B.push(Ae(F))}B.push(O(L,{creator:W(),creatorPhoneNumber:W(),date:W(),audioDownloadURL:W(),audioRefFullPath:W()})),await Promise.all(B)}async function pe(){const c=le(),g=E(V(),$+c);await Promise.all([Me(g,{}),O(t,{blackboards:Ee(c)})]),await Ve()}const me=c=>A(c),$e=(c,g)=>_(g,c),he=(c,g)=>c(g.detail.newStroke),be=(c,g)=>b(g.detail.audioBlob,c);return a.$$set=c=>{"classID"in c&&o(10,i=c.classID),"roomID"in c&&o(11,f=c.roomID)},a.$$.update=()=>{a.$$.dirty[0]&2048&&(t=E(V(),w+f)),a.$$.dirty[0]&2048&&d()},[u,l,r,s,$,A,_,b,M,pe,i,f,me,$e,he,be]}class wt extends De{constructor(e){super();Re(this,e,ct,ut,ye,{classID:10,roomID:11},null,[-1,-1])}}export{wt as default,kt as load};

var Be=Object.defineProperty;var ae=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var le=(n,e,r)=>e in n?Be(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r,C=(n,e)=>{for(var r in e||(e={}))Ee.call(e,r)&&le(n,r,e[r]);if(ae)for(var r of ae(e))Le.call(e,r)&&le(n,r,e[r]);return n};import{S as Z,i as X,s as x,G as ie,H as ce,I as fe,J as ue,x as _,u as p,U as Me,O as y,N as L,ar as ee,ac as Ne,ax as je,ay as Ce,Z as Fe,Q as Ve,az as Oe,aA as de,D as F,A as me,aB as qe,aa as ze,e as te,j as R,k as z,c as oe,a as re,m as S,n as W,d as g,K as We,W as _e,f as k,o as I,L as He,Y as ne,at as Ge,w as T,v as P,l as U,_ as pe,r as A,aC as Qe,ao as H,aD as he,aE as $e,aF as Je,aG as Ke,aH as Ye,aI as V,b as G,aw as N,a1 as Q,t as O,g as q,M as se}from"../../../chunks/vendor-e4153bd8.js";import{f as Ze,a as Xe}from"../../../chunks/database-3727f2a6.js";import{f as be,j as J,g as xe,u as et,a as tt,c as ot}from"../../../chunks/store-acbdb0b4.js";import{B as rt,D as nt}from"../../../chunks/DoodleVideo-c1ad5f2b.js";import{g as st}from"../../../chunks/canvas-257efe3e.js";import"../../../chunks/singletons-12a22614.js";function at(n,e){let r=document.getElementById(e);return r==null||r.appendChild(n),{destroy(){n.remove()}}}function ge(n,e){let r=new IntersectionObserver(t=>{for(const o of t)if(o.isIntersecting){e(),r.unobserve(n);return}},{root:null,threshold:.2,rootMargin:"0px"});r.observe(n)}const lt=n=>({boardDoc:n&4,isFetchingStrokes:n&2,strokesArray:n&1}),ke=n=>({boardDoc:n[2],fetchStrokes:n[3],listenToStrokes:n[4],isFetchingStrokes:n[1],strokesArray:n[0],handleNewlyDrawnStroke:n[5],deleteAllStrokesFromDb:n[6]});function it(n){let e;const r=n[9].default,t=ie(r,n,n[8],ke);return{c(){t&&t.c()},l(o){t&&t.l(o)},m(o,s){t&&t.m(o,s),e=!0},p(o,[s]){t&&t.p&&(!e||s&263)&&ce(t,r,o,o[8],e?ue(r,o[8],s,lt):fe(o[8]),ke)},i(o){e||(_(t,o),e=!0)},o(o){p(t,o),e=!1},d(o){t&&t.d(o)}}}function we(n){const e=C({id:n.id},n.data());return e.startTime=0,e.endTime=0,n.data().isErasing||(e.endTime+=.5),e}function ct(n,e,r){let{$$slots:t={},$$scope:o}=e,{dbPath:s}=e,a,i=!1,l,c;const f=Me(y(),`${s}/strokes`),$=L(y(),s);ee($,b=>{r(2,l=C({id:b.id},b.data()))}),Ne(()=>{c&&c()});async function u(){r(1,i=!0),r(0,a=await Ze(s+"/strokes"))}async function d(){r(1,i=!0);const b=je(f,Ce("timestamp"));c=ee(b,async w=>{w.docChanges().filter(v=>v.type==="removed").length>0?(r(0,a=[]),await Fe(),w.docs.length>0&&w.docs.forEach(v=>{a.push(we(v))})):(a||(r(1,i=!1),r(0,a=[])),w.docs.length===a.length||w.docChanges().filter(v=>v.type==="added").forEach(v=>{r(0,a=[...a,we(v.doc)])}))})}function h(b){a.push(b);try{Ve(L(y(),`${s}/strokes/${b.id}`),C({timestamp:Oe()},b))}catch(w){alert(w)}}async function j(){const b=[];let w=de(y()),M=0;for(const v of a){M>=500&&(b.push(w.commit()),w=de(y()),M=0);const K=L(y(),`${s}/strokes/${v.id}`);w.delete(K),M+=1}b.push(w.commit()),await Promise.all(b)}return n.$$set=b=>{"dbPath"in b&&r(7,s=b.dbPath),"$$scope"in b&&r(8,o=b.$$scope)},[a,i,l,u,d,h,j,s,o,t]}class ft extends Z{constructor(e){super();X(this,e,ct,it,x,{dbPath:7})}}const ut=n=>({currentTime:n&1}),De=n=>({startRecording:n[1],stopRecording:n[2],currentTime:n[0]});function dt(n){let e;const r=n[4].default,t=ie(r,n,n[3],De);return{c(){t&&t.c()},l(o){t&&t.l(o)},m(o,s){t&&t.m(o,s),e=!0},p(o,[s]){t&&t.p&&(!e||s&9)&&ce(t,r,o,o[3],e?ue(r,o[3],s,ut):fe(o[3]),De)},i(o){e||(_(t,o),e=!0)},o(o){p(t,o),e=!1},d(o){t&&t.d(o)}}}function mt(n,e,r){let t;F(n,be,u=>r(7,t=u));let{$$slots:o={},$$scope:s}=e,a=0,i;me(()=>{window&&(window.MediaRecorder=qe)});const l=ze();let c=null;function f(){return new Promise(async u=>{if(!t){const h=await navigator.mediaDevices.getUserMedia({audio:!0});be.set(h)}const d=t.clone();c=new MediaRecorder(d),c.start(),i=setInterval(()=>r(0,a+=.1),100),l("record-start"),J.set("mid_record"),u()})}function $(){return new Promise((u,d)=>{clearTimeout(i),J.set("post_record"),c.addEventListener("dataavailable",h=>{const j=h.data;l("record-end",{audioBlob:j}),u(),J.set("pre_record")}),c.stop();for(const h of c.stream.getTracks())h.stop()})}return n.$$set=u=>{"$$scope"in u&&r(3,s=u.$$scope)},[a,f,$,s,o]}class _t extends Z{constructor(e){super();X(this,e,mt,dt,x,{})}}function ve(n,e,r){const t=n.slice();return t[19]=e[r],t}function ye(n){let e,r,t,o=[],s=new Map,a,i,l,c;r=new pe({props:{value:n[0].name,class:"room-title",style:"width: 100%; margin-bottom: 20px;"}}),r.$on("input",n[11]);let f=n[0].blackboards;const $=u=>u[19];for(let u=0;u<f.length;u+=1){let d=ve(n,f,u),h=$(d);s.set(h,o[u]=Te(h,d))}return{c(){e=te("div"),R(r.$$.fragment),t=z();for(let u=0;u<o.length;u+=1)o[u].c();this.h()},l(u){e=oe(u,"DIV",{style:!0});var d=re(e);S(r.$$.fragment,d),t=W(d);for(let h=0;h<o.length;h+=1)o[h].l(d);d.forEach(g),this.h()},h(){We(e,"padding","16px"),_e(e,"question",n[0].name.charAt(n[0].name.length-1)==="?")},m(u,d){k(u,e,d),I(r,e,null),He(e,t);for(let h=0;h<o.length;h+=1)o[h].m(e,null);i=!0,l||(c=ne(a=at.call(null,e,"main-content")),l=!0)},p(u,d){const h={};d[0]&1&&(h.value=u[0].name),r.$set(h),d[0]&2076180959&&(f=u[0].blackboards,A(),o=Ge(o,d,$,1,u,f,s,e,Qe,Te,null,ve),T()),d[0]&1&&_e(e,"question",u[0].name.charAt(u[0].name.length-1)==="?")},i(u){if(!i){_(r.$$.fragment,u);for(let d=0;d<f.length;d+=1)_(o[d]);i=!0}},o(u){p(r.$$.fragment,u);for(let d=0;d<o.length;d+=1)p(o[d]);i=!1},d(u){u&&g(e),P(r);for(let d=0;d<o.length;d+=1)o[d].d();l=!1,c()}}}function Re(n){let e,r,t,o,s,a=n[25]&&Se(n);const i=[ht,pt],l=[];function c(f,$){return f[22].audioDownloadURL?0:1}return r=c(n),t=l[r]=i[r](n),{c(){a&&a.c(),e=z(),t.c(),o=U()},l(f){a&&a.l(f),e=W(f),t.l(f),o=U()},m(f,$){a&&a.m(f,$),k(f,e,$),l[r].m(f,$),k(f,o,$),s=!0},p(f,$){f[25]?a?(a.p(f,$),$[0]&33554432&&_(a,1)):(a=Se(f),a.c(),_(a,1),a.m(e.parentNode,e)):a&&(A(),p(a,1,1,()=>{a=null}),T());let u=r;r=c(f),r===u?l[r].p(f,$):(A(),p(l[u],1,1,()=>{l[u]=null}),T(),t=l[r],t?t.p(f,$):(t=l[r]=i[r](f),t.c()),_(t,1),t.m(o.parentNode,o))},i(f){s||(_(a),_(t),s=!0)},o(f){p(a),p(t),s=!1},d(f){a&&a.d(f),f&&g(e),l[r].d(f),f&&g(o)}}}function Se(n){let e,r;function t(...o){return n[12](n[19],...o)}return e=new pe({props:{textarea:!0,value:n[22].description||"",style:`width: ${n[1]}px; margin-bottom: 10px`}}),e.$on("input",t),{c(){R(e.$$.fragment)},l(o){S(e.$$.fragment,o)},m(o,s){I(e,o,s),r=!0},p(o,s){n=o;const a={};s[0]&4194304&&(a.value=n[22].description||""),s[0]&2&&(a.style=`width: ${n[1]}px; margin-bottom: 10px`),e.$set(a)},i(o){r||(_(e.$$.fragment,o),r=!0)},o(o){p(e.$$.fragment,o),r=!1},d(o){P(e,o)}}}function pt(n){let e,r,t,o,s,a,i=n[25]&&Ie(n);return{c(){e=te("div"),i&&i.c(),this.h()},l(l){e=oe(l,"DIV",{style:!0});var c=re(e);i&&i.l(c),c.forEach(g),this.h()},h(){G(e,"style",r=`width: 100%; height: ${n[2]+80}px`)},m(l,c){k(l,e,c),i&&i.m(e,null),o=!0,s||(a=ne(t=ge.call(null,e,n[24])),s=!0)},p(l,c){l[25]?i?(i.p(l,c),c[0]&33554432&&_(i,1)):(i=Ie(l),i.c(),_(i,1),i.m(e,null)):i&&(A(),p(i,1,1,()=>{i=null}),T()),(!o||c[0]&4&&r!==(r=`width: 100%; height: ${l[2]+80}px`))&&G(e,"style",r),t&&N(t.update)&&c[0]&16777216&&t.update.call(null,l[24])},i(l){o||(_(i),o=!0)},o(l){p(i),o=!1},d(l){l&&g(e),i&&i.d(),s=!1,a()}}}function ht(n){let e,r,t,o,s,a,i=n[25]&&Pe(n);return{c(){e=te("div"),i&&i.c(),this.h()},l(l){e=oe(l,"DIV",{style:!0});var c=re(e);i&&i.l(c),c.forEach(g),this.h()},h(){G(e,"style",r=`width: 100%; height: ${n[2]+80}px`)},m(l,c){k(l,e,c),i&&i.m(e,null),o=!0,s||(a=ne(t=ge.call(null,e,n[23])),s=!0)},p(l,c){l[25]?i?(i.p(l,c),c[0]&33554432&&_(i,1)):(i=Pe(l),i.c(),_(i,1),i.m(e,null)):i&&(A(),p(i,1,1,()=>{i=null}),T()),(!o||c[0]&4&&r!==(r=`width: 100%; height: ${l[2]+80}px`))&&G(e,"style",r),t&&N(t.update)&&c[0]&8388608&&t.update.call(null,l[23])},i(l){o||(_(i),o=!0)},o(l){p(i),o=!1},d(l){l&&g(e),i&&i.d(),s=!1,a()}}}function Ie(n){let e,r;function t(...o){return n[14](n[19],...o)}return e=new _t({props:{$$slots:{default:[yt,({startRecording:o,stopRecording:s,currentTime:a})=>({28:o,29:s,30:a}),({startRecording:o,stopRecording:s,currentTime:a})=>[(o?268435456:0)|(s?536870912:0)|(a?1073741824:0)]]},$$scope:{ctx:n}}}),e.$on("record-end",t),{c(){R(e.$$.fragment)},l(o){S(e.$$.fragment,o)},m(o,s){I(e,o,s),r=!0},p(o,s){n=o;const a={};s[0]&2046820360|s[1]&1&&(a.$$scope={dirty:s,ctx:n}),e.$set(a)},i(o){r||(_(e.$$.fragment,o),r=!0)},o(o){p(e.$$.fragment,o),r=!1},d(o){P(e,o)}}}function $t(n){let e;return{c(){e=O("Uploading...")},l(r){e=q(r,"Uploading...")},m(r,t){k(r,e,t)},p:se,i:se,o:se,d(r){r&&g(e)}}}function bt(n){let e,r;return e=new Q({props:{$$slots:{default:[kt]},$$scope:{ctx:n}}}),e.$on("click",function(){N(n[29])&&n[29].apply(this,arguments)}),{c(){R(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,o){I(e,t,o),r=!0},p(t,o){n=t;const s={};o[1]&1&&(s.$$scope={dirty:o,ctx:n}),e.$set(s)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){p(e.$$.fragment,t),r=!1},d(t){P(e,t)}}}function gt(n){let e,r,t,o;return e=new Q({props:{$$slots:{default:[wt]},$$scope:{ctx:n}}}),e.$on("click",function(){N(n[28])&&n[28].apply(this,arguments)}),t=new Q({props:{$$slots:{default:[Dt]},$$scope:{ctx:n}}}),t.$on("click",function(){N(n[27])&&n[27].apply(this,arguments)}),{c(){R(e.$$.fragment),r=z(),R(t.$$.fragment)},l(s){S(e.$$.fragment,s),r=W(s),S(t.$$.fragment,s)},m(s,a){I(e,s,a),k(s,r,a),I(t,s,a),o=!0},p(s,a){n=s;const i={};a[1]&1&&(i.$$scope={dirty:a,ctx:n}),e.$set(i);const l={};a[1]&1&&(l.$$scope={dirty:a,ctx:n}),t.$set(l)},i(s){o||(_(e.$$.fragment,s),_(t.$$.fragment,s),o=!0)},o(s){p(e.$$.fragment,s),p(t.$$.fragment,s),o=!1},d(s){P(e,s),s&&g(r),P(t,s)}}}function kt(n){let e;return{c(){e=O("Stop")},l(r){e=q(r,"Stop")},m(r,t){k(r,e,t)},d(r){r&&g(e)}}}function wt(n){let e;return{c(){e=O("Record")},l(r){e=q(r,"Record")},m(r,t){k(r,e,t)},d(r){r&&g(e)}}}function Dt(n){let e;return{c(){e=O("Wipe board")},l(r){e=q(r,"Wipe board")},m(r,t){k(r,e,t)},d(r){r&&g(e)}}}function vt(n){let e,r,t,o;const s=[gt,bt,$t],a=[];function i(l,c){return l[3]==="pre_record"?0:l[3]==="mid_record"?1:2}return e=i(n),r=a[e]=s[e](n),{c(){r.c(),t=U()},l(l){r.l(l),t=U()},m(l,c){a[e].m(l,c),k(l,t,c),o=!0},p(l,c){let f=e;e=i(l),e===f?a[e].p(l,c):(A(),p(a[f],1,1,()=>{a[f]=null}),T(),r=a[e],r?r.p(l,c):(r=a[e]=s[e](l),r.c()),_(r,1),r.m(t.parentNode,t))},i(l){o||(_(r),o=!0)},o(l){p(r),o=!1},d(l){a[e].d(l),l&&g(t)}}}function yt(n){let e,r;function t(...o){return n[13](n[26],...o)}return e=new rt({props:{strokesArray:n[25],currentTime:n[30],$$slots:{default:[vt]},$$scope:{ctx:n}}}),e.$on("stroke-drawn",t),{c(){R(e.$$.fragment)},l(o){S(e.$$.fragment,o)},m(o,s){I(e,o,s),r=!0},p(o,s){n=o;const a={};s[0]&33554432&&(a.strokesArray=n[25]),s[0]&1073741824&&(a.currentTime=n[30]),s[0]&939524104|s[1]&1&&(a.$$scope={dirty:s,ctx:n}),e.$set(a)},i(o){r||(_(e.$$.fragment,o),r=!0)},o(o){p(e.$$.fragment,o),r=!1},d(o){P(e,o)}}}function Pe(n){let e,r;return e=new nt({props:{strokesArray:n[25],audioDownloadURL:n[22].audioDownloadURL,$$slots:{default:[St]},$$scope:{ctx:n}}}),{c(){R(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,o){I(e,t,o),r=!0},p(t,o){const s={};o[0]&33554432&&(s.strokesArray=t[25]),o[0]&4194304&&(s.audioDownloadURL=t[22].audioDownloadURL),o[0]&4194304|o[1]&1&&(s.$$scope={dirty:o,ctx:t}),e.$set(s)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){p(e.$$.fragment,t),r=!1},d(t){P(e,t)}}}function Rt(n){let e;return{c(){e=O("Revert to board")},l(r){e=q(r,"Revert to board")},m(r,t){k(r,e,t)},d(r){r&&g(e)}}}function St(n){let e,r;return e=new Q({props:{$$slots:{default:[Rt]},$$scope:{ctx:n}}}),e.$on("click",function(){N(n[8](n[22]))&&n[8](n[22]).apply(this,arguments)}),{c(){R(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,o){I(e,t,o),r=!0},p(t,o){n=t;const s={};o[1]&1&&(s.$$scope={dirty:o,ctx:n}),e.$set(s)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){p(e.$$.fragment,t),r=!1},d(t){P(e,t)}}}function It(n){let e,r,t=n[22]&&Re(n);return{c(){t&&t.c(),e=z()},l(o){t&&t.l(o),e=W(o)},m(o,s){t&&t.m(o,s),k(o,e,s),r=!0},p(o,s){o[22]?t?(t.p(o,s),s[0]&4194304&&_(t,1)):(t=Re(o),t.c(),_(t,1),t.m(e.parentNode,e)):t&&(A(),p(t,1,1,()=>{t=null}),T())},i(o){r||(_(t),r=!0)},o(o){p(t),r=!1},d(o){t&&t.d(o),o&&g(e)}}}function Te(n,e){let r,t,o;return t=new ft({props:{dbPath:e[4]+e[19],$$slots:{default:[It,({boardDoc:s,fetchStrokes:a,listenToStrokes:i,strokesArray:l,handleNewlyDrawnStroke:c,deleteAllStrokesFromDb:f})=>({22:s,23:a,24:i,25:l,26:c,27:f}),({boardDoc:s,fetchStrokes:a,listenToStrokes:i,strokesArray:l,handleNewlyDrawnStroke:c,deleteAllStrokesFromDb:f})=>[(s?4194304:0)|(a?8388608:0)|(i?16777216:0)|(l?33554432:0)|(c?67108864:0)|(f?134217728:0)]]},$$scope:{ctx:e}}}),{key:n,first:null,c(){r=U(),R(t.$$.fragment),this.h()},l(s){r=U(),S(t.$$.fragment,s),this.h()},h(){this.first=r},m(s,a){k(s,r,a),I(t,s,a),o=!0},p(s,a){e=s;const i={};a[0]&1&&(i.dbPath=e[4]+e[19]),a[0]&197132303|a[1]&1&&(i.$$scope={dirty:a,ctx:e}),t.$set(i)},i(s){o||(_(t.$$.fragment,s),o=!0)},o(s){p(t.$$.fragment,s),o=!1},d(s){s&&g(r),P(t,s)}}}function Pt(n){let e,r,t=n[0]&&ye(n);return{c(){t&&t.c(),e=U()},l(o){t&&t.l(o),e=U()},m(o,s){t&&t.m(o,s),k(o,e,s),r=!0},p(o,s){o[0]?t?(t.p(o,s),s[0]&1&&_(t,1)):(t=ye(o),t.c(),_(t,1),t.m(e.parentNode,e)):t&&(A(),p(t,1,1,()=>{t=null}),T())},i(o){r||(_(t),r=!0)},o(o){p(t),r=!1},d(o){t&&t.d(o),o&&g(e)}}}async function jt({page:n}){return{props:{classID:n.params.class,roomID:n.params.room}}}function Tt(n,e,r){let t,o,s,a,i;F(n,et,m=>r(16,o=m)),F(n,tt,m=>r(1,s=m)),F(n,ot,m=>r(2,a=m)),F(n,J,m=>r(3,i=m));let{classID:l}=e,{roomID:c}=e,f;const $=`classes/${l}/blackboards/`,u=`classes/${l}/rooms/`;o.uid||st("/");async function d(m){const{value:D}=m.srcElement;await H(t,{name:D})}async function h(m,D){const{value:B}=m.srcElement,E=L(y(),$+D);await H(E,{description:B})}me(async()=>{ee(t,m=>{r(0,f=C({id:m.id},m.data()))})});async function j(){r(0,f=await Xe(u+c))}async function b(m,D){console.log("saveVideo(), audioBlob =",m);const B=he(),E=$e(B,`audio/${xe()}`);await Je(E,m);const Y=await Ke(E),Ae=L(y(),$+D);await H(Ae,{creatorUID:o.uid,creatorPhoneNumber:o.phoneNumber,date:new Date().toISOString(),audioDownloadURL:Y,audioRefFullPath:E.fullPath})}async function w({id:m,audioRefFullPath:D}){const B=[],E=L(y(),$+m);if(D){const Y=$e(he(),D);B.push(Ye(Y))}B.push(H(E,{creator:V(),creatorPhoneNumber:V(),date:V(),audioDownloadURL:V(),audioRefFullPath:V()})),await Promise.all(B)}const M=m=>d(m),v=(m,D)=>h(D,m),K=(m,D)=>m(D.detail.newStroke),Ue=(m,D)=>b(D.detail.audioBlob,m);return n.$$set=m=>{"classID"in m&&r(9,l=m.classID),"roomID"in m&&r(10,c=m.roomID)},n.$$.update=()=>{n.$$.dirty[0]&1024&&(t=L(y(),u+c)),n.$$.dirty[0]&1024&&j()},[f,s,a,i,$,d,h,b,w,l,c,M,v,K,Ue]}class Ct extends Z{constructor(e){super();X(this,e,Tt,Pt,x,{classID:9,roomID:10},null,[-1,-1])}}export{Ct as default,jt as load};

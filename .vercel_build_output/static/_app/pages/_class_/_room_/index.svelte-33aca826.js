var ln=Object.defineProperty;var gt=Object.getOwnPropertySymbols;var sn=Object.prototype.hasOwnProperty,an=Object.prototype.propertyIsEnumerable;var bt=(o,e,t)=>e in o?ln(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,Se=(o,e)=>{for(var t in e||(e={}))sn.call(e,t)&&bt(o,t,e[t]);if(gt)for(var t of gt(e))an.call(e,t)&&bt(o,t,e[t]);return o};import{S as fe,i as de,s as me,aI as un,k as F,e as V,n as W,c as B,b as P,M as b,W as cn,aH as pe,f as v,a2 as te,aL as ge,t as L,a as A,aM as be,d as h,g as E,N as U,ak as $t,I as $e,j as M,m as O,o as z,aJ as fn,aK as dn,h as ne,J as ke,K as we,L as ve,x as I,u as R,v as j,F as J,r as le,w as se,a3 as kt,a4 as ut,A as wt,Z as Oe,O as re,ae as mn,a5 as Ce,ai as pn,al as ze,aN as Pe,aO as _n,aE as _e,a8 as je,Q as H,a9 as ct,aa as vt,a6 as ft,aP as hn,T as yt,P as K,aQ as gn,a7 as Dt,aR as bn,_ as G,V as It,aF as $n,l as Z,aS as kn,aG as wn,aT as vn,aA as dt,az as mt,aU as Rt,aV as Tt,aW as ye,aB as yn,aC as Dn,aX as In,ab as Rn,ay as Tn,aj as Sn,aY as Cn,ar as Pn,X as Fe,ad as St,aZ as Un}from"../../../chunks/vendor-e2c30920.js";import{R as Ln,a as En,D as An}from"../../../chunks/RenderlessFetchStrokes-6693052c.js";import{_ as Nn}from"../../../chunks/preload-helper-ec9aa979.js";import{o as pt,u as _t,f as We,a as Ct,c as Pt,g as Qe,e as Vn,d as Bn,j as De,b as Mn,w as Ut}from"../../../chunks/store-b8ea9b61.js";/* empty css                                                                */import{d as qe,r as On,a as zn}from"../../../chunks/canvas-9dadfeb6.js";import{g as jn}from"../../../chunks/navigation-51f4a605.js";import"../../../chunks/singletons-12a22614.js";const Fn=o=>({}),Lt=o=>({});function Et(o,e,t){const n=o.slice();return n[8]=e[t],n}function At(o){let e,t,n,r,l,s=o[1].pencilColors,a=[];for(let c=0;c<s.length;c+=1)a[c]=Nt(Et(o,s,c));return{c(){for(let c=0;c<a.length;c+=1)a[c].c();e=F(),t=V("img"),this.h()},l(c){for(let u=0;u<a.length;u+=1)a[u].l(c);e=W(c),t=B(c,"IMG",{width:!0,height:!0,style:!0,src:!0,alt:!0,class:!0}),this.h()},h(){P(t,"width","46"),P(t,"height","40"),b(t,"margin-left","8px"),b(t,"margin-right","8px"),cn(t.src,n="https://i.imgur.com/Klln1yP.png")||P(t,"src",n),P(t,"alt","eraser"),P(t,"class","svelte-1bgxyxs"),pe(t,"eraser-selected",o[2].type==="eraser")},m(c,u){for(let f=0;f<a.length;f+=1)a[f].m(c,u);v(c,e,u),v(c,t,u),r||(l=te(t,"click",o[7]),r=!0)},p(c,u){if(u&6){s=c[1].pencilColors;let f;for(f=0;f<s.length;f+=1){const i=Et(c,s,f);a[f]?a[f].p(i,u):(a[f]=Nt(i),a[f].c(),a[f].m(e.parentNode,e))}for(;f<a.length;f+=1)a[f].d(1);a.length=s.length}u&4&&pe(t,"eraser-selected",c[2].type==="eraser")},d(c){$t(a,c),c&&h(e),c&&h(t),r=!1,l()}}}function Nt(o){let e,t,n,r,l,s,a,c,u,f,i,_;function m(){return o[6](o[8])}return{c(){e=V("div"),t=ge("svg"),n=ge("g"),r=ge("path"),l=L(`;\r
            `),s=ge("polygon"),c=ge("path"),u=ge("path"),this.h()},l(d){e=B(d,"DIV",{style:!0,class:!0});var p=A(e);t=be(p,"svg",{preserveAspectRatio:!0,version:!0,id:!0,xmlns:!0,"xmlns:xlink":!0,x:!0,y:!0,width:!0,height:!0,viewBox:!0,style:!0,"xml:space":!0,class:!0});var $=A(t);n=be($,"g",{});var w=A(n);r=be(w,"path",{d:!0}),A(r).forEach(h),l=E(w,`;\r
            `),s=be(w,"polygon",{style:!0,points:!0}),A(s).forEach(h),c=be(w,"path",{style:!0,d:!0}),A(c).forEach(h),u=be(w,"path",{style:!0,d:!0}),A(u).forEach(h),w.forEach(h),$.forEach(h),p.forEach(h),this.h()},h(){P(r,"d",`M0,0v72.377c0,1.588,0.234,3.169,0.698,4.706l45.416,150.032C46.633,228.828,48.212,230,50,230s3.367-1.172,3.886-2.883\r
              L99.31,77.079c0.457-1.525,0.69-3.108,0.69-4.702V0.002`),P(s,"style",a=`fill: ${o[8]};`),P(s,"points","50,211.978 38.879,175.24 61.122,175.24"),b(c,"fill","#424242"),P(c,"d",`M63.581,167.118H36.42L8.765,75.761l10.924-9.63l12.5,11.015c1.54,1.353,3.835,1.35,5.375-0.002\r
                l12.468-11.007l12.464,11.005c1.54,1.357,3.839,1.357,5.377,0l12.465-11.005l10.9,9.623L63.581,167.118z`),P(u,"style",f=`fill: ${o[8]};`),P(u,"d",`M91.878,0v65.486l-8.852-7.813c-1.539-1.353-3.838-1.354-5.377,0.002L65.185,68.679L52.72,57.674\r
                c-1.539-1.356-3.838-1.354-5.377-0.002L34.871,68.683L22.375,57.67c-0.769-0.676-1.725-1.013-2.685-1.013\r
                c-0.959,0-1.919,0.339-2.685,1.013L8.121,65.5L8.098,0.024L91.878,0z`),P(t,"preserveAspectRatio","none"),P(t,"version","1.1"),P(t,"id","Layer_1"),P(t,"xmlns","http://www.w3.org/2000/svg"),P(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),P(t,"x","0px"),P(t,"y","0px"),P(t,"width","16px"),P(t,"height","30px"),P(t,"viewBox","0 0 100 230"),b(t,"enable-background","new 0 0 100 230"),P(t,"xml:space","preserve"),P(t,"class","svelte-1bgxyxs"),b(e,"margin","0 4px"),b(e,"width","30px"),b(e,"height","42px"),b(e,"border-radius","3px"),b(e,"align-items","center"),b(e,"display","flex"),b(e,"justify-content","center"),P(e,"class","svelte-1bgxyxs"),pe(e,"pencil-selected",o[2].color===o[8])},m(d,p){v(d,e,p),U(e,t),U(t,n),U(n,r),U(n,l),U(n,s),U(n,c),U(n,u),i||(_=te(e,"click",m),i=!0)},p(d,p){o=d,p&2&&a!==(a=`fill: ${o[8]};`)&&P(s,"style",a),p&2&&f!==(f=`fill: ${o[8]};`)&&P(u,"style",f),p&6&&pe(e,"pencil-selected",o[2].color===o[8])},d(d){d&&h(e),i=!1,_()}}}function Wn(o){let e,t,n,r,l,s=(o[0]?"No touch":"Touch draw")+"",a,c,u=Object.keys(o[1]).length>0,f,i,_,m,d;n=new un({props:{icons:!1,checked:!o[0],style:"margin: 0 !important"}});let p=u&&At(o);const $=o[5].default,w=$e($,o,o[4],null),Q=o[5]["dropdown-menu"],C=$e(Q,o,o[4],Lt);return{c(){e=V("div"),t=V("div"),M(n.$$.fragment),r=F(),l=V("div"),a=L(s),c=F(),p&&p.c(),f=F(),w&&w.c(),i=F(),C&&C.c(),this.h()},l(T){e=B(T,"DIV",{style:!0});var y=A(e);t=B(y,"DIV",{style:!0});var S=A(t);O(n.$$.fragment,S),r=W(S),l=B(S,"DIV",{style:!0});var N=A(l);a=E(N,s),N.forEach(h),S.forEach(h),c=W(y),p&&p.l(y),f=W(y),w&&w.l(y),i=W(y),C&&C.l(y),y.forEach(h),this.h()},h(){b(l,"margin-top","1px"),b(l,"margin-left","1px"),b(l,"font-size","0.52rem"),b(l,"font-family","Roboto,sans-serif"),b(l,"color","white"),b(t,"margin-right","10px"),b(t,"text-align","center"),b(e,"position","absolute"),b(e,"display","flex"),b(e,"align-items","center"),b(e,"height","50px"),b(e,"left","0"),b(e,"right","auto"),b(e,"top","0"),b(e,"bottom","auto"),b(e,"z-index","2"),b(e,"background-color","grey"),b(e,"padding-left","10px"),b(e,"border-radius","2px")},m(T,y){v(T,e,y),U(e,t),z(n,t,null),U(t,r),U(t,l),U(l,a),U(e,c),p&&p.m(e,null),U(e,f),w&&w.m(e,null),U(e,i),C&&C.m(e,null),_=!0,m||(d=te(t,"click",fn(dn(o[3]))),m=!0)},p(T,[y]){const S={};y&1&&(S.checked=!T[0]),n.$set(S),(!_||y&1)&&s!==(s=(T[0]?"No touch":"Touch draw")+"")&&ne(a,s),y&2&&(u=Object.keys(T[1]).length>0),u?p?p.p(T,y):(p=At(T),p.c(),p.m(e,f)):p&&(p.d(1),p=null),w&&w.p&&(!_||y&16)&&ke(w,$,T,T[4],_?ve($,T[4],y,null):we(T[4]),null),C&&C.p&&(!_||y&16)&&ke(C,Q,T,T[4],_?ve(Q,T[4],y,Fn):we(T[4]),Lt)},i(T){_||(I(n.$$.fragment,T),I(w,T),I(C,T),_=!0)},o(T){R(n.$$.fragment,T),R(w,T),R(C,T),_=!1},d(T){T&&h(e),j(n),p&&p.d(),w&&w.d(T),C&&C.d(T),m=!1,d()}}}function Qn(o,e,t){let n,r,l;J(o,pt,i=>t(0,n=i)),J(o,_t,i=>t(1,r=i)),J(o,We,i=>t(2,l=i));let{$$slots:s={},$$scope:a}=e;function c(){pt.set(!n)}const u=i=>We.set({type:"pencil",color:i,lineWidth:3}),f=()=>We.set({type:"eraser",color:"",lineWidth:32});return o.$$set=i=>{"$$scope"in i&&t(4,a=i.$$scope)},[n,r,l,c,a,s,u,f]}class qn extends fe{constructor(e){super();de(this,e,Qn,Wn,me,{})}}function Vt(o){let e,t;return e=new qn({props:{$$slots:{"dropdown-menu":[to],default:[Hn]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment)},l(n){O(e.$$.fragment,n)},m(n,r){z(e,n,r),t=!0},p(n,r){const l={};r[0]&536871694&&(l.$$scope={dirty:r,ctx:n}),e.$set(l)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){R(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Hn(o){let e;const t=o[22].default,n=$e(t,o,o[29],null);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,l){n&&n.m(r,l),e=!0},p(r,l){n&&n.p&&(!e||l[0]&536870912)&&ke(n,t,r,r[29],e?ve(t,r[29],l,null):we(r[29]),null)},i(r){e||(I(n,r),e=!0)},o(r){R(n,r),e=!1},d(r){n&&n.d(r)}}}function Bt(o){let e,t,n,r;return{c(){e=V("span"),t=L("more_vert"),this.h()},l(l){e=B(l,"SPAN",{class:!0,style:!0});var s=A(e);t=E(s,"more_vert"),s.forEach(h),this.h()},h(){P(e,"class","material-icons"),b(e,"margin-right","10px"),b(e,"color","white"),b(e,"font-size","2rem")},m(l,s){v(l,e,s),U(e,t),n||(r=te(e,"click",o[23]),n=!0)},p:re,d(l){l&&h(e),n=!1,r()}}}function Xn(o){let e,t;return e=new ze({props:{$$slots:{default:[Kn]},$$scope:{ctx:o}}}),e.$on("click",o[10]),{c(){M(e.$$.fragment)},l(n){O(e.$$.fragment,n)},m(n,r){z(e,n,r),t=!0},p(n,r){const l={};r[0]&536870912&&(l.$$scope={dirty:r,ctx:n}),e.$set(l)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){R(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Yn(o){let e,t;return e=new ze({props:{$$slots:{default:[Gn]},$$scope:{ctx:o}}}),e.$on("click",o[12]),{c(){M(e.$$.fragment)},l(n){O(e.$$.fragment,n)},m(n,r){z(e,n,r),t=!0},p(n,r){const l={};r[0]&536870912&&(l.$$scope={dirty:r,ctx:n}),e.$set(l)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){R(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Kn(o){let e;return{c(){e=L("Set background")},l(t){e=E(t,"Set background")},m(t,n){v(t,e,n)},d(t){t&&h(e)}}}function Gn(o){let e;return{c(){e=L("Remove background")},l(t){e=E(t,"Remove background")},m(t,n){v(t,e,n)},d(t){t&&h(e)}}}function Jn(o){let e;return{c(){e=L("Wipe board")},l(t){e=E(t,"Wipe board")},m(t,n){v(t,e,n)},d(t){t&&h(e)}}}function Zn(o){let e;return{c(){e=L("Delete board")},l(t){e=E(t,"Delete board")},m(t,n){v(t,e,n)},d(t){t&&h(e)}}}function xn(o){let e,t,n,r,l,s,a;const c=[Yn,Xn],u=[];function f(i,_){return i[2]?0:1}return e=f(o),t=u[e]=c[e](o),r=new ze({props:{$$slots:{default:[Jn]},$$scope:{ctx:o}}}),r.$on("SMUI:action",o[13]),s=new ze({props:{$$slots:{default:[Zn]},$$scope:{ctx:o}}}),s.$on("SMUI:action",o[14]),{c(){t.c(),n=F(),M(r.$$.fragment),l=F(),M(s.$$.fragment)},l(i){t.l(i),n=W(i),O(r.$$.fragment,i),l=W(i),O(s.$$.fragment,i)},m(i,_){u[e].m(i,_),v(i,n,_),z(r,i,_),v(i,l,_),z(s,i,_),a=!0},p(i,_){let m=e;e=f(i),e===m?u[e].p(i,_):(le(),R(u[m],1,1,()=>{u[m]=null}),se(),t=u[e],t?t.p(i,_):(t=u[e]=c[e](i),t.c()),I(t,1),t.m(n.parentNode,n));const d={};_[0]&536870912&&(d.$$scope={dirty:_,ctx:i}),r.$set(d);const p={};_[0]&536870912&&(p.$$scope={dirty:_,ctx:i}),s.$set(p)},i(i){a||(I(t),I(r.$$.fragment,i),I(s.$$.fragment,i),a=!0)},o(i){R(t),R(r.$$.fragment,i),R(s.$$.fragment,i),a=!1},d(i){u[e].d(i),i&&h(n),j(r,i),i&&h(l),j(s,i)}}}function eo(o){let e,t;return e=new pn({props:{$$slots:{default:[xn]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment)},l(n){O(e.$$.fragment,n)},m(n,r){z(e,n,r),t=!0},p(n,r){const l={};r[0]&536870916&&(l.$$scope={dirty:r,ctx:n}),e.$set(l)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){R(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function to(o){let e,t,n,r,l,s,a,c,u=(o[3]==="pre_record"||o[1]===0)&&Bt(o),f={style:"width: 300px",$$slots:{default:[eo]},$$scope:{ctx:o}};return l=new mn({props:f}),o[26](l),{c(){e=V("div"),u&&u.c(),t=F(),n=V("input"),r=F(),M(l.$$.fragment),this.h()},l(i){e=B(i,"DIV",{slot:!0});var _=A(e);u&&u.l(_),t=W(_),n=B(_,"INPUT",{style:!0,type:!0,accept:!0}),r=W(_),O(l.$$.fragment,_),_.forEach(h),this.h()},h(){b(n,"display","none"),P(n,"type","file"),P(n,"accept","image/gif, image/jpeg, image/png"),P(e,"slot","dropdown-menu")},m(i,_){v(i,e,_),u&&u.m(e,null),U(e,t),U(e,n),o[24](n),U(e,r),z(l,e,null),s=!0,a||(c=te(n,"change",o[25]),a=!0)},p(i,_){i[3]==="pre_record"||i[1]===0?u?u.p(i,_):(u=Bt(i),u.c(),u.m(e,t)):u&&(u.d(1),u=null);const m={};_[0]&536870916&&(m.$$scope={dirty:_,ctx:i}),l.$set(m)},i(i){s||(I(l.$$.fragment,i),s=!0)},o(i){R(l.$$.fragment,i),s=!1},d(i){i&&h(e),u&&u.d(),o[24](null),o[26](null),j(l),a=!1,c()}}}function no(o){let e,t,n,r,l,s,a,c,u,f=o[0]&&Vt(o);return{c(){f&&f.c(),e=F(),t=V("canvas"),r=F(),l=V("canvas"),this.h()},l(i){f&&f.l(i),e=W(i),t=B(i,"CANVAS",{style:!0});var _=A(t);_.forEach(h),r=W(i),l=B(i,"CANVAS",{style:!0});var m=A(l);m.forEach(h),this.h()},h(){P(t,"style",n=`position: absolute; z-index: 1; margin-top: 0; margin-left: 0; width: ${o[7]}px; height: ${o[6]}px`),P(l,"style",s=`position: absolute;
  top: 0;
  left: 0;
  z-index: 0;
  display: block;
  background-color: rgb(46, 49, 49); width: ${o[7]}px; height: ${o[6]}px`)},m(i,_){f&&f.m(i,_),v(i,e,_),v(i,t,_),o[27](t),v(i,r,_),v(i,l,_),o[28](l),a=!0,c||(u=[te(t,"touchstart",o[15]),te(t,"touchmove",o[16]),te(t,"touchend",o[17])],c=!0)},p(i,_){i[0]?f?(f.p(i,_),_[0]&1&&I(f,1)):(f=Vt(i),f.c(),I(f,1),f.m(e.parentNode,e)):f&&(le(),R(f,1,1,()=>{f=null}),se()),(!a||_[0]&192&&n!==(n=`position: absolute; z-index: 1; margin-top: 0; margin-left: 0; width: ${i[7]}px; height: ${i[6]}px`))&&P(t,"style",n),(!a||_[0]&192&&s!==(s=`position: absolute;
  top: 0;
  left: 0;
  z-index: 0;
  display: block;
  background-color: rgb(46, 49, 49); width: ${i[7]}px; height: ${i[6]}px`))&&P(l,"style",s)},i(i){a||(I(f),a=!0)},o(i){R(f),a=!1},d(i){f&&f.d(i),i&&h(e),i&&h(t),o[27](null),i&&h(r),i&&h(l),o[28](null),c=!1,kt(u)}}}function oo(o){return(o.endTime-o.startTime)/o.points.length}function ro(o,e,t){let n,r,l,s;J(o,Ct,k=>t(6,n=k)),J(o,Pt,k=>t(7,r=k)),J(o,We,k=>t(33,l=k)),J(o,pt,k=>t(34,s=k));let{$$slots:a={},$$scope:c}=e,{strokesArray:u}=e,{currentTime:f=0}=e,{backgroundImageDownloadURL:i=""}=e,{recordState:_=""}=e;const m=ut();let d,p,$,w,Q=[],C=!1,T={x:-1,y:-1},y={points:[]},S,N,Y;wt(()=>{t(18,d=$.getContext("2d")),t(19,p=w.getContext("2d")),window.addEventListener("popstate",Le),window.onbeforeunload=function(k){_==="mid_record"&&(k.returnValue="")}}),Oe(()=>{window.removeEventListener("popstate",Le)});function Le(){_==="mid_record"&&(confirm("This will interrupt your current recording, are you sure?")||history.pushState(null,document.title,location.href))}function He(){Y.click()}function Ee(k){m("background-upload",{imageFile:k.target.files[0]})}function Xe(){m("background-reset")}function Ae(){m("board-wipe")}function Ye(){m("board-delete")}function Ke(k){if(k.touches.length>1)return;const q=k.touches[0].touchType==="stylus";if(s&&!q){console.log("error: cannot use finger during Apple Pencil mode");return}Ve(k,{isInitialContact:!0})}function Ie(k){if(!C)return;if(k.touches.length>1){console.log("touchmove ignored: only 1 finger allowed");return}const q=k.touches[0].touchType==="stylus";if(s&&!q){console.log("error: cannot use finger during Apple Pencil mode");return}Ve(k,{isInitialContact:!1})}function Ge(k){if(!C||k.touches.length>0)return;const q=k.changedTouches[0].touchType==="stylus";if(s&&!q){console.log("error: cannot use finger during Apple Pencil mode");return}Me(y),C=!1}function Ne(k){C=!0,T={x:-1,y:-1},y={strokeNumber:u.length+1,startTime:f,color:l.color,lineWidth:l.lineWidth,canvasWidth:r,isErasing:l.type==="eraser",points:[],sessionID:"123"}}function Ve(k,{isInitialContact:q}){k.preventDefault(),q&&Ne();const x=Je(k);Be(k,x)}function Be(k,q){y.points.push({unitX:parseFloat(q.x/$.width).toFixed(4),unitY:parseFloat(q.y/$.height).toFixed(4)}),T.x!==-1&&T.y!==-1&&zn([Re(T),Re(q)],1,l.type==="eraser",d,l.color,l.lineWidth,$),T=q}function Me(k){k.endTime=f,k.id=Qe(),Q.push(k),m("stroke-drawn",{newStroke:k})}function Je(k){const{left:q,top:x}=$.getBoundingClientRect();return{x:k.touches[0].pageX-q-window.scrollX,y:k.touches[0].pageY-x-window.scrollY}}function Re({x:k,y:q}){return{unitX:k/$.width,unitY:q/$.height}}function Ze(){d.clearRect(0,0,r,n)}const xe=()=>N.setOpen(!0);function et(k){Ce[k?"unshift":"push"](()=>{Y=k,t(9,Y)})}const tt=k=>Ee(k);function nt(k){Ce[k?"unshift":"push"](()=>{N=k,t(8,N)})}function ot(k){Ce[k?"unshift":"push"](()=>{$=k,t(4,$),t(18,d),t(7,r),t(6,n),t(0,u)})}function rt(k){Ce[k?"unshift":"push"](()=>{w=k,t(5,w),t(18,d),t(7,r),t(6,n),t(0,u),t(4,$)})}return o.$$set=k=>{"strokesArray"in k&&t(0,u=k.strokesArray),"currentTime"in k&&t(1,f=k.currentTime),"backgroundImageDownloadURL"in k&&t(2,i=k.backgroundImageDownloadURL),"recordState"in k&&t(3,_=k.recordState),"$$scope"in k&&t(29,c=k.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&262353&&d&&(t(4,$.width=r,$),t(4,$.height=n,$),t(5,w.width=r,w),t(5,w.height=n,w),u))for(const k of u)qe(k,null,d,$);if(o.$$.dirty[0]&524340&&p&&(p.clearRect(0,0,w.scrollWidth,w.scrollHeight),On(i,$,p)),o.$$.dirty[0]&3407889&&d&&u){let k=Q.length,q=u.length;if(k!==q)if(k<q)if(k===0){for(const x of u)qe(x,null,d,$);t(20,Q=[...u])}else for(let x=k;x<q;x++){const ce=u[x];qe(ce,ce.startTime!==ce.endTime?oo(ce):null,d,$),Q.push(ce)}else{let x=function(){Ze(),t(20,Q=[]),T={x:-1,y:-1};for(const lt of u)qe(lt,null,d,$)};(function(){console.log("debounced board reset"),S&&clearTimeout(S),t(21,S=setTimeout(x,1e3))})()}}},[u,f,i,_,$,w,n,r,N,Y,He,Ee,Xe,Ae,Ye,Ke,Ie,Ge,d,p,Q,S,a,xe,et,tt,nt,ot,rt,c]}class lo extends fe{constructor(e){super();de(this,e,ro,no,me,{strokesArray:0,currentTime:1,backgroundImageDownloadURL:2,recordState:3},null,[-1,-1])}}const so=o=>({currentTime:o&1}),Mt=o=>({startRecording:o[1],stopRecording:o[2],currentTime:o[0]});function ao(o){let e;const t=o[4].default,n=$e(t,o,o[3],Mt);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,l){n&&n.m(r,l),e=!0},p(r,[l]){n&&n.p&&(!e||l&9)&&ke(n,t,r,r[3],e?ve(t,r[3],l,so):we(r[3]),Mt)},i(r){e||(I(n,r),e=!0)},o(r){R(n,r),e=!1},d(r){n&&n.d(r)}}}const Ue=100;function io(o,e){var t=Math.pow(10,e);return(Math.round(o*t)/t).toFixed(e)}function uo(o,e,t){let n,r;J(o,Vn,C=>t(10,n=C)),J(o,Bn,C=>t(11,r=C));let{$$slots:l={},$$scope:s}=e,a,c=null,u=null,f=0,i="";function _(){c=Date.now(),u=c+Ue,i=setTimeout(d,Ue)}function m(){clearTimeout(i),i="",t(0,f=0),u=null}function d(){const C=Date.now()-u;C>Ue&&console.log("setTimeout is lagging greatly"),u+=Ue;const T=1e3,y=1;t(0,f=io((u-c)/T,y)),i=setTimeout(d,Math.max(0,Ue-C))}wt(async()=>{window&&(a=await Nn(()=>import("../../../chunks/index-f195c495.js"),[]),window.MediaRecorder=a.default)});const p=ut();let $=null;function w(){return new Promise(async(C,T)=>{let y;if(n)if(r.local.audio)y=n.clone();else{alert("Cannot start recording because your mic is muted - click the switch next to your name to unmute"),T("Cannot start recording because mic stream is muted");return}else try{y=await navigator.mediaDevices.getUserMedia({audio:!0})}catch{return alert(`Don't forget to enable your your mic! Click the "aA" / "i" button beside the URL bar "https://explain.mit.edu", then click "website settings" / "microphone"`),T("Can't access mic stream")}$=new MediaRecorder(y),$.start(),_(),p("record-start"),C()})}function Q(){return new Promise((C,T)=>{m(),$.addEventListener("dataavailable",y=>{const S=y.data;p("record-end",{audioBlob:S}),C()}),$.stop();for(const y of $.stream.getTracks())y.stop()})}return o.$$set=C=>{"$$scope"in C&&t(3,s=C.$$scope)},[f,w,Q,s,l]}class co extends fe{constructor(e){super();de(this,e,uo,ao,me,{})}}function fo(o,e){let t=document.getElementById(e);return t==null||t.appendChild(o),{destroy(){o.remove()}}}function Ot(o,e){let t=new IntersectionObserver(n=>{for(const r of n)if(r.isIntersecting){e(),t.unobserve(o);return}},{root:null,threshold:.2,rootMargin:"0px"});t.observe(o)}function mo(o){let e,t,n,r,l;return{c(){e=V("div"),t=V("textarea"),this.h()},l(s){e=B(s,"DIV",{style:!0,class:!0});var a=A(e);t=B(a,"TEXTAREA",{placeholder:!0,rows:!0,style:!0,class:!0}),A(t).forEach(h),a.forEach(h),this.h()},h(){t.value=o[0],P(t,"placeholder",o[1]),P(t,"rows","1"),b(t,"width",100+"%"),P(t,"class","svelte-1iax4ps"),b(e,"display","grid"),P(e,"class","grow-wrap svelte-1iax4ps")},m(s,a){v(s,e,a),U(e,t),o[7](e),r||(l=[te(t,"input",o[6]),Pe(o[5].call(null,e)),Pe(n=_n.call(null,e,o[3]))],r=!0)},p(s,[a]){a&1&&(t.value=s[0]),a&2&&P(t,"placeholder",s[1]),n&&_e(n.update)&&a&8&&n.update.call(null,s[3])},i:re,o:re,d(s){s&&h(e),o[7](null),r=!1,kt(l)}}}function po(o,e,t){let n,{value:r}=e,{placeholder:l}=e,s;const a=ut();function c(i){i.dataset.replicatedValue=r}const u=i=>{t(2,s.dataset.replicatedValue=i.target.value,s),a("input",i.target.value)};function f(i){Ce[i?"unshift":"push"](()=>{s=i,t(2,s)})}return o.$$set=i=>{"value"in i&&t(0,r=i.value),"placeholder"in i&&t(1,l=i.placeholder)},t(3,n={width:"100%"}),[r,l,s,n,a,c,u,f]}class zt extends fe{constructor(e){super();de(this,e,po,mo,me,{value:0,placeholder:1})}}const _o=o=>({strokesArray:o&1}),jt=o=>({listenToStrokes:o[1],strokesArray:o[0],handleNewlyDrawnStroke:o[2],deleteAllStrokesFromDb:o[3]});function ho(o){let e;const t=o[6].default,n=$e(t,o,o[5],jt);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,l){n&&n.m(r,l),e=!0},p(r,[l]){n&&n.p&&(!e||l&33)&&ke(n,t,r,r[5],e?ve(t,r[5],l,_o):we(r[5]),jt)},i(r){e||(I(n,r),e=!0)},o(r){R(n,r),e=!1},d(r){n&&n.d(r)}}}function Ft(o){const e=Se({id:o.id},o.data());return e.startTime=0,e.endTime=0,o.data().isErasing||(e.endTime+=.5),e}function go(o,e,t){let{$$slots:n={},$$scope:r}=e,{dbPath:l}=e,s,a;const c=je(H(),`${l}/strokes`),u=ct(c,vt("timestamp"));Oe(()=>{a&&a()});async function f(){a=ft(u,async m=>{m.docChanges().filter(p=>p.type==="removed").length>0?(t(0,s=[]),await hn(),m.docs.length>0&&m.docs.forEach(p=>{s.push(Ft(p))})):(s||t(0,s=[]),m.docs.length===s.length||m.docChanges().filter(p=>p.type==="added").forEach(p=>{t(0,s=[...s,Ft(p.doc)])}))})}function i(m){s.push(m);try{yt(K(H(),`${l}/strokes/${m.id}`),Se({timestamp:gn()},m))}catch(d){alert(d)}}async function _(){return new Promise(async m=>{const d=[];let p=Dt(H()),$=0;for(const w of s){$>=500&&(d.push(p.commit()),p=Dt(H()),$=0);const Q=K(H(),`${l}/strokes/${w.id}`);p.delete(Q),$+=1}d.push(p.commit()),await Promise.all(d),t(0,s=[]),m()})}return o.$$set=m=>{"dbPath"in m&&t(4,l=m.dbPath),"$$scope"in m&&t(5,r=m.$$scope)},[s,f,i,_,l,r,n]}class bo extends fe{constructor(e){super();de(this,e,go,ho,me,{dbPath:4})}}const $o=o=>({allComments:o&1,newComment:o&2,isShowingComments:o&4}),Wt=o=>({listenToComments:o[3],allComments:o[0],newComment:o[1],bindLocalValue:o[4],submitNewComment:o[5],isShowingComments:o[2],hideComments:o[6]});function ko(o){let e;const t=o[9].default,n=$e(t,o,o[8],Wt);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,l){n&&n.m(r,l),e=!0},p(r,[l]){n&&n.p&&(!e||l&263)&&ke(n,t,r,r[8],e?ve(t,r[8],l,$o):we(r[8]),Wt)},i(r){e||(I(n,r),e=!0)},o(r){R(n,r),e=!1},d(r){n&&n.d(r)}}}function wo(o,e,t){let n;J(o,_t,w=>t(11,n=w));let{$$slots:r={},$$scope:l}=e,{dbPath:s}=e,a;const c=je(H(),`${s}/comments`),u=ct(c,vt("isoStringOfDate"));let f=null,i="",_=!1;Oe(()=>{f&&f()});async function m(){f=ft(u,w=>{const Q=[];for(const C of w.docs)Q.push(Se({id:C.id},C.data()));t(0,a=Q),t(2,_=!0)})}function d(w){console.log("e =",w),t(1,i=w)}async function p(){const w=je(H(),`${s}/comments`);bn(w,{content:i,isoStringOfDate:new Date().toISOString(),creatorUID:n.uid,creatorName:n.name});const Q=K(H(),s);G(Q,{numOfComments:It(1)})}function $(){t(2,_=!1)}return o.$$set=w=>{"dbPath"in w&&t(7,s=w.dbPath),"$$scope"in w&&t(8,l=w.$$scope)},[a,i,_,m,d,p,$,s,l,r]}class vo extends fe{constructor(e){super();de(this,e,wo,ko,me,{dbPath:7})}}function Qt(o,e,t){const n=o.slice();return n[1]=e[t],n}function qt(o){let e,t=o[1].content+"",n,r,l,s=De(o[1].isoStringOfDate)+"",a,c,u=(o[1].creatorName||o[1].creatorUID)+"",f,i;return{c(){e=V("div"),n=L(t),r=F(),l=V("div"),a=L(s),c=L(" by "),f=L(u),i=F(),this.h()},l(_){e=B(_,"DIV",{class:!0});var m=A(e);n=E(m,t),m.forEach(h),r=W(_),l=B(_,"DIV",{class:!0});var d=A(l);a=E(d,s),c=E(d," by "),f=E(d,u),i=W(d),d.forEach(h),this.h()},h(){P(e,"class","copied-from-old-explain svelte-aku6lc"),P(l,"class","copied-from-old-explain-2 svelte-aku6lc")},m(_,m){v(_,e,m),U(e,n),v(_,r,m),v(_,l,m),U(l,a),U(l,c),U(l,f),U(l,i)},p(_,m){m&1&&t!==(t=_[1].content+"")&&ne(n,t),m&1&&s!==(s=De(_[1].isoStringOfDate)+"")&&ne(a,s),m&1&&u!==(u=(_[1].creatorName||_[1].creatorUID)+"")&&ne(f,u)},d(_){_&&h(e),_&&h(r),_&&h(l)}}}function yo(o){let e,t=o[0],n=[];for(let r=0;r<t.length;r+=1)n[r]=qt(Qt(o,t,r));return{c(){e=V("div");for(let r=0;r<n.length;r+=1)n[r].c()},l(r){e=B(r,"DIV",{});var l=A(e);for(let s=0;s<n.length;s+=1)n[s].l(l);l.forEach(h)},m(r,l){v(r,e,l);for(let s=0;s<n.length;s+=1)n[s].m(e,null)},p(r,[l]){if(l&1){t=r[0];let s;for(s=0;s<t.length;s+=1){const a=Qt(r,t,s);n[s]?n[s].p(a,l):(n[s]=qt(a),n[s].c(),n[s].m(e,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},i:re,o:re,d(r){r&&h(e),$t(n,r)}}}function Do(o,e,t){let{allComments:n=[]}=e;return o.$$set=r=>{"allComments"in r&&t(0,n=r.allComments)},o.$$.update=()=>{o.$$.dirty&1},[n]}class Io extends fe{constructor(e){super();de(this,e,Do,yo,me,{allComments:0})}}function Ht(o,e,t){const n=o.slice();return n[49]=e[t],n[51]=t,n}function Xt(o){let e,t,n,r,l,s=[],a=new Map,c,u,f,i;t=new kn({props:{disabled:ue(o[0].name)&&o[0].askerUID&&o[6].uid!==o[0].askerUID,value:o[0].name,class:"room-title",style:`width: ${o[8]}px;`,$$slots:{helper:[Uo]},$$scope:{ctx:o}}}),t.$on("input",o[24]);let _=o[0].blackboards;const m=d=>d[49];for(let d=0;d<_.length;d+=1){let p=Ht(o,_,d),$=m(p);a.set($,s[d]=xt($,p))}return{c(){e=V("div"),M(t.$$.fragment),n=F(),r=V("div"),l=F();for(let d=0;d<s.length;d+=1)s[d].c();this.h()},l(d){e=B(d,"DIV",{style:!0});var p=A(e);O(t.$$.fragment,p),n=W(p),r=B(p,"DIV",{style:!0}),A(r).forEach(h),l=W(p);for(let $=0;$<s.length;$+=1)s[$].l(p);p.forEach(h),this.h()},h(){b(r,"margin-bottom","14px"),b(e,"padding","16px"),pe(e,"question",ue(o[0].name))},m(d,p){v(d,e,p),z(t,e,null),U(e,n),U(e,r),U(e,l);for(let $=0;$<s.length;$+=1)s[$].m(e,null);u=!0,f||(i=Pe(c=fo.call(null,e,"main-content")),f=!0)},p(d,p){const $={};p[0]&65&&($.disabled=ue(d[0].name)&&d[0].askerUID&&d[6].uid!==d[0].askerUID),p[0]&1&&($.value=d[0].name),p[0]&256&&($.style=`width: ${d[8]}px;`),p[0]&31|p[2]&64&&($.$$scope={dirty:p,ctx:d}),t.$set($),p[0]&2064353|p[1]&1876951040|p[2]&35&&(_=d[0].blackboards,le(),s=$n(s,p,m,1,d,_,a,e,wn,xt,null,Ht),se()),p[0]&1&&pe(e,"question",ue(d[0].name))},i(d){if(!u){I(t.$$.fragment,d);for(let p=0;p<_.length;p+=1)I(s[p]);u=!0}},o(d){R(t.$$.fragment,d);for(let p=0;p<s.length;p+=1)R(s[p]);u=!1},d(d){d&&h(e),j(t);for(let p=0;p<s.length;p+=1)s[p].d();f=!1,i()}}}function Ro(o){let e=o[0].askerName+"",t,n,r=De(o[0].dateAsked)+"",l;return{c(){t=L(e),n=L(" asked on "),l=L(r)},l(s){t=E(s,e),n=E(s," asked on "),l=E(s,r)},m(s,a){v(s,t,a),v(s,n,a),v(s,l,a)},p(s,a){a[0]&1&&e!==(e=s[0].askerName+"")&&ne(t,e),a[0]&1&&r!==(r=De(s[0].dateAsked)+"")&&ne(l,r)},d(s){s&&h(t),s&&h(n),s&&h(l)}}}function To(o){let e,t,n;return{c(){e=L("Resolving this question in "),t=L(o[4]),n=L(", cancel by re-adding ?")},l(r){e=E(r,"Resolving this question in "),t=E(r,o[4]),n=E(r,", cancel by re-adding ?")},m(r,l){v(r,e,l),v(r,t,l),v(r,n,l)},p(r,l){l[0]&16&&ne(t,r[4])},d(r){r&&h(e),r&&h(t),r&&h(n)}}}function So(o){let e,t,n;return{c(){e=L("Pinging server members in "),t=L(o[2]),n=L(', cancel by backtracking the "?""')},l(r){e=E(r,"Pinging server members in "),t=E(r,o[2]),n=E(r,', cancel by backtracking the "?""')},m(r,l){v(r,e,l),v(r,t,l),v(r,n,l)},p(r,l){l[0]&4&&ne(t,r[2])},d(r){r&&h(e),r&&h(t),r&&h(n)}}}function Co(o){let e;return{c(){e=L('To ask the server a question, end your title with a question mark "?"')},l(t){e=E(t,'To ask the server a question, end your title with a question mark "?"')},m(t,n){v(t,e,n)},p:re,d(t){t&&h(e)}}}function Yt(o){let e,t=De(o[0].dateResolved)+"",n;return{c(){e=L(", resolved "),n=L(t)},l(r){e=E(r,", resolved "),n=E(r,t)},m(r,l){v(r,e,l),v(r,n,l)},p(r,l){l[0]&1&&t!==(t=De(r[0].dateResolved)+"")&&ne(n,t)},d(r){r&&h(e),r&&h(n)}}}function Po(o){let e,t;function n(a,c){if(!a[1]&&!a[3]&&!a[0].askerUID)return Co;if(a[1])return So;if(a[3])return To;if(a[0].askerName&&a[0].askerUID&&a[0].date)return Ro}let r=n(o),l=r&&r(o),s=o[0].dateResolved&&Yt(o);return{c(){l&&l.c(),e=F(),s&&s.c(),t=Z()},l(a){l&&l.l(a),e=W(a),s&&s.l(a),t=Z()},m(a,c){l&&l.m(a,c),v(a,e,c),s&&s.m(a,c),v(a,t,c)},p(a,c){r===(r=n(a))&&l?l.p(a,c):(l&&l.d(1),l=r&&r(a),l&&(l.c(),l.m(e.parentNode,e))),a[0].dateResolved?s?s.p(a,c):(s=Yt(a),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},d(a){l&&l.d(a),a&&h(e),s&&s.d(a),a&&h(t)}}}function Uo(o){let e,t;return e=new vn({props:{slot:"helper",$$slots:{default:[Po]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment)},l(n){O(e.$$.fragment,n)},m(n,r){z(e,n,r),t=!0},p(n,r){const l={};r[0]&31|r[2]&64&&(l.$$scope={dirty:r,ctx:n}),e.$set(l)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){R(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Kt(o){let e,t,n,r,l,s,a,c;function u(...d){return o[25](o[49],...d)}t=new zt({props:{value:o[52].description||"",placeholder:"Describe the blackboard..."}}),t.$on("input",u);const f=[Eo,Lo],i=[];function _(d,p){return d[52].audioDownloadURL?0:1}r=_(o),l=i[r]=f[r](o);let m=o[51]===o[0].blackboards.length-1&&Zt(o);return{c(){e=V("div"),M(t.$$.fragment),n=F(),l.c(),s=F(),m&&m.c(),a=Z(),this.h()},l(d){e=B(d,"DIV",{style:!0});var p=A(e);O(t.$$.fragment,p),p.forEach(h),n=W(d),l.l(d),s=W(d),m&&m.l(d),a=Z(),this.h()},h(){b(e,"width",o[8]+"px"),b(e,"margin-top","10px"),b(e,"margin-bottom","0px")},m(d,p){v(d,e,p),z(t,e,null),v(d,n,p),i[r].m(d,p),v(d,s,p),m&&m.m(d,p),v(d,a,p),c=!0},p(d,p){o=d;const $={};p[1]&2097152&&($.value=o[52].description||""),t.$set($),(!c||p[0]&256)&&b(e,"width",o[8]+"px");let w=r;r=_(o),r===w?i[r].p(o,p):(le(),R(i[w],1,1,()=>{i[w]=null}),se(),l=i[r],l?l.p(o,p):(l=i[r]=f[r](o),l.c()),I(l,1),l.m(s.parentNode,s)),o[51]===o[0].blackboards.length-1?m?m.p(o,p):(m=Zt(o),m.c(),m.m(a.parentNode,a)):m&&(m.d(1),m=null)},i(d){c||(I(t.$$.fragment,d),I(l),c=!0)},o(d){R(t.$$.fragment,d),R(l),c=!1},d(d){d&&h(e),j(t),d&&h(n),i[r].d(d),d&&h(s),m&&m.d(d),d&&h(a)}}}function Lo(o){let e,t;return e=new bo({props:{dbPath:o[5]+o[49],$$slots:{default:[Oo,({listenToStrokes:n,strokesArray:r,handleNewlyDrawnStroke:l,deleteAllStrokesFromDb:s})=>({63:n,54:r,64:l,55:s}),({listenToStrokes:n,strokesArray:r,handleNewlyDrawnStroke:l,deleteAllStrokesFromDb:s})=>[0,(r?8388608:0)|(s?16777216:0),(n?2:0)|(l?4:0)]]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment)},l(n){O(e.$$.fragment,n)},m(n,r){z(e,n,r),t=!0},p(n,r){const l={};r[0]&33&&(l.dbPath=n[5]+n[49]),r[0]&897|r[1]&27262976|r[2]&66&&(l.$$scope={dirty:r,ctx:n}),e.$set(l)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){R(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Eo(o){let e,t,n,r;return e=new vo({props:{dbPath:o[5]+o[49],$$slots:{default:[Xo,({listenToComments:l,allComments:s,newComment:a,bindLocalValue:c,submitNewComment:u,isShowingComments:f,hideComments:i})=>({56:l,57:s,58:a,59:c,60:u,61:f,62:i}),({listenToComments:l,allComments:s,newComment:a,bindLocalValue:c,submitNewComment:u,isShowingComments:f,hideComments:i})=>[0,(l?33554432:0)|(s?67108864:0)|(a?134217728:0)|(c?268435456:0)|(u?536870912:0)|(f?1073741824:0),i?1:0]]},$$scope:{ctx:o}}}),n=new En({props:{dbPath:o[5]+o[49],$$slots:{default:[Go,({fetchStrokes:l,strokesArray:s,deleteAllStrokesFromDb:a})=>({53:l,54:s,55:a}),({fetchStrokes:l,strokesArray:s,deleteAllStrokesFromDb:a})=>[0,(l?4194304:0)|(s?8388608:0)|(a?16777216:0)]]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment),t=F(),M(n.$$.fragment)},l(l){O(e.$$.fragment,l),t=W(l),O(n.$$.fragment,l)},m(l,s){z(e,l,s),v(l,t,s),z(n,l,s),r=!0},p(l,s){const a={};s[0]&33&&(a.dbPath=l[5]+l[49]),s[0]&256|s[1]&1847590912|s[2]&65&&(a.$$scope={dirty:s,ctx:l}),e.$set(a);const c={};s[0]&33&&(c.dbPath=l[5]+l[49]),s[0]&833|s[1]&14680064|s[2]&64&&(c.$$scope={dirty:s,ctx:l}),n.$set(c)},i(l){r||(I(e.$$.fragment,l),I(n.$$.fragment,l),r=!0)},o(l){R(e.$$.fragment,l),R(n.$$.fragment,l),r=!1},d(l){j(e,l),l&&h(t),j(n,l)}}}function Ao(o){let e,t,n;return t=new Un({props:{class:"my-four-colors",style:"height: 32px; width: 32px;",indeterminate:!0,fourColor:!0}}),{c(){e=V("div"),M(t.$$.fragment),this.h()},l(r){e=B(r,"DIV",{style:!0});var l=A(e);O(t.$$.fragment,l),l.forEach(h),this.h()},h(){b(e,"display","flex"),b(e,"justify-content","center"),b(e,"margin-left","20px"),b(e,"margin-right","20px")},m(r,l){v(r,e,l),z(t,e,null),n=!0},p:re,i(r){n||(I(t.$$.fragment,r),n=!0)},o(r){R(t.$$.fragment,r),n=!1},d(r){r&&h(e),j(t)}}}function No(o){let e,t,n,r;function l(){return o[30](o[66],o[49])}return{c(){e=V("span"),t=L("stop_circle"),this.h()},l(s){e=B(s,"SPAN",{class:!0,style:!0});var a=A(e);t=E(a,"stop_circle"),a.forEach(h),this.h()},h(){P(e,"class","material-icons svelte-53fhoc"),b(e,"font-size","2.5rem"),b(e,"color","cyan"),b(e,"margin-left","22px"),b(e,"margin-right","26px"),pe(e,"unclickable",o[7]!==o[52].recorderBrowserTabID)},m(s,a){v(s,e,a),U(e,t),n||(r=te(e,"click",l),n=!0)},p(s,a){o=s,a[0]&128|a[1]&2097152&&pe(e,"unclickable",o[7]!==o[52].recorderBrowserTabID)},i:re,o:re,d(s){s&&h(e),n=!1,r()}}}function Vo(o){let e,t,n,r;function l(){return o[29](o[65],o[49])}return{c(){e=V("span"),t=L("album"),this.h()},l(s){e=B(s,"SPAN",{class:!0,style:!0});var a=A(e);t=E(a,"album"),a.forEach(h),this.h()},h(){P(e,"class","material-icons"),b(e,"font-size","2.5rem"),b(e,"color","cyan"),b(e,"margin-left","22px"),b(e,"margin-right","26px")},m(s,a){v(s,e,a),U(e,t),n||(r=te(e,"click",l),n=!0)},p(s,a){o=s},i:re,o:re,d(s){s&&h(e),n=!1,r()}}}function Bo(o){let e,t,n,r;const l=[Vo,No,Ao],s=[];function a(c,u){return c[52].recordState==="pre_record"||c[67]===0?0:c[52].recordState==="mid_record"?1:c[52].recordState==="post_record"?2:-1}return~(e=a(o))&&(t=s[e]=l[e](o)),{c(){t&&t.c(),n=Z()},l(c){t&&t.l(c),n=Z()},m(c,u){~e&&s[e].m(c,u),v(c,n,u),r=!0},p(c,u){let f=e;e=a(c),e===f?~e&&s[e].p(c,u):(t&&(le(),R(s[f],1,1,()=>{s[f]=null}),se()),~e?(t=s[e],t?t.p(c,u):(t=s[e]=l[e](c),t.c()),I(t,1),t.m(n.parentNode,n)):t=null)},i(c){r||(I(t),r=!0)},o(c){R(t),r=!1},d(c){~e&&s[e].d(c),c&&h(n)}}}function Mo(o){let e,t;function n(...a){return o[31](o[49],...a)}function r(){return o[32](o[49])}function l(...a){return o[33](o[64],...a)}function s(){return o[34](o[49],o[55])}return e=new lo({props:{strokesArray:o[54],currentTime:o[67],backgroundImageDownloadURL:o[52].backgroundImageDownloadURL,recordState:o[52].recordState,$$slots:{default:[Bo]},$$scope:{ctx:o}}}),e.$on("background-upload",n),e.$on("background-reset",r),e.$on("stroke-drawn",l),e.$on("board-wipe",function(){_e(o[55])&&o[55].apply(this,arguments)}),e.$on("board-delete",s),{c(){M(e.$$.fragment)},l(a){O(e.$$.fragment,a)},m(a,c){z(e,a,c),t=!0},p(a,c){o=a;const u={};c[1]&8388608&&(u.strokesArray=o[54]),c[2]&32&&(u.currentTime=o[67]),c[1]&2097152&&(u.backgroundImageDownloadURL=o[52].backgroundImageDownloadURL),c[1]&2097152&&(u.recordState=o[52].recordState),c[0]&129|c[1]&2097152|c[2]&96&&(u.$$scope={dirty:c,ctx:o}),e.$set(u)},i(a){t||(I(e.$$.fragment,a),t=!0)},o(a){R(e.$$.fragment,a),t=!1},d(a){j(e,a)}}}function Oo(o){let e,t,n,r,l,s,a;function c(...u){return o[35](o[54],o[49],...u)}return t=new co({props:{$$slots:{default:[Mo,({startRecording:u,stopRecording:f,currentTime:i})=>({65:u,66:f,67:i}),({startRecording:u,stopRecording:f,currentTime:i})=>[0,0,(u?8:0)|(f?16:0)|(i?32:0)]]},$$scope:{ctx:o}}}),t.$on("record-end",c),{c(){e=V("div"),M(t.$$.fragment),this.h()},l(u){e=B(u,"DIV",{style:!0});var f=A(e);O(t.$$.fragment,f),f.forEach(h),this.h()},h(){P(e,"style",n=`width: ${o[8]}px; height: ${o[9]}px; position: relative`)},m(u,f){v(u,e,f),z(t,e,null),l=!0,s||(a=Pe(r=Ot.call(null,e,o[63])),s=!0)},p(u,f){o=u;const i={};f[0]&129|f[1]&27262976|f[2]&96&&(i.$$scope={dirty:f,ctx:o}),t.$set(i),(!l||f[0]&768&&n!==(n=`width: ${o[8]}px; height: ${o[9]}px; position: relative`))&&P(e,"style",n),r&&_e(r.update)&&f[2]&2&&r.update.call(null,o[63])},i(u){l||(I(t.$$.fragment,u),l=!0)},o(u){R(t.$$.fragment,u),l=!1},d(u){u&&h(e),j(t),s=!1,a()}}}function zo(o){let e,t;return e=new Fe({props:{$$slots:{default:[Wo]},$$scope:{ctx:o}}}),e.$on("click",function(){_e(o[62])&&o[62].apply(this,arguments)}),{c(){M(e.$$.fragment)},l(n){O(e.$$.fragment,n)},m(n,r){z(e,n,r),t=!0},p(n,r){o=n;const l={};r[2]&64&&(l.$$scope={dirty:r,ctx:o}),e.$set(l)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){R(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function jo(o){let e,t;return e=new Fe({props:{$$slots:{default:[qo]},$$scope:{ctx:o}}}),e.$on("click",function(){_e(o[56])&&o[56].apply(this,arguments)}),{c(){M(e.$$.fragment)},l(n){O(e.$$.fragment,n)},m(n,r){z(e,n,r),t=!0},p(n,r){o=n;const l={};r[2]&64&&(l.$$scope={dirty:r,ctx:o}),e.$set(l)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){R(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Fo(o){let e;return{c(){e=L("expand_less")},l(t){e=E(t,"expand_less")},m(t,n){v(t,e,n)},d(t){t&&h(e)}}}function Wo(o){let e,t;return e=new St({props:{class:"material-icons",style:"margin-right: 0",$$slots:{default:[Fo]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment)},l(n){O(e.$$.fragment,n)},m(n,r){z(e,n,r),t=!0},p(n,r){const l={};r[2]&64&&(l.$$scope={dirty:r,ctx:n}),e.$set(l)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){R(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Qo(o){let e;return{c(){e=L("expand_more")},l(t){e=E(t,"expand_more")},m(t,n){v(t,e,n)},d(t){t&&h(e)}}}function qo(o){let e,t;return e=new St({props:{class:"material-icons",style:"margin-right: 0",$$slots:{default:[Qo]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment)},l(n){O(e.$$.fragment,n)},m(n,r){z(e,n,r),t=!0},p(n,r){const l={};r[2]&64&&(l.$$scope={dirty:r,ctx:n}),e.$set(l)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){R(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function Gt(o){let e,t,n,r,l,s,a,c,u,f,i;t=new Io({props:{allComments:o[57]}});function _(...m){return o[26](o[59],...m)}return s=new zt({props:{value:o[58],placeholder:"Type comment..."}}),s.$on("input",_),c=new Fe({props:{$$slots:{default:[Ho]},$$scope:{ctx:o}}}),c.$on("click",function(){_e(o[60])&&o[60].apply(this,arguments)}),{c(){e=V("div"),M(t.$$.fragment),n=F(),r=V("div"),l=F(),M(s.$$.fragment),a=F(),M(c.$$.fragment),u=F(),f=V("div"),this.h()},l(m){e=B(m,"DIV",{style:!0});var d=A(e);O(t.$$.fragment,d),n=W(d),r=B(d,"DIV",{style:!0}),A(r).forEach(h),l=W(d),O(s.$$.fragment,d),a=W(d),O(c.$$.fragment,d),d.forEach(h),u=W(m),f=B(m,"DIV",{style:!0}),A(f).forEach(h),this.h()},h(){b(r,"margin-bottom","4px"),b(e,"width",o[8]-20+"px"),b(e,"margin-left","20px"),b(f,"margin-bottom","10px")},m(m,d){v(m,e,d),z(t,e,null),U(e,n),U(e,r),U(e,l),z(s,e,null),U(e,a),z(c,e,null),v(m,u,d),v(m,f,d),i=!0},p(m,d){o=m;const p={};d[1]&67108864&&(p.allComments=o[57]),t.$set(p);const $={};d[1]&134217728&&($.value=o[58]),s.$set($);const w={};d[2]&64&&(w.$$scope={dirty:d,ctx:o}),c.$set(w),(!i||d[0]&256)&&b(e,"width",o[8]-20+"px")},i(m){i||(I(t.$$.fragment,m),I(s.$$.fragment,m),I(c.$$.fragment,m),i=!0)},o(m){R(t.$$.fragment,m),R(s.$$.fragment,m),R(c.$$.fragment,m),i=!1},d(m){m&&h(e),j(t),j(s),j(c),m&&h(u),m&&h(f)}}}function Ho(o){let e;return{c(){e=L("SUBMIT")},l(t){e=E(t,"SUBMIT")},m(t,n){v(t,e,n)},d(t){t&&h(e)}}}function Xo(o){let e,t,n=(o[52].numOfEurekas||0)+"",r,l,s=(o[52].viewMinutes||0)+"",a,c,u=(o[52].numOfComments||0)+"",f,i,_,m,d,p,$,w;const Q=[jo,zo],C=[];function T(S,N){return S[61]?1:0}m=T(o),d=C[m]=Q[m](o);let y=o[61]&&Gt(o);return{c(){e=V("div"),t=V("div"),r=L(n),l=L(` eurekas, \r
                  `),a=L(s),c=L(` minutes viewed,\r
                  `),f=L(u),i=L(" comments"),_=F(),d.c(),p=F(),y&&y.c(),$=Z(),this.h()},l(S){e=B(S,"DIV",{style:!0});var N=A(e);t=B(N,"DIV",{style:!0});var Y=A(t);r=E(Y,n),l=E(Y,` eurekas, \r
                  `),a=E(Y,s),c=E(Y,` minutes viewed,\r
                  `),f=E(Y,u),i=E(Y," comments"),Y.forEach(h),_=W(N),d.l(N),N.forEach(h),p=W(S),y&&y.l(S),$=Z(),this.h()},h(){b(t,"color","grey"),b(t,"font-size","0.7rem"),b(e,"display","flex"),b(e,"align-items","center")},m(S,N){v(S,e,N),U(e,t),U(t,r),U(t,l),U(t,a),U(t,c),U(t,f),U(t,i),U(e,_),C[m].m(e,null),v(S,p,N),y&&y.m(S,N),v(S,$,N),w=!0},p(S,N){(!w||N[1]&2097152)&&n!==(n=(S[52].numOfEurekas||0)+"")&&ne(r,n),(!w||N[1]&2097152)&&s!==(s=(S[52].viewMinutes||0)+"")&&ne(a,s),(!w||N[1]&2097152)&&u!==(u=(S[52].numOfComments||0)+"")&&ne(f,u);let Y=m;m=T(S),m===Y?C[m].p(S,N):(le(),R(C[Y],1,1,()=>{C[Y]=null}),se(),d=C[m],d?d.p(S,N):(d=C[m]=Q[m](S),d.c()),I(d,1),d.m(e,null)),S[61]?y?(y.p(S,N),N[1]&1073741824&&I(y,1)):(y=Gt(S),y.c(),I(y,1),y.m($.parentNode,$)):y&&(le(),R(y,1,1,()=>{y=null}),se())},i(S){w||(I(d),I(y),w=!0)},o(S){R(d),R(y),w=!1},d(S){S&&h(e),C[m].d(),S&&h(p),y&&y.d(S),S&&h($)}}}function Jt(o){let e,t;function n(){return o[27](o[52],o[55])}return e=new Fe({props:{slot:"top-left-corner",style:"margin-left: "+(o[8]-240)+"px; background-color: rgba(255,255,255,0.5); color: white",$$slots:{default:[Yo]},$$scope:{ctx:o}}}),e.$on("click",n),{c(){M(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,l){z(e,r,l),t=!0},p(r,l){o=r;const s={};l[0]&256&&(s.style="margin-left: "+(o[8]-240)+"px; background-color: rgba(255,255,255,0.5); color: white"),l[2]&64&&(s.$$scope={dirty:l,ctx:o}),e.$set(s)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){R(e.$$.fragment,r),t=!1},d(r){j(e,r)}}}function Yo(o){let e;return{c(){e=L("Delete video")},l(t){e=E(t,"Delete video")},m(t,n){v(t,e,n)},d(t){t&&h(e)}}}function Ko(o){let e,t,n=(o[6].uid===o[52].creatorUID||!o[52].creatorUID)&&Jt(o);return{c(){n&&n.c(),e=Z()},l(r){n&&n.l(r),e=Z()},m(r,l){n&&n.m(r,l),v(r,e,l),t=!0},p(r,l){r[6].uid===r[52].creatorUID||!r[52].creatorUID?n?(n.p(r,l),l[0]&64|l[1]&2097152&&I(n,1)):(n=Jt(r),n.c(),I(n,1),n.m(e.parentNode,e)):n&&(le(),R(n,1,1,()=>{n=null}),se())},i(r){t||(I(n),t=!0)},o(r){R(n),t=!1},d(r){n&&n.d(r),r&&h(e)}}}function Go(o){let e,t,n,r,l,s,a;function c(){return o[28](o[49])}return t=new An({props:{strokesArray:o[54],audioDownloadURL:o[52].audioDownloadURL,backgroundImageDownloadURL:o[52].backgroundImageDownloadURL,$$slots:{default:[Ko]},$$scope:{ctx:o}}}),t.$on("six-seconds-watched",c),{c(){e=V("div"),M(t.$$.fragment),this.h()},l(u){e=B(u,"DIV",{style:!0});var f=A(e);O(t.$$.fragment,f),f.forEach(h),this.h()},h(){P(e,"style",n=`width: ${o[8]}px; height: ${o[9]+40}px; position: relative`)},m(u,f){v(u,e,f),z(t,e,null),l=!0,s||(a=Pe(r=Ot.call(null,e,o[53])),s=!0)},p(u,f){o=u;const i={};f[1]&8388608&&(i.strokesArray=o[54]),f[1]&2097152&&(i.audioDownloadURL=o[52].audioDownloadURL),f[1]&2097152&&(i.backgroundImageDownloadURL=o[52].backgroundImageDownloadURL),f[0]&320|f[1]&2097152|f[2]&64&&(i.$$scope={dirty:f,ctx:o}),t.$set(i),(!l||f[0]&768&&n!==(n=`width: ${o[8]}px; height: ${o[9]+40}px; position: relative`))&&P(e,"style",n),r&&_e(r.update)&&f[1]&4194304&&r.update.call(null,o[53])},i(u){l||(I(t.$$.fragment,u),l=!0)},o(u){R(t.$$.fragment,u),l=!1},d(u){u&&h(e),j(t),s=!1,a()}}}function Zt(o){let e,t,n,r;return{c(){e=V("div"),t=L("New blackboard"),this.h()},l(l){e=B(l,"DIV",{style:!0});var s=A(e);t=E(s,"New blackboard"),s.forEach(h),this.h()},h(){b(e,"display","flex"),b(e,"justify-content","center"),b(e,"align-items","center"),b(e,"margin-top","40px"),b(e,"background-color","#2e3131"),b(e,"font-family","Roboto, sans-serif"),b(e,"text-transform","uppercase"),b(e,"color","white"),b(e,"height","35px"),b(e,"width",o[8]+"px")},m(l,s){v(l,e,s),U(e,t),n||(r=te(e,"click",o[19]),n=!0)},p(l,s){s[0]&256&&b(e,"width",l[8]+"px")},d(l){l&&h(e),n=!1,r()}}}function Jo(o){let e,t,n=o[52]&&Kt(o);return{c(){n&&n.c(),e=F()},l(r){n&&n.l(r),e=W(r)},m(r,l){n&&n.m(r,l),v(r,e,l),t=!0},p(r,l){r[52]?n?(n.p(r,l),l[1]&2097152&&I(n,1)):(n=Kt(r),n.c(),I(n,1),n.m(e.parentNode,e)):n&&(le(),R(n,1,1,()=>{n=null}),se())},i(r){t||(I(n),t=!0)},o(r){R(n),t=!1},d(r){n&&n.d(r),r&&h(e)}}}function xt(o,e){let t,n,r;return n=new Ln({props:{dbPath:e[5]+e[49],$$slots:{default:[Jo,({boardDoc:l})=>({52:l}),({boardDoc:l})=>[0,l?2097152:0]]},$$scope:{ctx:e}}}),{key:o,first:null,c(){t=Z(),M(n.$$.fragment),this.h()},l(l){t=Z(),O(n.$$.fragment,l),this.h()},h(){this.first=t},m(l,s){v(l,t,s),z(n,l,s),r=!0},p(l,s){e=l;const a={};s[0]&33&&(a.dbPath=e[5]+e[49]),s[0]&993|s[1]&2097152|s[2]&64&&(a.$$scope={dirty:s,ctx:e}),n.$set(a)},i(l){r||(I(n.$$.fragment,l),r=!0)},o(l){R(n.$$.fragment,l),r=!1},d(l){l&&h(t),j(n,l)}}}function Zo(o){let e,t,n=o[0]&&Xt(o);return{c(){n&&n.c(),e=Z()},l(r){n&&n.l(r),e=Z()},m(r,l){n&&n.m(r,l),v(r,e,l),t=!0},p(r,l){r[0]?n?(n.p(r,l),l[0]&1&&I(n,1)):(n=Xt(r),n.c(),I(n,1),n.m(e.parentNode,e)):n&&(le(),R(n,1,1,()=>{n=null}),se())},i(r){t||(I(n),t=!0)},o(r){R(n),t=!1},d(r){n&&n.d(r),r&&h(e)}}}async function cr({page:o}){return{props:{classID:o.params.class,roomID:o.params.room}}}async function en(...o){for(const e of o)try{await e()}catch(t){alert(t);return}}function ue(o){return o?o.charAt(o.length-1)==="?":!1}function ht(o){return o.askerName&&o.dateAsked&&o.askerUID}function xo(o){let e;return{promise:new Promise((n,r)=>{e=r,setTimeout(n,o)}),cancel:e}}function er(o,e,t){let n,r,l,s,a,c,u;J(o,_t,g=>t(6,s=g)),J(o,Mn,g=>t(7,a=g)),J(o,Pt,g=>t(8,c=g)),J(o,Ct,g=>t(9,u=g));let{classID:f}=e,{roomID:i}=e,_,m={name:"",blackboards:[]};async function d(){_&&_(),_=ft(l,g=>{g.exists()?t(0,m=Se({id:g.id},g.data())):jn(`/${f}/${f}`)})}Oe(()=>{_()});function p(g){const D=K(H(),n+g);G(D,{viewMinutes:It(.1)})}function $(g){const D=K(H(),n+g);G(D,{recorderBrowserTabID:a})}function w(g,D){const X=K(H(),n+g);G(X,{recordState:D})}async function Q(g,D){const X=K(H(),n+D);if(!!g)if(g.type.split("/")[0]==="image"){const ee=dt(),ae=mt(ee,`images/${Qe()}`);await Rt(ae,g);const ie=await Tt(ae);G(X,{backgroundImageDownloadURL:ie})}else alert("Error: only images can be used")}function C(g){const D=K(H(),n+g);G(D,{backgroundImageDownloadURL:ye()})}let T="",y=5,S,N=5;async function Y({srcElement:g}){const{value:D}=g,X={name:D};!ue(m.name)&&ue(D)&&!ht(m)?Le():T&&!ue(D)?Ae():!ue(D)&&ht(m)?He():S&&ue(D)&&ht(m)&&Xe(),await G(l,X)}function Le(){t(2,y=5),t(1,T=setInterval(()=>{t(2,y-=1),y===0&&(Ye(),Ke(),Ae())},1e3))}function He(){t(4,N=5),t(3,S=setInterval(()=>{t(4,N-=1),N===0&&Ee()},1e3))}function Ee(){G(l,{dateResolved:new Date().toISOString()})}function Xe(){clearTimeout(S),t(3,S="")}function Ae(){clearTimeout(T),t(1,T="")}function Ye(){G(l,{askerName:s.name||"Beaver #999",askerUID:s.uid,dateAsked:new Date().toISOString()})}async function Ke(){const g=[],D=yn(),X=Dn(D,"sendTextMessage"),ee=je(H(),"users"),ae=ct(ee,In("willReceiveText","==",!0)),ie=await Rn(ae);if(ie.docs)for(const Te of ie.docs){console.log("phoneNumber =",Te.data().phoneNumber);try{Te.id!==s.uid&&g.push(X({content:`${s.name} asked on https://ihtfp.app: "${m.name||"Fake question here"}"`,toWho:Te.data().phoneNumber}))}catch(st){alert(st)}}await Promise.all(g),console.log("success, sent all texts.")}let Ie={promise:null,cancel:g=>{}};function Ge(g,D){return async(...X)=>{try{Ie.cancel(),Ie=xo(D),await Ie.promise,await g(...X)}catch{}}}async function Ne({detail:g},D){Ge(()=>Ve({detail:g},D),3e3)({detail:g},D)}async function Ve({detail:g},D){const X=K(H(),n+D);await G(X,{description:g})}async function Be(g,D,X){function ee(oe){return oe.startTime!==0&&oe.endTime!==ae}const ae=.5,ie=[],Te=D.length;for(let oe=0;oe<Te;oe++){if(!ee(D[oe])){let he=oe-1;for(;he>=0;){if(ee(D[he])){D[oe].startTime=D[he].endTime,D[oe].endTime=D[oe].startTime+ae,ie.push(oe);break}he-=1}}for(let he of ie){const it=D[he],on=n+X,rn=K(H(),`${on}/strokes/${it.id}`);G(rn,{startTime:it.startTime,endTime:it.endTime})}}const st=dt(),at=mt(st,`audio/${Qe()}`);await Rt(at,g);const tn=await Tt(at),nn=K(H(),n+X);await G(nn,{creatorUID:s.uid||"",creatorPhoneNumber:s.phoneNumber||"",date:new Date().toISOString(),audioDownloadURL:tn,audioRefFullPath:at.fullPath}),w(X,"pre_record")}async function Me({id:g,audioRefFullPath:D},X){const ee=[],ae=K(H(),n+g);if(D){const ie=mt(dt(),D);ee.push(Tn(ie))}ee.push(G(ae,{creator:ye(),creatorPhoneNumber:ye(),date:ye(),audioDownloadURL:ye(),audioRefFullPath:ye()})),ee.push(X()),await Promise.all(ee)}async function Je(){const g=Qe(),D=K(H(),n+g);await Promise.all([yt(D,{recordState:"pre_record"}),G(l,{blackboards:Sn(g)})])}function Re(g,D){if(m.blackboards.length===1){alert("Can't delete the last blackboard");return}G(l,{blackboards:Cn(g)}),D(),Pn(K(H(),n+g))}const Ze=g=>Y(g),xe=(g,D)=>Ne(D,g),et=(g,D)=>g(D.detail),tt=(g,D)=>Me(g,D),nt=g=>p(g),ot=(g,D)=>en(g,()=>w(D,"mid_record"),()=>$(D),()=>Ut.set(!0)),rt=(g,D)=>en(g,()=>w(D,"post_record"),()=>Ut.set(!1)),k=(g,D)=>Q(D.detail.imageFile,g),q=g=>C(g),x=(g,D)=>g(D.detail.newStroke),ce=(g,D)=>Re(g,D),lt=(g,D,X)=>Be(X.detail.audioBlob,g,D);return o.$$set=g=>{"classID"in g&&t(21,f=g.classID),"roomID"in g&&t(22,i=g.roomID)},o.$$.update=()=>{o.$$.dirty[0]&2097152&&t(5,n=`classes/${f}/blackboards/`),o.$$.dirty[0]&2097152&&t(23,r=`classes/${f}/rooms/`),o.$$.dirty[0]&12582912&&(l=K(H(),r+i)),o.$$.dirty[0]&4194304&&d()},[m,T,y,S,N,n,s,a,c,u,p,$,w,Q,C,Y,Ne,Be,Me,Je,Re,f,i,r,Ze,xe,et,tt,nt,ot,rt,k,q,x,ce,lt]}class fr extends fe{constructor(e){super();de(this,e,er,Zo,me,{classID:21,roomID:22},null,[-1,-1,-1])}}export{fr as default,cr as load};

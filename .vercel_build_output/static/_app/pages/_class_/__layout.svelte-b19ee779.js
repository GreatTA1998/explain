var dt=Object.defineProperty;var Ve=Object.getOwnPropertySymbols;var _t=Object.prototype.hasOwnProperty,pt=Object.prototype.propertyIsEnumerable;var Me=(o,e,n)=>e in o?dt(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n,be=(o,e)=>{for(var n in e||(e={}))_t.call(e,n)&&Me(o,n,e[n]);if(Ve)for(var n of Ve(e))pt.call(e,n)&&Me(o,n,e[n]);return o};import{S as me,i as de,s as fe,aa as ht,ab as je,a3 as _e,ac as Pe,e as R,t as P,k as N,j as U,c as T,a as S,g as A,d as _,n as z,m as L,M as m,f as D,N as w,o as q,a1 as ce,h as re,ad as Ae,x as h,u as $,v as B,F as Z,A as ge,a6 as $e,Q as W,a9 as Ne,P as x,_ as ue,ae as we,r as K,w as Y,af as bt,V as gt,l as H,ag as $t,ah as vt,ai as ze,aj as Dt,ak as kt,b as M,al as wt,H as It,am as yt,W as Ct,I as Ie,J as ye,K as Ce,L as Ee,O as ae,X as Oe,an as Fe,ao as Ue,ap as Le,aq as Et,ar as Ot,T as Re,as as Rt,at as ie,R as qe,a4 as Be,a7 as Tt,a8 as St,au as Vt,av as Mt,aw as jt,ax as Pt,ay as At,az as He,aA as Qe,aB as Je,aC as We,aD as ve,aE as Nt,aF as zt,aG as Ft}from"../../chunks/vendor-d35e056c.js";import{u as De,g as ke,b as Te,i as Se,r as ne,d as Ge,e as pe,f as Ke,a as Ut,c as Lt}from"../../chunks/navigation-e96c681c.js";import{b as qt}from"../../chunks/canvas-74f91cf9.js";import"../../chunks/singletons-12a22614.js";function Ye(o,e,n){const t=o.slice();return t[17]=e[n],t}function Bt(o){let e;return{c(){e=P("arrow_drop_down")},l(n){e=A(n,"arrow_drop_down")},m(n,t){D(n,e,t)},d(n){n&&_(e)}}}function Xe(o){let e,n,t=o[7].enrolledClasses,s=[];for(let a=0;a<t.length;a+=1)s[a]=xe(Ye(o,t,a));const l=a=>$(s[a],1,1,()=>{s[a]=null});return{c(){for(let a=0;a<s.length;a+=1)s[a].c();e=H()},l(a){for(let r=0;r<s.length;r+=1)s[r].l(a);e=H()},m(a,r){for(let i=0;i<s.length;i+=1)s[i].m(a,r);D(a,e,r),n=!0},p(a,r){if(r&385){t=a[7].enrolledClasses;let i;for(i=0;i<t.length;i+=1){const f=Ye(a,t,i);s[i]?(s[i].p(f,r),h(s[i],1)):(s[i]=xe(f),s[i].c(),h(s[i],1),s[i].m(e.parentNode,e))}for(K(),i=t.length;i<s.length;i+=1)l(i);Y()}},i(a){if(!n){for(let r=0;r<t.length;r+=1)h(s[r]);n=!0}},o(a){s=s.filter(Boolean);for(let r=0;r<s.length;r+=1)$(s[r]);n=!1},d(a){$t(s,a),a&&_(e)}}}function Ze(o){let e,n;function t(){return o[10](o[17])}return e=new ze({props:{$$slots:{default:[Ht]},$$scope:{ctx:o}}}),e.$on("SMUI:action",t),{c(){U(e.$$.fragment)},l(s){L(e.$$.fragment,s)},m(s,l){q(e,s,l),n=!0},p(s,l){o=s;const a={};l&1048704&&(a.$$scope={dirty:l,ctx:o}),e.$set(a)},i(s){n||(h(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){B(e,s)}}}function Ht(o){let e=o[17].name+"",n,t,s=o[17].description+"",l,a;return{c(){n=P(e),t=P(" ("),l=P(s),a=P(`)\r
              \r
            `)},l(r){n=A(r,e),t=A(r," ("),l=A(r,s),a=A(r,`)\r
              \r
            `)},m(r,i){D(r,n,i),D(r,t,i),D(r,l,i),D(r,a,i)},p(r,i){i&128&&e!==(e=r[17].name+"")&&re(n,e),i&128&&s!==(s=r[17].description+"")&&re(l,s)},d(r){r&&_(n),r&&_(t),r&&_(l),r&&_(a)}}}function xe(o){let e,n,t=o[17].name!==o[0]&&Ze(o);return{c(){t&&t.c(),e=H()},l(s){t&&t.l(s),e=H()},m(s,l){t&&t.m(s,l),D(s,e,l),n=!0},p(s,l){s[17].name!==s[0]?t?(t.p(s,l),l&129&&h(t,1)):(t=Ze(s),t.c(),h(t,1),t.m(e.parentNode,e)):t&&(K(),$(t,1,1,()=>{t=null}),Y())},i(s){n||(h(t),n=!0)},o(s){$(t),n=!1},d(s){t&&t.d(s),s&&_(e)}}}function Qt(o){let e,n,t=o[7].enrolledClasses&&Xe(o);return{c(){t&&t.c(),e=H()},l(s){t&&t.l(s),e=H()},m(s,l){t&&t.m(s,l),D(s,e,l),n=!0},p(s,l){s[7].enrolledClasses?t?(t.p(s,l),l&128&&h(t,1)):(t=Xe(s),t.c(),h(t,1),t.m(e.parentNode,e)):t&&(K(),$(t,1,1,()=>{t=null}),Y())},i(s){n||(h(t),n=!0)},o(s){$(t),n=!1},d(s){t&&t.d(s),s&&_(e)}}}function et(o){let e,n,t;function s(a){o[11](a)}let l={options:o[6],getOptionLabel:Gt,textfield$variant:"outlined",label:"Search class"};return o[3]!==void 0&&(l.value=o[3]),e=new vt({props:l}),_e.push(()=>Pe(e,"value",s)),{c(){U(e.$$.fragment)},l(a){L(e.$$.fragment,a)},m(a,r){q(e,a,r),t=!0},p(a,r){const i={};r&64&&(i.options=a[6]),!n&&r&8&&(n=!0,i.value=a[3],Ae(()=>n=!1)),e.$set(i)},i(a){t||(h(e.$$.fragment,a),t=!0)},o(a){$(e.$$.fragment,a),t=!1},d(a){B(e,a)}}}function Jt(o){let e,n,t,s;e=new we({props:{$$slots:{default:[Qt]},$$scope:{ctx:o}}});let l=o[2].length>0&&et(o);return{c(){U(e.$$.fragment),n=N(),t=R("div"),l&&l.c(),this.h()},l(a){L(e.$$.fragment,a),n=z(a),t=T(a,"DIV",{style:!0});var r=S(t);l&&l.l(r),r.forEach(_),this.h()},h(){m(t,"margin","4px")},m(a,r){q(e,a,r),D(a,n,r),D(a,t,r),l&&l.m(t,null),s=!0},p(a,r){const i={};r&1048705&&(i.$$scope={dirty:r,ctx:a}),e.$set(i),a[2].length>0?l?(l.p(a,r),r&4&&h(l,1)):(l=et(a),l.c(),h(l,1),l.m(t,null)):l&&(K(),$(l,1,1,()=>{l=null}),Y())},i(a){s||(h(e.$$.fragment,a),h(l),s=!0)},o(a){$(e.$$.fragment,a),$(l),s=!1},d(a){B(e,a),a&&_(n),a&&_(t),l&&l.d()}}}function Wt(o){let e,n,t,s,l,a,r,i,f,c,u,p,I,b,g,C;c=new ht({props:{class:"material-icons",$$slots:{default:[Bt]},$$scope:{ctx:o}}});function E(d){o[13](d)}let O={anchor:!1,anchorCorner:"BOTTOM_LEFT",style:"left: 70px; top: 65px; width: 280px; overflow: scroll;",$$slots:{default:[Jt]},$$scope:{ctx:o}};return o[4]!==void 0&&(O.anchorElement=o[4]),p=new je({props:O}),o[12](p),_e.push(()=>Pe(p,"anchorElement",E)),{c(){e=R("div"),n=R("div"),t=R("div"),s=R("h1"),l=P(o[0]),a=N(),r=R("div"),i=P(o[1]),f=N(),U(c.$$.fragment),u=N(),U(p.$$.fragment),this.h()},l(d){e=T(d,"DIV",{});var k=S(e);n=T(k,"DIV",{style:!0});var V=S(n);t=T(V,"DIV",{});var y=S(t);s=T(y,"H1",{style:!0});var Q=S(s);l=A(Q,o[0]),Q.forEach(_),a=z(y),r=T(y,"DIV",{style:!0});var ee=S(r);i=A(ee,o[1]),ee.forEach(_),y.forEach(_),f=z(V),L(c.$$.fragment,V),V.forEach(_),u=z(k),L(p.$$.fragment,k),k.forEach(_),this.h()},h(){m(s,"font-family","Roboto, sans-serif"),m(s,"font-weight","400"),m(s,"margin-left","6px"),m(s,"margin-top","5px"),m(s,"margin-bottom","0px"),m(s,"font-size","2.0rem"),m(r,"font-family","Roboto,sans-serif"),m(r,"font-size","0.875rem"),m(r,"color","rgba(0,0,0,.6)"),m(r,"margin-left","8px"),m(r,"margin-bottom","12px"),m(n,"display","flex"),m(n,"align-items","center")},m(d,k){D(d,e,k),w(e,n),w(n,t),w(t,s),w(s,l),w(t,a),w(t,r),w(r,i),w(n,f),q(c,n,null),w(e,u),q(p,e,null),o[14](e),b=!0,g||(C=ce(n,"click",o[9]),g=!0)},p(d,[k]){(!b||k&1)&&re(l,d[0]),(!b||k&2)&&re(i,d[1]);const V={};k&1048576&&(V.$$scope={dirty:k,ctx:d}),c.$set(V);const y={};k&1048781&&(y.$$scope={dirty:k,ctx:d}),!I&&k&16&&(I=!0,y.anchorElement=d[4],Ae(()=>I=!1)),p.$set(y)},i(d){b||(h(c.$$.fragment,d),h(p.$$.fragment,d),b=!0)},o(d){$(c.$$.fragment,d),$(p.$$.fragment,d),b=!1},d(d){d&&_(e),B(c),o[12](null),B(p),o[14](null),g=!1,C()}}}const Gt=o=>o?`${o.name} (${o.description})`:"";function Kt(o,e,n){let t,s;Z(o,De,d=>n(7,s=d));let{nameOfClass:l}=e,{descriptionOfClass:a}=e,r,i=[],f="",c;ge(async()=>{const d=$e(W(),"/classes"),k=await Ne(d),V=[];k.forEach(y=>{V.push(be({id:y.id},y.data()))}),n(2,i=[...V])});async function u({mitClass:d}){console.log("join mitClass =",d);for(const V of s.enrolledClasses)if(V.id===d.id){alert(`You are already in ${d.name}`);return}const k=W();ue(x(k,`users/${s.uid}`),{enrolledClasses:bt(d),mostRecentClassID:d.id}),ue(x(k,`classes/${d.id}`),{numOfMembers:gt(1)}),ke(`/${d.id}/${d.id}`)}async function p(d){const k=W(),V=x(k,`users/${s.uid}`);ue(V,{mostRecentClassID:d.id}),ke(`/${d.id}/${d.id}`)}const I=()=>c.setOpen(!0),b=d=>p(d);function g(d){f=d,n(3,f)}function C(d){_e[d?"unshift":"push"](()=>{c=d,n(5,c)})}function E(d){r=d,n(4,r)}function O(d){_e[d?"unshift":"push"](()=>{r=d,n(4,r)})}return o.$$set=d=>{"nameOfClass"in d&&n(0,l=d.nameOfClass),"descriptionOfClass"in d&&n(1,a=d.descriptionOfClass)},o.$$.update=()=>{o.$$.dirty&8&&f&&(console.log("selected option =",f),u({mitClass:f})),o.$$.dirty&4&&n(6,t=i)},[l,a,i,f,r,c,t,s,p,I,b,g,C,E,O]}class Yt extends me{constructor(e){super();de(this,e,Kt,Wt,fe,{nameOfClass:0,descriptionOfClass:1})}}function Xt(o){let e,n,t,s,l;return{c(){e=R("div"),n=P(o[0]),t=N(),s=R("div"),l=P(o[1]),this.h()},l(a){e=T(a,"DIV",{style:!0,class:!0});var r=S(e);n=A(r,o[0]),r.forEach(_),t=z(a),s=T(a,"DIV",{style:!0,class:!0});var i=S(s);l=A(i,o[1]),i.forEach(_),this.h()},h(){m(e,"font-family","Roboto, sans-serif"),m(e,"font-weight","400"),m(e,"margin-left","6px"),m(e,"margin-top","5px"),m(e,"margin-bottom","0px"),m(e,"font-size","2.0rem"),M(e,"class","svelte-ek1cfd"),m(s,"font-family","Roboto,sans-serif"),m(s,"font-size","0.875rem"),m(s,"color","rgba(0,0,0,.6)"),m(s,"margin-left","8px"),m(s,"margin-bottom","12px"),M(s,"class","svelte-ek1cfd")},m(a,r){D(a,e,r),w(e,n),D(a,t,r),D(a,s,r),w(s,l)},p(a,r){r&1&&re(n,a[0]),r&2&&re(l,a[1])},i:ae,o:ae,d(a){a&&_(e),a&&_(t),a&&_(s)}}}function Zt(o){let e,n;return e=new Yt({props:{nameOfClass:o[0],descriptionOfClass:o[1]}}),{c(){U(e.$$.fragment)},l(t){L(e.$$.fragment,t)},m(t,s){q(e,t,s),n=!0},p(t,s){const l={};s&1&&(l.nameOfClass=t[0]),s&2&&(l.descriptionOfClass=t[1]),e.$set(l)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function xt(o){let e;const n=o[4].default,t=Ie(n,o,o[5],null);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,l){t&&t.m(s,l),e=!0},p(s,l){t&&t.p&&(!e||l&32)&&ye(t,n,s,s[5],e?Ee(n,s[5],l,null):Ce(s[5]),null)},i(s){e||(h(t,s),e=!0)},o(s){$(t,s),e=!1},d(s){t&&t.d(s)}}}function es(o){let e,n,t,s,l,a,r,i,f,c,u,p,I;const b=[Zt,Xt],g=[];function C(E,O){return E[2].uid?0:1}return r=C(o),i=g[r]=b[r](o),c=new we({props:{$$slots:{default:[xt]},$$scope:{ctx:o}}}),{c(){e=R("div"),n=R("div"),t=R("img"),l=N(),a=R("div"),i.c(),f=N(),U(c.$$.fragment),this.h()},l(E){e=T(E,"DIV",{style:!0,class:!0});var O=S(e);n=T(O,"DIV",{style:!0,class:!0});var d=S(n);t=T(d,"IMG",{src:!0,width:!0,height:!0,alt:!0,class:!0}),l=z(d),a=T(d,"DIV",{class:!0});var k=S(a);i.l(k),k.forEach(_),d.forEach(_),O.forEach(_),f=z(E),L(c.$$.fragment,E),this.h()},h(){Ct(t.src,s="/logo.png")||M(t,"src",s),M(t,"width","60"),M(t,"height","54"),M(t,"alt","web-logo"),M(t,"class","logo-image svelte-ek1cfd"),M(a,"class","svelte-ek1cfd"),m(n,"display","flex"),m(n,"align-items","center"),M(n,"class","svelte-ek1cfd"),m(e,"margin-bottom","12px"),m(e,"padding-top","2px"),m(e,"padding-bottom","0"),m(e,"padding-left","8px"),M(e,"class","mdc-elevation--z"+4+" svelte-ek1cfd")},m(E,O){D(E,e,O),w(e,n),w(n,t),w(n,l),w(n,a),g[r].m(a,null),D(E,f,O),q(c,E,O),u=!0,p||(I=ce(t,"click",o[3]),p=!0)},p(E,O){let d=r;r=C(E),r===d?g[r].p(E,O):(K(),$(g[d],1,1,()=>{g[d]=null}),Y(),i=g[r],i?i.p(E,O):(i=g[r]=b[r](E),i.c()),h(i,1),i.m(a,null));const k={};O&32&&(k.$$scope={dirty:O,ctx:E}),c.$set(k)},i(E){u||(h(i),h(c.$$.fragment,E),u=!0)},o(E){$(i),$(c.$$.fragment,E),u=!1},d(E){E&&_(e),g[r].d(),E&&_(f),B(c,E),p=!1,I()}}}function ts(o){let e,n;return e=new wt({props:{$$slots:{default:[es]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},l(t){L(e.$$.fragment,t)},m(t,s){q(e,t,s),n=!0},p(t,s){const l={};s&39&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function ss(o){let e;return{c(){e=R("main"),this.h()},l(n){e=T(n,"MAIN",{class:!0,id:!0,style:!0});var t=S(e);t.forEach(_),this.h()},h(){M(e,"class","main-content svelte-ek1cfd"),M(e,"id","main-content"),m(e,"padding","0")},m(n,t){D(n,e,t)},d(n){n&&_(e)}}}function ns(o){let e,n,t,s,l;return n=new Dt({props:{style:"overflow-y: scroll; height: 100%;",class:"mdc-elevation--z"+5,$$slots:{default:[ts]},$$scope:{ctx:o}}}),s=new kt({props:{class:"app-content",$$slots:{default:[ss]},$$scope:{ctx:o}}}),{c(){e=R("div"),U(n.$$.fragment),t=N(),U(s.$$.fragment),this.h()},l(a){e=T(a,"DIV",{class:!0});var r=S(e);L(n.$$.fragment,r),t=z(r),L(s.$$.fragment,r),r.forEach(_),this.h()},h(){M(e,"class","drawer-container svelte-ek1cfd")},m(a,r){D(a,e,r),q(n,e,null),w(e,t),q(s,e,null),l=!0},p(a,[r]){const i={};r&39&&(i.$$scope={dirty:r,ctx:a}),n.$set(i);const f={};r&32&&(f.$$scope={dirty:r,ctx:a}),s.$set(f)},i(a){l||(h(n.$$.fragment,a),h(s.$$.fragment,a),l=!0)},o(a){$(n.$$.fragment,a),$(s.$$.fragment,a),l=!1},d(a){a&&_(e),B(n),B(s)}}}function os(o,e,n){let t;Z(o,De,f=>n(2,t=f));let{$$slots:s={},$$scope:l}=e,{nameOfClass:a}=e,{descriptionOfClass:r}=e;function i(){if(t.uid){const f=It();yt(f)}ke("/")}return o.$$set=f=>{"nameOfClass"in f&&n(0,a=f.nameOfClass),"descriptionOfClass"in f&&n(1,r=f.descriptionOfClass),"$$scope"in f&&n(5,l=f.$$scope)},[a,r,t,i,s,l]}class ls extends me{constructor(e){super();de(this,e,os,ns,fe,{nameOfClass:0,descriptionOfClass:1})}}function rs(o,e,n){let t,s,l,a;Z(o,Te,b=>n(10,s=b)),Z(o,De,b=>n(3,l=b)),Z(o,Se,b=>n(4,a=b));let{classID:r}=e,{roomID:i}=e,f,c,u,p,I;return Oe(()=>{I&&I(),a&&(Fe(c),Se.set(!1)),p&&p.cancel()}),ge(()=>{ne.set({}),u=Ue(Le(),".info/connected"),I=Et(u,async b=>{if(b.val()===!0){const g=Ge();f=Ue(Le(),`/class/${r}/room/${i}/participants/${g}`),p=Ot(f),p.set({hasDisconnected:!0,userUID:l.uid}),n(2,c=x(W(),`classes/${r}/participants/${g}`)),Re(c,{uid:l.uid,browserTabID:s,currentRoomID:i,name:t}),Se.set(!0)}})}),o.$$set=b=>{"classID"in b&&n(0,r=b.classID),"roomID"in b&&n(1,i=b.roomID)},o.$$.update=()=>{o.$$.dirty&8&&(t=l.name?l.name:"Beaver #"),o.$$.dirty&30&&a&&l.name&&ue(c,{currentRoomID:i,name:l.name})},[r,i,c,l,a]}class as extends me{constructor(e){super();de(this,e,rs,null,fe,{classID:0,roomID:1})}}const is="0ac8a98cf9bef2827f5beef5cd36c4f42a442863ce904a2469de12caa9097fa1",fs=o=>({activeSpeakerID:o&2,firestoreIDToDailyID:o&1}),tt=o=>({toggleMic:o[2],activeSpeakerID:o[1],firestoreIDToDailyID:o[0]});function cs(o){let e;const n=o[8].default,t=Ie(n,o,o[7],tt);return{c(){t&&t.c()},l(s){t&&t.l(s)},m(s,l){t&&t.m(s,l),e=!0},p(s,[l]){t&&t.p&&(!e||l&131)&&ye(t,n,s,s[7],e?Ee(n,s[7],l,fs):Ce(s[7]),tt)},i(s){e||(h(t,s),e=!0)},o(s){$(t,s),e=!1},d(s){t&&t.d(s)}}}async function us({track:o,participant:e}){switch(o.kind){case"audio":if(e.local)return;{const n=document.createElement("audio");n.srcObject=new MediaStream([o]),n.setAttribute("id","audio"+e.user_id),n.setAttribute("playsinline",!0),n.setAttribute("autoplay",!0),document.getElementById("container-for-audio-elements").appendChild(n)}break}}async function ms({track:o,participant:e}){const n=document.getElementById(o.id);n&&(n.srcObject=null,n.remove())}function ds(o,e,n){let t,s,l;Z(o,pe,y=>n(10,t=y)),Z(o,Te,y=>n(11,s=y)),Z(o,Ke,y=>n(12,l=y));let{$$slots:a={},$$scope:r}=e,{roomID:i}=e,f,c,u,p,I,b="";Oe(()=>{p==="connected"&&k()}),ge(async()=>{await g(),C()});async function g(){return new Promise(async(y,Q)=>{if(!l)try{const X=await navigator.mediaDevices.getUserMedia({audio:!0});Ke.set(X)}catch{return alert(`Don't forget to enable your your mic! Click the "aA" / "i" button beside the URL bar "https://explain.mit.edu", then click "website settings" / "microphone"`),Q("Can't access mic stream")}const[ee]=l.getAudioTracks();f=Rt.createCallObject({audioSource:ee,videoSource:!1});const te=["participant-joined","participant-updated","participant-left"];for(const X of te)f.on(X,()=>{pe.set(f.participants());const oe={};for(const v of Object.keys(t)){const F=t[v],G=F.user_name;G&&(oe[G]=F.user_id)}n(0,c=oe)});f.on("track-started",us),f.on("track-stopped",ms),f.on("active-speaker-change",({activeSpeaker:X})=>{n(1,b=X.peerId)}),f.on("load-attempt-failed",({action:X,errorMsg:oe})=>{alert(X+": "+oe)}),f.on("error",({action:X,errorMsg:oe})=>{alert(X+": "+oe)}),y()})}async function C(){n(4,u="not_connected"),n(5,p="connecting"),n(6,I=i);const{url:y}=await E();y&&(await O(y),n(4,u="connecting"),n(5,p="connected"))}function E(){return new Promise(async y=>{try{const Q=2*60*60,te=await(await fetch("https://api.daily.co/v1/rooms",{method:"POST",headers:{"content-type":"application/json",Authorization:"Bearer "+is},body:JSON.stringify({name:i,properties:{exp:Math.round(Date.now()/1e3)+Q,eject_at_room_exp:!0,start_video_off:!0}})})).json();te.error==="invalid-request-error"&&te.info===`a room named ${i} already exists`?y({url:`https://feynman.daily.co/${i}`}):y(te)}catch(Q){console.error(Q),alert(Q),reject({url:""})}})}function O(y){return new Promise(async(Q,ee)=>{try{await f.join({url:y,userName:s}),Q()}catch(te){console.log("error)"),alert(te),ee()}})}function d(){f.setLocalAudio(!t.local.audio),pe.set(f.participants())}function k(){const y=document.querySelectorAll("audio");for(const Q of y)Q.remove();V(),n(4,u="connected"),n(5,p="not_connected")}function V(){f.leave(),pe.set({}),n(1,b="")}return o.$$set=y=>{"roomID"in y&&n(3,i=y.roomID),"$$scope"in y&&n(7,r=y.$$scope)},o.$$.update=()=>{o.$$.dirty&120&&I!==i&&p==="connected"&&u==="connecting"&&k(),o.$$.dirty&120&&I!==i&&p==="not_connected"&&u==="connected"&&C()},[c,b,d,i,u,p,I,r,a]}class _s extends me{constructor(e){super();de(this,e,ds,cs,fe,{roomID:3})}}function st(o,e,n){const t=o.slice();return t[28]=e[n],t}function nt(o,e,n){const t=o.slice();return t[31]=e[n],t}function ot(o){let e=o[0],n,t,s=lt(o);return{c(){s.c(),n=H()},l(l){s.l(l),n=H()},m(l,a){s.m(l,a),D(l,n,a),t=!0},p(l,a){a[0]&1&&fe(e,e=l[0])?(K(),$(s,1,1,ae),Y(),s=lt(l),s.c(),h(s),s.m(n.parentNode,n)):s.p(l,a)},i(l){t||(h(s),t=!0)},o(l){$(s),t=!1},d(l){l&&_(n),s.d(l)}}}function lt(o){let e,n;return e=new as({props:{classID:o[0],roomID:o[1]}}),{c(){U(e.$$.fragment)},l(t){L(e.$$.fragment,t)},m(t,s){q(e,t,s),n=!0},p(t,s){const l={};s[0]&1&&(l.classID=t[0]),s[0]&2&&(l.roomID=t[1]),e.$set(l)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function ps(o){let e,n;return{c(){e=R("div"),n=P("(empty room)"),this.h()},l(t){e=T(t,"DIV",{style:!0});var s=S(e);n=A(s,"(empty room)"),s.forEach(_),this.h()},h(){m(e,"margin-bottom","2px")},m(t,s){D(t,e,s),w(e,n)},p:ae,d(t){t&&_(e)}}}function hs(o){let e,n=o[28].name+"",t;return{c(){e=R("div"),t=P(n),this.h()},l(s){e=T(s,"DIV",{style:!0,class:!0});var l=S(e);t=A(l,n),l.forEach(_),this.h()},h(){m(e,"white-space","nowrap"),m(e,"overflow","hidden"),m(e,"text-overflow","ellipsis margin-bottom: 2px"),M(e,"class","svelte-ms4my9"),ve(e,"question-item",o[28].name.charAt(o[28].name.length-1)==="?"&&o[28].id!==o[1])},m(s,l){D(s,e,l),w(e,t)},p(s,l){l[0]&32&&n!==(n=s[28].name+"")&&re(t,n),l[0]&34&&ve(e,"question-item",s[28].name.charAt(s[28].name.length-1)==="?"&&s[28].id!==s[1])},d(s){s&&_(e)}}}function rt(o){let e,n,t,s,l,a,r,i={style:"width: 300px",$$slots:{default:[$s]},$$scope:{ctx:o}};return s=new je({props:i}),o[14](s),{c(){e=R("span"),n=P("more_horiz"),t=N(),U(s.$$.fragment),this.h()},l(f){e=T(f,"SPAN",{class:!0,style:!0});var c=S(e);n=A(c,"more_horiz"),c.forEach(_),t=z(f),L(s.$$.fragment,f),this.h()},h(){M(e,"class","material-icons"),m(e,"margin-right","0px"),m(e,"margin-left","auto"),m(e,"color","white"),m(e,"font-size","1.5rem")},m(f,c){D(f,e,c),w(e,n),D(f,t,c),q(s,f,c),l=!0,a||(r=ce(e,"click",function(){Qe(o[6].setOpen(!0))&&o[6].setOpen(!0).apply(this,arguments)}),a=!0)},p(f,c){o=f;const u={};c[0]&65568&&(u.$$scope={dirty:c,ctx:o}),s.$set(u)},i(f){l||(h(s.$$.fragment,f),l=!0)},o(f){$(s.$$.fragment,f),l=!1},d(f){f&&_(e),f&&_(t),o[14](null),B(s,f),a=!1,r()}}}function bs(o){let e;return{c(){e=P("Delete room")},l(n){e=A(n,"Delete room")},m(n,t){D(n,e,t)},d(n){n&&_(e)}}}function gs(o){let e,n;function t(){return o[13](o[28])}return e=new ze({props:{$$slots:{default:[bs]},$$scope:{ctx:o}}}),e.$on("SMUI:action",t),{c(){U(e.$$.fragment)},l(s){L(e.$$.fragment,s)},m(s,l){q(e,s,l),n=!0},p(s,l){o=s;const a={};l[0]&65536&&(a.$$scope={dirty:l,ctx:o}),e.$set(a)},i(s){n||(h(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){B(e,s)}}}function $s(o){let e,n;return e=new we({props:{$$slots:{default:[gs]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},l(t){L(e.$$.fragment,t)},m(t,s){q(e,t,s),n=!0},p(t,s){const l={};s[0]&65568&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function at(o){let e=[],n=new Map,t,s,l=o[7][o[28].id];const a=r=>r[31].browserTabID;for(let r=0;r<l.length;r+=1){let i=nt(o,l,r),f=a(i);n.set(f,e[r]=ft(f,i))}return{c(){for(let r=0;r<e.length;r+=1)e[r].c();t=H()},l(r){for(let i=0;i<e.length;i+=1)e[i].l(r);t=H()},m(r,i){for(let f=0;f<e.length;f+=1)e[f].m(r,i);D(r,t,i),s=!0},p(r,i){i[0]&234881952&&(l=r[7][r[28].id],K(),e=Je(e,i,a,1,r,l,n,t.parentNode,We,ft,t,nt),Y())},i(r){if(!s){for(let i=0;i<l.length;i+=1)h(e[i]);s=!0}},o(r){for(let i=0;i<e.length;i+=1)$(e[i]);s=!1},d(r){for(let i=0;i<e.length;i+=1)e[i].d(r);r&&_(t)}}}function it(o){let e,n,t,s;const l=[Ds,vs],a=[];function r(i,f){return i[31].browserTabID===i[9]?0:i[8][i[27][i[31].browserTabID]]?1:-1}return~(e=r(o))&&(n=a[e]=l[e](o)),{c(){n&&n.c(),t=H()},l(i){n&&n.l(i),t=H()},m(i,f){~e&&a[e].m(i,f),D(i,t,f),s=!0},p(i,f){let c=e;e=r(i),e===c?~e&&a[e].p(i,f):(n&&(K(),$(a[c],1,1,()=>{a[c]=null}),Y()),~e?(n=a[e],n?n.p(i,f):(n=a[e]=l[e](i),n.c()),h(n,1),n.m(t.parentNode,t)):n=null)},i(i){s||(h(n),s=!0)},o(i){$(n),s=!1},d(i){~e&&a[e].d(i),i&&_(t)}}}function vs(o){let e;function n(l,a){return l[8][l[27][l[31].browserTabID]].audio?ws:ks}let t=n(o),s=t(o);return{c(){s.c(),e=H()},l(l){s.l(l),e=H()},m(l,a){s.m(l,a),D(l,e,a)},p(l,a){t===(t=n(l))&&s?s.p(l,a):(s.d(1),s=t(l),s&&(s.c(),s.m(e.parentNode,e)))},i:ae,o:ae,d(l){s.d(l),l&&_(e)}}}function Ds(o){let e,n,t,s,l,a,r;t=new Nt({props:{checked:o[8].local.audio,style:"margin: 0 !important"}});function i(u,p){return u[8].local.audio?ys:Is}let f=i(o),c=f(o);return{c(){e=R("div"),n=R("div"),U(t.$$.fragment),s=N(),c.c(),this.h()},l(u){e=T(u,"DIV",{style:!0});var p=S(e);n=T(p,"DIV",{style:!0});var I=S(n);L(t.$$.fragment,I),I.forEach(_),s=z(p),c.l(p),p.forEach(_),this.h()},h(){m(n,"padding-top","5px"),m(e,"display","flex"),m(e,"align-items","center"),m(e,"margin-right","6px"),m(e,"margin-left","auto")},m(u,p){D(u,e,p),w(e,n),q(t,n,null),w(e,s),c.m(e,null),l=!0,a||(r=ce(n,"click",zt(Ft(function(){Qe(o[26])&&o[26].apply(this,arguments)}))),a=!0)},p(u,p){o=u;const I={};p[0]&256&&(I.checked=o[8].local.audio),t.$set(I),f!==(f=i(o))&&(c.d(1),c=f(o),c&&(c.c(),c.m(e,null)))},i(u){l||(h(t.$$.fragment,u),l=!0)},o(u){$(t.$$.fragment,u),l=!1},d(u){u&&_(e),B(t),c.d(),a=!1,r()}}}function ks(o){let e,n;return{c(){e=R("span"),n=P("mic_off"),this.h()},l(t){e=T(t,"SPAN",{class:!0,style:!0});var s=S(e);n=A(s,"mic_off"),s.forEach(_),this.h()},h(){M(e,"class","material-icons"),m(e,"margin-right","0"),m(e,"margin-left","auto"),m(e,"font-size","1.1rem"),m(e,"color","red")},m(t,s){D(t,e,s),w(e,n)},p:ae,d(t){t&&_(e)}}}function ws(o){let e,n;return{c(){e=R("span"),n=P("mic"),this.h()},l(t){e=T(t,"SPAN",{class:!0,style:!0});var s=S(e);n=A(s,"mic"),s.forEach(_),this.h()},h(){M(e,"class","material-icons"),m(e,"margin-right","0"),m(e,"margin-left","auto"),m(e,"font-size","1.1rem"),m(e,"color",o[27]&&o[27][o[31].browserTabID]&&o[27][o[31].browserTabID]===o[25]?"white":"")},m(t,s){D(t,e,s),w(e,n)},p(t,s){s[0]&167772320&&m(e,"color",t[27]&&t[27][t[31].browserTabID]&&t[27][t[31].browserTabID]===t[25]?"white":"")},d(t){t&&_(e)}}}function Is(o){let e,n;return{c(){e=R("div"),n=P("muted"),this.h()},l(t){e=T(t,"DIV",{style:!0});var s=S(e);n=A(s,"muted"),s.forEach(_),this.h()},h(){m(e,"font-size","0.7rem"),m(e,"margin-left","6px"),m(e,"color","red")},m(t,s){D(t,e,s),w(e,n)},d(t){t&&_(e)}}}function ys(o){let e,n;return{c(){e=R("div"),n=P("voice on"),this.h()},l(t){e=T(t,"DIV",{style:!0});var s=S(e);n=A(s,"voice on"),s.forEach(_),this.h()},h(){m(e,"font-size","0.7rem"),m(e,"margin-left","6px"),m(e,"color","#33ff33")},m(t,s){D(t,e,s),w(e,n)},d(t){t&&_(e)}}}function ft(o,e){let n,t,s=e[31].name+"",l,a,r=Object.keys(e[8]).length>0,i,f,c=r&&it(e);return{key:o,first:null,c(){n=R("div"),t=R("div"),l=P(s),a=N(),c&&c.c(),i=N(),this.h()},l(u){n=T(u,"DIV",{style:!0});var p=S(n);t=T(p,"DIV",{style:!0,class:!0});var I=S(t);l=A(I,s),I.forEach(_),a=z(p),c&&c.l(p),i=z(p),p.forEach(_),this.h()},h(){m(t,"font-size","0.7rem"),m(t,"margin-left","6px"),M(t,"class","svelte-ms4my9"),ve(t,"speaking",e[27]&&e[27][e[31].browserTabID]&&e[27][e[31].browserTabID]===e[25]),m(n,"display","flex"),m(n,"align-items","center"),m(n,"padding-left","8px"),m(n,"padding-right","8px"),this.first=n},m(u,p){D(u,n,p),w(n,t),w(t,l),w(n,a),c&&c.m(n,null),w(n,i),f=!0},p(u,p){e=u,(!f||p[0]&160)&&s!==(s=e[31].name+"")&&re(l,s),p[0]&167772320&&ve(t,"speaking",e[27]&&e[27][e[31].browserTabID]&&e[27][e[31].browserTabID]===e[25]),p[0]&256&&(r=Object.keys(e[8]).length>0),r?c?(c.p(e,p),p[0]&256&&h(c,1)):(c=it(e),c.c(),h(c,1),c.m(n,i)):c&&(K(),$(c,1,1,()=>{c=null}),Y())},i(u){f||(h(c),f=!0)},o(u){$(c),f=!1},d(u){u&&_(n),c&&c.d()}}}function ct(o,e){let n,t,s,l,a,r,i,f,c,u;function p(O,d){if(O[28].name)return hs;if(O[28].name==="")return ps}let I=p(e),b=I&&I(e),g=e[28].id===e[1]&e[2].uid&&rt(e),C=e[7][e[28].id]&&at(e);function E(){return e[15](e[28])}return{key:o,first:null,c(){n=R("div"),t=R("div"),s=R("div"),b&&b.c(),l=N(),g&&g.c(),a=N(),C&&C.c(),i=N(),this.h()},l(O){n=T(O,"DIV",{style:!0});var d=S(n);t=T(d,"DIV",{class:!0,style:!0});var k=S(t);s=T(k,"DIV",{style:!0});var V=S(s);b&&b.l(V),l=z(V),g&&g.l(V),V.forEach(_),a=z(k),C&&C.l(k),k.forEach(_),i=z(d),d.forEach(_),this.h()},h(){m(s,"display","flex"),m(s,"align-items","center"),m(s,"padding-left","8px"),m(s,"padding-right","5px"),m(s,"padding-top","6px"),M(t,"class",r=""+(He(e[28].id===e[1]?"selected":"")+" svelte-ms4my9")),m(t,"padding-bottom","6px"),m(t,"opacity","90%"),m(t,"border-radius","5px"),m(n,"padding","6px"),this.first=n},m(O,d){D(O,n,d),w(n,t),w(t,s),b&&b.m(s,null),w(s,l),g&&g.m(s,null),w(t,a),C&&C.m(t,null),w(n,i),f=!0,c||(u=ce(n,"click",E),c=!0)},p(O,d){e=O,I===(I=p(e))&&b?b.p(e,d):(b&&b.d(1),b=I&&I(e),b&&(b.c(),b.m(s,l))),e[28].id===e[1]&e[2].uid?g?(g.p(e,d),d[0]&38&&h(g,1)):(g=rt(e),g.c(),h(g,1),g.m(s,null)):g&&(K(),$(g,1,1,()=>{g=null}),Y()),e[7][e[28].id]?C?(C.p(e,d),d[0]&160&&h(C,1)):(C=at(e),C.c(),h(C,1),C.m(t,null)):C&&(K(),$(C,1,1,()=>{C=null}),Y()),(!f||d[0]&34&&r!==(r=""+(He(e[28].id===e[1]?"selected":"")+" svelte-ms4my9")))&&M(t,"class",r)},i(O){f||(h(g),h(C),f=!0)},o(O){$(g),$(C),f=!1},d(O){O&&_(n),b&&b.d(),g&&g.d(),C&&C.d(),c=!1,u()}}}function ut(o){let e,n,t,s,l,a;return{c(){e=R("div"),n=R("span"),t=P("add"),s=P(`\r
        new room`),this.h()},l(r){e=T(r,"DIV",{style:!0});var i=S(e);n=T(i,"SPAN",{class:!0,style:!0});var f=S(n);t=A(f,"add"),f.forEach(_),s=A(i,`\r
        new room`),i.forEach(_),this.h()},h(){M(n,"class","material-icons"),m(n,"margin-left","6px"),m(n,"margin-right","5px"),m(n,"margin-top","2.5px"),m(n,"font-size","1.2rem"),m(e,"padding","6px"),m(e,"display","flex"),m(e,"align-items","center")},m(r,i){D(r,e,i),w(e,n),w(n,t),w(e,s),l||(a=ce(e,"click",o[10]),l=!0)},p:ae,d(r){r&&_(e),l=!1,a()}}}function Cs(o){let e=[],n=new Map,t,s,l,a=o[5];const r=f=>f[28].id+f[1];for(let f=0;f<a.length;f+=1){let c=st(o,a,f),u=r(c);n.set(u,e[f]=ct(u,c))}let i=o[2].uid&&ut(o);return{c(){for(let f=0;f<e.length;f+=1)e[f].c();t=N(),i&&i.c(),s=H()},l(f){for(let c=0;c<e.length;c+=1)e[c].l(f);t=z(f),i&&i.l(f),s=H()},m(f,c){for(let u=0;u<e.length;u+=1)e[u].m(f,c);D(f,t,c),i&&i.m(f,c),D(f,s,c),l=!0},p(f,c){c[0]&234884071&&(a=f[5],K(),e=Je(e,c,r,1,f,a,n,t.parentNode,We,ct,t,st),Y()),f[2].uid?i?i.p(f,c):(i=ut(f),i.c(),i.m(s.parentNode,s)):i&&(i.d(1),i=null)},i(f){if(!l){for(let c=0;c<a.length;c+=1)h(e[c]);l=!0}},o(f){for(let c=0;c<e.length;c+=1)$(e[c]);l=!1},d(f){for(let c=0;c<e.length;c+=1)e[c].d(f);f&&_(t),i&&i.d(f),f&&_(s)}}}function Es(o){let e,n;return e=new ls({props:{nameOfClass:o[3],descriptionOfClass:o[4],$$slots:{default:[Cs]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},l(t){L(e.$$.fragment,t)},m(t,s){q(e,t,s),n=!0},p(t,s){const l={};s[0]&8&&(l.nameOfClass=t[3]),s[0]&16&&(l.descriptionOfClass=t[4]),s[0]&234947559&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){n||(h(e.$$.fragment,t),n=!0)},o(t){$(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function Os(o){let e,n,t,s,l,a,r=o[2].uid&&ot(o);s=new _s({props:{roomID:o[1],$$slots:{default:[Es,({activeSpeakerID:c,toggleMic:u,firestoreIDToDailyID:p})=>({25:c,26:u,27:p}),({activeSpeakerID:c,toggleMic:u,firestoreIDToDailyID:p})=>[(c?33554432:0)|(u?67108864:0)|(p?134217728:0)]]},$$scope:{ctx:o}}});const i=o[12].default,f=Ie(i,o,o[16],null);return{c(){r&&r.c(),e=N(),n=R("div"),t=N(),U(s.$$.fragment),l=N(),f&&f.c(),this.h()},l(c){r&&r.l(c),e=z(c),n=T(c,"DIV",{id:!0});var u=S(n);u.forEach(_),t=z(c),L(s.$$.fragment,c),l=z(c),f&&f.l(c),this.h()},h(){M(n,"id","container-for-audio-elements")},m(c,u){r&&r.m(c,u),D(c,e,u),D(c,n,u),D(c,t,u),q(s,c,u),D(c,l,u),f&&f.m(c,u),a=!0},p(c,u){c[2].uid?r?(r.p(c,u),u[0]&4&&h(r,1)):(r=ot(c),r.c(),h(r,1),r.m(e.parentNode,e)):r&&(K(),$(r,1,1,()=>{r=null}),Y());const p={};u[0]&2&&(p.roomID=c[1]),u[0]&234947583&&(p.$$scope={dirty:u,ctx:c}),s.$set(p),f&&f.p&&(!a||u[0]&65536)&&ye(f,i,c,c[16],a?Ee(i,c[16],u,null):Ce(c[16]),null)},i(c){a||(h(r),h(s.$$.fragment,c),h(f,c),a=!0)},o(c){$(r),$(s.$$.fragment,c),$(f,c),a=!1},d(c){r&&r.d(c),c&&_(e),c&&_(n),c&&_(t),B(s,c),c&&_(l),f&&f.d(c)}}}function Ps({page:o}){return{props:{classID:o.params.class,roomID:o.params.room}}}function Rs(o,e,n){let t,s,l,a;Z(o,ne,v=>n(7,t=v)),Z(o,De,v=>n(2,s=v)),Z(o,pe,v=>n(8,l=v)),Z(o,Te,v=>n(9,a=v));let{$$slots:r={},$$scope:i}=e,{classID:f}=e,{roomID:c}=e;const u=`classes/${f}/`;let p=[],I="",b="",g=[],C;function E(){for(const v of p)v();p=[]}async function O(){const v=x(W(),`classes/${f}`),F=await qe(v);n(3,I=F.data().name),n(4,b=F.data().description)}ge(async()=>{window.addEventListener("resize",V),V()}),Oe(()=>{E(),window.removeEventListener("resize",V)});async function d(){for(const J of g)if(J.name===""){alert("There is still an empty room available");return}const v=Ge(),F=x(W(),u+`rooms/${v}`),G=x(W(),u+`blackboards/${v}`);await Promise.all([Re(F,{name:"",blackboards:[v],date:new Date().toISOString()}),Re(G,{})])}function k(){const{height:v,width:F}=qt();Ut.set(v),Lt.set(F)}function V(){setTimeout(k,100)}function y(){const v=$e(W(),`classes/${f}/participants`);p.push(Be(v,F=>{F.docChanges().forEach(G=>{const J=G.doc.data(),j=J.currentRoomID;switch(G.type){case"added":t[j]||ie(ne,t[j]=[],t),ie(ne,t[j]=[...t[j],J],t);break;case"modified":for(const se of Object.keys(t))for(const he of t[se])he.browserTabID===J.browserTabID&&ie(ne,t[se]=t[se].filter(le=>le.browserTabID!==J.browserTabID),t);t[j]||ie(ne,t[j]=[],t),ie(ne,t[j]=[...t[j],J],t);break;case"removed":ie(ne,t[j]=t[j].filter(se=>se.browserTabID!==J.browserTabID),t);break}})}))}function Q(){const v=$e(W(),`classes/${f}/rooms`),F=Tt(v,St("date","asc"));p.push(Be(F,async G=>{const J=[];if(G.forEach(j=>{J.push(be({id:j.id,ref:j.ref.path},j.data()))}),n(5,g=J),g.length===0){const j=$e(W(),`classes/${f}/rooms`),se=[];(await Ne(j)).docs.forEach(le=>{se.push(be({id:le.id},le.data()))});for(const le of se){const mt=x(W(),`classes/${f}/rooms/${le.id}`);ue(mt,{date:Date.now()})}}}))}async function ee(v){const F=[];for(const J of v.blackboards)F.push(qe(x(W(),u+`blackboards/${J}`)));await Promise.all(F);const G=[];for(const J of F){const j=await J;(await j.data()).audioRefFullPath&&G.push(Vt(Mt(jt(),audioRefFullPath)));const he=Pt(),le=At(he,"recursiveDelete");G.push(le({path:`/classes/${f}/blackboards/${j.id}`}).then(console.log(`Deleted blackboard /classes/${f}/blackboards/${j.id}`)))}await Promise.all(G),await Fe(x(W(),u+`rooms/${v.id}`))}const te=v=>ee(v);function X(v){_e[v?"unshift":"push"](()=>{C=v,n(6,C)})}const oe=v=>ke(`/${f}/${v.id}`);return o.$$set=v=>{"classID"in v&&n(0,f=v.classID),"roomID"in v&&n(1,c=v.roomID),"$$scope"in v&&n(16,i=v.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&1&&f&&(E(),ie(ne,t=[],t),O(),y(),Q()),o.$$.dirty[0]&7&&c&&s.uid){const v=x(W(),`users/${s.uid}`);ue(v,{mostRecentClassAndRoomID:`/${f}/${c}`})}},[f,c,s,I,b,g,C,t,l,a,d,ee,r,te,X,oe,i]}class As extends me{constructor(e){super();de(this,e,Rs,Os,fe,{classID:0,roomID:1},null,[-1,-1])}}export{As as default,Ps as load};

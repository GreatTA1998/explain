var gt=Object.defineProperty;var Me=Object.getOwnPropertySymbols;var bt=Object.prototype.hasOwnProperty,$t=Object.prototype.propertyIsEnumerable;var je=(l,e,s)=>e in l?gt(l,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[e]=s,ve=(l,e)=>{for(var s in e||(e={}))bt.call(e,s)&&je(l,s,e[s]);if(Me)for(var s of Me(e))$t.call(e,s)&&je(l,s,e[s]);return l};import{S as de,i as me,s as ce,ad as vt,ae as Ne,a5 as he,af as ze,e as w,t as M,k as j,j as F,c as E,a as S,g as N,d as _,n as z,m as q,b as A,M as d,f as C,N as $,o as B,a2 as ae,h as ie,ag as Le,x as b,u as y,v as H,F as K,A as Ie,a8 as De,Q as W,ab as Ue,P as te,_ as pe,ah as Dt,ai as we,aj as kt,V as yt,l as Y,r as G,w as Z,ak as It,al as Fe,am as wt,O as x,a3 as Et,a4 as Ct,H as Ot,an as Rt,ao as St,ap as Tt,aq as Vt,W as At,I as Ee,J as Ce,K as Oe,L as Re,Z as Se,ar as qe,as as Be,at as He,au as Pt,av as Mt,T as Te,aw as jt,ax as fe,R as Je,a6 as Qe,a9 as Nt,aa as zt,ay as Lt,az as Ut,aA as Ft,aB as qt,aC as Bt,aD as Ke,aE as We,aF as Ye,aG as Ge,aH as ke,aI as Ht,aJ as Jt,aK as Qt}from"../../chunks/vendor-e2c30920.js";import{u as _e,b as Ve,i as Ae,r as le,g as Ze,d as ge,e as Pe,w as Xe,a as Kt,c as Wt}from"../../chunks/store-b8ea9b61.js";import{g as be}from"../../chunks/navigation-51f4a605.js";import{b as Yt}from"../../chunks/canvas-9dadfeb6.js";import"../../chunks/singletons-12a22614.js";function xe(l,e,s){const t=l.slice();return t[18]=e[s],t}function Gt(l){let e;return{c(){e=M("arrow_drop_down")},l(s){e=N(s,"arrow_drop_down")},m(s,t){C(s,e,t)},d(s){s&&_(e)}}}function et(l){let e,s,t=l[7].enrolledClasses,n=[];for(let r=0;r<t.length;r+=1)n[r]=st(xe(l,t,r));const o=r=>y(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=Y()},l(r){for(let i=0;i<n.length;i+=1)n[i].l(r);e=Y()},m(r,i){for(let f=0;f<n.length;f+=1)n[f].m(r,i);C(r,e,i),s=!0},p(r,i){if(i&641){t=r[7].enrolledClasses;let f;for(f=0;f<t.length;f+=1){const c=xe(r,t,f);n[f]?(n[f].p(c,i),b(n[f],1)):(n[f]=st(c),n[f].c(),b(n[f],1),n[f].m(e.parentNode,e))}for(G(),f=t.length;f<n.length;f+=1)o(f);Z()}},i(r){if(!s){for(let i=0;i<t.length;i+=1)b(n[i]);s=!0}},o(r){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)y(n[i]);s=!1},d(r){It(n,r),r&&_(e)}}}function tt(l){let e,s;function t(){return l[10](l[18])}return e=new Fe({props:{$$slots:{default:[Zt]},$$scope:{ctx:l}}}),e.$on("SMUI:action",t),{c(){F(e.$$.fragment)},l(n){q(e.$$.fragment,n)},m(n,o){B(e,n,o),s=!0},p(n,o){l=n;const r={};o&2097280&&(r.$$scope={dirty:o,ctx:l}),e.$set(r)},i(n){s||(b(e.$$.fragment,n),s=!0)},o(n){y(e.$$.fragment,n),s=!1},d(n){H(e,n)}}}function Zt(l){let e,s=l[18].name+"",t,n,o=l[18].description+"",r,i,f;return{c(){e=w("div"),t=M(s),n=M(" ("),r=M(o),i=M(")"),f=j(),this.h()},l(c){e=E(c,"DIV",{class:!0});var a=S(e);t=N(a,s),n=N(a," ("),r=N(a,o),i=N(a,")"),a.forEach(_),f=z(c),this.h()},h(){A(e,"class","my-truncated-text")},m(c,a){C(c,e,a),$(e,t),$(e,n),$(e,r),$(e,i),C(c,f,a)},p(c,a){a&128&&s!==(s=c[18].name+"")&&ie(t,s),a&128&&o!==(o=c[18].description+"")&&ie(r,o)},d(c){c&&_(e),c&&_(f)}}}function st(l){let e,s,t=l[18].name!==l[0]&&tt(l);return{c(){t&&t.c(),e=Y()},l(n){t&&t.l(n),e=Y()},m(n,o){t&&t.m(n,o),C(n,e,o),s=!0},p(n,o){n[18].name!==n[0]?t?(t.p(n,o),o&129&&b(t,1)):(t=tt(n),t.c(),b(t,1),t.m(e.parentNode,e)):t&&(G(),y(t,1,1,()=>{t=null}),Z())},i(n){s||(b(t),s=!0)},o(n){y(t),s=!1},d(n){t&&t.d(n),n&&_(e)}}}function nt(l){let e,s,t;function n(r){l[11](r)}let o={options:l[6],getOptionLabel:ts,textfield$variant:"outlined",label:"Search class",menu$style:"max-height: 226px;"};return l[3]!==void 0&&(o.value=l[3]),e=new wt({props:o}),he.push(()=>ze(e,"value",n)),e.$on("SMUIAutocomplete:",l[12]),{c(){F(e.$$.fragment)},l(r){q(e.$$.fragment,r)},m(r,i){B(e,r,i),t=!0},p(r,i){const f={};i&64&&(f.options=r[6]),!s&&i&8&&(s=!0,f.value=r[3],Le(()=>s=!1)),e.$set(f)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){y(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Xt(l){let e,s,t,n=l[7].enrolledClasses&&et(l),o=l[2].length>0&&nt(l);return{c(){n&&n.c(),e=j(),s=w("div"),o&&o.c(),this.h()},l(r){n&&n.l(r),e=z(r),s=E(r,"DIV",{style:!0});var i=S(s);o&&o.l(i),i.forEach(_),this.h()},h(){d(s,"margin-left","12px"),d(s,"margin-bottom","4px"),d(s,"margin-top","16px")},m(r,i){n&&n.m(r,i),C(r,e,i),C(r,s,i),o&&o.m(s,null),t=!0},p(r,i){r[7].enrolledClasses?n?(n.p(r,i),i&128&&b(n,1)):(n=et(r),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(G(),y(n,1,1,()=>{n=null}),Z()),r[2].length>0?o?(o.p(r,i),i&4&&b(o,1)):(o=nt(r),o.c(),b(o,1),o.m(s,null)):o&&(G(),y(o,1,1,()=>{o=null}),Z())},i(r){t||(b(n),b(o),t=!0)},o(r){y(n),y(o),t=!1},d(r){n&&n.d(r),r&&_(e),r&&_(s),o&&o.d()}}}function xt(l){let e,s;return e=new we({props:{$$slots:{default:[Xt]},$$scope:{ctx:l}}}),{c(){F(e.$$.fragment)},l(t){q(e.$$.fragment,t)},m(t,n){B(e,t,n),s=!0},p(t,n){const o={};n&2097357&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){y(e.$$.fragment,t),s=!1},d(t){H(e,t)}}}function es(l){let e,s,t,n,o,r,i,f,c,a,u,m,v,D,g,O;a=new vt({props:{class:"material-icons",$$slots:{default:[Gt]},$$scope:{ctx:l}}});function P(h){l[14](h)}let T={anchor:!1,anchorCorner:"BOTTOM_LEFT",style:"left: 70px; top: 5px; width: 240px; overflow: visible;",$$slots:{default:[xt]},$$scope:{ctx:l}};return l[4]!==void 0&&(T.anchorElement=l[4]),m=new Ne({props:T}),l[13](m),he.push(()=>ze(m,"anchorElement",P)),{c(){e=w("div"),s=w("div"),t=w("div"),n=w("h1"),o=M(l[0]),r=j(),i=w("div"),f=M(l[1]),c=j(),F(a.$$.fragment),u=j(),F(m.$$.fragment),this.h()},l(h){e=E(h,"DIV",{});var p=S(e);s=E(p,"DIV",{style:!0});var R=S(s);t=E(R,"DIV",{});var V=S(t);n=E(V,"H1",{class:!0,style:!0});var I=S(n);o=N(I,l[0]),I.forEach(_),r=z(V),i=E(V,"DIV",{class:!0,style:!0});var U=S(i);f=N(U,l[1]),U.forEach(_),V.forEach(_),c=z(R),q(a.$$.fragment,R),R.forEach(_),u=z(p),q(m.$$.fragment,p),p.forEach(_),this.h()},h(){A(n,"class","my-truncated-text"),d(n,"width","150px"),d(n,"font-family","Roboto, sans-serif"),d(n,"font-weight","400"),d(n,"margin-left","6px"),d(n,"margin-top","5px"),d(n,"margin-bottom","0px"),d(n,"font-size","2.0rem"),A(i,"class","my-truncated-text"),d(i,"width","150px"),d(i,"font-family","Roboto, sans-serif"),d(i,"font-size","0.875rem"),d(i,"color","rgba(0,0,0,.6)"),d(i,"margin-left",6+2+"px"),d(i,"margin-bottom","12px"),d(s,"display","flex"),d(s,"align-items","center")},m(h,p){C(h,e,p),$(e,s),$(s,t),$(t,n),$(n,o),$(t,r),$(t,i),$(i,f),$(s,c),B(a,s,null),$(e,u),B(m,e,null),l[15](e),D=!0,g||(O=ae(s,"click",l[8]),g=!0)},p(h,[p]){(!D||p&1)&&ie(o,h[0]),(!D||p&2)&&ie(f,h[1]);const R={};p&2097152&&(R.$$scope={dirty:p,ctx:h}),a.$set(R);const V={};p&2097357&&(V.$$scope={dirty:p,ctx:h}),!v&&p&16&&(v=!0,V.anchorElement=h[4],Le(()=>v=!1)),m.$set(V)},i(h){D||(b(a.$$.fragment,h),b(m.$$.fragment,h),D=!0)},o(h){y(a.$$.fragment,h),y(m.$$.fragment,h),D=!1},d(h){h&&_(e),H(a),l[13](null),H(m),l[15](null),g=!1,O()}}}const ts=l=>l?`${l.name} (${l.description})`:"";function ss(l,e,s){let t,n;K(l,_e,p=>s(7,n=p));let{nameOfClass:o}=e,{descriptionOfClass:r}=e,i,f=[],c="",a;Ie(async()=>{const p=De(W(),"/classes"),R=await Ue(p),V=[];R.forEach(I=>{V.push(ve({id:I.id},I.data()))}),s(2,f=[...V])});function u(){a.setOpen(!0)}async function m({mitClass:p}){console.log("join mitClass =",p);for(const V of n.enrolledClasses)if(V.id===p.id){alert(`You are already in ${p.name}`);return}const R=W();pe(te(R,`users/${n.uid}`),{enrolledClasses:kt(p),mostRecentClassID:p.id}),pe(te(R,`classes/${p.id}`),{numOfMembers:yt(1)}),s(3,c=""),be(`/${p.id}/${p.id}`)}async function v(p){const R=W(),V=te(R,`users/${n.uid}`);pe(V,{mostRecentClassID:p.id}),be(`/${p.id}/${p.id}`)}const D=p=>v(p);function g(p){c=p,s(3,c)}function O(p){Dt.call(this,l,p)}function P(p){he[p?"unshift":"push"](()=>{a=p,s(5,a)})}function T(p){i=p,s(4,i)}function h(p){he[p?"unshift":"push"](()=>{i=p,s(4,i)})}return l.$$set=p=>{"nameOfClass"in p&&s(0,o=p.nameOfClass),"descriptionOfClass"in p&&s(1,r=p.descriptionOfClass)},l.$$.update=()=>{l.$$.dirty&8&&c&&m({mitClass:c}),l.$$.dirty&4&&s(6,t=f)},[o,r,f,c,i,a,t,n,u,v,D,g,O,P,T,h]}class ns extends de{constructor(e){super();me(this,e,ss,es,ce,{nameOfClass:0,descriptionOfClass:1})}}function ls(l){let e,s,t,n,o,r,i,f,c,a,u,m,v,D,g,O;return{c(){e=w("div"),s=w("div"),t=w("h2"),n=M("App Settings"),o=j(),r=w("span"),i=M("close"),f=j(),c=w("div"),a=M("TODO: notifications and name"),u=j(),m=w("div"),v=w("button"),D=M("Logout"),this.h()},l(P){e=E(P,"DIV",{id:!0,class:!0});var T=S(e);s=E(T,"DIV",{style:!0});var h=S(s);t=E(h,"H2",{});var p=S(t);n=N(p,"App Settings"),p.forEach(_),o=z(h),r=E(h,"SPAN",{class:!0,style:!0});var R=S(r);i=N(R,"close"),R.forEach(_),h.forEach(_),f=z(T),c=E(T,"DIV",{style:!0});var V=S(c);a=N(V,"TODO: notifications and name"),V.forEach(_),u=z(T),m=E(T,"DIV",{style:!0});var I=S(m);v=E(I,"BUTTON",{style:!0});var U=S(v);D=N(U,"Logout"),U.forEach(_),I.forEach(_),T.forEach(_),this.h()},h(){A(r,"class","material-icons"),d(r,"margin-right","0"),d(r,"margin-left","auto"),d(s,"display","flex"),d(s,"align-items","center"),d(s,"margin-left","10px"),d(s,"margin-right","10px"),d(c,"margin-left","10px"),d(v,"margin-right","16px"),d(v,"margin-left","auto"),d(m,"display","flex"),d(m,"margin-left","4px"),d(m,"margin-bottom","0px"),d(m,"margin-top","auto"),A(e,"id","app-popup"),A(e,"class","svelte-1ptar6u")},m(P,T){C(P,e,T),$(e,s),$(s,t),$(t,n),$(s,o),$(s,r),$(r,i),$(e,f),$(e,c),$(c,a),$(e,u),$(e,m),$(m,v),$(v,D),g||(O=[ae(r,"click",l[2]),ae(v,"click",l[1])],g=!0)},p:x,i:x,o:x,d(P){P&&_(e),g=!1,Et(O)}}}function os(l,e,s){let t;K(l,_e,i=>s(3,t=i));const n=Ct();function o(){if(t.uid){const i=Ot();Rt(i)}be("/")}return[n,o,()=>n("popup-close")]}class rs extends de{constructor(e){super();me(this,e,os,ls,ce,{})}}function lt(l){let e,s;return e=new rs({}),e.$on("popup-close",l[6]),{c(){F(e.$$.fragment)},l(t){q(e.$$.fragment,t)},m(t,n){B(e,t,n),s=!0},p:x,i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){y(e.$$.fragment,t),s=!1},d(t){H(e,t)}}}function as(l){let e,s,t,n,o;return{c(){e=w("div"),s=M(l[0]),t=j(),n=w("div"),o=M(l[1]),this.h()},l(r){e=E(r,"DIV",{style:!0,class:!0});var i=S(e);s=N(i,l[0]),i.forEach(_),t=z(r),n=E(r,"DIV",{style:!0,class:!0});var f=S(n);o=N(f,l[1]),f.forEach(_),this.h()},h(){d(e,"font-family","Roboto, sans-serif"),d(e,"font-weight","400"),d(e,"margin-left","6px"),d(e,"margin-top","5px"),d(e,"margin-bottom","0px"),d(e,"font-size","2.0rem"),A(e,"class","svelte-ek1cfd"),d(n,"font-family","Roboto,sans-serif"),d(n,"font-size","0.875rem"),d(n,"color","rgba(0,0,0,.6)"),d(n,"margin-left","8px"),d(n,"margin-bottom","12px"),A(n,"class","svelte-ek1cfd")},m(r,i){C(r,e,i),$(e,s),C(r,t,i),C(r,n,i),$(n,o)},p(r,i){i&1&&ie(s,r[0]),i&2&&ie(o,r[1])},i:x,o:x,d(r){r&&_(e),r&&_(t),r&&_(n)}}}function is(l){let e,s;return e=new ns({props:{nameOfClass:l[0],descriptionOfClass:l[1]}}),{c(){F(e.$$.fragment)},l(t){q(e.$$.fragment,t)},m(t,n){B(e,t,n),s=!0},p(t,n){const o={};n&1&&(o.nameOfClass=t[0]),n&2&&(o.descriptionOfClass=t[1]),e.$set(o)},i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){y(e.$$.fragment,t),s=!1},d(t){H(e,t)}}}function cs(l){let e;const s=l[4].default,t=Ee(s,l,l[7],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,o){t&&t.p&&(!e||o&128)&&Ce(t,s,n,n[7],e?Re(s,n[7],o,null):Oe(n[7]),null)},i(n){e||(b(t,n),e=!0)},o(n){y(t,n),e=!1},d(n){t&&t.d(n)}}}function fs(l){let e,s,t,n,o,r,i,f,c,a,u,m,v,D,g=l[2]&&lt(l);const O=[is,as],P=[];function T(h,p){return h[3].uid?0:1}return f=T(l),c=P[f]=O[f](l),u=new we({props:{$$slots:{default:[cs]},$$scope:{ctx:l}}}),{c(){e=w("div"),s=w("div"),t=w("img"),o=j(),g&&g.c(),r=j(),i=w("div"),c.c(),a=j(),F(u.$$.fragment),this.h()},l(h){e=E(h,"DIV",{style:!0,class:!0});var p=S(e);s=E(p,"DIV",{style:!0,class:!0});var R=S(s);t=E(R,"IMG",{src:!0,width:!0,height:!0,alt:!0,class:!0}),o=z(R),g&&g.l(R),r=z(R),i=E(R,"DIV",{class:!0});var V=S(i);c.l(V),V.forEach(_),R.forEach(_),p.forEach(_),a=z(h),q(u.$$.fragment,h),this.h()},h(){At(t.src,n="/logo.png")||A(t,"src",n),A(t,"width","60"),A(t,"height","54"),A(t,"alt","web-logo"),A(t,"class","logo-image svelte-ek1cfd"),A(i,"class","svelte-ek1cfd"),d(s,"display","flex"),d(s,"align-items","center"),A(s,"class","svelte-ek1cfd"),d(e,"margin-bottom","12px"),d(e,"padding-top","2px"),d(e,"padding-bottom","0"),d(e,"padding-left","8px"),A(e,"class","mdc-elevation--z"+4+" svelte-ek1cfd")},m(h,p){C(h,e,p),$(e,s),$(s,t),$(s,o),g&&g.m(s,null),$(s,r),$(s,i),P[f].m(i,null),C(h,a,p),B(u,h,p),m=!0,v||(D=ae(t,"click",l[5]),v=!0)},p(h,p){h[2]?g?(g.p(h,p),p&4&&b(g,1)):(g=lt(h),g.c(),b(g,1),g.m(s,r)):g&&(G(),y(g,1,1,()=>{g=null}),Z());let R=f;f=T(h),f===R?P[f].p(h,p):(G(),y(P[R],1,1,()=>{P[R]=null}),Z(),c=P[f],c?c.p(h,p):(c=P[f]=O[f](h),c.c()),b(c,1),c.m(i,null));const V={};p&128&&(V.$$scope={dirty:p,ctx:h}),u.$set(V)},i(h){m||(b(g),b(c),b(u.$$.fragment,h),m=!0)},o(h){y(g),y(c),y(u.$$.fragment,h),m=!1},d(h){h&&_(e),g&&g.d(),P[f].d(),h&&_(a),H(u,h),v=!1,D()}}}function us(l){let e,s;return e=new Vt({props:{$$slots:{default:[fs]},$$scope:{ctx:l}}}),{c(){F(e.$$.fragment)},l(t){q(e.$$.fragment,t)},m(t,n){B(e,t,n),s=!0},p(t,n){const o={};n&143&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){y(e.$$.fragment,t),s=!1},d(t){H(e,t)}}}function ds(l){let e;return{c(){e=w("main"),this.h()},l(s){e=E(s,"MAIN",{class:!0,id:!0,style:!0});var t=S(e);t.forEach(_),this.h()},h(){A(e,"class","main-content svelte-ek1cfd"),A(e,"id","main-content"),d(e,"padding","0")},m(s,t){C(s,e,t)},d(s){s&&_(e)}}}function ms(l){let e,s,t,n,o;return s=new St({props:{style:"overflow-y: scroll; height: 100%;",class:"mdc-elevation--z"+5,$$slots:{default:[us]},$$scope:{ctx:l}}}),n=new Tt({props:{class:"app-content",$$slots:{default:[ds]},$$scope:{ctx:l}}}),{c(){e=w("div"),F(s.$$.fragment),t=j(),F(n.$$.fragment),this.h()},l(r){e=E(r,"DIV",{class:!0});var i=S(e);q(s.$$.fragment,i),t=z(i),q(n.$$.fragment,i),i.forEach(_),this.h()},h(){A(e,"class","drawer-container svelte-ek1cfd")},m(r,i){C(r,e,i),B(s,e,null),$(e,t),B(n,e,null),o=!0},p(r,[i]){const f={};i&143&&(f.$$scope={dirty:i,ctx:r}),s.$set(f);const c={};i&128&&(c.$$scope={dirty:i,ctx:r}),n.$set(c)},i(r){o||(b(s.$$.fragment,r),b(n.$$.fragment,r),o=!0)},o(r){y(s.$$.fragment,r),y(n.$$.fragment,r),o=!1},d(r){r&&_(e),H(s),H(n)}}}function ps(l,e,s){let t;K(l,_e,u=>s(3,t=u));let{$$slots:n={},$$scope:o}=e,{nameOfClass:r}=e,{descriptionOfClass:i}=e,f=!1;const c=()=>s(2,f=!0),a=()=>s(2,f=!1);return l.$$set=u=>{"nameOfClass"in u&&s(0,r=u.nameOfClass),"descriptionOfClass"in u&&s(1,i=u.descriptionOfClass),"$$scope"in u&&s(7,o=u.$$scope)},[r,i,f,t,n,c,a,o]}class _s extends de{constructor(e){super();me(this,e,ps,ms,ce,{nameOfClass:0,descriptionOfClass:1})}}function hs(l,e,s){let t,n,o,r;K(l,Ve,D=>s(10,n=D)),K(l,_e,D=>s(3,o=D)),K(l,Ae,D=>s(4,r=D));let{classID:i}=e,{roomID:f}=e,c,a,u,m,v;return Se(()=>{v&&v(),r&&(qe(a),Ae.set(!1)),m&&m.cancel()}),Ie(()=>{le.set({}),u=Be(He(),".info/connected"),v=Pt(u,async D=>{if(D.val()===!0){const g=Ze();c=Be(He(),`/class/${i}/room/${f}/participants/${g}`),m=Mt(c),m.set({hasDisconnected:!0,userUID:o.uid}),s(2,a=te(W(),`classes/${i}/participants/${g}`)),Te(a,{uid:o.uid,browserTabID:n,currentRoomID:f,name:t}),Ae.set(!0)}})}),l.$$set=D=>{"classID"in D&&s(0,i=D.classID),"roomID"in D&&s(1,f=D.roomID)},l.$$.update=()=>{l.$$.dirty&8&&(t=o.name?o.name:"Beaver #"),l.$$.dirty&30&&r&&o.name&&pe(a,{currentRoomID:f,name:o.name})},[i,f,a,o,r]}class gs extends de{constructor(e){super();me(this,e,hs,null,ce,{classID:0,roomID:1})}}const bs="0ac8a98cf9bef2827f5beef5cd36c4f42a442863ce904a2469de12caa9097fa1",$s=l=>({activeSpeakerID:l&2,firestoreIDToDailyID:l&1}),ot=l=>({toggleMic:l[2],activeSpeakerID:l[1],firestoreIDToDailyID:l[0]});function vs(l){let e;const s=l[9].default,t=Ee(s,l,l[8],ot);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,o){t&&t.m(n,o),e=!0},p(n,[o]){t&&t.p&&(!e||o&259)&&Ce(t,s,n,n[8],e?Re(s,n[8],o,$s):Oe(n[8]),ot)},i(n){e||(b(t,n),e=!0)},o(n){y(t,n),e=!1},d(n){t&&t.d(n)}}}async function Ds({track:l,participant:e}){switch(l.kind){case"audio":if(e.local)return;{const s=document.createElement("audio");s.srcObject=new MediaStream([l]),s.setAttribute("id","audio"+e.user_id),s.setAttribute("playsinline",!0),s.setAttribute("autoplay",!0),document.getElementById("container-for-audio-elements").appendChild(s)}break}}async function ks({track:l,participant:e}){const s=document.getElementById(l.id);s&&(s.srcObject=null,s.remove())}function ys(l,e,s){let t,n,o,r;K(l,ge,I=>s(11,t=I)),K(l,Ve,I=>s(12,n=I)),K(l,Pe,I=>s(13,o=I)),K(l,_e,I=>s(7,r=I));let{$$slots:i={},$$scope:f}=e,{roomID:c}=e,a,u,m,v,D,g="";Se(()=>{v==="connected"&&R(),o&&(o.getAudioTracks().forEach(I=>{I.stop()}),Pe.set(null))});async function O(){return new Promise(async(I,U)=>{if(!o)try{const X=await navigator.mediaDevices.getUserMedia({audio:!0});Pe.set(X)}catch{return alert(`Don't forget to enable your your mic! Click the "aA" / "i" button beside the URL bar "https://explain.mit.edu", then click "website settings" / "microphone"`),U("Can't access mic stream")}const[ue]=o.getAudioTracks();a=jt.createCallObject({audioSource:ue,videoSource:!1});const se=["participant-joined","participant-updated","participant-left"];for(const X of se)a.on(X,()=>{ge.set(a.participants());const oe={};for(const ye of Object.keys(t)){const k=t[ye],J=k.user_name;J&&(oe[J]=k.user_id)}s(0,u=oe)});a.on("track-started",Ds),a.on("track-stopped",ks),a.on("active-speaker-change",({activeSpeaker:X})=>{s(1,g=X.peerId)}),a.on("load-attempt-failed",({action:X,errorMsg:oe})=>{alert(X+": "+oe)}),a.on("error",({action:X,errorMsg:oe})=>{alert(X+": "+oe)}),I()})}async function P(){s(4,m="not_connected"),s(5,v="connecting"),s(6,D=c);const{url:I}=await T();I&&(await h(I),s(4,m="connecting"),s(5,v="connected"))}function T(){return new Promise(async I=>{try{const U=2*60*60,se=await(await fetch("https://api.daily.co/v1/rooms",{method:"POST",headers:{"content-type":"application/json",Authorization:"Bearer "+bs},body:JSON.stringify({name:c,properties:{exp:Math.round(Date.now()/1e3)+U,eject_at_room_exp:!0,start_video_off:!0}})})).json();se.error==="invalid-request-error"&&se.info===`a room named ${c} already exists`?I({url:`https://feynman.daily.co/${c}`}):I(se)}catch(U){console.error(U),alert(U),reject({url:""})}})}function h(I){return new Promise(async(U,ue)=>{try{await a.join({url:I,userName:n}),U()}catch(se){console.log("error)"),alert(se),ue()}})}function p(){a.setLocalAudio(!t.local.audio),ge.set(a.participants())}function R(){const I=document.querySelectorAll("audio");for(const U of I)U.remove();V(),s(4,m="connected"),s(5,v="not_connected")}function V(){a.leave(),ge.set({}),s(1,g="")}return l.$$set=I=>{"roomID"in I&&s(3,c=I.roomID),"$$scope"in I&&s(8,f=I.$$scope)},l.$$.update=()=>{if(l.$$.dirty&120&&D!==c&&v==="connected"&&m==="connecting"&&R(),l.$$.dirty&120&&D!==c&&v==="not_connected"&&m==="connected"&&P(),l.$$.dirty&128&&r.uid){async function I(){await O(),P()}I()}},[u,g,p,c,m,v,D,r,f,i]}class Is extends de{constructor(e){super();me(this,e,ys,vs,ce,{roomID:3})}}function rt(l,e,s){const t=l.slice();return t[30]=e[s],t}function at(l,e,s){const t=l.slice();return t[33]=e[s],t}function it(l){let e=l[0],s,t,n=ct(l);return{c(){n.c(),s=Y()},l(o){n.l(o),s=Y()},m(o,r){n.m(o,r),C(o,s,r),t=!0},p(o,r){r[0]&1&&ce(e,e=o[0])?(G(),y(n,1,1,x),Z(),n=ct(o),n.c(),b(n),n.m(s.parentNode,s)):n.p(o,r)},i(o){t||(b(n),t=!0)},o(o){y(n),t=!1},d(o){o&&_(s),n.d(o)}}}function ct(l){let e,s;return e=new gs({props:{classID:l[0],roomID:l[1]}}),{c(){F(e.$$.fragment)},l(t){q(e.$$.fragment,t)},m(t,n){B(e,t,n),s=!0},p(t,n){const o={};n[0]&1&&(o.classID=t[0]),n[0]&2&&(o.roomID=t[1]),e.$set(o)},i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){y(e.$$.fragment,t),s=!1},d(t){H(e,t)}}}function ws(l){let e,s;return{c(){e=w("div"),s=M("(no title)"),this.h()},l(t){e=E(t,"DIV",{style:!0});var n=S(e);s=N(n,"(no title)"),n.forEach(_),this.h()},h(){d(e,"margin-bottom","2px")},m(t,n){C(t,e,n),$(e,s)},p:x,d(t){t&&_(e)}}}function Es(l){let e,s=l[30].name+"",t;return{c(){e=w("div"),t=M(s),this.h()},l(n){e=E(n,"DIV",{class:!0,style:!0});var o=S(e);t=N(o,s),o.forEach(_),this.h()},h(){A(e,"class","my-truncated-text svelte-ms4my9"),d(e,"margin-bottom","2px"),ke(e,"question-item",l[30].name.charAt(l[30].name.length-1)==="?"&&l[30].id!==l[1])},m(n,o){C(n,e,o),$(e,t)},p(n,o){o[0]&32&&s!==(s=n[30].name+"")&&ie(t,s),o[0]&34&&ke(e,"question-item",n[30].name.charAt(n[30].name.length-1)==="?"&&n[30].id!==n[1])},d(n){n&&_(e)}}}function ft(l){let e,s,t,n,o,r,i,f={style:"width: 300px",$$slots:{default:[Rs]},$$scope:{ctx:l}};return n=new Ne({props:f}),l[15](n),{c(){e=w("span"),s=M("more_vert"),t=j(),F(n.$$.fragment),this.h()},l(c){e=E(c,"SPAN",{class:!0,style:!0});var a=S(e);s=N(a,"more_vert"),a.forEach(_),t=z(c),q(n.$$.fragment,c),this.h()},h(){A(e,"class","material-icons"),d(e,"margin-right","0px"),d(e,"margin-left","auto"),d(e,"color","white"),d(e,"font-size","1.5rem")},m(c,a){C(c,e,a),$(e,s),C(c,t,a),B(n,c,a),o=!0,r||(i=ae(e,"click",function(){We(l[6].setOpen(!0))&&l[6].setOpen(!0).apply(this,arguments)}),r=!0)},p(c,a){l=c;const u={};a[0]&131104&&(u.$$scope={dirty:a,ctx:l}),n.$set(u)},i(c){o||(b(n.$$.fragment,c),o=!0)},o(c){y(n.$$.fragment,c),o=!1},d(c){c&&_(e),c&&_(t),l[15](null),H(n,c),r=!1,i()}}}function Cs(l){let e;return{c(){e=M("Delete room")},l(s){e=N(s,"Delete room")},m(s,t){C(s,e,t)},d(s){s&&_(e)}}}function Os(l){let e,s;function t(){return l[14](l[30])}return e=new Fe({props:{$$slots:{default:[Cs]},$$scope:{ctx:l}}}),e.$on("SMUI:action",t),{c(){F(e.$$.fragment)},l(n){q(e.$$.fragment,n)},m(n,o){B(e,n,o),s=!0},p(n,o){l=n;const r={};o[0]&131072&&(r.$$scope={dirty:o,ctx:l}),e.$set(r)},i(n){s||(b(e.$$.fragment,n),s=!0)},o(n){y(e.$$.fragment,n),s=!1},d(n){H(e,n)}}}function Rs(l){let e,s;return e=new we({props:{$$slots:{default:[Os]},$$scope:{ctx:l}}}),{c(){F(e.$$.fragment)},l(t){q(e.$$.fragment,t)},m(t,n){B(e,t,n),s=!0},p(t,n){const o={};n[0]&131104&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){y(e.$$.fragment,t),s=!1},d(t){H(e,t)}}}function ut(l){let e=[],s=new Map,t,n,o=l[7][l[30].id];const r=i=>i[33].browserTabID;for(let i=0;i<o.length;i+=1){let f=at(l,o,i),c=r(f);s.set(c,e[i]=mt(c,f))}return{c(){for(let i=0;i<e.length;i+=1)e[i].c();t=Y()},l(i){for(let f=0;f<e.length;f+=1)e[f].l(i);t=Y()},m(i,f){for(let c=0;c<e.length;c+=1)e[c].m(i,f);C(i,t,f),n=!0},p(i,f){f[0]&939525024&&(o=i[7][i[30].id],G(),e=Ye(e,f,r,1,i,o,s,t.parentNode,Ge,mt,t,at),Z())},i(i){if(!n){for(let f=0;f<o.length;f+=1)b(e[f]);n=!0}},o(i){for(let f=0;f<e.length;f+=1)y(e[f]);n=!1},d(i){for(let f=0;f<e.length;f+=1)e[f].d(i);i&&_(t)}}}function dt(l){let e,s,t,n;const o=[Ts,Ss],r=[];function i(f,c){return f[33].browserTabID===f[9]?0:f[8][f[29][f[33].browserTabID]]?1:-1}return~(e=i(l))&&(s=r[e]=o[e](l)),{c(){s&&s.c(),t=Y()},l(f){s&&s.l(f),t=Y()},m(f,c){~e&&r[e].m(f,c),C(f,t,c),n=!0},p(f,c){let a=e;e=i(f),e===a?~e&&r[e].p(f,c):(s&&(G(),y(r[a],1,1,()=>{r[a]=null}),Z()),~e?(s=r[e],s?s.p(f,c):(s=r[e]=o[e](f),s.c()),b(s,1),s.m(t.parentNode,t)):s=null)},i(f){n||(b(s),n=!0)},o(f){y(s),n=!1},d(f){~e&&r[e].d(f),f&&_(t)}}}function Ss(l){let e;function s(o,r){return o[8][o[29][o[33].browserTabID]].audio?As:Vs}let t=s(l),n=t(l);return{c(){n.c(),e=Y()},l(o){n.l(o),e=Y()},m(o,r){n.m(o,r),C(o,e,r)},p(o,r){t===(t=s(o))&&n?n.p(o,r):(n.d(1),n=t(o),n&&(n.c(),n.m(e.parentNode,e)))},i:x,o:x,d(o){n.d(o),o&&_(e)}}}function Ts(l){let e,s,t,n,o,r,i;t=new Ht({props:{checked:l[8].local.audio,style:"margin: 0 !important"}});function f(u,m){return u[8].local.audio?Ms:Ps}let c=f(l),a=c(l);return{c(){e=w("div"),s=w("div"),F(t.$$.fragment),n=j(),a.c(),this.h()},l(u){e=E(u,"DIV",{style:!0});var m=S(e);s=E(m,"DIV",{style:!0});var v=S(s);q(t.$$.fragment,v),v.forEach(_),n=z(m),a.l(m),m.forEach(_),this.h()},h(){d(s,"padding-top","5px"),d(e,"display","flex"),d(e,"align-items","center"),d(e,"margin-right","6px"),d(e,"margin-left","auto")},m(u,m){C(u,e,m),$(e,s),B(t,s,null),$(e,n),a.m(e,null),o=!0,r||(i=ae(s,"click",Jt(Qt(function(){We(l[28])&&l[28].apply(this,arguments)}))),r=!0)},p(u,m){l=u;const v={};m[0]&256&&(v.checked=l[8].local.audio),t.$set(v),c!==(c=f(l))&&(a.d(1),a=c(l),a&&(a.c(),a.m(e,null)))},i(u){o||(b(t.$$.fragment,u),o=!0)},o(u){y(t.$$.fragment,u),o=!1},d(u){u&&_(e),H(t),a.d(),r=!1,i()}}}function Vs(l){let e,s;return{c(){e=w("span"),s=M("mic_off"),this.h()},l(t){e=E(t,"SPAN",{class:!0,style:!0});var n=S(e);s=N(n,"mic_off"),n.forEach(_),this.h()},h(){A(e,"class","material-icons"),d(e,"margin-right","0"),d(e,"margin-left","auto"),d(e,"font-size","1.1rem"),d(e,"color","red")},m(t,n){C(t,e,n),$(e,s)},p:x,d(t){t&&_(e)}}}function As(l){let e,s;return{c(){e=w("span"),s=M("mic"),this.h()},l(t){e=E(t,"SPAN",{class:!0,style:!0});var n=S(e);s=N(n,"mic"),n.forEach(_),this.h()},h(){A(e,"class","material-icons"),d(e,"margin-right","0"),d(e,"margin-left","auto"),d(e,"font-size","1.1rem"),d(e,"color",l[29]&&l[29][l[33].browserTabID]&&l[29][l[33].browserTabID]===l[27]?"white":"")},m(t,n){C(t,e,n),$(e,s)},p(t,n){n[0]&671088800&&d(e,"color",t[29]&&t[29][t[33].browserTabID]&&t[29][t[33].browserTabID]===t[27]?"white":"")},d(t){t&&_(e)}}}function Ps(l){let e,s;return{c(){e=w("div"),s=M("muted"),this.h()},l(t){e=E(t,"DIV",{style:!0});var n=S(e);s=N(n,"muted"),n.forEach(_),this.h()},h(){d(e,"font-size","0.7rem"),d(e,"margin-left","6px"),d(e,"color","red")},m(t,n){C(t,e,n),$(e,s)},d(t){t&&_(e)}}}function Ms(l){let e,s;return{c(){e=w("div"),s=M("voice on"),this.h()},l(t){e=E(t,"DIV",{style:!0});var n=S(e);s=N(n,"voice on"),n.forEach(_),this.h()},h(){d(e,"font-size","0.7rem"),d(e,"margin-left","6px"),d(e,"color","#33ff33")},m(t,n){C(t,e,n),$(e,s)},d(t){t&&_(e)}}}function mt(l,e){let s,t,n=e[33].name+"",o,r,i=Object.keys(e[8]).length>0,f,c,a=i&&dt(e);return{key:l,first:null,c(){s=w("div"),t=w("div"),o=M(n),r=j(),a&&a.c(),f=j(),this.h()},l(u){s=E(u,"DIV",{style:!0});var m=S(s);t=E(m,"DIV",{style:!0,class:!0});var v=S(t);o=N(v,n),v.forEach(_),r=z(m),a&&a.l(m),f=z(m),m.forEach(_),this.h()},h(){d(t,"font-size","0.7rem"),d(t,"margin-left","6px"),A(t,"class","svelte-ms4my9"),ke(t,"speaking",e[29]&&e[29][e[33].browserTabID]&&e[29][e[33].browserTabID]===e[27]),d(s,"display","flex"),d(s,"align-items","center"),d(s,"padding-left","8px"),d(s,"padding-right","8px"),this.first=s},m(u,m){C(u,s,m),$(s,t),$(t,o),$(s,r),a&&a.m(s,null),$(s,f),c=!0},p(u,m){e=u,(!c||m[0]&160)&&n!==(n=e[33].name+"")&&ie(o,n),m[0]&671088800&&ke(t,"speaking",e[29]&&e[29][e[33].browserTabID]&&e[29][e[33].browserTabID]===e[27]),m[0]&256&&(i=Object.keys(e[8]).length>0),i?a?(a.p(e,m),m[0]&256&&b(a,1)):(a=dt(e),a.c(),b(a,1),a.m(s,f)):a&&(G(),y(a,1,1,()=>{a=null}),Z())},i(u){c||(b(a),c=!0)},o(u){y(a),c=!1},d(u){u&&_(s),a&&a.d()}}}function pt(l,e){let s,t,n,o,r,i,f,c,a,u;function m(T,h){return T[30].name?Es:ws}let v=m(e),D=v(e),g=e[30].id===e[1]&&e[2].uid&&ft(e),O=e[7][e[30].id]&&ut(e);function P(){return e[16](e[30])}return{key:l,first:null,c(){s=w("div"),t=w("div"),n=w("div"),D.c(),o=j(),g&&g.c(),r=j(),O&&O.c(),f=j(),this.h()},l(T){s=E(T,"DIV",{style:!0});var h=S(s);t=E(h,"DIV",{class:!0,style:!0});var p=S(t);n=E(p,"DIV",{style:!0});var R=S(n);D.l(R),o=z(R),g&&g.l(R),R.forEach(_),r=z(p),O&&O.l(p),p.forEach(_),f=z(h),h.forEach(_),this.h()},h(){d(n,"display","flex"),d(n,"align-items","center"),d(n,"padding-left","8px"),d(n,"padding-right","5px"),d(n,"padding-top","6px"),A(t,"class",i=""+(Ke(e[30].id===e[1]?"selected":"")+" svelte-ms4my9")),d(t,"padding-bottom","6px"),d(t,"opacity","90%"),d(t,"border-radius","5px"),d(s,"padding","6px"),this.first=s},m(T,h){C(T,s,h),$(s,t),$(t,n),D.m(n,null),$(n,o),g&&g.m(n,null),$(t,r),O&&O.m(t,null),$(s,f),c=!0,a||(u=ae(s,"click",P),a=!0)},p(T,h){e=T,v===(v=m(e))&&D?D.p(e,h):(D.d(1),D=v(e),D&&(D.c(),D.m(n,o))),e[30].id===e[1]&&e[2].uid?g?(g.p(e,h),h[0]&38&&b(g,1)):(g=ft(e),g.c(),b(g,1),g.m(n,null)):g&&(G(),y(g,1,1,()=>{g=null}),Z()),e[7][e[30].id]?O?(O.p(e,h),h[0]&160&&b(O,1)):(O=ut(e),O.c(),b(O,1),O.m(t,null)):O&&(G(),y(O,1,1,()=>{O=null}),Z()),(!c||h[0]&34&&i!==(i=""+(Ke(e[30].id===e[1]?"selected":"")+" svelte-ms4my9")))&&A(t,"class",i)},i(T){c||(b(g),b(O),c=!0)},o(T){y(g),y(O),c=!1},d(T){T&&_(s),D.d(),g&&g.d(),O&&O.d(),a=!1,u()}}}function _t(l){let e,s,t,n,o,r;return{c(){e=w("div"),s=w("span"),t=M("add"),n=M(`\r
        new room`),this.h()},l(i){e=E(i,"DIV",{style:!0});var f=S(e);s=E(f,"SPAN",{class:!0,style:!0});var c=S(s);t=N(c,"add"),c.forEach(_),n=N(f,`\r
        new room`),f.forEach(_),this.h()},h(){A(s,"class","material-icons"),d(s,"margin-left","6px"),d(s,"margin-right","5px"),d(s,"margin-top","2.5px"),d(s,"font-size","1.2rem"),d(e,"padding","6px"),d(e,"display","flex"),d(e,"align-items","center")},m(i,f){C(i,e,f),$(e,s),$(s,t),$(e,n),o||(r=ae(e,"click",l[11]),o=!0)},p:x,d(i){i&&_(e),o=!1,r()}}}function js(l){let e=[],s=new Map,t,n,o,r=l[5];const i=c=>c[30].id+c[1];for(let c=0;c<r.length;c+=1){let a=rt(l,r,c),u=i(a);s.set(u,e[c]=pt(u,a))}let f=l[2].uid&&_t(l);return{c(){for(let c=0;c<e.length;c+=1)e[c].c();t=j(),f&&f.c(),n=Y()},l(c){for(let a=0;a<e.length;a+=1)e[a].l(c);t=z(c),f&&f.l(c),n=Y()},m(c,a){for(let u=0;u<e.length;u+=1)e[u].m(c,a);C(c,t,a),f&&f.m(c,a),C(c,n,a),o=!0},p(c,a){a[0]&939530214&&(r=c[5],G(),e=Ye(e,a,i,1,c,r,s,t.parentNode,Ge,pt,t,rt),Z()),c[2].uid?f?f.p(c,a):(f=_t(c),f.c(),f.m(n.parentNode,n)):f&&(f.d(1),f=null)},i(c){if(!o){for(let a=0;a<r.length;a+=1)b(e[a]);o=!0}},o(c){for(let a=0;a<e.length;a+=1)y(e[a]);o=!1},d(c){for(let a=0;a<e.length;a+=1)e[a].d(c);c&&_(t),f&&f.d(c),c&&_(n)}}}function Ns(l){let e,s;return e=new _s({props:{nameOfClass:l[3],descriptionOfClass:l[4],$$slots:{default:[js]},$$scope:{ctx:l}}}),{c(){F(e.$$.fragment)},l(t){q(e.$$.fragment,t)},m(t,n){B(e,t,n),s=!0},p(t,n){const o={};n[0]&8&&(o.nameOfClass=t[3]),n[0]&16&&(o.descriptionOfClass=t[4]),n[0]&939656166&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){y(e.$$.fragment,t),s=!1},d(t){H(e,t)}}}function zs(l){let e,s,t,n,o,r,i=l[2].uid&&it(l);n=new Is({props:{roomID:l[1],$$slots:{default:[Ns,({activeSpeakerID:a,toggleMic:u,firestoreIDToDailyID:m})=>({27:a,28:u,29:m}),({activeSpeakerID:a,toggleMic:u,firestoreIDToDailyID:m})=>[(a?134217728:0)|(u?268435456:0)|(m?536870912:0)]]},$$scope:{ctx:l}}});const f=l[13].default,c=Ee(f,l,l[17],null);return{c(){i&&i.c(),e=j(),s=w("div"),t=j(),F(n.$$.fragment),o=j(),c&&c.c(),this.h()},l(a){i&&i.l(a),e=z(a),s=E(a,"DIV",{id:!0});var u=S(s);u.forEach(_),t=z(a),q(n.$$.fragment,a),o=z(a),c&&c.l(a),this.h()},h(){A(s,"id","container-for-audio-elements")},m(a,u){i&&i.m(a,u),C(a,e,u),C(a,s,u),C(a,t,u),B(n,a,u),C(a,o,u),c&&c.m(a,u),r=!0},p(a,u){a[2].uid?i?(i.p(a,u),u[0]&4&&b(i,1)):(i=it(a),i.c(),b(i,1),i.m(e.parentNode,e)):i&&(G(),y(i,1,1,()=>{i=null}),Z());const m={};u[0]&2&&(m.roomID=a[1]),u[0]&939656190&&(m.$$scope={dirty:u,ctx:a}),n.$set(m),c&&c.p&&(!r||u[0]&131072)&&Ce(c,f,a,a[17],r?Re(f,a[17],u,null):Oe(a[17]),null)},i(a){r||(b(i),b(n.$$.fragment,a),b(c,a),r=!0)},o(a){y(i),y(n.$$.fragment,a),y(c,a),r=!1},d(a){i&&i.d(a),a&&_(e),a&&_(s),a&&_(t),H(n,a),a&&_(o),c&&c.d(a)}}}function Qs({page:l}){return{props:{classID:l.params.class,roomID:l.params.room}}}function Ls(l,e,s){let t,n,o,r,i;K(l,le,k=>s(7,t=k)),K(l,Xe,k=>s(19,n=k)),K(l,_e,k=>s(2,o=k)),K(l,ge,k=>s(8,r=k)),K(l,Ve,k=>s(9,i=k));let{$$slots:f={},$$scope:c}=e,{classID:a}=e,{roomID:u}=e;const m=`classes/${a}/`;let v=[],D="",g="",O=[],P;function T(){for(const k of v)k();v=[]}async function h(){const k=te(W(),`classes/${a}`),J=await Je(k);s(3,D=J.data().name),s(4,g=J.data().description)}Ie(async()=>{window.addEventListener("resize",I),I()}),Se(()=>{T(),window.removeEventListener("resize",I)});function p(k){n?window.confirm("You're still recording, are you sure you want to leave?")&&(Xe.set(!1),be(`/${a}/${k}`)):be(`/${a}/${k}`)}async function R(){for(const Q of O)if(Q.name===""){alert("There is still an empty room available");return}const k=Ze(),J=te(W(),m+`rooms/${k}`),ne=te(W(),m+`blackboards/${k}`);await Promise.all([Te(J,{name:"",blackboards:[k],date:new Date().toISOString()}),Te(ne,{recordState:"pre_record"})])}function V(){const{height:k,width:J}=Yt();Kt.set(k),Wt.set(J)}function I(){setTimeout(V,100)}function U(){const k=De(W(),`classes/${a}/participants`);v.push(Qe(k,J=>{J.docChanges().forEach(ne=>{const Q=ne.doc.data(),L=Q.currentRoomID;switch(ne.type){case"added":t[L]||fe(le,t[L]=[],t),fe(le,t[L]=[...t[L],Q],t);break;case"modified":for(const ee of Object.keys(t))for(const $e of t[ee])$e.browserTabID===Q.browserTabID&&fe(le,t[ee]=t[ee].filter(re=>re.browserTabID!==Q.browserTabID),t);t[L]||fe(le,t[L]=[],t),fe(le,t[L]=[...t[L],Q],t);break;case"removed":fe(le,t[L]=t[L].filter(ee=>ee.browserTabID!==Q.browserTabID),t);break}})}))}function ue(){const k=De(W(),`classes/${a}/rooms`),J=Nt(k,zt("date","asc"));v.push(Qe(J,async ne=>{const Q=[];if(ne.forEach(L=>{Q.push(ve({id:L.id,ref:L.ref.path},L.data()))}),s(5,O=Q),O.length===0){const L=De(W(),`classes/${a}/rooms`),ee=[];(await Ue(L)).docs.forEach(re=>{ee.push(ve({id:re.id},re.data()))});for(const re of ee){const ht=te(W(),`classes/${a}/rooms/${re.id}`);pe(ht,{date:Date.toISOString()})}}}))}async function se(k){const J=[];for(const Q of k.blackboards)J.push(Je(te(W(),m+`blackboards/${Q}`)));await Promise.all(J);const ne=[];for(const Q of J){const L=await Q,ee=await L.data();ee.audioRefFullPath&&ne.push(Lt(Ut(Ft(),ee.audioRefFullPath)));const $e=qt(),re=Bt($e,"recursiveDelete");ne.push(re({path:`/classes/${a}/blackboards/${L.id}`}).then(console.log(`Deleted blackboard /classes/${a}/blackboards/${L.id}`)))}await Promise.all(ne),await qe(te(W(),m+`rooms/${k.id}`))}const X=k=>se(k);function oe(k){he[k?"unshift":"push"](()=>{P=k,s(6,P)})}const ye=k=>p(k.id);return l.$$set=k=>{"classID"in k&&s(0,a=k.classID),"roomID"in k&&s(1,u=k.roomID),"$$scope"in k&&s(17,c=k.$$scope)},l.$$.update=()=>{if(l.$$.dirty[0]&1&&a&&(T(),fe(le,t=[],t),h(),U(),ue()),l.$$.dirty[0]&7&&u&&o.uid){const k=te(W(),`users/${o.uid}`);pe(k,{mostRecentClassAndRoomID:`/${a}/${u}`})}},[a,u,o,D,g,O,P,t,r,i,p,R,se,f,X,oe,ye,c]}class Ks extends de{constructor(e){super();me(this,e,Ls,zs,ce,{classID:0,roomID:1},null,[-1,-1])}}export{Ks as default,Qs as load};

var q=Object.defineProperty;var k=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var p=(n,t,s)=>t in n?q(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,g=(n,t)=>{for(var s in t||(t={}))N.call(t,s)&&p(n,s,t[s]);if(k)for(var s of k(t))V.call(t,s)&&p(n,s,t[s]);return n};import{S as x,i as H,s as M,e as A,k as O,c as b,a as R,d as h,n as Y,$ as S,b as w,Y as B,f as T,E as G,a7 as v,ae as J,a0 as D,a8 as K,ag as Q,A as X,a2 as z}from"../../chunks/vendor-0c80fc2b.js";import{r as Z,c as $}from"../../chunks/canvasHelpers-a780b7c6.js";function ee(n){let t,s,d,a,f,u,c;return{c(){t=A("canvas"),d=O(),a=A("audio"),this.h()},l(i){t=b(i,"CANVAS",{});var r=R(t);r.forEach(h),d=Y(i),a=b(i,"AUDIO",{src:!0,style:!0});var m=R(a);m.forEach(h),this.h()},h(){S(a.src,f=n[1])||w(a,"src",f),a.controls=!0,B(a,"width","100%")},m(i,r){T(i,t,r),n[6](t),T(i,d,r),T(i,a,r),n[7](a),u||(c=[G(s=Z.call(null,t,{strokesArray:n[0],handleResize:n[5]})),v(t,"resized",n[5]),v(a,"play",n[4])],u=!0)},p(i,[r]){s&&J(s.update)&&r&1&&s.update.call(null,{strokesArray:i[0],handleResize:i[5]}),r&2&&!S(a.src,f=i[1])&&w(a,"src",f)},i:D,o:D,d(i){i&&h(t),n[6](null),i&&h(d),i&&h(a),n[7](null),u=!1,K(c)}}}let te=1;function ne(n){return(n.endTime-n.startTime)/n.points.length}function se(n,t,s){let{strokesArray:d}=t,{audioDownloadURL:a}=t,f,u=0,c,i,r,m;Q(()=>{m&&clearTimeout(m)}),X(()=>{i=c.getContext("2d");const e=[];for(let o=0;o<d.length;o++)for(let l=1;l<d[o].points.length;l++){const _={strokeIndex:o,pointIndex:l};e.push(g({startTime:F(_)},_))}f=e.sort((o,l)=>o.startTime-l.startTime)});function F({strokeIndex:e,pointIndex:o}){const l=d[e];return l.startTime+(o-1)*ne(l)}function P(){u=0,i.clearRect(0,0,c.width,c.height),y()}function y(){if(!!r&&(U(),u<f.length)){const e=f[u],o=1e3*(e.startTime-r.currentTime);m=setTimeout(y,o/te)}}function U(){if(!r)return;const e=f[u];(!e||e.startTime>r.currentTime)&&(i.clearRect(0,0,c.width,c.height),u=0),C()}function C(){const{currentTime:e}=r;for(let o=u;o<f.length;o++){const l=f[o];if(l.startTime>e)break;L(l),u+=1}}function L({strokeIndex:e,pointIndex:o}){const l=d[e],j=l.lineWidth*(c.scrollWidth/1e3);$(l.points,o,l.isErasing,i,l.color,j,c)}function W(){return new Promise(async e=>{m?(u=0,this.syncStrokesToAudio()):this.renderFramesUntilCurrentTime(),e()})}function E(e){z[e?"unshift":"push"](()=>{c=e,s(2,c)})}function I(e){z[e?"unshift":"push"](()=>{r=e,s(3,r)})}return n.$$set=e=>{"strokesArray"in e&&s(0,d=e.strokesArray),"audioDownloadURL"in e&&s(1,a=e.audioDownloadURL)},[d,a,c,r,P,W,E,I]}class oe extends x{constructor(t){super();H(this,t,se,ee,M,{strokesArray:0,audioDownloadURL:1})}}export{oe as default};

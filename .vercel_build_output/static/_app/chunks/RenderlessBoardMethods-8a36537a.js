var Be=Object.defineProperty;var he=Object.getOwnPropertySymbols;var Ue=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var me=(s,e,t)=>e in s?Be(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,K=(s,e)=>{for(var t in e||(e={}))Ue.call(e,t)&&me(s,t,e[t]);if(he)for(var t of he(e))ze.call(e,t)&&me(s,t,e[t]);return s};import{S as Q,i as J,s as Z,a9 as Oe,k as N,e as W,n as M,c as j,b as y,aa as ie,f as E,a4 as B,ab as V,a as R,ac as q,d as b,K as v,L as F,ad as Ve,G as x,j as pe,t as _e,m as ge,g as ye,o as ke,H as $,I as ee,J as te,x as U,u as z,v as we,D as I,a5 as be,ae as Te,A as ae,_ as ce,M as qe,af as ve,U as Ge,O as G,N as ue,ag as Ae,ah as He,ai as Xe,Y as Ye,Q as Ke,aj as Qe,ak as Se}from"./vendor-60dbf49e.js";import{o as oe,u as Je,b as fe,a as De,c as Pe,g as Ze,d as Re,r as de}from"./store-620103ad.js";import{d as H,a as Ee}from"./canvas-e5ae1966.js";import{_ as xe}from"./preload-helper-ec9aa979.js";import{f as $e}from"./database-63c5af1e.js";function Fe(s,e,t){const o=s.slice();return o[7]=e[t],o}function Ce(s){let e,t,o,r,c,h=s[1].pencilColors,f=[];for(let n=0;n<h.length;n+=1)f[n]=Le(Fe(s,h,n));return{c(){for(let n=0;n<f.length;n+=1)f[n].c();e=N(),t=W("img"),this.h()},l(n){for(let d=0;d<f.length;d+=1)f[d].l(n);e=M(n),t=j(n,"IMG",{width:!0,height:!0,src:!0}),this.h()},h(){y(t,"width","40"),y(t,"height","30"),ie(t.src,o="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR30G9gEErDXNf8qxm0-vvSLs2zaE8V6v-pDqxNg-CUaoeORwmoosKPF-DC2SUG772Tm3A&usqp=CAU")||y(t,"src",o)},m(n,d){for(let l=0;l<f.length;l+=1)f[l].m(n,d);E(n,e,d),E(n,t,d),r||(c=B(t,"click",s[6]),r=!0)},p(n,d){if(d&2){h=n[1].pencilColors;let l;for(l=0;l<h.length;l+=1){const k=Fe(n,h,l);f[l]?f[l].p(k,d):(f[l]=Le(k),f[l].c(),f[l].m(e.parentNode,e))}for(;l<f.length;l+=1)f[l].d(1);f.length=h.length}},d(n){Ve(f,n),n&&b(e),n&&b(t),r=!1,c()}}}function Le(s){let e,t,o,r,c,h,f,n,d,l,k;function p(){return s[5](s[7])}return{c(){e=W("div"),t=V("svg"),o=V("g"),r=V("path"),c=V("polygon"),f=V("path"),n=V("path"),this.h()},l(a){e=j(a,"DIV",{style:!0});var i=R(e);t=q(i,"svg",{preserveAspectRatio:!0,version:!0,id:!0,xmlns:!0,"xmlns:xlink":!0,x:!0,y:!0,width:!0,height:!0,viewBox:!0,style:!0,"xml:space":!0,class:!0});var u=R(t);o=q(u,"g",{});var _=R(o);r=q(_,"path",{d:!0}),R(r).forEach(b),c=q(_,"polygon",{style:!0,points:!0}),R(c).forEach(b),f=q(_,"path",{style:!0,d:!0}),R(f).forEach(b),n=q(_,"path",{style:!0,d:!0}),R(n).forEach(b),_.forEach(b),u.forEach(b),i.forEach(b),this.h()},h(){y(r,"d",`M0,0v72.377c0,1.588,0.234,3.169,0.698,4.706l45.416,150.032C46.633,228.828,48.212,230,50,230s3.367-1.172,3.886-2.883\r
              L99.31,77.079c0.457-1.525,0.69-3.108,0.69-4.702V0.002`),y(c,"style",h=`fill: ${s[7]};`),y(c,"points","50,211.978 38.879,175.24 61.122,175.24"),v(f,"fill","#424242"),y(f,"d",`M63.581,167.118H36.42L8.765,75.761l10.924-9.63l12.5,11.015c1.54,1.353,3.835,1.35,5.375-0.002\r
                l12.468-11.007l12.464,11.005c1.54,1.357,3.839,1.357,5.377,0l12.465-11.005l10.9,9.623L63.581,167.118z`),y(n,"style",d=`fill: ${s[7]};`),y(n,"d",`M91.878,0v65.486l-8.852-7.813c-1.539-1.353-3.838-1.354-5.377,0.002L65.185,68.679L52.72,57.674\r
                c-1.539-1.356-3.838-1.354-5.377-0.002L34.871,68.683L22.375,57.67c-0.769-0.676-1.725-1.013-2.685-1.013\r
                c-0.959,0-1.919,0.339-2.685,1.013L8.121,65.5L8.098,0.024L91.878,0z`),y(t,"preserveAspectRatio","none"),y(t,"version","1.1"),y(t,"id","Layer_1"),y(t,"xmlns","http://www.w3.org/2000/svg"),y(t,"xmlns:xlink","http://www.w3.org/1999/xlink"),y(t,"x","0px"),y(t,"y","0px"),y(t,"width","16px"),y(t,"height","30px"),y(t,"viewBox","0 0 100 230"),v(t,"enable-background","new 0 0 100 230"),y(t,"xml:space","preserve"),y(t,"class","svelte-ln95yv"),v(e,"margin","0 8px")},m(a,i){E(a,e,i),F(e,t),F(t,o),F(o,r),F(o,c),F(o,f),F(o,n),l||(k=B(e,"click",p),l=!0)},p(a,i){s=a,i&2&&h!==(h=`fill: ${s[7]};`)&&y(c,"style",h),i&2&&d!==(d=`fill: ${s[7]};`)&&y(n,"style",d)},d(a){a&&b(e),l=!1,k()}}}function et(s){let e,t,o,r,c,h,f=Object.keys(s[1]).length>0,n,d;t=new Oe({props:{icons:!1,checked:!oe,style:"margin: 0 !important"}}),t.$on("click",s[4]);let l=f&&Ce(s);const k=s[3].default,p=x(k,s,s[2],null);return{c(){e=W("div"),pe(t.$$.fragment),o=N(),r=W("div"),c=_e("Touch draw"),h=N(),l&&l.c(),n=N(),p&&p.c(),this.h()},l(a){e=j(a,"DIV",{style:!0});var i=R(e);ge(t.$$.fragment,i),o=M(i),r=j(i,"DIV",{style:!0});var u=R(r);c=ye(u,"Touch draw"),u.forEach(b),h=M(i),l&&l.l(i),n=M(i),p&&p.l(i),i.forEach(b),this.h()},h(){v(r,"margin-left","6px"),v(r,"font-size","0.65rem"),v(r,"font-family","Roboto,sans-serif"),v(r,"color","white"),v(e,"position","absolute"),v(e,"display","flex"),v(e,"align-items","center"),v(e,"height","50px"),v(e,"right","0"),v(e,"top","0"),v(e,"bottom","auto"),v(e,"left","auto"),v(e,"z-index","100"),v(e,"background-color","grey"),v(e,"padding-left","10px")},m(a,i){E(a,e,i),ke(t,e,null),F(e,o),F(e,r),F(r,c),F(e,h),l&&l.m(e,null),F(e,n),p&&p.m(e,null),d=!0},p(a,[i]){i&2&&(f=Object.keys(a[1]).length>0),f?l?l.p(a,i):(l=Ce(a),l.c(),l.m(e,n)):l&&(l.d(1),l=null),p&&p.p&&(!d||i&4)&&$(p,k,a,a[2],d?te(k,a[2],i,null):ee(a[2]),null)},i(a){d||(U(t.$$.fragment,a),U(p,a),d=!0)},o(a){z(t.$$.fragment,a),z(p,a),d=!1},d(a){a&&b(e),we(t),l&&l.d(),p&&p.d(a)}}}function tt(s,e,t){let o,r;I(s,oe,l=>t(0,o=l)),I(s,Je,l=>t(1,r=l));let{$$slots:c={},$$scope:h}=e;const f=()=>oe.set(!o),n=l=>fe.set({type:"pencil",color:l,lineWidth:3}),d=()=>fe.set({type:"eraser",color:"",lineWidth:40});return s.$$set=l=>{"$$scope"in l&&t(2,h=l.$$scope)},[o,r,h,c,f,n,d]}class st extends Q{constructor(e){super();J(this,e,tt,et,Z,{})}}function ot(s){let e;const t=s[11].default,o=x(t,s,s[13],null);return{c(){o&&o.c()},l(r){o&&o.l(r)},m(r,c){o&&o.m(r,c),e=!0},p(r,c){o&&o.p&&(!e||c&8192)&&$(o,t,r,r[13],e?te(t,r[13],c,null):ee(r[13]),null)},i(r){e||(U(o,r),e=!0)},o(r){z(o,r),e=!1},d(r){o&&o.d(r)}}}function rt(s){let e,t,o,r,c,h,f;return e=new st({props:{$$slots:{default:[ot]},$$scope:{ctx:s}}}),{c(){pe(e.$$.fragment),t=N(),o=W("canvas"),this.h()},l(n){ge(e.$$.fragment,n),t=M(n),o=j(n,"CANVAS",{style:!0});var d=R(o);d.forEach(b),this.h()},h(){y(o,"style",r=`position: absolute; margin-top: 0; margin-left: 0; background-color: #2e3131; width: ${s[2]}; height: ${s[1]}`)},m(n,d){ke(e,n,d),E(n,t,d),E(n,o,d),s[12](o),c=!0,h||(f=[B(o,"touchstart",s[3]),B(o,"touchmove",s[4]),B(o,"touchend",s[5])],h=!0)},p(n,[d]){const l={};d&8192&&(l.$$scope={dirty:d,ctx:n}),e.$set(l),(!c||d&6&&r!==(r=`position: absolute; margin-top: 0; margin-left: 0; background-color: #2e3131; width: ${n[2]}; height: ${n[1]}`))&&y(o,"style",r)},i(n){c||(U(e.$$.fragment,n),c=!0)},o(n){z(e.$$.fragment,n),c=!1},d(n){we(e,n),n&&b(t),n&&b(o),s[12](null),h=!1,be(f)}}}function nt(s){return(s.endTime-s.startTime)/s.points.length}function lt(s,e,t){let o,r,c,h;I(s,De,m=>t(1,o=m)),I(s,Pe,m=>t(2,r=m)),I(s,fe,m=>t(17,c=m)),I(s,oe,m=>t(18,h=m));let{$$slots:f={},$$scope:n}=e,{strokesArray:d}=e,{currentTime:l=0}=e;const k=Te();let p,a=[],i,u=!1,_={x:-1,y:-1},w={points:[]},S;ae(()=>{t(8,p=i.getContext("2d"))});function L(m){if(m.touches.length>1)return;const A=m.touches[0].touchType==="stylus";if(h&&!A){console.log("error: cannot use finger during Apple Pencil mode");return}se(m,{isInitialContact:!0})}function P(m){if(!u)return;if(m.touches.length>1){console.log("touchmove ignored: only 1 finger allowed");return}const A=m.touches[0].touchType==="stylus";if(h&&!A){console.log("error: cannot use finger during Apple Pencil mode");return}se(m,{isInitialContact:!1})}function X(m){if(!u||m.touches.length>0)return;const A=m.changedTouches[0].touchType==="stylus";if(h&&!A){console.log("error: cannot use finger during Apple Pencil mode");return}le(w),u=!1}function re(m){u=!0,_={x:-1,y:-1},w={strokeNumber:d.length+1,startTime:Number(l.toFixed(1)),color:c.color,lineWidth:c.lineWidth,isErasing:c.type==="eraser",points:[],sessionID:"123"}}function se(m,{isInitialContact:A}){m.preventDefault(),A&&re();const C=g(m);ne(m,C)}function ne(m,A){w.points.push({unitX:parseFloat(A.x/i.width).toFixed(4),unitY:parseFloat(A.y/i.height).toFixed(4)}),_.x!==-1&&_.y!==-1&&Ee([T(_),T(A)],1,c.type==="eraser",p,c.color,c.lineWidth,i),_=A}function le(m){m.endTime=Number(l.toFixed(1)),m.id=Ze(),a.push(m),k("stroke-drawn",{newStroke:m})}function g(m){const{left:A,top:C}=i.getBoundingClientRect();return{x:m.touches[0].pageX-A-window.scrollX,y:m.touches[0].pageY-C-window.scrollY}}function T({x:m,y:A}){return{unitX:m/i.width,unitY:A/i.height}}function D(){p.clearRect(0,0,r,o)}function Y(m){ce[m?"unshift":"push"](()=>{i=m,t(0,i),t(8,p),t(2,r),t(1,o),t(6,d)})}return s.$$set=m=>{"strokesArray"in m&&t(6,d=m.strokesArray),"currentTime"in m&&t(7,l=m.currentTime),"$$scope"in m&&t(13,n=m.$$scope)},s.$$.update=()=>{if(s.$$.dirty&327&&p){t(0,i.width=r,i),t(0,i.height=o,i);for(const m of d)H(m,null,p,i)}if(s.$$.dirty&1857&&p){let m=a.length,A=d.length;if(m!==A)if(m<A)if(m===0){for(const C of d)H(C,null,p,i);t(9,a=[...d])}else for(let C=m;C<A;C++){const O=d[C];H(O,O.startTime!==O.endTime?nt(O):null,p,i),a.push(O)}else{let C=function(){D(),t(9,a=[]),_={x:-1,y:-1};for(const je of d)H(je,null,p,i)};(function(){console.log("debounced board reset"),S&&clearTimeout(S),t(10,S=setTimeout(C,1e3))})()}}},[i,o,r,L,P,X,d,l,p,a,S,f,Y,n]}class vt extends Q{constructor(e){super();J(this,e,lt,rt,Z,{strokesArray:6,currentTime:7})}}function Ie(s){let e,t,o,r;return{c(){e=W("span"),t=_e("play_circle"),this.h()},l(c){e=j(c,"SPAN",{class:!0,style:!0});var h=R(e);t=ye(h,"play_circle"),h.forEach(b),this.h()},h(){y(e,"class","material-icons overlay-center svelte-12w6n3q"),v(e,"color","white"),v(e,"font-size","6rem"),v(e,"width","120px"),v(e,"height","120px")},m(c,h){E(c,e,h),F(e,t),o||(r=B(e,"click",s[7]),o=!0)},p:qe,d(c){c&&b(e),o=!1,r()}}}function it(s){let e,t,o,r,c,h,f,n,d,l,k;const p=s[13].default,a=x(p,s,s[12],null);let i=!s[6]&&s[3]===!1&&Ie(s);return{c(){a&&a.c(),e=N(),i&&i.c(),t=N(),o=W("canvas"),c=N(),h=W("audio"),this.h()},l(u){a&&a.l(u),e=M(u),i&&i.l(u),t=M(u),o=j(u,"CANVAS",{style:!0});var _=R(o);_.forEach(b),c=M(u),h=j(u,"AUDIO",{src:!0,style:!0});var w=R(h);w.forEach(b),this.h()},h(){y(o,"style",r=`background-color: #2e3131; width: ${s[2]}; height: ${s[1]}`),ie(h.src,f=s[0])||y(h,"src",f),h.controls=!0,y(h,"style",n=`width: ${s[2]}px`)},m(u,_){a&&a.m(u,_),E(u,e,_),i&&i.m(u,_),E(u,t,_),E(u,o,_),s[14](o),E(u,c,_),E(u,h,_),s[15](h),d=!0,l||(k=[B(h,"play",s[8]),B(h,"seeking",s[9])],l=!0)},p(u,[_]){a&&a.p&&(!d||_&4096)&&$(a,p,u,u[12],d?te(p,u[12],_,null):ee(u[12]),null),!u[6]&&u[3]===!1?i?i.p(u,_):(i=Ie(u),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null),(!d||_&6&&r!==(r=`background-color: #2e3131; width: ${u[2]}; height: ${u[1]}`))&&y(o,"style",r),(!d||_&1&&!ie(h.src,f=u[0]))&&y(h,"src",f),(!d||_&4&&n!==(n=`width: ${u[2]}px`))&&y(h,"style",n)},i(u){d||(U(a,u),d=!0)},o(u){z(a,u),d=!1},d(u){a&&a.d(u),u&&b(e),i&&i.d(u),u&&b(t),u&&b(o),s[14](null),u&&b(c),u&&b(h),s[15](null),l=!1,be(k)}}}let at=1;function ct(s){return(s.endTime-s.startTime)/s.points.length}function ut(s,e,t){let o,r;I(s,De,g=>t(1,o=g)),I(s,Pe,g=>t(2,r=g));let{$$slots:c={},$$scope:h}=e,{strokesArray:f}=e,{audioDownloadURL:n}=e,d=!1,l,k,p,a,i,u;ve(()=>{u&&clearTimeout(u)}),ae(()=>{t(11,a=p.getContext("2d")),console.log("initial preview");for(const T of f)H(T,null,a,p);console.log("strokesArray =",f);const g=[];for(let T=0;T<f.length;T++)for(let D=1;D<f[T].points.length;D++){const Y={strokeIndex:T,pointIndex:D};g.push(K({startTime:w(Y)},Y))}l=g.sort((T,D)=>T.startTime-D.startTime)});function _(){i.play()}function w({strokeIndex:g,pointIndex:T}){const D=f[g];return D.startTime+(T-1)*ct(D)}function S(){t(3,d=!0),k=0,a.clearRect(0,0,r,o),L()}function L(){if(!!i&&(P(),k<l.length)){const g=l[k],T=1e3*(g.startTime-i.currentTime);t(6,u=setTimeout(L,T/at))}}function P(){if(!i)return;const g=l[k];(!g||g.startTime>i.currentTime)&&(a.clearRect(0,0,p.width,p.height),k=0),X()}function X(){const{currentTime:g}=i;for(let T=k;T<l.length;T++){const D=l[T];if(D.startTime>g)break;re(D),k+=1}}function re({strokeIndex:g,pointIndex:T}){const D=f[g],m=D.lineWidth*(p.scrollWidth/1e3);Ee(D.points,T,D.isErasing,a,D.color,m,p)}function se(){return new Promise(async g=>{if(u)k=0,P();else for(const T of f)H(T,null,a,p);g()})}function ne(g){ce[g?"unshift":"push"](()=>{p=g,t(4,p),t(11,a),t(2,r),t(1,o)})}function le(g){ce[g?"unshift":"push"](()=>{i=g,t(5,i)})}return s.$$set=g=>{"strokesArray"in g&&t(10,f=g.strokesArray),"audioDownloadURL"in g&&t(0,n=g.audioDownloadURL),"$$scope"in g&&t(12,h=g.$$scope)},s.$$.update=()=>{s.$$.dirty&2054&&a&&(t(4,p.width=r,p),t(4,p.height=o,p),se())},[n,o,r,d,p,i,u,_,S,P,f,a,h,c,ne,le]}class At extends Q{constructor(e){super();J(this,e,ut,it,Z,{strokesArray:10,audioDownloadURL:0})}}const ft=s=>({currentTime:s&1}),Ne=s=>({startRecording:s[1],stopRecording:s[2],currentTime:s[0]});function dt(s){let e;const t=s[4].default,o=x(t,s,s[3],Ne);return{c(){o&&o.c()},l(r){o&&o.l(r)},m(r,c){o&&o.m(r,c),e=!0},p(r,[c]){o&&o.p&&(!e||c&9)&&$(o,t,r,r[3],e?te(t,r[3],c,ft):ee(r[3]),Ne)},i(r){e||(U(o,r),e=!0)},o(r){z(o,r),e=!1},d(r){o&&o.d(r)}}}function ht(s,e,t){let o;I(s,Re,a=>t(8,o=a));let{$$slots:r={},$$scope:c}=e,h,f=0,n;ae(async()=>{window&&(h=await xe(()=>import("./index-f195c495.js"),[]),window.MediaRecorder=h.default)});const d=Te();let l=null;function k(){return new Promise(async a=>{if(!o){const u=await navigator.mediaDevices.getUserMedia({audio:!0});Re.set(u)}const i=o.clone();l=new MediaRecorder(i),l.start(),n=setInterval(()=>t(0,f+=.1),100),d("record-start"),de.set("mid_record"),a()})}function p(){return new Promise((a,i)=>{clearTimeout(n),de.set("post_record"),l.addEventListener("dataavailable",u=>{const _=u.data;d("record-end",{audioBlob:_}),a(),de.set("pre_record")}),l.stop();for(const u of l.stream.getTracks())u.stop()})}return s.$$set=a=>{"$$scope"in a&&t(3,c=a.$$scope)},[f,k,p,c,r]}class St extends Q{constructor(e){super();J(this,e,ht,dt,Z,{})}}const mt=s=>({boardDoc:s&4,isFetchingStrokes:s&2,strokesArray:s&1}),We=s=>({boardDoc:s[2],fetchStrokes:s[3],listenToStrokes:s[4],isFetchingStrokes:s[1],strokesArray:s[0],handleNewlyDrawnStroke:s[5],deleteAllStrokesFromDb:s[6]});function pt(s){let e;const t=s[10].default,o=x(t,s,s[9],We);return{c(){o&&o.c()},l(r){o&&o.l(r)},m(r,c){o&&o.m(r,c),e=!0},p(r,[c]){o&&o.p&&(!e||c&519)&&$(o,t,r,r[9],e?te(t,r[9],c,mt):ee(r[9]),We)},i(r){e||(U(o,r),e=!0)},o(r){z(o,r),e=!1},d(r){o&&o.d(r)}}}function Me(s){const e=K({id:s.id},s.data());return e.startTime=0,e.endTime=0,s.data().isErasing||(e.endTime+=.5),e}function _t(s,e,t){let{$$slots:o={},$$scope:r}=e,{dbPath:c}=e,{autoFetchStrokes:h=!1}=e,f,n=!1,d,l;const k=Ge(G(),`${c}/strokes`),p=ue(G(),c);Ae(p,w=>{t(2,d=K({id:w.id},w.data()))}),h&&a(),ve(()=>{l&&l()});async function a(){t(1,n=!0),t(0,f=await $e(c+"/strokes"))}async function i(){t(1,n=!0);const w=He(k,Xe("timestamp"));l=Ae(w,async S=>{S.docChanges().filter(P=>P.type==="removed").length>0?(t(0,f=[]),await Ye(),S.docs.length>0&&S.docs.forEach(P=>{f.push(Me(P))})):(f||(t(1,n=!1),t(0,f=[])),S.docs.length===f.length||S.docChanges().filter(P=>P.type==="added").forEach(P=>{t(0,f=[...f,Me(P.doc)])}))})}function u(w){f.push(w);try{Ke(ue(G(),`${c}/strokes/${w.id}`),K({timestamp:Qe()},w))}catch(S){alert(S)}}async function _(){const w=[];let S=Se(G()),L=0;for(const P of f){L>=500&&(w.push(S.commit()),S=Se(G()),L=0);const X=ue(G(),`${c}/strokes/${P.id}`);S.delete(X),L+=1}w.push(S.commit()),await Promise.all(w)}return s.$$set=w=>{"dbPath"in w&&t(7,c=w.dbPath),"autoFetchStrokes"in w&&t(8,h=w.autoFetchStrokes),"$$scope"in w&&t(9,r=w.$$scope)},[f,n,d,a,i,u,_,c,h,r,o]}class Dt extends Q{constructor(e){super();J(this,e,_t,pt,Z,{dbPath:7,autoFetchStrokes:8})}}export{vt as B,At as D,Dt as R,St as a};

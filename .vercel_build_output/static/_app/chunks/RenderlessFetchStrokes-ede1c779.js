var be=Object.defineProperty;var te=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var se=(t,e,s)=>e in t?be(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,j=(t,e)=>{for(var s in e||(e={}))ge.call(e,s)&&se(t,s,e[s]);if(te)for(var s of te(e))ke.call(e,s)&&se(t,s,e[s]);return t};import{S as Q,i as J,s as K,I as X,e as I,t as ye,c as L,a as v,g as we,d as P,b as F,M as D,f as z,N as C,a1 as q,O as De,k as B,n as H,W as oe,J as G,K as Y,L as Z,x,u as $,a2 as Se,F as ne,A as Pe,X as Re,a3 as ee,P as ae,Q as E,a4 as Te,a5 as le,a6 as Ae,a7 as Fe,a8 as Ie,a9 as Le}from"./vendor-271324cb.js";import{d as re,r as ve,a as ze}from"./canvas-74f91cf9.js";import{a as Ue,c as We}from"./navigation-7e077723.js";/* empty css                                                  */function ie(t){let e,s,n,o;return{c(){e=I("span"),s=ye("play_circle"),this.h()},l(l){e=L(l,"SPAN",{class:!0,style:!0});var d=v(e);s=we(d,"play_circle"),d.forEach(P),this.h()},h(){F(e,"class","material-icons overlay-center svelte-12w6n3q"),D(e,"color","white"),D(e,"font-size","6rem"),D(e,"width","120px"),D(e,"height","120px"),D(e,"z-index","5")},m(l,d){z(l,e,d),C(e,s),n||(o=q(e,"click",t[10]),n=!0)},p:De,d(l){l&&P(e),n=!1,o()}}}function Ce(t){let e,s,n,o,l,d,u,h,R,S,k,i,c,b,f,A,m;const T=t[18].default,w=X(T,t,t[17],null);let g=!t[8]&&t[6]===!1&&t[0]&&ie(t);return{c(){e=I("div"),w&&w.c(),s=B(),g&&g.c(),n=B(),o=I("div"),l=I("canvas"),u=B(),h=I("canvas"),S=B(),k=I("div"),i=I("audio"),this.h()},l(a){e=L(a,"DIV",{style:!0});var _=v(e);w&&w.l(_),_.forEach(P),s=H(a),g&&g.l(a),n=H(a),o=L(a,"DIV",{style:!0});var U=v(o);l=L(U,"CANVAS",{style:!0});var V=v(l);V.forEach(P),u=H(U),h=L(U,"CANVAS",{style:!0});var W=v(h);W.forEach(P),U.forEach(P),S=H(a),k=L(a,"DIV",{});var N=v(k);i=L(N,"AUDIO",{src:!0,style:!0});var M=v(i);M.forEach(P),N.forEach(P),this.h()},h(){D(e,"position","absolute"),D(e,"right","0"),D(e,"left","auto"),D(e,"top","0"),D(e,"bottom","auto"),D(e,"display","flex"),D(e,"padding-top","4px"),D(e,"padding-bottom","4px"),D(e,"z-index","5"),F(l,"style",d=`
      position: absolute; 
      z-index: 1; 
      margin-top: 0; 
      margin-left: 0; 
      width: ${t[5]}px; 
      height: ${t[4]}px; 
      background-color: transparent`),F(h,"style",R=`
      position: absolute;
      z-index: 0;
      top: 0;
      left: 0;
      display: block;
      width: ${t[5]}px; 
      height: ${t[4]}px;
      background-color: rgb(46, 49, 49);`),D(o,"position","relative"),oe(i.src,c=t[1])||F(i,"src",c),i.controls=!0,F(i,"style",b=`width: ${t[5]}px; height: 40px; position: absolute; bottom: 0; top: auto;`)},m(a,_){z(a,e,_),w&&w.m(e,null),z(a,s,_),g&&g.m(a,_),z(a,n,_),z(a,o,_),C(o,l),t[19](l),C(o,u),C(o,h),t[20](h),z(a,S,_),z(a,k,_),C(k,i),t[21](i),f=!0,A||(m=[q(l,"click",t[9]),q(i,"play",t[11]),q(i,"seeking",t[12])],A=!0)},p(a,[_]){w&&w.p&&(!f||_&131072)&&G(w,T,a,a[17],f?Z(T,a[17],_,null):Y(a[17]),null),!a[8]&&a[6]===!1&&a[0]?g?g.p(a,_):(g=ie(a),g.c(),g.m(n.parentNode,n)):g&&(g.d(1),g=null),(!f||_&48&&d!==(d=`
      position: absolute; 
      z-index: 1; 
      margin-top: 0; 
      margin-left: 0; 
      width: ${a[5]}px; 
      height: ${a[4]}px; 
      background-color: transparent`))&&F(l,"style",d),(!f||_&48&&R!==(R=`
      position: absolute;
      z-index: 0;
      top: 0;
      left: 0;
      display: block;
      width: ${a[5]}px; 
      height: ${a[4]}px;
      background-color: rgb(46, 49, 49);`))&&F(h,"style",R),(!f||_&2&&!oe(i.src,c=a[1]))&&F(i,"src",c),(!f||_&32&&b!==(b=`width: ${a[5]}px; height: 40px; position: absolute; bottom: 0; top: auto;`))&&F(i,"style",b)},i(a){f||(x(w,a),f=!0)},o(a){$(w,a),f=!1},d(a){a&&P(e),w&&w.d(a),a&&P(s),g&&g.d(a),a&&P(n),a&&P(o),t[19](null),t[20](null),a&&P(S),a&&P(k),t[21](null),A=!1,Se(m)}}}let ue=2;function Ee(t){return(t.endTime-t.startTime)/t.points.length}function Ve(t,e,s){let n,o;ne(t,Ue,r=>s(4,n=r)),ne(t,We,r=>s(5,o=r));let{$$slots:l={},$$scope:d}=e,{strokesArray:u}=e,{audioDownloadURL:h}=e,{backgroundImageDownloadURL:R}=e,S=!1,k,i,c,b,f,A,m,T;Pe(()=>{s(15,f=c.getContext("2d")),s(16,A=b.getContext("2d")),s(7,m.playbackRate=ue,m),s(7,m.onended=r=>s(6,S=!1),m),s(7,m.onpause=r=>s(6,S=!1),m)}),Re(()=>{T&&clearTimeout(T)});function w(){!T&&S===!1&&u?a():S?m.pause():m.play()}function g(){for(const p of u)re(p,null,f,c);const r=[];for(let p=0;p<u.length;p++)for(let y=1;y<u[p].points.length;y++){const O={strokeIndex:p,pointIndex:y};r.push(j({startTime:_(O)},O))}s(14,k=r.sort((p,y)=>p.startTime-y.startTime))}function a(){m.play()}function _({strokeIndex:r,pointIndex:p}){const y=u[r];return y.startTime+(p-1)*Ee(y)}function U(){s(6,S=!0),i=0,f.clearRect(0,0,o,n),V()}function V(){if(!!m&&(W(),i<k.length)){const r=k[i],p=1e3*(r.startTime-m.currentTime);s(8,T=setTimeout(V,p/ue))}}function W(){if(!m)return;const r=k[i];(!r||r.startTime>m.currentTime)&&(f.clearRect(0,0,c.width,c.height),i=0),N()}function N(){const{currentTime:r}=m;for(let p=i;p<k.length;p++){const y=k[p];if(y.startTime>r)break;M(y),i+=1}}function M({strokeIndex:r,pointIndex:p}){const y=u[r],pe=y.lineWidth*(c.scrollWidth/1e3);ze(y.points,p,y.isErasing,f,y.color,pe,c)}function de(){return new Promise(async r=>{if(T)i=0,W();else for(const p of u)re(p,null,f,c);r()})}function he(r){ee[r?"unshift":"push"](()=>{c=r,s(2,c),s(15,f),s(5,o),s(4,n),s(0,u)})}function me(r){ee[r?"unshift":"push"](()=>{b=r,s(3,b),s(15,f),s(5,o),s(4,n),s(0,u)})}function _e(r){ee[r?"unshift":"push"](()=>{m=r,s(7,m)})}return t.$$set=r=>{"strokesArray"in r&&s(0,u=r.strokesArray),"audioDownloadURL"in r&&s(1,h=r.audioDownloadURL),"backgroundImageDownloadURL"in r&&s(13,R=r.backgroundImageDownloadURL),"$$scope"in r&&s(17,d=r.$$scope)},t.$$.update=()=>{t.$$.dirty&32817&&f&&(s(2,c.width=o,c),s(2,c.height=n,c),s(3,b.width=o,b),s(3,b.height=n,b),u&&de()),t.$$.dirty&49153&&f&&u&&!k&&g(),t.$$.dirty&73740&&A&&(A.clearRect(0,0,b.scrollWidth,b.scrollHeight),ve(R,c,A))},[u,h,c,b,n,o,S,m,T,w,a,U,W,R,k,f,A,d,l,he,me,_e]}class Ye extends Q{constructor(e){super();J(this,e,Ve,Ce,K,{strokesArray:0,audioDownloadURL:1,backgroundImageDownloadURL:13})}}const Ne=t=>({boardDoc:t&1}),ce=t=>({boardDoc:t[0]});function je(t){let e;const s=t[3].default,n=X(s,t,t[2],ce);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,l){n&&n.m(o,l),e=!0},p(o,[l]){n&&n.p&&(!e||l&5)&&G(n,s,o,o[2],e?Z(s,o[2],l,Ne):Y(o[2]),ce)},i(o){e||(x(n,o),e=!0)},o(o){$(n,o),e=!1},d(o){n&&n.d(o)}}}function qe(t,e,s){let{$$slots:n={},$$scope:o}=e,{dbPath:l}=e,d;const u=ae(E(),l);return Te(u,h=>{s(0,d=j({id:h.id},h.data()))}),t.$$set=h=>{"dbPath"in h&&s(1,l=h.dbPath),"$$scope"in h&&s(2,o=h.$$scope)},[d,l,o,n]}class Ze extends Q{constructor(e){super();J(this,e,qe,je,K,{dbPath:1})}}async function Be({boardPath:t,strokesArray:e}){return new Promise(async s=>{const n=[];let o=le(E()),l=0;for(const d of e){l>=500&&(n.push(o.commit()),o=le(E()),l=0);const u=ae(E(),`${t}/strokes/${d.id}`);o.delete(u),l+=1}n.push(o.commit()),await Promise.all(n),e=[],s()})}const He=t=>({strokesArray:t&2,deleteAllStrokesFromDb:t&3}),fe=t=>({fetchStrokes:t[2],strokesArray:t[1],deleteAllStrokesFromDb:t[6]});function Me(t){let e;const s=t[5].default,n=X(s,t,t[4],fe);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,l){n&&n.m(o,l),e=!0},p(o,[l]){n&&n.p&&(!e||l&19)&&G(n,s,o,o[4],e?Z(s,o[4],l,He):Y(o[4]),fe)},i(o){e||(x(n,o),e=!0)},o(o){$(n,o),e=!1},d(o){n&&n.d(o)}}}function Oe(t,e,s){let{$$slots:n={},$$scope:o}=e,{dbPath:l}=e,{autoFetchStrokes:d=!1}=e,u;const h=Ae(E(),`${l}/strokes`),R=Fe(h,Ie("timestamp"));d&&S();async function S(){const i=await Le(R),c=[];for(const b of i.docs)c.push(j({id:b.id},b.data()));s(1,u=c)}const k=()=>Be({boardPath:l,strokesArray:u});return t.$$set=i=>{"dbPath"in i&&s(0,l=i.dbPath),"autoFetchStrokes"in i&&s(3,d=i.autoFetchStrokes),"$$scope"in i&&s(4,o=i.$$scope)},[l,u,S,d,o,n,k]}class xe extends Q{constructor(e){super();J(this,e,Oe,Me,K,{dbPath:0,autoFetchStrokes:3})}}export{Ye as D,Ze as R,xe as a};

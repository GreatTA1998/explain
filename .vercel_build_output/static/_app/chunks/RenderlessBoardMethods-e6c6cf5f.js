var Ue=Object.defineProperty;var ye=Object.getOwnPropertySymbols;var Ve=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var be=(o,e,t)=>e in o?Ue(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,Y=(o,e)=>{for(var t in e||(e={}))Ve.call(e,t)&&be(o,t,e[t]);if(ye)for(var t of ye(e))qe.call(e,t)&&be(o,t,e[t]);return o};import{S as Q,i as G,s as J,k as I,j as se,n as N,m as re,f as R,o as ne,x as P,u as E,v as le,r as we,w as Te,a6 as He,d as w,a0 as ue,G as K,e as Z,c as $,a as C,K as F,L as B,H as x,I as ee,J as te,D as M,t as fe,g as de,h as Xe,a7 as z,a8 as O,b as y,a9 as U,aa as Ae,ab as Se,A as he,Z as me,M as Ye,ac as ve,ad as De,U as Qe,O as V,N as pe,ae as Pe,af as Ge,ag as Je,a3 as Ke,Q as Ze,ah as $e,ai as Re}from"./vendor-9a185f2a.js";import{u as xe,o as _e,b as ge,c as Ee,a as Fe,g as et,d as Le,r as ke}from"./store-cdeddc4e.js";import{d as q,c as Ce}from"./canvas-257efe3e.js";import{_ as tt}from"./preload-helper-ec9aa979.js";import{f as ot}from"./database-9b97f416.js";function We(o,e,t){const r=o.slice();return r[7]=e[t],r}function Me(o){let e,t,r,s=o[0].pencilColors,l=[];for(let n=0;n<s.length;n+=1)l[n]=Be(We(o,s,n));const u=n=>E(l[n],1,1,()=>{l[n]=null});return t=new ue({props:{$$slots:{default:[rt]},$$scope:{ctx:o}}}),t.$on("click",o[4]),{c(){for(let n=0;n<l.length;n+=1)l[n].c();e=I(),se(t.$$.fragment)},l(n){for(let c=0;c<l.length;c+=1)l[c].l(n);e=N(n),re(t.$$.fragment,n)},m(n,c){for(let a=0;a<l.length;a+=1)l[a].m(n,c);R(n,e,c),ne(t,n,c),r=!0},p(n,c){if(c&1){s=n[0].pencilColors;let i;for(i=0;i<s.length;i+=1){const m=We(n,s,i);l[i]?(l[i].p(m,c),P(l[i],1)):(l[i]=Be(m),l[i].c(),P(l[i],1),l[i].m(e.parentNode,e))}for(we(),i=s.length;i<l.length;i+=1)u(i);Te()}const a={};c&64&&(a.$$scope={dirty:c,ctx:n}),t.$set(a)},i(n){if(!r){for(let c=0;c<s.length;c+=1)P(l[c]);P(t.$$.fragment,n),r=!0}},o(n){l=l.filter(Boolean);for(let c=0;c<l.length;c+=1)E(l[c]);E(t.$$.fragment,n),r=!1},d(n){He(l,n),n&&w(e),le(t,n)}}}function st(o){let e,t,r,s,l,u,n,c;return{c(){e=z("svg"),t=z("g"),r=z("path"),s=z("polygon"),u=z("path"),n=z("path"),this.h()},l(a){e=O(a,"svg",{preserveAspectRatio:!0,version:!0,id:!0,xmlns:!0,"xmlns:xlink":!0,x:!0,y:!0,width:!0,height:!0,viewBox:!0,style:!0,"xml:space":!0,class:!0});var i=C(e);t=O(i,"g",{});var m=C(t);r=O(m,"path",{d:!0}),C(r).forEach(w),s=O(m,"polygon",{style:!0,points:!0}),C(s).forEach(w),u=O(m,"path",{style:!0,d:!0}),C(u).forEach(w),n=O(m,"path",{style:!0,d:!0}),C(n).forEach(w),m.forEach(w),i.forEach(w),this.h()},h(){y(r,"d",`M0,0v72.377c0,1.588,0.234,3.169,0.698,4.706l45.416,150.032C46.633,228.828,48.212,230,50,230s3.367-1.172,3.886-2.883\r
              L99.31,77.079c0.457-1.525,0.69-3.108,0.69-4.702V0.002`),y(s,"style",l=`fill: ${o[7]};`),y(s,"points","50,211.978 38.879,175.24 61.122,175.24"),F(u,"fill","#424242"),y(u,"d",`M63.581,167.118H36.42L8.765,75.761l10.924-9.63l12.5,11.015c1.54,1.353,3.835,1.35,5.375-0.002\r
                l12.468-11.007l12.464,11.005c1.54,1.357,3.839,1.357,5.377,0l12.465-11.005l10.9,9.623L63.581,167.118z`),y(n,"style",c=`fill: ${o[7]};`),y(n,"d",`M91.878,0v65.486l-8.852-7.813c-1.539-1.353-3.838-1.354-5.377,0.002L65.185,68.679L52.72,57.674\r
                c-1.539-1.356-3.838-1.354-5.377-0.002L34.871,68.683L22.375,57.67c-0.769-0.676-1.725-1.013-2.685-1.013\r
                c-0.959,0-1.919,0.339-2.685,1.013L8.121,65.5L8.098,0.024L91.878,0z`),y(e,"preserveAspectRatio","none"),y(e,"version","1.1"),y(e,"id","Layer_1"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),y(e,"x","0px"),y(e,"y","0px"),y(e,"width","16px"),y(e,"height","30px"),y(e,"viewBox","0 0 100 230"),F(e,"enable-background","new 0 0 100 230"),y(e,"xml:space","preserve"),y(e,"class","svelte-ln95yv")},m(a,i){R(a,e,i),B(e,t),B(t,r),B(t,s),B(t,u),B(t,n)},p(a,i){i&1&&l!==(l=`fill: ${a[7]};`)&&y(s,"style",l),i&1&&c!==(c=`fill: ${a[7]};`)&&y(n,"style",c)},d(a){a&&w(e)}}}function Be(o){let e,t;function r(){return o[3](o[7])}return e=new ue({props:{$$slots:{default:[st]},$$scope:{ctx:o}}}),e.$on("click",r),{c(){se(e.$$.fragment)},l(s){re(e.$$.fragment,s)},m(s,l){ne(e,s,l),t=!0},p(s,l){o=s;const u={};l&65&&(u.$$scope={dirty:l,ctx:o}),e.$set(u)},i(s){t||(P(e.$$.fragment,s),t=!0)},o(s){E(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function rt(o){let e;return{c(){e=fe("Eraser")},l(t){e=de(t,"Eraser")},m(t,r){R(t,e,r)},d(t){t&&w(e)}}}function nt(o){let e=(o[1]?"Enable touch":"Disable touch")+"",t;return{c(){t=fe(e)},l(r){t=de(r,e)},m(r,s){R(r,t,s)},p(r,s){s&2&&e!==(e=(r[1]?"Enable touch":"Disable touch")+"")&&Xe(t,e)},d(r){r&&w(t)}}}function lt(o){let e,t=Object.keys(o[0]).length>0,r,s,l,u,n=t&&Me(o);s=new ue({props:{$$slots:{default:[nt]},$$scope:{ctx:o}}}),s.$on("click",o[5]);const c=o[2].default,a=K(c,o,o[6],null);return{c(){e=Z("div"),n&&n.c(),r=I(),se(s.$$.fragment),l=I(),a&&a.c(),this.h()},l(i){e=$(i,"DIV",{style:!0});var m=C(e);n&&n.l(m),r=N(m),re(s.$$.fragment,m),l=N(m),a&&a.l(m),m.forEach(w),this.h()},h(){F(e,"position","absolute"),F(e,"right","0"),F(e,"top","0"),F(e,"bottom","auto"),F(e,"left","auto"),F(e,"z-index","100"),F(e,"background-color","grey")},m(i,m){R(i,e,m),n&&n.m(e,null),B(e,r),ne(s,e,null),B(e,l),a&&a.m(e,null),u=!0},p(i,[m]){m&1&&(t=Object.keys(i[0]).length>0),t?n?(n.p(i,m),m&1&&P(n,1)):(n=Me(i),n.c(),P(n,1),n.m(e,r)):n&&(we(),E(n,1,1,()=>{n=null}),Te());const _={};m&66&&(_.$$scope={dirty:m,ctx:i}),s.$set(_),a&&a.p&&(!u||m&64)&&x(a,c,i,i[6],u?te(c,i[6],m,null):ee(i[6]),null)},i(i){u||(P(n),P(s.$$.fragment,i),P(a,i),u=!0)},o(i){E(n),E(s.$$.fragment,i),E(a,i),u=!1},d(i){i&&w(e),n&&n.d(),le(s),a&&a.d(i)}}}function it(o,e,t){let r,s;M(o,xe,i=>t(0,r=i)),M(o,_e,i=>t(1,s=i));let{$$slots:l={},$$scope:u}=e;const n=i=>ge.set({type:"pencil",color:i,lineWidth:3}),c=()=>ge.set({type:"eraser",color:"",lineWidth:40}),a=()=>_e.set(!s);return o.$$set=i=>{"$$scope"in i&&t(6,u=i.$$scope)},[r,s,l,n,c,a,u]}class at extends Q{constructor(e){super();G(this,e,it,lt,J,{})}}function ct(o){let e;const t=o[11].default,r=K(t,o,o[13],null);return{c(){r&&r.c()},l(s){r&&r.l(s)},m(s,l){r&&r.m(s,l),e=!0},p(s,l){r&&r.p&&(!e||l&8192)&&x(r,t,s,s[13],e?te(t,s[13],l,null):ee(s[13]),null)},i(s){e||(P(r,s),e=!0)},o(s){E(r,s),e=!1},d(s){r&&r.d(s)}}}function ut(o){let e,t,r,s,l,u,n;return e=new at({props:{$$slots:{default:[ct]},$$scope:{ctx:o}}}),{c(){se(e.$$.fragment),t=I(),r=Z("canvas"),this.h()},l(c){re(e.$$.fragment,c),t=N(c),r=$(c,"CANVAS",{style:!0});var a=C(r);a.forEach(w),this.h()},h(){y(r,"style",s=`position: absolute; margin-top: 0; margin-left: 0; background-color: #2e3131; width: ${o[2]}; height: ${o[1]}`)},m(c,a){ne(e,c,a),R(c,t,a),R(c,r,a),o[12](r),l=!0,u||(n=[U(r,"touchstart",o[3]),U(r,"touchmove",o[4]),U(r,"touchend",o[5])],u=!0)},p(c,[a]){const i={};a&8192&&(i.$$scope={dirty:a,ctx:c}),e.$set(i),(!l||a&6&&s!==(s=`position: absolute; margin-top: 0; margin-left: 0; background-color: #2e3131; width: ${c[2]}; height: ${c[1]}`))&&y(r,"style",s)},i(c){l||(P(e.$$.fragment,c),l=!0)},o(c){E(e.$$.fragment,c),l=!1},d(c){le(e,c),c&&w(t),c&&w(r),o[12](null),u=!1,Ae(n)}}}function ft(o){return(o.endTime-o.startTime)/o.points.length}function dt(o,e,t){let r,s,l,u;M(o,Ee,d=>t(1,r=d)),M(o,Fe,d=>t(2,s=d)),M(o,ge,d=>t(17,l=d)),M(o,_e,d=>t(18,u=d));let{$$slots:n={},$$scope:c}=e,{strokesArray:a}=e,{currentTime:i=0}=e;const m=Se();let _,p=[],h,f=!1,k={x:-1,y:-1},b={points:[]},S;he(()=>{t(8,_=h.getContext("2d"))});function W(d){if(d.touches.length>1)return;const A=d.touches[0].touchType==="stylus";if(u&&!A){console.log("error: cannot use finger during Apple Pencil mode");return}oe(d,{isInitialContact:!0})}function D(d){if(!f)return;if(d.touches.length>1){console.log("touchmove ignored: only 1 finger allowed");return}const A=d.touches[0].touchType==="stylus";if(u&&!A){console.log("error: cannot use finger during Apple Pencil mode");return}oe(d,{isInitialContact:!1})}function H(d){if(!f||d.touches.length>0)return;const A=d.changedTouches[0].touchType==="stylus";if(u&&!A){console.log("error: cannot use finger during Apple Pencil mode");return}ce(b),f=!1}function ie(d){f=!0,k={x:-1,y:-1},b={strokeNumber:a.length+1,startTime:Number(i.toFixed(1)),color:l.color,lineWidth:l.lineWidth,isErasing:l.type==="eraser",points:[],sessionID:"123"}}function oe(d,{isInitialContact:A}){d.preventDefault(),A&&ie();const L=g(d);ae(d,L)}function ae(d,A){b.points.push({unitX:parseFloat(A.x/h.width).toFixed(4),unitY:parseFloat(A.y/h.height).toFixed(4)}),k.x!==-1&&k.y!==-1&&Ce([T(k),T(A)],1,l.type==="eraser",_,l.color,l.lineWidth,h),k=A}function ce(d){d.endTime=Number(i.toFixed(1)),d.id=et(),p.push(d),m("stroke-drawn",{newStroke:d})}function g(d){const{left:A,top:L}=h.getBoundingClientRect();return{x:d.touches[0].pageX-A-window.scrollX,y:d.touches[0].pageY-L-window.scrollY}}function T({x:d,y:A}){return{unitX:d/h.width,unitY:A/h.height}}function v(){_.clearRect(0,0,s,r)}function X(d){me[d?"unshift":"push"](()=>{h=d,t(0,h),t(8,_),t(2,s),t(1,r),t(6,a)})}return o.$$set=d=>{"strokesArray"in d&&t(6,a=d.strokesArray),"currentTime"in d&&t(7,i=d.currentTime),"$$scope"in d&&t(13,c=d.$$scope)},o.$$.update=()=>{if(o.$$.dirty&327&&_){t(0,h.width=s,h),t(0,h.height=r,h);for(const d of a)q(d,null,_,h)}if(o.$$.dirty&1857&&_){let d=p.length,A=a.length;if(d!==A)if(d<A)if(d===0){for(const L of a)q(L,null,_,h);t(9,p=[...a])}else for(let L=d;L<A;L++){const j=a[L];q(j,j.startTime!==j.endTime?ft(j):null,_,h),p.push(j)}else{let L=function(){v(),t(9,p=[]),k={x:-1,y:-1};for(const Oe of a)q(Oe,null,_,h)};(function(){console.log("debounced board reset"),S&&clearTimeout(S),t(10,S=setTimeout(L,1e3))})()}}},[h,r,s,W,D,H,a,i,_,p,S,n,X,c]}class Et extends Q{constructor(e){super();G(this,e,dt,ut,J,{strokesArray:6,currentTime:7})}}function Ie(o){let e,t,r,s;return{c(){e=Z("span"),t=fe("play_circle"),this.h()},l(l){e=$(l,"SPAN",{class:!0,style:!0});var u=C(e);t=de(u,"play_circle"),u.forEach(w),this.h()},h(){y(e,"class","material-icons overlay-center svelte-12w6n3q"),F(e,"color","white"),F(e,"font-size","6rem"),F(e,"width","120px"),F(e,"height","120px")},m(l,u){R(l,e,u),B(e,t),r||(s=U(e,"click",o[7]),r=!0)},p:Ye,d(l){l&&w(e),r=!1,s()}}}function ht(o){let e,t,r,s,l,u,n,c,a,i,m;const _=o[13].default,p=K(_,o,o[12],null);let h=!o[6]&&o[3]===!1&&Ie(o);return{c(){p&&p.c(),e=I(),h&&h.c(),t=I(),r=Z("canvas"),l=I(),u=Z("audio"),this.h()},l(f){p&&p.l(f),e=N(f),h&&h.l(f),t=N(f),r=$(f,"CANVAS",{style:!0});var k=C(r);k.forEach(w),l=N(f),u=$(f,"AUDIO",{src:!0,style:!0});var b=C(u);b.forEach(w),this.h()},h(){y(r,"style",s=`background-color: #2e3131; width: ${o[2]}; height: ${o[1]}`),ve(u.src,n=o[0])||y(u,"src",n),u.controls=!0,y(u,"style",c=`width: ${o[2]}px`)},m(f,k){p&&p.m(f,k),R(f,e,k),h&&h.m(f,k),R(f,t,k),R(f,r,k),o[14](r),R(f,l,k),R(f,u,k),o[15](u),a=!0,i||(m=[U(u,"play",o[8]),U(u,"seeking",o[9])],i=!0)},p(f,[k]){p&&p.p&&(!a||k&4096)&&x(p,_,f,f[12],a?te(_,f[12],k,null):ee(f[12]),null),!f[6]&&f[3]===!1?h?h.p(f,k):(h=Ie(f),h.c(),h.m(t.parentNode,t)):h&&(h.d(1),h=null),(!a||k&6&&s!==(s=`background-color: #2e3131; width: ${f[2]}; height: ${f[1]}`))&&y(r,"style",s),(!a||k&1&&!ve(u.src,n=f[0]))&&y(u,"src",n),(!a||k&4&&c!==(c=`width: ${f[2]}px`))&&y(u,"style",c)},i(f){a||(P(p,f),a=!0)},o(f){E(p,f),a=!1},d(f){p&&p.d(f),f&&w(e),h&&h.d(f),f&&w(t),f&&w(r),o[14](null),f&&w(l),f&&w(u),o[15](null),i=!1,Ae(m)}}}let mt=1;function pt(o){return(o.endTime-o.startTime)/o.points.length}function _t(o,e,t){let r,s;M(o,Ee,g=>t(1,r=g)),M(o,Fe,g=>t(2,s=g));let{$$slots:l={},$$scope:u}=e,{strokesArray:n}=e,{audioDownloadURL:c}=e,a=!1,i,m,_,p,h,f;De(()=>{f&&clearTimeout(f)}),he(()=>{t(11,p=_.getContext("2d")),console.log("initial preview");for(const T of n)q(T,null,p,_);console.log("strokesArray =",n);const g=[];for(let T=0;T<n.length;T++)for(let v=1;v<n[T].points.length;v++){const X={strokeIndex:T,pointIndex:v};g.push(Y({startTime:b(X)},X))}i=g.sort((T,v)=>T.startTime-v.startTime)});function k(){h.play()}function b({strokeIndex:g,pointIndex:T}){const v=n[g];return v.startTime+(T-1)*pt(v)}function S(){t(3,a=!0),m=0,p.clearRect(0,0,s,r),W()}function W(){if(!!h&&(D(),m<i.length)){const g=i[m],T=1e3*(g.startTime-h.currentTime);t(6,f=setTimeout(W,T/mt))}}function D(){if(!h)return;const g=i[m];(!g||g.startTime>h.currentTime)&&(p.clearRect(0,0,_.width,_.height),m=0),H()}function H(){const{currentTime:g}=h;for(let T=m;T<i.length;T++){const v=i[T];if(v.startTime>g)break;ie(v),m+=1}}function ie({strokeIndex:g,pointIndex:T}){const v=n[g],d=v.lineWidth*(_.scrollWidth/1e3);Ce(v.points,T,v.isErasing,p,v.color,d,_)}function oe(){return new Promise(async g=>{if(f)m=0,D();else for(const T of n)q(T,null,p,_);g()})}function ae(g){me[g?"unshift":"push"](()=>{_=g,t(4,_),t(11,p),t(2,s),t(1,r)})}function ce(g){me[g?"unshift":"push"](()=>{h=g,t(5,h)})}return o.$$set=g=>{"strokesArray"in g&&t(10,n=g.strokesArray),"audioDownloadURL"in g&&t(0,c=g.audioDownloadURL),"$$scope"in g&&t(12,u=g.$$scope)},o.$$.update=()=>{o.$$.dirty&2054&&p&&(t(4,_.width=s,_),t(4,_.height=r,_),oe())},[c,r,s,a,_,h,f,k,S,D,n,p,u,l,ae,ce]}class Ft extends Q{constructor(e){super();G(this,e,_t,ht,J,{strokesArray:10,audioDownloadURL:0})}}const gt=o=>({currentTime:o&1}),Ne=o=>({startRecording:o[1],stopRecording:o[2],currentTime:o[0]});function kt(o){let e;const t=o[4].default,r=K(t,o,o[3],Ne);return{c(){r&&r.c()},l(s){r&&r.l(s)},m(s,l){r&&r.m(s,l),e=!0},p(s,[l]){r&&r.p&&(!e||l&9)&&x(r,t,s,s[3],e?te(t,s[3],l,gt):ee(s[3]),Ne)},i(s){e||(P(r,s),e=!0)},o(s){E(r,s),e=!1},d(s){r&&r.d(s)}}}function yt(o,e,t){let r;M(o,Le,p=>t(8,r=p));let{$$slots:s={},$$scope:l}=e,u,n=0,c;he(async()=>{window&&(u=await tt(()=>import("./index-f195c495.js"),[]),window.MediaRecorder=u.default,console.log("AudioRecorder initialized =",u),console.log(window.MediaRecorder))});const a=Se();let i=null;function m(){return new Promise(async p=>{if(!r){const f=await navigator.mediaDevices.getUserMedia({audio:!0});Le.set(f)}const h=r.clone();i=new MediaRecorder(h),i.start(),c=setInterval(()=>t(0,n+=.1),100),a("record-start"),ke.set("mid_record"),p()})}function _(){return new Promise((p,h)=>{clearTimeout(c),ke.set("post_record"),i.addEventListener("dataavailable",f=>{const k=f.data;a("record-end",{audioBlob:k}),p(),ke.set("pre_record")}),i.stop();for(const f of i.stream.getTracks())f.stop()})}return o.$$set=p=>{"$$scope"in p&&t(3,l=p.$$scope)},[n,m,_,l,s]}class Lt extends Q{constructor(e){super();G(this,e,yt,kt,J,{})}}const bt=o=>({boardDoc:o&4,isFetchingStrokes:o&2,strokesArray:o&1}),je=o=>({boardDoc:o[2],fetchStrokes:o[3],listenToStrokes:o[4],isFetchingStrokes:o[1],strokesArray:o[0],handleNewlyDrawnStroke:o[5],deleteAllStrokesFromDb:o[6]});function wt(o){let e;const t=o[10].default,r=K(t,o,o[9],je);return{c(){r&&r.c()},l(s){r&&r.l(s)},m(s,l){r&&r.m(s,l),e=!0},p(s,[l]){r&&r.p&&(!e||l&519)&&x(r,t,s,s[9],e?te(t,s[9],l,bt):ee(s[9]),je)},i(s){e||(P(r,s),e=!0)},o(s){E(r,s),e=!1},d(s){r&&r.d(s)}}}function ze(o){const e=Y({id:o.id},o.data());return e.startTime=0,e.endTime=0,o.data().isErasing||(e.endTime+=.5),e}function Tt(o,e,t){let{$$slots:r={},$$scope:s}=e,{dbPath:l}=e,{autoFetchStrokes:u=!1}=e,n,c=!1,a,i;const m=Qe(V(),`${l}/strokes`),_=pe(V(),l);Pe(_,b=>{t(2,a=Y({id:b.id},b.data()))}),u&&p(),De(()=>{i&&i()});async function p(){t(1,c=!0),t(0,n=await ot(l+"/strokes"))}async function h(){t(1,c=!0);const b=Ge(m,Je("timestamp"));i=Pe(b,async S=>{S.docChanges().filter(D=>D.type==="removed").length>0?(t(0,n=[]),await Ke(),S.docs.length>0&&S.docs.forEach(D=>{n.push(ze(D))})):(n||(t(1,c=!1),t(0,n=[])),S.docs.length===n.length||S.docChanges().filter(D=>D.type==="added").forEach(D=>{t(0,n=[...n,ze(D.doc)])}))})}function f(b){n.push(b);try{Ze(pe(V(),`${l}/strokes/${b.id}`),Y({timestamp:$e()},b))}catch(S){alert(S)}}async function k(){const b=[];let S=Re(V()),W=0;for(const D of n){W>=500&&(b.push(S.commit()),S=Re(V()),W=0);const H=pe(V(),`${l}/strokes/${D.id}`);S.delete(H),W+=1}b.push(S.commit()),await Promise.all(b)}return o.$$set=b=>{"dbPath"in b&&t(7,l=b.dbPath),"autoFetchStrokes"in b&&t(8,u=b.autoFetchStrokes),"$$scope"in b&&t(9,s=b.$$scope)},[n,c,a,p,h,f,k,l,u,s,r]}class Ct extends Q{constructor(e){super();G(this,e,Tt,wt,J,{dbPath:7,autoFetchStrokes:8})}}export{Et as B,Ft as D,Ct as R,Lt as a};

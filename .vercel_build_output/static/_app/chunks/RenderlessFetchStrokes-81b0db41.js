var ge=Object.defineProperty;var J=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var K=(t,s,e)=>s in t?ge(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e,z=(t,s)=>{for(var e in s||(s={}))pe.call(s,e)&&K(t,e,s[e]);if(J)for(var e of J(s))be.call(s,e)&&K(t,e,s[e]);return t};import{S as N,i as j,s as q,e as D,t as ke,c as P,a as R,g as ye,d as w,b as S,M as T,f as A,N as F,a1 as W,O as B,k as H,n as M,W as X,a2 as we,F as G,A as Se,X as De,a3 as O,I as Y,J as Z,K as x,L as $,x as ee,u as te,P as se,Q as I,a4 as Pe,a5 as Re,a6 as Te,a7 as Ae,a8 as Fe,a9 as oe}from"./vendor-17ac3c4e.js";import{d as ne,r as Ie,a as Le}from"./canvas-74f91cf9.js";import{a as Ue,c as ze}from"./navigation-1456a012.js";/* empty css                                                  */function ae(t){let s,e,o,n;return{c(){s=D("span"),e=ke("play_circle"),this.h()},l(a){s=P(a,"SPAN",{class:!0,style:!0});var f=R(s);e=ye(f,"play_circle"),f.forEach(w),this.h()},h(){S(s,"class","material-icons overlay-center svelte-12w6n3q"),T(s,"color","white"),T(s,"font-size","6rem"),T(s,"width","120px"),T(s,"height","120px"),T(s,"z-index","5")},m(a,f){A(a,s,f),F(s,e),o||(n=W(s,"click",t[10]),o=!0)},p:B,d(a){a&&w(s),o=!1,n()}}}function We(t){let s,e,o,n,a,f,y,m,p,c,d,u,h,b,r=!t[8]&&t[6]===!1&&t[0]&&ae(t);return{c(){r&&r.c(),s=H(),e=D("div"),o=D("canvas"),a=H(),f=D("canvas"),m=H(),p=D("div"),c=D("audio"),this.h()},l(i){r&&r.l(i),s=M(i),e=P(i,"DIV",{style:!0});var _=R(e);o=P(_,"CANVAS",{style:!0});var C=R(o);C.forEach(w),a=M(_),f=P(_,"CANVAS",{style:!0});var L=R(f);L.forEach(w),_.forEach(w),m=M(i),p=P(i,"DIV",{});var U=R(p);c=P(U,"AUDIO",{src:!0,style:!0});var E=R(c);E.forEach(w),U.forEach(w),this.h()},h(){S(o,"style",n=`
      position: absolute; 
      z-index: 1; 
      margin-top: 0; 
      margin-left: 0; 
      width: ${t[5]}px; 
      height: ${t[4]}px; 
      background-color: transparent`),S(f,"style",y=`
      position: absolute;
      z-index: 0;
      top: 0;
      left: 0;
      display: block;
      width: ${t[5]}px; 
      height: ${t[4]}px;
      background-color: rgb(46, 49, 49);`),T(e,"position","relative"),X(c.src,d=t[1])||S(c,"src",d),c.controls=!0,S(c,"style",u=`width: ${t[5]}px; height: 40px; position: absolute; bottom: 0; top: auto;`)},m(i,_){r&&r.m(i,_),A(i,s,_),A(i,e,_),F(e,o),t[17](o),F(e,a),F(e,f),t[18](f),A(i,m,_),A(i,p,_),F(p,c),t[19](c),h||(b=[W(o,"click",t[9]),W(c,"play",t[11]),W(c,"seeking",t[12])],h=!0)},p(i,[_]){!i[8]&&i[6]===!1&&i[0]?r?r.p(i,_):(r=ae(i),r.c(),r.m(s.parentNode,s)):r&&(r.d(1),r=null),_&48&&n!==(n=`
      position: absolute; 
      z-index: 1; 
      margin-top: 0; 
      margin-left: 0; 
      width: ${i[5]}px; 
      height: ${i[4]}px; 
      background-color: transparent`)&&S(o,"style",n),_&48&&y!==(y=`
      position: absolute;
      z-index: 0;
      top: 0;
      left: 0;
      display: block;
      width: ${i[5]}px; 
      height: ${i[4]}px;
      background-color: rgb(46, 49, 49);`)&&S(f,"style",y),_&2&&!X(c.src,d=i[1])&&S(c,"src",d),_&32&&u!==(u=`width: ${i[5]}px; height: 40px; position: absolute; bottom: 0; top: auto;`)&&S(c,"style",u)},i:B,o:B,d(i){r&&r.d(i),i&&w(s),i&&w(e),t[17](null),t[18](null),i&&w(m),i&&w(p),t[19](null),h=!1,we(b)}}}let re=2;function Ce(t){return(t.endTime-t.startTime)/t.points.length}function Ee(t,s,e){let o,n;G(t,Ue,l=>e(4,o=l)),G(t,ze,l=>e(5,n=l));let{strokesArray:a}=s,{audioDownloadURL:f}=s,{backgroundImageDownloadURL:y}=s,m=!1,p,c,d,u,h,b,r,i;Se(()=>{e(15,h=d.getContext("2d")),e(16,b=u.getContext("2d")),e(7,r.playbackRate=re,r),e(7,r.onended=l=>e(6,m=!1),r),e(7,r.onpause=l=>e(6,m=!1),r)}),De(()=>{i&&clearTimeout(i)});function _(){!i&&m===!1&&a?L():m?r.pause():r.play()}function C(){for(const g of a)ne(g,null,h,d);const l=[];for(let g=0;g<a.length;g++)for(let k=1;k<a[g].points.length;k++){const v={strokeIndex:g,pointIndex:k};l.push(z({startTime:U(v)},v))}e(14,p=l.sort((g,k)=>g.startTime-k.startTime))}function L(){r.play()}function U({strokeIndex:l,pointIndex:g}){const k=a[l];return k.startTime+(g-1)*Ce(k)}function E(){e(6,m=!0),c=0,h.clearRect(0,0,n,o),Q()}function Q(){if(!!r&&(V(),c<p.length)){const l=p[c],g=1e3*(l.startTime-r.currentTime);e(8,i=setTimeout(Q,g/re))}}function V(){if(!r)return;const l=p[c];(!l||l.startTime>r.currentTime)&&(h.clearRect(0,0,d.width,d.height),c=0),ce()}function ce(){const{currentTime:l}=r;for(let g=c;g<p.length;g++){const k=p[g];if(k.startTime>l)break;ue(k),c+=1}}function ue({strokeIndex:l,pointIndex:g}){const k=a[l],_e=k.lineWidth*(d.scrollWidth/1e3);Le(k.points,g,k.isErasing,h,k.color,_e,d)}function fe(){return new Promise(async l=>{if(i)c=0,V();else for(const g of a)ne(g,null,h,d);l()})}function de(l){O[l?"unshift":"push"](()=>{d=l,e(2,d),e(15,h),e(5,n),e(4,o),e(0,a)})}function he(l){O[l?"unshift":"push"](()=>{u=l,e(3,u),e(15,h),e(5,n),e(4,o),e(0,a)})}function me(l){O[l?"unshift":"push"](()=>{r=l,e(7,r)})}return t.$$set=l=>{"strokesArray"in l&&e(0,a=l.strokesArray),"audioDownloadURL"in l&&e(1,f=l.audioDownloadURL),"backgroundImageDownloadURL"in l&&e(13,y=l.backgroundImageDownloadURL)},t.$$.update=()=>{t.$$.dirty&32817&&h&&(e(2,d.width=n,d),e(2,d.height=o,d),e(3,u.width=n,u),e(3,u.height=o,u),a&&fe()),t.$$.dirty&49153&&h&&a&&!p&&C(),t.$$.dirty&73740&&b&&(b.clearRect(0,0,u.scrollWidth,u.scrollHeight),Ie(y,d,b))},[a,f,d,u,o,n,m,r,i,_,L,E,V,y,p,h,b,de,he,me]}class Ke extends N{constructor(s){super();j(this,s,Ee,We,q,{strokesArray:0,audioDownloadURL:1,backgroundImageDownloadURL:13})}}const Ve=t=>({boardDoc:t&1}),ie=t=>({boardDoc:t[0]});function ve(t){let s;const e=t[3].default,o=Y(e,t,t[2],ie);return{c(){o&&o.c()},l(n){o&&o.l(n)},m(n,a){o&&o.m(n,a),s=!0},p(n,[a]){o&&o.p&&(!s||a&5)&&Z(o,e,n,n[2],s?$(e,n[2],a,Ve):x(n[2]),ie)},i(n){s||(ee(o,n),s=!0)},o(n){te(o,n),s=!1},d(n){o&&o.d(n)}}}function Ne(t,s,e){let{$$slots:o={},$$scope:n}=s,{dbPath:a}=s,f;const y=se(I(),a);return Pe(y,m=>{e(0,f=z({id:m.id},m.data()))}),t.$$set=m=>{"dbPath"in m&&e(1,a=m.dbPath),"$$scope"in m&&e(2,n=m.$$scope)},[f,a,n,o]}class Xe extends N{constructor(s){super();j(this,s,Ne,ve,q,{dbPath:1})}}const je=t=>({strokesArray:t&1}),le=t=>({fetchStrokes:t[1],strokesArray:t[0],deleteAllStrokesFromDb:t[2]});function qe(t){let s;const e=t[6].default,o=Y(e,t,t[5],le);return{c(){o&&o.c()},l(n){o&&o.l(n)},m(n,a){o&&o.m(n,a),s=!0},p(n,[a]){o&&o.p&&(!s||a&33)&&Z(o,e,n,n[5],s?$(e,n[5],a,je):x(n[5]),le)},i(n){s||(ee(o,n),s=!0)},o(n){te(o,n),s=!1},d(n){o&&o.d(n)}}}function Be(t,s,e){let{$$slots:o={},$$scope:n}=s,{dbPath:a}=s,{autoFetchStrokes:f=!1}=s,y;const m=Re(I(),`${a}/strokes`),p=Te(m,Ae("timestamp"));f&&c();async function c(){const u=await Fe(p),h=[];for(const b of u.docs)h.push(z({id:b.id},b.data()));e(0,y=h)}async function d(){return new Promise(async u=>{const h=[];let b=oe(I()),r=0;for(const i of y){r>=500&&(h.push(b.commit()),b=oe(I()),r=0);const _=se(I(),`${a}/strokes/${i.id}`);b.delete(_),r+=1}h.push(b.commit()),await Promise.all(h),e(0,y=[]),u()})}return t.$$set=u=>{"dbPath"in u&&e(3,a=u.dbPath),"autoFetchStrokes"in u&&e(4,f=u.autoFetchStrokes),"$$scope"in u&&e(5,n=u.$$scope)},[y,c,d,a,f,n,o]}class Ge extends N{constructor(s){super();j(this,s,Be,qe,q,{dbPath:3,autoFetchStrokes:4})}}export{Ke as D,Xe as R,Ge as a};

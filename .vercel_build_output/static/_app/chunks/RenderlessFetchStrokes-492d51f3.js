var pe=Object.defineProperty;var te=Object.getOwnPropertySymbols;var be=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var se=(t,e,s)=>e in t?pe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,N=(t,e)=>{for(var s in e||(e={}))be.call(e,s)&&se(t,s,e[s]);if(te)for(var s of te(e))ge.call(e,s)&&se(t,s,e[s]);return t};import{S as O,i as J,s as K,H as Q,e as z,t as ke,c as I,a as L,g as ye,d as S,b as v,L as D,f as U,M as C,a3 as Z,N as we,k as q,n as B,U as oe,I as G,J as X,K as Y,x,u as $,a4 as De,E as ne,A as Se,a6 as Pe,Z as ee,O as ae,P as V,a7 as Te,a8 as Re,a9 as Ae,aa as ve,ab as Fe,ac as re}from"./vendor-3008e3e0.js";import{d as ie,r as ze,a as Ie}from"./canvas-10fde0b2.js";import{a as Le,c as Ue}from"./navigation-6099b534.js";function le(t){let e,s,n,o;return{c(){e=z("span"),s=ke("play_circle"),this.h()},l(i){e=I(i,"SPAN",{class:!0,style:!0});var p=L(e);s=ye(p,"play_circle"),p.forEach(S),this.h()},h(){v(e,"class","material-icons overlay-center svelte-12w6n3q"),D(e,"color","white"),D(e,"font-size","6rem"),D(e,"width","120px"),D(e,"height","120px"),D(e,"z-index","5")},m(i,p){U(i,e,p),C(e,s),n||(o=Z(e,"click",t[9]),n=!0)},p:we,d(i){i&&S(e),n=!1,o()}}}function Ee(t){let e,s,n,o,i,p,f,h,T,R,g,l,u,d,c,P,k;const A=t[17].default,w=Q(A,t,t[16],null);let b=!t[8]&&t[6]===!1&&t[0]&&le(t);return{c(){e=z("div"),w&&w.c(),s=q(),b&&b.c(),n=q(),o=z("div"),i=z("canvas"),f=q(),h=z("canvas"),R=q(),g=z("div"),l=z("audio"),this.h()},l(a){e=I(a,"DIV",{style:!0});var m=L(e);w&&w.l(m),m.forEach(S),s=B(a),b&&b.l(a),n=B(a),o=I(a,"DIV",{style:!0});var F=L(o);i=I(F,"CANVAS",{style:!0});var E=L(i);E.forEach(S),f=B(F),h=I(F,"CANVAS",{style:!0});var j=L(h);j.forEach(S),F.forEach(S),R=B(a),g=I(a,"DIV",{});var W=L(g);l=I(W,"AUDIO",{src:!0,style:!0});var H=L(l);H.forEach(S),W.forEach(S),this.h()},h(){D(e,"position","absolute"),D(e,"right","0"),D(e,"left","auto"),D(e,"top","0"),D(e,"bottom","auto"),D(e,"display","flex"),D(e,"padding-top","4px"),D(e,"padding-bottom","4px"),D(e,"z-index","5"),v(i,"style",p=`position: absolute; z-index: 1; z-index: 1; margin-top: 0; margin-left: 0; width: ${t[5]}px; height: ${t[4]}px; background-color: transparent`),v(h,"style",T=`position: absolute;
    top: 0;
    left: 0;
    z-index: 0;
    display: block;
    background-color: rgb(46, 49, 49); width: ${t[5]}px; height: ${t[4]}px`),D(o,"position","relative"),oe(l.src,u=t[1])||v(l,"src",u),l.controls=!0,v(l,"style",d=`width: ${t[5]}px; height: 40px; position: absolute; bottom: 0; top: auto;`)},m(a,m){U(a,e,m),w&&w.m(e,null),U(a,s,m),b&&b.m(a,m),U(a,n,m),U(a,o,m),C(o,i),t[18](i),C(o,f),C(o,h),t[19](h),U(a,R,m),U(a,g,m),C(g,l),t[20](l),c=!0,P||(k=[Z(l,"play",t[10]),Z(l,"seeking",t[11])],P=!0)},p(a,[m]){w&&w.p&&(!c||m&65536)&&G(w,A,a,a[16],c?Y(A,a[16],m,null):X(a[16]),null),!a[8]&&a[6]===!1&&a[0]?b?b.p(a,m):(b=le(a),b.c(),b.m(n.parentNode,n)):b&&(b.d(1),b=null),(!c||m&48&&p!==(p=`position: absolute; z-index: 1; z-index: 1; margin-top: 0; margin-left: 0; width: ${a[5]}px; height: ${a[4]}px; background-color: transparent`))&&v(i,"style",p),(!c||m&48&&T!==(T=`position: absolute;
    top: 0;
    left: 0;
    z-index: 0;
    display: block;
    background-color: rgb(46, 49, 49); width: ${a[5]}px; height: ${a[4]}px`))&&v(h,"style",T),(!c||m&2&&!oe(l.src,u=a[1]))&&v(l,"src",u),(!c||m&32&&d!==(d=`width: ${a[5]}px; height: 40px; position: absolute; bottom: 0; top: auto;`))&&v(l,"style",d)},i(a){c||(x(w,a),c=!0)},o(a){$(w,a),c=!1},d(a){a&&S(e),w&&w.d(a),a&&S(s),b&&b.d(a),a&&S(n),a&&S(o),t[18](null),t[19](null),a&&S(R),a&&S(g),t[20](null),P=!1,De(k)}}}let ue=2;function Ce(t){return(t.endTime-t.startTime)/t.points.length}function Ve(t,e,s){let n,o;ne(t,Le,r=>s(4,n=r)),ne(t,Ue,r=>s(5,o=r));let{$$slots:i={},$$scope:p}=e,{strokesArray:f}=e,{audioDownloadURL:h}=e,{backgroundImageDownloadURL:T}=e,R=!1,g,l,u,d,c,P,k,A;Se(()=>{s(14,c=u.getContext("2d")),s(15,P=d.getContext("2d"))}),Pe(()=>{A&&clearTimeout(A)});function w(){for(const _ of f)ie(_,null,c,u);const r=[];for(let _=0;_<f.length;_++)for(let y=1;y<f[_].points.length;y++){const M={strokeIndex:_,pointIndex:y};r.push(N({startTime:a(M)},M))}s(13,g=r.sort((_,y)=>_.startTime-y.startTime))}function b(){s(7,k.playbackRate=ue,k),k.play()}function a({strokeIndex:r,pointIndex:_}){const y=f[r];return y.startTime+(_-1)*Ce(y)}function m(){s(6,R=!0),l=0,c.clearRect(0,0,o,n),F()}function F(){if(!!k&&(E(),l<g.length)){const r=g[l],_=1e3*(r.startTime-k.currentTime);s(8,A=setTimeout(F,_/ue))}}function E(){if(!k)return;const r=g[l];(!r||r.startTime>k.currentTime)&&(c.clearRect(0,0,u.width,u.height),l=0),j()}function j(){const{currentTime:r}=k;for(let _=l;_<g.length;_++){const y=g[_];if(y.startTime>r)break;W(y),l+=1}}function W({strokeIndex:r,pointIndex:_}){const y=f[r],_e=y.lineWidth*(u.scrollWidth/1e3);Ie(y.points,_,y.isErasing,c,y.color,_e,u)}function H(){return new Promise(async r=>{if(A)l=0,E();else for(const _ of f)ie(_,null,c,u);r()})}function de(r){ee[r?"unshift":"push"](()=>{u=r,s(2,u),s(14,c),s(5,o),s(4,n),s(0,f)})}function he(r){ee[r?"unshift":"push"](()=>{d=r,s(3,d),s(14,c),s(5,o),s(4,n),s(0,f)})}function me(r){ee[r?"unshift":"push"](()=>{k=r,s(7,k)})}return t.$$set=r=>{"strokesArray"in r&&s(0,f=r.strokesArray),"audioDownloadURL"in r&&s(1,h=r.audioDownloadURL),"backgroundImageDownloadURL"in r&&s(12,T=r.backgroundImageDownloadURL),"$$scope"in r&&s(16,p=r.$$scope)},t.$$.update=()=>{t.$$.dirty&16433&&c&&(s(2,u.width=o,u),s(2,u.height=n,u),s(3,d.width=o,d),s(3,d.height=n,d),f&&H()),t.$$.dirty&24577&&c&&f&&!g&&w(),t.$$.dirty&36876&&P&&(P.clearRect(0,0,d.scrollWidth,d.scrollHeight),ze(T,u,P))},[f,h,u,d,n,o,R,k,A,b,m,E,T,g,c,P,p,i,de,he,me]}class Qe extends O{constructor(e){super();J(this,e,Ve,Ee,K,{strokesArray:0,audioDownloadURL:1,backgroundImageDownloadURL:12})}}const We=t=>({boardDoc:t&1}),ce=t=>({boardDoc:t[0]});function Ne(t){let e;const s=t[3].default,n=Q(s,t,t[2],ce);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,i){n&&n.m(o,i),e=!0},p(o,[i]){n&&n.p&&(!e||i&5)&&G(n,s,o,o[2],e?Y(s,o[2],i,We):X(o[2]),ce)},i(o){e||(x(n,o),e=!0)},o(o){$(n,o),e=!1},d(o){n&&n.d(o)}}}function qe(t,e,s){let{$$slots:n={},$$scope:o}=e,{dbPath:i}=e,p;const f=ae(V(),i);return Te(f,h=>{s(0,p=N({id:h.id},h.data()))}),t.$$set=h=>{"dbPath"in h&&s(1,i=h.dbPath),"$$scope"in h&&s(2,o=h.$$scope)},[p,i,o,n]}class Ze extends O{constructor(e){super();J(this,e,qe,Ne,K,{dbPath:1})}}const Be=t=>({strokesArray:t&1}),fe=t=>({fetchStrokes:t[1],strokesArray:t[0],deleteAllStrokesFromDb:t[2]});function je(t){let e;const s=t[6].default,n=Q(s,t,t[5],fe);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,i){n&&n.m(o,i),e=!0},p(o,[i]){n&&n.p&&(!e||i&33)&&G(n,s,o,o[5],e?Y(s,o[5],i,Be):X(o[5]),fe)},i(o){e||(x(n,o),e=!0)},o(o){$(n,o),e=!1},d(o){n&&n.d(o)}}}function He(t,e,s){let{$$slots:n={},$$scope:o}=e,{dbPath:i}=e,{autoFetchStrokes:p=!1}=e,f;const h=Re(V(),`${i}/strokes`),T=Ae(h,ve("timestamp"));p&&R();async function R(){const l=await Fe(T),u=[];for(const d of l.docs)u.push(N({id:d.id},d.data()));s(0,f=u)}async function g(){return new Promise(async l=>{const u=[];let d=re(V()),c=0;for(const P of f){c>=500&&(u.push(d.commit()),d=re(V()),c=0);const k=ae(V(),`${i}/strokes/${P.id}`);d.delete(k),c+=1}u.push(d.commit()),await Promise.all(u),s(0,f=[]),l()})}return t.$$set=l=>{"dbPath"in l&&s(3,i=l.dbPath),"autoFetchStrokes"in l&&s(4,p=l.autoFetchStrokes),"$$scope"in l&&s(5,o=l.$$scope)},[f,R,g,i,p,o,n]}class Ge extends O{constructor(e){super();J(this,e,He,je,K,{dbPath:3,autoFetchStrokes:4})}}export{Qe as D,Ze as R,Ge as a};

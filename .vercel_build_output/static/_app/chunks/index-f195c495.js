var v=()=>{let i=2,e=[];function o(n){let a=n.length,c=new Uint8Array(a*i);for(let r=0;r<a;r++){let t=r*i,s=n[r];s>1?s=1:s<-1&&(s=-1),s=s*32768,c[t]=s,c[t+1]=s>>8}e.push(c)}function u(n){let a=e.length?e[0].length:0,c=e.length*a,r=new Uint8Array(44+c),t=new DataView(r.buffer);t.setUint32(0,1380533830,!1),t.setUint32(4,36+c,!0),t.setUint32(8,1463899717,!1),t.setUint32(12,1718449184,!1),t.setUint32(16,16,!0),t.setUint16(20,1,!0),t.setUint16(22,1,!0),t.setUint32(24,n,!0),t.setUint32(28,n*i,!0),t.setUint16(32,i,!0),t.setUint16(34,8*i,!0),t.setUint32(36,1684108385,!1),t.setUint32(40,c,!0);for(let s=0;s<e.length;s++)r.set(e[s],s*a+44);e=[],postMessage(r.buffer,[r.buffer])}onmessage=n=>{n.data[0]==="encode"?o(n.data[1]):n.data[0]==="dump"&&u(n.data[1])}};let l=window.AudioContext||window.webkitAudioContext,m=i=>{let e=i.toString().replace(/^(\(\)\s*=>|function\s*\(\))\s*{/,"").replace(/}$/,""),o=new Blob([e]);return new Worker(URL.createObjectURL(o))},p=i=>{let e=new Event("error");return e.data=new Error("Wrong state for "+i),e},h;class d{constructor(e,o=null){this.stream=e,this.config=o,this.state="inactive",this.em=document.createDocumentFragment(),this.encoder=m(d.encoder);let u=this;this.encoder.addEventListener("message",n=>{let a=new Event("dataavailable");a.data=new Blob([n.data],{type:u.mimeType}),u.em.dispatchEvent(a),u.state==="inactive"&&u.em.dispatchEvent(new Event("stop"))})}start(e){if(this.state!=="inactive")return this.em.dispatchEvent(p("start"));this.state="recording",h||(h=new l(this.config)),this.clone=this.stream.clone(),this.input=h.createMediaStreamSource(this.clone),this.processor=h.createScriptProcessor(2048,1,1),this.encoder.postMessage(["init",h.sampleRate]),this.processor.onaudioprocess=o=>{this.state==="recording"&&this.encoder.postMessage(["encode",o.inputBuffer.getChannelData(0)])},this.input.connect(this.processor),this.processor.connect(h.destination),this.em.dispatchEvent(new Event("start")),e&&(this.slicing=setInterval(()=>{this.state==="recording"&&this.requestData()},e))}stop(){return this.state==="inactive"?this.em.dispatchEvent(p("stop")):(this.requestData(),this.state="inactive",this.clone.getTracks().forEach(e=>{e.stop()}),this.processor.disconnect(),this.input.disconnect(),clearInterval(this.slicing))}pause(){return this.state!=="recording"?this.em.dispatchEvent(p("pause")):(this.state="paused",this.em.dispatchEvent(new Event("pause")))}resume(){return this.state!=="paused"?this.em.dispatchEvent(p("resume")):(this.state="recording",this.em.dispatchEvent(new Event("resume")))}requestData(){return this.state==="inactive"?this.em.dispatchEvent(p("requestData")):this.encoder.postMessage(["dump",h.sampleRate])}addEventListener(...e){this.em.addEventListener(...e)}removeEventListener(...e){this.em.removeEventListener(...e)}dispatchEvent(...e){this.em.dispatchEvent(...e)}}d.prototype.mimeType="audio/wav";d.isTypeSupported=i=>d.prototype.mimeType===i;d.notSupported=!navigator.mediaDevices||!l;d.encoder=v;export{d as default};

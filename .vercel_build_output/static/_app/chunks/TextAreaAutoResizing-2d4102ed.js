var Ue=Object.defineProperty;var ke=Object.getOwnPropertySymbols;var Oe=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var be=(s,t,e)=>t in s?Ue(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,X=(s,t)=>{for(var e in t||(t={}))Oe.call(t,e)&&be(s,e,t[e]);if(ke)for(var e of ke(t))qe.call(t,e)&&be(s,e,t[e]);return s};import{S as G,i as H,s as Y,a7 as Xe,k as B,e as L,n as U,c as I,b as w,K as _,a8 as ce,U as oe,f as C,a2 as V,a9 as K,t as ue,a as E,aa as Q,d as T,g as fe,L as F,ab as Ge,G as $,j as we,m as ve,o as Te,ac as He,ad as Ye,h as Ke,H as ee,I as te,J as se,x as M,u as z,v as Ae,D as W,r as Qe,w as Je,a3 as de,ae as he,A as pe,Y as re,M as me,af as Se,ag as Ze,O as J,ah as xe,ai as $e,N as ge,aj as De,ak as et,W as tt,Q as st,al as ot,am as Re,$ as rt}from"./vendor-14b779e4.js";import{o as _e,u as nt,b as ne,a as Pe,c as ye,g as lt,d as Ee,r as Fe}from"./store-4d4357c6.js";import{d as Z,a as Ce}from"./canvas-5b7b0e82.js";import{_ as it}from"./preload-helper-ec9aa979.js";function Le(s,t,e){const o=s.slice();return o[8]=t[e],o}function Ie(s){let t,e,o,r,l,d=s[1].pencilColors,n=[];for(let i=0;i<d.length;i+=1)n[i]=Ne(Le(s,d,i));return{c(){for(let i=0;i<n.length;i+=1)n[i].c();t=B(),e=L("img"),this.h()},l(i){for(let f=0;f<n.length;f+=1)n[f].l(i);t=U(i),e=I(i,"IMG",{width:!0,height:!0,style:!0,src:!0,alt:!0,class:!0}),this.h()},h(){w(e,"width","46"),w(e,"height","33"),_(e,"margin-left","8px"),ce(e.src,o="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR30G9gEErDXNf8qxm0-vvSLs2zaE8V6v-pDqxNg-CUaoeORwmoosKPF-DC2SUG772Tm3A&usqp=CAU")||w(e,"src",o),w(e,"alt","eraser"),w(e,"class","svelte-1bgxyxs"),oe(e,"eraser-selected",s[2].type==="eraser")},m(i,f){for(let a=0;a<n.length;a+=1)n[a].m(i,f);C(i,t,f),C(i,e,f),r||(l=V(e,"click",s[7]),r=!0)},p(i,f){if(f&6){d=i[1].pencilColors;let a;for(a=0;a<d.length;a+=1){const y=Le(i,d,a);n[a]?n[a].p(y,f):(n[a]=Ne(y),n[a].c(),n[a].m(t.parentNode,t))}for(;a<n.length;a+=1)n[a].d(1);n.length=d.length}f&4&&oe(e,"eraser-selected",i[2].type==="eraser")},d(i){Ge(n,i),i&&T(t),i&&T(e),r=!1,l()}}}function Ne(s){let t,e,o,r,l,d,n,i,f,a,y,k;function b(){return s[6](s[8])}return{c(){t=L("div"),e=K("svg"),o=K("g"),r=K("path"),l=ue(`;\r
            `),d=K("polygon"),i=K("path"),f=K("path"),this.h()},l(c){t=I(c,"DIV",{style:!0,class:!0});var m=E(t);e=Q(m,"svg",{preserveAspectRatio:!0,version:!0,id:!0,xmlns:!0,"xmlns:xlink":!0,x:!0,y:!0,width:!0,height:!0,viewBox:!0,style:!0,"xml:space":!0,class:!0});var u=E(e);o=Q(u,"g",{});var h=E(o);r=Q(h,"path",{d:!0}),E(r).forEach(T),l=fe(h,`;\r
            `),d=Q(h,"polygon",{style:!0,points:!0}),E(d).forEach(T),i=Q(h,"path",{style:!0,d:!0}),E(i).forEach(T),f=Q(h,"path",{style:!0,d:!0}),E(f).forEach(T),h.forEach(T),u.forEach(T),m.forEach(T),this.h()},h(){w(r,"d",`M0,0v72.377c0,1.588,0.234,3.169,0.698,4.706l45.416,150.032C46.633,228.828,48.212,230,50,230s3.367-1.172,3.886-2.883\r
              L99.31,77.079c0.457-1.525,0.69-3.108,0.69-4.702V0.002`),w(d,"style",n=`fill: ${s[8]};`),w(d,"points","50,211.978 38.879,175.24 61.122,175.24"),_(i,"fill","#424242"),w(i,"d",`M63.581,167.118H36.42L8.765,75.761l10.924-9.63l12.5,11.015c1.54,1.353,3.835,1.35,5.375-0.002\r
                l12.468-11.007l12.464,11.005c1.54,1.357,3.839,1.357,5.377,0l12.465-11.005l10.9,9.623L63.581,167.118z`),w(f,"style",a=`fill: ${s[8]};`),w(f,"d",`M91.878,0v65.486l-8.852-7.813c-1.539-1.353-3.838-1.354-5.377,0.002L65.185,68.679L52.72,57.674\r
                c-1.539-1.356-3.838-1.354-5.377-0.002L34.871,68.683L22.375,57.67c-0.769-0.676-1.725-1.013-2.685-1.013\r
                c-0.959,0-1.919,0.339-2.685,1.013L8.121,65.5L8.098,0.024L91.878,0z`),w(e,"preserveAspectRatio","none"),w(e,"version","1.1"),w(e,"id","Layer_1"),w(e,"xmlns","http://www.w3.org/2000/svg"),w(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),w(e,"x","0px"),w(e,"y","0px"),w(e,"width","16px"),w(e,"height","30px"),w(e,"viewBox","0 0 100 230"),_(e,"enable-background","new 0 0 100 230"),w(e,"xml:space","preserve"),w(e,"class","svelte-1bgxyxs"),_(t,"margin","0 4px"),_(t,"width","30px"),_(t,"height","42px"),_(t,"border-radius","3px"),_(t,"align-items","center"),_(t,"display","flex"),_(t,"justify-content","center"),w(t,"class","svelte-1bgxyxs"),oe(t,"pencil-selected",s[2].color===s[8])},m(c,m){C(c,t,m),F(t,e),F(e,o),F(o,r),F(o,l),F(o,d),F(o,i),F(o,f),y||(k=V(t,"click",b),y=!0)},p(c,m){s=c,m&2&&n!==(n=`fill: ${s[8]};`)&&w(d,"style",n),m&2&&a!==(a=`fill: ${s[8]};`)&&w(f,"style",a),m&6&&oe(t,"pencil-selected",s[2].color===s[8])},d(c){c&&T(t),y=!1,k()}}}function at(s){let t,e,o,r,l,d=(s[0]?"No touch":"Touch draw")+"",n,i,f=Object.keys(s[1]).length>0,a,y,k,b;o=new Xe({props:{icons:!1,checked:!s[0],style:"margin: 0 !important"}});let c=f&&Ie(s);const m=s[5].default,u=$(m,s,s[4],null);return{c(){t=L("div"),e=L("div"),we(o.$$.fragment),r=B(),l=L("div"),n=ue(d),i=B(),c&&c.c(),a=B(),u&&u.c(),this.h()},l(h){t=I(h,"DIV",{style:!0});var g=E(t);e=I(g,"DIV",{style:!0});var A=E(e);ve(o.$$.fragment,A),r=U(A),l=I(A,"DIV",{style:!0});var S=E(l);n=fe(S,d),S.forEach(T),A.forEach(T),i=U(g),c&&c.l(g),a=U(g),u&&u.l(g),g.forEach(T),this.h()},h(){_(l,"margin-top","2px"),_(l,"font-size","0.55rem"),_(l,"font-family","Roboto,sans-serif"),_(l,"color","white"),_(e,"margin-right","10px"),_(e,"text-align","center"),_(t,"position","absolute"),_(t,"display","flex"),_(t,"align-items","center"),_(t,"height","50px"),_(t,"left","0"),_(t,"right","auto"),_(t,"top","0"),_(t,"bottom","auto"),_(t,"z-index","100"),_(t,"background-color","grey"),_(t,"padding-left","10px"),_(t,"border-radius","2px")},m(h,g){C(h,t,g),F(t,e),Te(o,e,null),F(e,r),F(e,l),F(l,n),F(t,i),c&&c.m(t,null),F(t,a),u&&u.m(t,null),y=!0,k||(b=V(e,"click",He(Ye(s[3]))),k=!0)},p(h,[g]){const A={};g&1&&(A.checked=!h[0]),o.$set(A),(!y||g&1)&&d!==(d=(h[0]?"No touch":"Touch draw")+"")&&Ke(n,d),g&2&&(f=Object.keys(h[1]).length>0),f?c?c.p(h,g):(c=Ie(h),c.c(),c.m(t,a)):c&&(c.d(1),c=null),u&&u.p&&(!y||g&16)&&ee(u,m,h,h[4],y?se(m,h[4],g,null):te(h[4]),null)},i(h){y||(M(o.$$.fragment,h),M(u,h),y=!0)},o(h){z(o.$$.fragment,h),z(u,h),y=!1},d(h){h&&T(t),Ae(o),c&&c.d(),u&&u.d(h),k=!1,b()}}}function ct(s,t,e){let o,r,l;W(s,_e,y=>e(0,o=y)),W(s,nt,y=>e(1,r=y)),W(s,ne,y=>e(2,l=y));let{$$slots:d={},$$scope:n}=t;function i(){_e.set(!o)}const f=y=>ne.set({type:"pencil",color:y,lineWidth:3}),a=()=>ne.set({type:"eraser",color:"",lineWidth:40});return s.$$set=y=>{"$$scope"in y&&e(4,n=y.$$scope)},[o,r,l,i,n,d,f,a]}class ut extends G{constructor(t){super();H(this,t,ct,at,Y,{})}}function We(s){let t,e;return t=new ut({props:{$$slots:{default:[ft]},$$scope:{ctx:s}}}),{c(){we(t.$$.fragment)},l(o){ve(t.$$.fragment,o)},m(o,r){Te(t,o,r),e=!0},p(o,r){const l={};r&8192&&(l.$$scope={dirty:r,ctx:o}),t.$set(l)},i(o){e||(M(t.$$.fragment,o),e=!0)},o(o){z(t.$$.fragment,o),e=!1},d(o){Ae(t,o)}}}function ft(s){let t;const e=s[11].default,o=$(e,s,s[13],null);return{c(){o&&o.c()},l(r){o&&o.l(r)},m(r,l){o&&o.m(r,l),t=!0},p(r,l){o&&o.p&&(!t||l&8192)&&ee(o,e,r,r[13],t?se(e,r[13],l,null):te(r[13]),null)},i(r){t||(M(o,r),t=!0)},o(r){z(o,r),t=!1},d(r){o&&o.d(r)}}}function dt(s){let t,e,o,r,l,d,n=s[0]&&We(s);return{c(){n&&n.c(),t=B(),e=L("canvas"),this.h()},l(i){n&&n.l(i),t=U(i),e=I(i,"CANVAS",{style:!0});var f=E(e);f.forEach(T),this.h()},h(){w(e,"style",o=`position: absolute; margin-top: 0; margin-left: 0; background-color: #2e3131; width: ${s[3]}; height: ${s[2]}`)},m(i,f){n&&n.m(i,f),C(i,t,f),C(i,e,f),s[12](e),r=!0,l||(d=[V(e,"touchstart",s[4]),V(e,"touchmove",s[5]),V(e,"touchend",s[6])],l=!0)},p(i,[f]){i[0]?n?(n.p(i,f),f&1&&M(n,1)):(n=We(i),n.c(),M(n,1),n.m(t.parentNode,t)):n&&(Qe(),z(n,1,1,()=>{n=null}),Je()),(!r||f&12&&o!==(o=`position: absolute; margin-top: 0; margin-left: 0; background-color: #2e3131; width: ${i[3]}; height: ${i[2]}`))&&w(e,"style",o)},i(i){r||(M(n),r=!0)},o(i){z(n),r=!1},d(i){n&&n.d(i),i&&T(t),i&&T(e),s[12](null),l=!1,de(d)}}}function ht(s){return(s.endTime-s.startTime)/s.points.length}function pt(s,t,e){let o,r,l,d;W(s,Pe,p=>e(2,o=p)),W(s,ye,p=>e(3,r=p)),W(s,ne,p=>e(17,l=p)),W(s,_e,p=>e(18,d=p));let{$$slots:n={},$$scope:i}=t,{strokesArray:f}=t,{currentTime:a=0}=t;const y=he();let k,b=[],c,m=!1,u={x:-1,y:-1},h={points:[]},g;pe(()=>{e(8,k=c.getContext("2d"))});function A(p){if(p.touches.length>1)return;const R=p.touches[0].touchType==="stylus";if(d&&!R){console.log("error: cannot use finger during Apple Pencil mode");return}O(p,{isInitialContact:!0})}function S(p){if(!m)return;if(p.touches.length>1){console.log("touchmove ignored: only 1 finger allowed");return}const R=p.touches[0].touchType==="stylus";if(d&&!R){console.log("error: cannot use finger during Apple Pencil mode");return}O(p,{isInitialContact:!1})}function j(p){if(!m||p.touches.length>0)return;const R=p.changedTouches[0].touchType==="stylus";if(d&&!R){console.log("error: cannot use finger during Apple Pencil mode");return}ie(h),m=!1}function x(p){m=!0,u={x:-1,y:-1},h={strokeNumber:f.length+1,startTime:Number(a.toFixed(1)),color:l.color,lineWidth:l.lineWidth,isErasing:l.type==="eraser",points:[],sessionID:"123"}}function O(p,{isInitialContact:R}){p.preventDefault(),R&&x();const N=ae(p);le(p,N)}function le(p,R){h.points.push({unitX:parseFloat(R.x/c.width).toFixed(4),unitY:parseFloat(R.y/c.height).toFixed(4)}),u.x!==-1&&u.y!==-1&&Ce([v(u),v(R)],1,l.type==="eraser",k,l.color,l.lineWidth,c),u=R}function ie(p){p.endTime=Number(a.toFixed(1)),p.id=lt(),b.push(p),y("stroke-drawn",{newStroke:p})}function ae(p){const{left:R,top:N}=c.getBoundingClientRect();return{x:p.touches[0].pageX-R-window.scrollX,y:p.touches[0].pageY-N-window.scrollY}}function v({x:p,y:R}){return{unitX:p/c.width,unitY:R/c.height}}function D(){k.clearRect(0,0,r,o)}function P(p){re[p?"unshift":"push"](()=>{c=p,e(1,c),e(8,k),e(3,r),e(2,o),e(0,f)})}return s.$$set=p=>{"strokesArray"in p&&e(0,f=p.strokesArray),"currentTime"in p&&e(7,a=p.currentTime),"$$scope"in p&&e(13,i=p.$$scope)},s.$$.update=()=>{if(s.$$.dirty&271&&k&&(e(1,c.width=r,c),e(1,c.height=o,c),f))for(const p of f)Z(p,null,k,c);if(s.$$.dirty&1795&&k&&f){let p=b.length,R=f.length;if(p!==R)if(p<R)if(p===0){for(const N of f)Z(N,null,k,c);e(9,b=[...f])}else for(let N=p;N<R;N++){const q=f[N];Z(q,q.startTime!==q.endTime?ht(q):null,k,c),b.push(q)}else{let N=function(){D(),e(9,b=[]),u={x:-1,y:-1};for(const Be of f)Z(Be,null,k,c)};(function(){console.log("debounced board reset"),g&&clearTimeout(g),e(10,g=setTimeout(N,1e3))})()}}},[f,c,o,r,A,S,j,a,k,b,g,n,P,i]}class Lt extends G{constructor(t){super();H(this,t,pt,dt,Y,{strokesArray:0,currentTime:7})}}function Ve(s){let t,e,o,r;return{c(){t=L("span"),e=ue("play_circle"),this.h()},l(l){t=I(l,"SPAN",{class:!0,style:!0});var d=E(t);e=fe(d,"play_circle"),d.forEach(T),this.h()},h(){w(t,"class","material-icons overlay-center svelte-12w6n3q"),_(t,"color","white"),_(t,"font-size","6rem"),_(t,"width","120px"),_(t,"height","120px")},m(l,d){C(l,t,d),F(t,e),o||(r=V(t,"click",s[8]),o=!0)},p:me,d(l){l&&T(t),o=!1,r()}}}function mt(s){let t,e,o,r,l,d,n,i,f,a,y,k;const b=s[14].default,c=$(b,s,s[13],null);let m=!s[7]&&s[4]===!1&&s[0]&&Ve(s);return{c(){t=L("div"),c&&c.c(),e=B(),m&&m.c(),o=B(),r=L("canvas"),d=B(),n=L("audio"),this.h()},l(u){t=I(u,"DIV",{style:!0});var h=E(t);c&&c.l(h),h.forEach(T),e=U(u),m&&m.l(u),o=U(u),r=I(u,"CANVAS",{style:!0});var g=E(r);g.forEach(T),d=U(u),n=I(u,"AUDIO",{src:!0,style:!0});var A=E(n);A.forEach(T),this.h()},h(){_(t,"position","absolute"),_(t,"right","0"),_(t,"left","auto"),_(t,"display","flex"),_(t,"padding-top","4px"),_(t,"padding-bottom","4px"),w(r,"style",l=`background-color: #2e3131; width: ${s[3]}; height: ${s[2]}`),ce(n.src,i=s[1])||w(n,"src",i),n.controls=!0,w(n,"style",f=`width: ${s[3]}px; height: 40px`)},m(u,h){C(u,t,h),c&&c.m(t,null),C(u,e,h),m&&m.m(u,h),C(u,o,h),C(u,r,h),s[15](r),C(u,d,h),C(u,n,h),s[16](n),a=!0,y||(k=[V(n,"play",s[9]),V(n,"seeking",s[10])],y=!0)},p(u,[h]){c&&c.p&&(!a||h&8192)&&ee(c,b,u,u[13],a?se(b,u[13],h,null):te(u[13]),null),!u[7]&&u[4]===!1&&u[0]?m?m.p(u,h):(m=Ve(u),m.c(),m.m(o.parentNode,o)):m&&(m.d(1),m=null),(!a||h&12&&l!==(l=`background-color: #2e3131; width: ${u[3]}; height: ${u[2]}`))&&w(r,"style",l),(!a||h&2&&!ce(n.src,i=u[1]))&&w(n,"src",i),(!a||h&8&&f!==(f=`width: ${u[3]}px; height: 40px`))&&w(n,"style",f)},i(u){a||(M(c,u),a=!0)},o(u){z(c,u),a=!1},d(u){u&&T(t),c&&c.d(u),u&&T(e),m&&m.d(u),u&&T(o),u&&T(r),s[15](null),u&&T(d),u&&T(n),s[16](null),y=!1,de(k)}}}let gt=1;function _t(s){return(s.endTime-s.startTime)/s.points.length}function yt(s,t,e){let o,r;W(s,Pe,v=>e(2,o=v)),W(s,ye,v=>e(3,r=v));let{$$slots:l={},$$scope:d}=t,{strokesArray:n}=t,{audioDownloadURL:i}=t,f=!1,a,y,k,b,c,m;pe(()=>{e(12,b=k.getContext("2d"))}),Se(()=>{m&&clearTimeout(m)});function u(){for(const D of n)Z(D,null,b,k);const v=[];for(let D=0;D<n.length;D++)for(let P=1;P<n[D].points.length;P++){const p={strokeIndex:D,pointIndex:P};v.push(X({startTime:g(p)},p))}e(11,a=v.sort((D,P)=>D.startTime-P.startTime))}function h(){c.play()}function g({strokeIndex:v,pointIndex:D}){const P=n[v];return P.startTime+(D-1)*_t(P)}function A(){e(4,f=!0),y=0,b.clearRect(0,0,r,o),S()}function S(){if(!!c&&(j(),y<a.length)){const v=a[y],D=1e3*(v.startTime-c.currentTime);e(7,m=setTimeout(S,D/gt))}}function j(){if(!c)return;const v=a[y];(!v||v.startTime>c.currentTime)&&(b.clearRect(0,0,k.width,k.height),y=0),x()}function x(){const{currentTime:v}=c;for(let D=y;D<a.length;D++){const P=a[D];if(P.startTime>v)break;O(P),y+=1}}function O({strokeIndex:v,pointIndex:D}){const P=n[v],R=P.lineWidth*(k.scrollWidth/1e3);Ce(P.points,D,P.isErasing,b,P.color,R,k)}function le(){return new Promise(async v=>{if(m)y=0,j();else for(const D of n)Z(D,null,b,k);v()})}function ie(v){re[v?"unshift":"push"](()=>{k=v,e(5,k),e(12,b),e(3,r),e(2,o),e(0,n)})}function ae(v){re[v?"unshift":"push"](()=>{c=v,e(6,c)})}return s.$$set=v=>{"strokesArray"in v&&e(0,n=v.strokesArray),"audioDownloadURL"in v&&e(1,i=v.audioDownloadURL),"$$scope"in v&&e(13,d=v.$$scope)},s.$$.update=()=>{s.$$.dirty&4109&&b&&(e(5,k.width=r,k),e(5,k.height=o,k),n&&le()),s.$$.dirty&6145&&b&&n&&!a&&u()},[n,i,o,r,f,k,c,m,h,A,j,a,b,d,l,ie,ae]}class It extends G{constructor(t){super();H(this,t,yt,mt,Y,{strokesArray:0,audioDownloadURL:1})}}const kt=s=>({currentTime:s&1}),Me=s=>({startRecording:s[1],stopRecording:s[2],currentTime:s[0]});function bt(s){let t;const e=s[4].default,o=$(e,s,s[3],Me);return{c(){o&&o.c()},l(r){o&&o.l(r)},m(r,l){o&&o.m(r,l),t=!0},p(r,[l]){o&&o.p&&(!t||l&9)&&ee(o,e,r,r[3],t?se(e,r[3],l,kt):te(r[3]),Me)},i(r){t||(M(o,r),t=!0)},o(r){z(o,r),t=!1},d(r){o&&o.d(r)}}}function wt(s,t,e){let o;W(s,Ee,b=>e(8,o=b));let{$$slots:r={},$$scope:l}=t,d,n=0,i;pe(async()=>{window&&(d=await it(()=>import("./index-f195c495.js"),[]),window.MediaRecorder=d.default)});const f=he();let a=null;function y(){return new Promise(async b=>{if(!o){const m=await navigator.mediaDevices.getUserMedia({audio:!0});Ee.set(m)}const c=o.clone();a=new MediaRecorder(c),a.start(),i=setInterval(()=>e(0,n+=.1),100),f("record-start"),Fe.set("mid_record"),b()})}function k(){return new Promise((b,c)=>{clearTimeout(i),Fe.set("post_record"),a.addEventListener("dataavailable",m=>{const u=m.data;f("record-end",{audioBlob:u}),b()}),a.stop();for(const m of a.stream.getTracks())m.stop()})}return s.$$set=b=>{"$$scope"in b&&e(3,l=b.$$scope)},[n,y,k,l,r]}class Nt extends G{constructor(t){super();H(this,t,wt,bt,Y,{})}}const vt=s=>({boardDoc:s&4,isFetchingStrokes:s&2,strokesArray:s&1}),je=s=>({boardDoc:s[2],fetchStrokes:s[3],listenToStrokes:s[4],isFetchingStrokes:s[1],strokesArray:s[0],handleNewlyDrawnStroke:s[5],deleteAllStrokesFromDb:s[6]});function Tt(s){let t;const e=s[10].default,o=$(e,s,s[9],je);return{c(){o&&o.c()},l(r){o&&o.l(r)},m(r,l){o&&o.m(r,l),t=!0},p(r,[l]){o&&o.p&&(!t||l&519)&&ee(o,e,r,r[9],t?se(e,r[9],l,vt):te(r[9]),je)},i(r){t||(M(o,r),t=!0)},o(r){z(o,r),t=!1},d(r){o&&o.d(r)}}}function ze(s){const t=X({id:s.id},s.data());return t.startTime=0,t.endTime=0,s.data().isErasing||(t.endTime+=.5),t}function At(s,t,e){let{$$slots:o={},$$scope:r}=t,{dbPath:l}=t,{autoFetchStrokes:d=!1}=t,n,i=!1,f,a;const y=Ze(J(),`${l}/strokes`),k=xe(y,$e("timestamp")),b=ge(J(),l);De(b,g=>{e(2,f=X({id:g.id},g.data()))}),d&&c(),Se(()=>{a&&a()});async function c(){if(n)return;e(1,i=!0);const g=await et(k),A=[];for(const S of g.docs)A.push(X({id:S.id},S.data()));e(0,n=A),e(1,i=!1)}async function m(){e(1,i=!0),a=De(k,async g=>{g.docChanges().filter(S=>S.type==="removed").length>0?(e(0,n=[]),await tt(),g.docs.length>0&&g.docs.forEach(S=>{n.push(ze(S))})):(n||(e(1,i=!1),e(0,n=[])),g.docs.length===n.length||g.docChanges().filter(S=>S.type==="added").forEach(S=>{e(0,n=[...n,ze(S.doc)])}))})}function u(g){n.push(g);try{st(ge(J(),`${l}/strokes/${g.id}`),X({timestamp:ot()},g))}catch(A){alert(A)}}async function h(){return new Promise(async g=>{const A=[];let S=Re(J()),j=0;for(const x of n){j>=500&&(A.push(S.commit()),S=Re(J()),j=0);const O=ge(J(),`${l}/strokes/${x.id}`);S.delete(O),j+=1}A.push(S.commit()),await Promise.all(A),e(0,n=[]),g()})}return s.$$set=g=>{"dbPath"in g&&e(7,l=g.dbPath),"autoFetchStrokes"in g&&e(8,d=g.autoFetchStrokes),"$$scope"in g&&e(9,r=g.$$scope)},[n,i,f,c,m,u,h,l,d,r,o]}class Wt extends G{constructor(t){super();H(this,t,At,Tt,Y,{dbPath:7,autoFetchStrokes:8})}}function St(s){let t,e,o,r;return{c(){t=L("div"),e=L("textarea"),this.h()},l(l){t=I(l,"DIV",{class:!0,style:!0});var d=E(t);e=I(d,"TEXTAREA",{style:!0,class:!0}),E(e).forEach(T),d.forEach(T),this.h()},h(){e.value=s[0],_(e,"box-sizing","border-box"),_(e,"width",s[2]+"px"),_(e,"padding","6px"),_(e,"border-radius","2px"),_(e,"font-family","Roboto, sans-serif"),_(e,"color","rgb(60 55 56 / 87%)"),w(e,"class","svelte-tv3wak"),w(t,"class","grow-wrap svelte-tv3wak"),_(t,"font-family","Roboto, sans-serif"),_(t,"margin","10px 0px")},m(l,d){C(l,t,d),F(t,e),s[6](t),o||(r=[V(e,"input",s[5]),rt(s[4].call(null,t))],o=!0)},p(l,[d]){d&1&&(e.value=l[0]),d&4&&_(e,"width",l[2]+"px")},i:me,o:me,d(l){l&&T(t),s[6](null),o=!1,de(r)}}}function Dt(s,t,e){let o;W(s,ye,a=>e(2,o=a));let{value:r}=t,l;const d=he();function n(a){a.dataset.replicatedValue=r}const i=a=>{e(1,l.dataset.replicatedValue=a.target.value,l),d("input",a.target.value)};function f(a){re[a?"unshift":"push"](()=>{l=a,e(1,l)})}return s.$$set=a=>{"value"in a&&e(0,r=a.value)},[r,l,o,d,n,i,f]}class Vt extends G{constructor(t){super();H(this,t,Dt,St,Y,{value:0})}}export{Lt as B,It as D,Wt as R,Vt as T,Nt as a};

var ye=Object.defineProperty;var ae=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var le=(s,e,t)=>e in s?ye(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,H=(s,e)=>{for(var t in e||(e={}))we.call(e,t)&&le(s,t,e[t]);if(ae)for(var t of ae(e))Se.call(e,t)&&le(s,t,e[t]);return s};import{S as Z,i as G,s as Y,X as De,I as x,e as E,t as $,c as L,a as z,g as ee,d as b,b as A,M as S,f as v,N as U,a2 as O,O as Pe,j as Re,k as N,m as Te,n as j,W as re,o as Ae,J as te,K as se,L as oe,x as Q,u as J,v as ve,a3 as Fe,F as ie,a4 as Ie,A as Ee,Z as Le,h as ze,a5 as ne,P as ce,Q as B,a6 as Ue,a7 as ue,a8 as Ve,a9 as We,aa as Ce,ab as Ne}from"./vendor-e2c30920.js";import{d as fe,r as je,a as qe}from"./canvas-9dadfeb6.js";import{c as Be,a as Me}from"./store-b8ea9b61.js";/* empty css                                                  */function He(s){let e,t,n,o,l;return{c(){e=E("div"),t=$(s[9]),n=$("x speed"),o=N(),l=E("span"),this.h()},l(i){e=L(i,"DIV",{style:!0});var c=z(e);t=ee(c,s[9]),n=ee(c,"x speed"),c.forEach(b),o=j(i),l=L(i,"SPAN",{class:!0}),z(l).forEach(b),this.h()},h(){S(e,"color","white"),A(l,"class","material-icons")},m(i,c){v(i,e,c),U(e,t),U(e,n),v(i,o,c),v(i,l,c)},p(i,c){c[0]&512&&ze(t,i[9])},d(i){i&&b(e),i&&b(o),i&&b(l)}}}function de(s){let e,t,n,o;return{c(){e=E("span"),t=$("play_circle"),this.h()},l(l){e=L(l,"SPAN",{class:!0,style:!0});var i=z(e);t=ee(i,"play_circle"),i.forEach(b),this.h()},h(){A(e,"class","material-icons overlay-center svelte-12w6n3q"),S(e,"color","white"),S(e,"font-size","6rem"),S(e,"width","120px"),S(e,"height","120px"),S(e,"z-index","5")},m(l,i){v(l,e,i),U(e,t),n||(o=O(e,"click",s[12]),n=!0)},p:Pe,d(l){l&&b(e),n=!1,o()}}}function Oe(s){let e,t,n,o,l,i,c,y,F,g,D,p,h,f,w,R,u,T,V;t=new De({props:{variant:"raised",style:"margin-left: 8px; padding-left: 8px; padding-right: 8px; background-color: rgba(255,255,255,0.5); color: white;",$$slots:{default:[He]},$$scope:{ctx:s}}}),t.$on("click",s[10]);const q=s[19].default,P=x(q,s,s[23],null);let k=!s[8]&&s[7]===!1&&s[0]&&de(s);return{c(){e=E("div"),Re(t.$$.fragment),n=N(),P&&P.c(),o=N(),k&&k.c(),l=N(),i=E("div"),c=E("canvas"),F=N(),g=E("canvas"),p=N(),h=E("div"),f=E("audio"),this.h()},l(a){e=L(a,"DIV",{style:!0});var d=z(e);Te(t.$$.fragment,d),n=j(d),P&&P.l(d),d.forEach(b),o=j(a),k&&k.l(a),l=j(a),i=L(a,"DIV",{style:!0});var I=z(i);c=L(I,"CANVAS",{style:!0});var K=z(c);K.forEach(b),F=j(I),g=L(I,"CANVAS",{style:!0});var M=z(g);M.forEach(b),I.forEach(b),p=j(a),h=L(a,"DIV",{});var W=z(h);f=L(W,"AUDIO",{src:!0,style:!0});var X=z(f);X.forEach(b),W.forEach(b),this.h()},h(){S(e,"position","absolute"),S(e,"left","0"),S(e,"right","auto"),S(e,"top","0"),S(e,"bottom","auto"),S(e,"display","flex"),S(e,"padding-top","8px"),S(e,"padding-bottom","4px"),S(e,"z-index","5"),A(c,"style",y=`
      position: absolute; 
      z-index: 1; 
      margin-top: 0; 
      margin-left: 0; 
      width: ${s[5]}px; 
      height: ${s[6]}px; 
      background-color: transparent`),A(g,"style",D=`
      position: absolute;
      z-index: 0;
      top: 0;
      left: 0;
      display: block;
      width: ${s[5]}px; 
      height: ${s[6]}px;
      background-color: rgb(46, 49, 49);`),S(i,"position","relative"),re(f.src,w=s[1])||A(f,"src",w),f.controls=!0,A(f,"style",R=`width: ${s[5]}px; height: 40px; position: absolute; bottom: 0; top: auto;`)},m(a,d){v(a,e,d),Ae(t,e,null),U(e,n),P&&P.m(e,null),v(a,o,d),k&&k.m(a,d),v(a,l,d),v(a,i,d),U(i,c),s[20](c),U(i,F),U(i,g),s[21](g),v(a,p,d),v(a,h,d),U(h,f),s[22](f),u=!0,T||(V=[O(c,"click",s[11]),O(f,"play",s[13]),O(f,"seeking",s[14])],T=!0)},p(a,d){const I={};d[0]&8389120&&(I.$$scope={dirty:d,ctx:a}),t.$set(I),P&&P.p&&(!u||d[0]&8388608)&&te(P,q,a,a[23],u?oe(q,a[23],d,null):se(a[23]),null),!a[8]&&a[7]===!1&&a[0]?k?k.p(a,d):(k=de(a),k.c(),k.m(l.parentNode,l)):k&&(k.d(1),k=null),(!u||d[0]&96&&y!==(y=`
      position: absolute; 
      z-index: 1; 
      margin-top: 0; 
      margin-left: 0; 
      width: ${a[5]}px; 
      height: ${a[6]}px; 
      background-color: transparent`))&&A(c,"style",y),(!u||d[0]&96&&D!==(D=`
      position: absolute;
      z-index: 0;
      top: 0;
      left: 0;
      display: block;
      width: ${a[5]}px; 
      height: ${a[6]}px;
      background-color: rgb(46, 49, 49);`))&&A(g,"style",D),(!u||d[0]&2&&!re(f.src,w=a[1]))&&A(f,"src",w),(!u||d[0]&32&&R!==(R=`width: ${a[5]}px; height: 40px; position: absolute; bottom: 0; top: auto;`))&&A(f,"style",R)},i(a){u||(Q(t.$$.fragment,a),Q(P,a),u=!0)},o(a){J(t.$$.fragment,a),J(P,a),u=!1},d(a){a&&b(e),ve(t),P&&P.d(a),a&&b(o),k&&k.d(a),a&&b(l),a&&b(i),s[20](null),s[21](null),a&&b(p),a&&b(h),s[22](null),T=!1,Fe(V)}}}function Qe(s){return(s.endTime-s.startTime)/s.points.length}function Je(s,e,t){let n,o;ie(s,Be,r=>t(5,n=r)),ie(s,Me,r=>t(6,o=r));let{$$slots:l={},$$scope:i}=e,{strokesArray:c}=e,{audioDownloadURL:y}=e,{backgroundImageDownloadURL:F}=e,g=!1,D,p,h,f,w,R,u,T,V=2;const q=Ie();Ee(()=>{t(17,w=h.getContext("2d")),t(18,R=f.getContext("2d")),t(4,u.playbackRate=V,u),t(4,u.onended=r=>t(7,g=!1),u),t(4,u.onpause=r=>t(7,g=!1),u)}),Le(()=>{T&&clearTimeout(T)});function P(){u.playbackRate===2?t(4,u.playbackRate=1,u):t(4,u.playbackRate=2,u)}function k(){!T&&g===!1&&c?d():g?u.pause():u.play()}function a(){for(const m of c)fe(m,null,w,h);const r=[];for(let m=0;m<c.length;m++)for(let _=1;_<c[m].points.length;_++){const C={strokeIndex:m,pointIndex:_};r.push(H({startTime:I(C)},C))}t(16,D=r.sort((m,_)=>m.startTime-_.startTime))}function d(){u.play()}function I({strokeIndex:r,pointIndex:m}){const _=c[r];return _.startTime+(m-1)*Qe(_)}function K(){t(7,g=!0),p=0,w.clearRect(0,0,n,o),M();const r=6e3;function m(){setTimeout(()=>{g&&(q("six-seconds-watched"),m())},r)}m()}function M(){if(!!u&&(W(),p<D.length)){const r=D[p],m=1e3*(r.startTime-u.currentTime);t(8,T=setTimeout(M,m/V))}}function W(){if(!u)return;const r=D[p];(!r||r.startTime>u.currentTime)&&(w.clearRect(0,0,h.width,h.height),p=0),X()}function X(){const{currentTime:r}=u;for(let m=p;m<D.length;m++){const _=D[m];if(_.startTime>r)break;pe(_),p+=1}}function pe({strokeIndex:r,pointIndex:m}){const _=c[r];let C;_.canvasWidth?C=_.lineWidth*(n/_.canvasWidth):C=_.lineWidth,qe(_.points,m,_.isErasing,w,_.color,C,h)}function _e(){return new Promise(async r=>{if(T)p=0,W();else for(const m of c)fe(m,null,w,h);r()})}function be(r){ne[r?"unshift":"push"](()=>{h=r,t(2,h),t(17,w),t(5,n),t(6,o),t(0,c)})}function ge(r){ne[r?"unshift":"push"](()=>{f=r,t(3,f),t(17,w),t(5,n),t(6,o),t(0,c)})}function ke(r){ne[r?"unshift":"push"](()=>{u=r,t(4,u)})}return s.$$set=r=>{"strokesArray"in r&&t(0,c=r.strokesArray),"audioDownloadURL"in r&&t(1,y=r.audioDownloadURL),"backgroundImageDownloadURL"in r&&t(15,F=r.backgroundImageDownloadURL),"$$scope"in r&&t(23,i=r.$$scope)},s.$$.update=()=>{s.$$.dirty[0]&131169&&w&&(t(2,h.width=n,h),t(2,h.height=o,h),t(3,f.width=n,f),t(3,f.height=o,f),c&&_e()),s.$$.dirty[0]&196609&&w&&c&&!D&&a(),s.$$.dirty[0]&294924&&R&&(R.clearRect(0,0,f.scrollWidth,f.scrollHeight),je(F,h,R)),s.$$.dirty[0]&16&&u&&t(9,V=u.playbackRate)},[c,y,h,f,u,n,o,g,T,V,P,k,d,K,W,F,D,w,R,l,be,ge,ke,i]}class at extends Z{constructor(e){super();G(this,e,Je,Oe,Y,{strokesArray:0,audioDownloadURL:1,backgroundImageDownloadURL:15},null,[-1,-1])}}const Ke=s=>({boardDoc:s&1}),he=s=>({boardDoc:s[0]});function Xe(s){let e;const t=s[3].default,n=x(t,s,s[2],he);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,l){n&&n.m(o,l),e=!0},p(o,[l]){n&&n.p&&(!e||l&5)&&te(n,t,o,o[2],e?oe(t,o[2],l,Ke):se(o[2]),he)},i(o){e||(Q(n,o),e=!0)},o(o){J(n,o),e=!1},d(o){n&&n.d(o)}}}function Ze(s,e,t){let{$$slots:n={},$$scope:o}=e,{dbPath:l}=e,i;const c=ce(B(),l);return Ue(c,y=>{t(0,i=H({id:y.id},y.data()))}),s.$$set=y=>{"dbPath"in y&&t(1,l=y.dbPath),"$$scope"in y&&t(2,o=y.$$scope)},[i,l,o,n]}class lt extends Z{constructor(e){super();G(this,e,Ze,Xe,Y,{dbPath:1})}}async function Ge({boardPath:s,strokesArray:e}){return new Promise(async t=>{const n=[];let o=ue(B()),l=0;for(const i of e){l>=500&&(n.push(o.commit()),o=ue(B()),l=0);const c=ce(B(),`${s}/strokes/${i.id}`);o.delete(c),l+=1}n.push(o.commit()),await Promise.all(n),e=[],t()})}const Ye=s=>({strokesArray:s&2,deleteAllStrokesFromDb:s&3}),me=s=>({fetchStrokes:s[2],strokesArray:s[1],deleteAllStrokesFromDb:s[6]});function xe(s){let e;const t=s[5].default,n=x(t,s,s[4],me);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,l){n&&n.m(o,l),e=!0},p(o,[l]){n&&n.p&&(!e||l&19)&&te(n,t,o,o[4],e?oe(t,o[4],l,Ye):se(o[4]),me)},i(o){e||(Q(n,o),e=!0)},o(o){J(n,o),e=!1},d(o){n&&n.d(o)}}}function $e(s,e,t){let{$$slots:n={},$$scope:o}=e,{dbPath:l}=e,{autoFetchStrokes:i=!1}=e,c;const y=Ve(B(),`${l}/strokes`),F=We(y,Ce("timestamp"));i&&g();async function g(){const p=await Ne(F),h=[];for(const f of p.docs)h.push(H({id:f.id},f.data()));t(1,c=h)}const D=()=>Ge({boardPath:l,strokesArray:c});return s.$$set=p=>{"dbPath"in p&&t(0,l=p.dbPath),"autoFetchStrokes"in p&&t(3,i=p.autoFetchStrokes),"$$scope"in p&&t(4,o=p.$$scope)},[l,c,g,i,o,n,D]}class rt extends Z{constructor(e){super();G(this,e,$e,xe,Y,{dbPath:0,autoFetchStrokes:3})}}export{at as D,lt as R,rt as a};

var pt=Object.defineProperty;var et=Object.getOwnPropertySymbols;var bt=Object.prototype.hasOwnProperty,gt=Object.prototype.propertyIsEnumerable;var st=(e,t,s)=>t in e?pt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,N=(e,t)=>{for(var s in t||(t={}))bt.call(t,s)&&st(e,s,t[s]);if(et)for(var s of et(t))gt.call(t,s)&&st(e,s,t[s]);return e};import{S as O,i as J,s as K,H as Q,e as z,t as kt,c as I,a as L,g as yt,d as S,b as v,L as D,f as U,M as W,a0 as G,N as wt,k as q,n as B,U as ot,I as X,J as Y,K as Z,x,u as $,a1 as Dt,E as nt,A as St,W as Pt,a2 as tt,O as at,P as C,a3 as Tt,a4 as Rt,a5 as At,a6 as vt,a7 as Ft,a8 as rt}from"./vendor-dda63b98.js";import{d as it,r as zt,a as It}from"./canvas-74f91cf9.js";import{c as Lt,a as Ut}from"./navigation-85f32556.js";function lt(e){let t,s,n,o;return{c(){t=z("span"),s=kt("play_circle"),this.h()},l(i){t=I(i,"SPAN",{class:!0,style:!0});var p=L(t);s=yt(p,"play_circle"),p.forEach(S),this.h()},h(){v(t,"class","material-icons overlay-center svelte-12w6n3q"),D(t,"color","white"),D(t,"font-size","6rem"),D(t,"width","120px"),D(t,"height","120px"),D(t,"z-index","5")},m(i,p){U(i,t,p),W(t,s),n||(o=G(t,"click",e[9]),n=!0)},p:wt,d(i){i&&S(t),n=!1,o()}}}function Et(e){let t,s,n,o,i,p,f,h,T,R,g,l,u,d,c,P,k;const A=e[17].default,w=Q(A,e,e[16],null);let b=!e[8]&&e[6]===!1&&e[0]&&lt(e);return{c(){t=z("div"),w&&w.c(),s=q(),b&&b.c(),n=q(),o=z("div"),i=z("canvas"),f=q(),h=z("canvas"),R=q(),g=z("div"),l=z("audio"),this.h()},l(a){t=I(a,"DIV",{style:!0});var m=L(t);w&&w.l(m),m.forEach(S),s=B(a),b&&b.l(a),n=B(a),o=I(a,"DIV",{style:!0});var F=L(o);i=I(F,"CANVAS",{style:!0});var E=L(i);E.forEach(S),f=B(F),h=I(F,"CANVAS",{style:!0});var j=L(h);j.forEach(S),F.forEach(S),R=B(a),g=I(a,"DIV",{});var V=L(g);l=I(V,"AUDIO",{src:!0,style:!0});var H=L(l);H.forEach(S),V.forEach(S),this.h()},h(){D(t,"position","absolute"),D(t,"right","0"),D(t,"left","auto"),D(t,"top","0"),D(t,"bottom","auto"),D(t,"display","flex"),D(t,"padding-top","4px"),D(t,"padding-bottom","4px"),D(t,"z-index","5"),v(i,"style",p=`position: absolute; z-index: 1; z-index: 1; margin-top: 0; margin-left: 0; width: ${e[5]}px; height: ${e[4]}px; background-color: transparent`),v(h,"style",T=`position: absolute;
    top: 0;
    left: 0;
    z-index: 0;
    display: block;
    background-color: rgb(46, 49, 49); width: ${e[5]}px; height: ${e[4]}px`),D(o,"position","relative"),ot(l.src,u=e[1])||v(l,"src",u),l.controls=!0,v(l,"style",d=`width: ${e[5]}px; height: 40px; position: absolute; bottom: 0; top: auto;`)},m(a,m){U(a,t,m),w&&w.m(t,null),U(a,s,m),b&&b.m(a,m),U(a,n,m),U(a,o,m),W(o,i),e[18](i),W(o,f),W(o,h),e[19](h),U(a,R,m),U(a,g,m),W(g,l),e[20](l),c=!0,P||(k=[G(l,"play",e[10]),G(l,"seeking",e[11])],P=!0)},p(a,[m]){w&&w.p&&(!c||m&65536)&&X(w,A,a,a[16],c?Z(A,a[16],m,null):Y(a[16]),null),!a[8]&&a[6]===!1&&a[0]?b?b.p(a,m):(b=lt(a),b.c(),b.m(n.parentNode,n)):b&&(b.d(1),b=null),(!c||m&48&&p!==(p=`position: absolute; z-index: 1; z-index: 1; margin-top: 0; margin-left: 0; width: ${a[5]}px; height: ${a[4]}px; background-color: transparent`))&&v(i,"style",p),(!c||m&48&&T!==(T=`position: absolute;
    top: 0;
    left: 0;
    z-index: 0;
    display: block;
    background-color: rgb(46, 49, 49); width: ${a[5]}px; height: ${a[4]}px`))&&v(h,"style",T),(!c||m&2&&!ot(l.src,u=a[1]))&&v(l,"src",u),(!c||m&32&&d!==(d=`width: ${a[5]}px; height: 40px; position: absolute; bottom: 0; top: auto;`))&&v(l,"style",d)},i(a){c||(x(w,a),c=!0)},o(a){$(w,a),c=!1},d(a){a&&S(t),w&&w.d(a),a&&S(s),b&&b.d(a),a&&S(n),a&&S(o),e[18](null),e[19](null),a&&S(R),a&&S(g),e[20](null),P=!1,Dt(k)}}}let ut=2;function Wt(e){return(e.endTime-e.startTime)/e.points.length}function Ct(e,t,s){let n,o;nt(e,Lt,r=>s(4,n=r)),nt(e,Ut,r=>s(5,o=r));let{$$slots:i={},$$scope:p}=t,{strokesArray:f}=t,{audioDownloadURL:h}=t,{backgroundImageDownloadURL:T}=t,R=!1,g,l,u,d,c,P,k,A;St(()=>{s(14,c=u.getContext("2d")),s(15,P=d.getContext("2d"))}),Pt(()=>{A&&clearTimeout(A)});function w(){for(const _ of f)it(_,null,c,u);const r=[];for(let _=0;_<f.length;_++)for(let y=1;y<f[_].points.length;y++){const M={strokeIndex:_,pointIndex:y};r.push(N({startTime:a(M)},M))}s(13,g=r.sort((_,y)=>_.startTime-y.startTime))}function b(){s(7,k.playbackRate=ut,k),k.play()}function a({strokeIndex:r,pointIndex:_}){const y=f[r];return y.startTime+(_-1)*Wt(y)}function m(){s(6,R=!0),l=0,c.clearRect(0,0,o,n),F()}function F(){if(!!k&&(E(),l<g.length)){const r=g[l],_=1e3*(r.startTime-k.currentTime);s(8,A=setTimeout(F,_/ut))}}function E(){if(!k)return;const r=g[l];(!r||r.startTime>k.currentTime)&&(c.clearRect(0,0,u.width,u.height),l=0),j()}function j(){const{currentTime:r}=k;for(let _=l;_<g.length;_++){const y=g[_];if(y.startTime>r)break;V(y),l+=1}}function V({strokeIndex:r,pointIndex:_}){const y=f[r],_t=y.lineWidth*(u.scrollWidth/1e3);It(y.points,_,y.isErasing,c,y.color,_t,u)}function H(){return new Promise(async r=>{if(A)l=0,E();else for(const _ of f)it(_,null,c,u);r()})}function dt(r){tt[r?"unshift":"push"](()=>{u=r,s(2,u),s(14,c),s(5,o),s(4,n),s(0,f)})}function ht(r){tt[r?"unshift":"push"](()=>{d=r,s(3,d),s(14,c),s(5,o),s(4,n),s(0,f)})}function mt(r){tt[r?"unshift":"push"](()=>{k=r,s(7,k)})}return e.$$set=r=>{"strokesArray"in r&&s(0,f=r.strokesArray),"audioDownloadURL"in r&&s(1,h=r.audioDownloadURL),"backgroundImageDownloadURL"in r&&s(12,T=r.backgroundImageDownloadURL),"$$scope"in r&&s(16,p=r.$$scope)},e.$$.update=()=>{e.$$.dirty&16433&&c&&(s(2,u.width=o,u),s(2,u.height=n,u),s(3,d.width=o,d),s(3,d.height=n,d),f&&H()),e.$$.dirty&24577&&c&&f&&!g&&w(),e.$$.dirty&36876&&P&&(P.clearRect(0,0,d.scrollWidth,d.scrollHeight),zt(T,u,P))},[f,h,u,d,n,o,R,k,A,b,m,E,T,g,c,P,p,i,dt,ht,mt]}class Qt extends O{constructor(t){super();J(this,t,Ct,Et,K,{strokesArray:0,audioDownloadURL:1,backgroundImageDownloadURL:12})}}const Vt=e=>({boardDoc:e&1}),ct=e=>({boardDoc:e[0]});function Nt(e){let t;const s=e[3].default,n=Q(s,e,e[2],ct);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,i){n&&n.m(o,i),t=!0},p(o,[i]){n&&n.p&&(!t||i&5)&&X(n,s,o,o[2],t?Z(s,o[2],i,Vt):Y(o[2]),ct)},i(o){t||(x(n,o),t=!0)},o(o){$(n,o),t=!1},d(o){n&&n.d(o)}}}function qt(e,t,s){let{$$slots:n={},$$scope:o}=t,{dbPath:i}=t,p;const f=at(C(),i);return Tt(f,h=>{s(0,p=N({id:h.id},h.data()))}),e.$$set=h=>{"dbPath"in h&&s(1,i=h.dbPath),"$$scope"in h&&s(2,o=h.$$scope)},[p,i,o,n]}class Gt extends O{constructor(t){super();J(this,t,qt,Nt,K,{dbPath:1})}}const Bt=e=>({strokesArray:e&1}),ft=e=>({fetchStrokes:e[1],strokesArray:e[0],deleteAllStrokesFromDb:e[2]});function jt(e){let t;const s=e[6].default,n=Q(s,e,e[5],ft);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,i){n&&n.m(o,i),t=!0},p(o,[i]){n&&n.p&&(!t||i&33)&&X(n,s,o,o[5],t?Z(s,o[5],i,Bt):Y(o[5]),ft)},i(o){t||(x(n,o),t=!0)},o(o){$(n,o),t=!1},d(o){n&&n.d(o)}}}function Ht(e,t,s){let{$$slots:n={},$$scope:o}=t,{dbPath:i}=t,{autoFetchStrokes:p=!1}=t,f;const h=Rt(C(),`${i}/strokes`),T=At(h,vt("timestamp"));p&&R();async function R(){const l=await Ft(T),u=[];for(const d of l.docs)u.push(N({id:d.id},d.data()));s(0,f=u)}async function g(){return new Promise(async l=>{const u=[];let d=rt(C()),c=0;for(const P of f){c>=500&&(u.push(d.commit()),d=rt(C()),c=0);const k=at(C(),`${i}/strokes/${P.id}`);d.delete(k),c+=1}u.push(d.commit()),await Promise.all(u),s(0,f=[]),l()})}return e.$$set=l=>{"dbPath"in l&&s(3,i=l.dbPath),"autoFetchStrokes"in l&&s(4,p=l.autoFetchStrokes),"$$scope"in l&&s(5,o=l.$$scope)},[f,R,g,i,p,o,n]}class Xt extends O{constructor(t){super();J(this,t,Ht,jt,K,{dbPath:3,autoFetchStrokes:4})}}export{Qt as D,Gt as R,Xt as a};
